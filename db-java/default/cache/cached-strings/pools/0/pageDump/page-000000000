{...}p0p6p7p8p9p10None.classObject.classClass<>.classXWorkBasicConverter.classBigInteger.classString.classFooBarConverter.classAddressTypeConverter.classPersonTypeConverter.classCat.classIllegalArgumentException.classp11p12p13JRHtmlExporterParameter.classJRCsvExporterParameter.classJRExporterParameter.classJRPdfExporterParameter.classJRXlsAbstractExporterParameter.classJExcelApiExporterParameter.classAssertCheck.classAssertConstraintSetCheck.classAssertFieldConstraintsCheck.classAssertValidCheck.classLengthCheck.classMinLengthCheck.classNotBlankCheck.classNotEmptyCheck.classNotNullCheck.classFieldMatchValidator.classSpringJUnit4ClassRunner.classContextLoader.classStringBridge.classPattern.classp14NoConverter.classNoValidator.classNoValueValidator<>.classCommaParameterSplitter.classimport Actionimport Resultimport Resultsstmtsuper(...)import EqualsBuilderimport HashCodeBuilderimport ToStringBuilderString id, ...;String clientName, ...;int amount, ...;...=...this.idthis.clientNamethis.amountOrder rhs(...)...... == ...... != ...getClass(...)isEquals(...)append(...)rhs.amountrhs.clientNamenew EqualsBuilder(...)rhs.idtoHashCode(...)new HashCodeBuilder(...)toString(...)new ToStringBuilder(...)import Collectionimport LogManagerimport Loggerimport DefaultHttpHeadersimport HttpHeadersimport ModelDrivenimport Validateableimport ValidationAwareSupportLogger log, ...;Order model, ...;Collection<Order> list, ...;OrdersService ordersService, ...;// GET /orders/1new DefaultHttpHeaders(...)// GET /ordersgetAll(...)disableCaching(...)// GET /orders/1/edit// GET /orders/newnew Order(...)// GET /orders/1/deleteConfirm// DELETE /orders/1debug(...)remove(...)addActionMessage(...)// POST /orderssave(...)setLocationId(...)getId(...)// PUT /orders/1... || ...getClientName(...)length(...)addFieldError(...)this.modelget(...)...?...:...new OrdersService(...)getLogger(...)OrdersController.classimport java.util.*Map<String,Order> orders, ...;int nextId, ...;new ArrayList<Order>(...)values(...)setId(...)valueOf(...)...++put(...)new HashMap<String,Order>(...)import WebTestCasesetBaseUrl(...)getTestContext(...)getBaseUrl(...)beginAt(...)assertTextPresent(...)assertTextNotPresent(...)String portgetProperty(...)... + ...import HttpClientimport PostMethodimport StringRequestEntityimport IOExceptionimport FailingHttpStatusCodeExceptionsetWorkingForm(...)setTextField(...)submit(...)assertLinkNotPresentWithText(...)FailingHttpStatusCodeException exassertTextFieldEquals(...)HttpClient clientnew HttpClient(...)PostMethod methodnew PostMethod(...)setRequestEntity(...)new StringRequestEntity(...)executeMethod(...)assertEquals(...)getStatusCode(...)assertTrue(...)startsWith(...)getValue(...)getResponseHeader(...)releaseConnection(...)String responsegetResponseBodyAsString(...)contains(...)assertNull(...)// ignore;import ActionSupportimport DateFormatimport Calendarimport Dateimport GregorianCalendar/** <code>DateAction</code> */DateFormat DF, ...;Date now, ...;Date past, ...;Date future, ...;Date after, ...;Date before, ...;format(...)new Date(...)/** @return */Calendar calgetInstance(...)getTime(...)roll(...)Calendar.DATE-...Calendar.HOURCalendar.YEARgetDateTimeInstance(...)DateFormat.MEDIUM/* $Id$ ... */import Category//START SNIPPET: treeExampleDynamicJavaSelectedlong nodeId, ...;Category currentCategory, ...;this.nodeIdgetById(...)getName(...)import ArrayListimport LinkedHashMapimport Listimport MapList<> _favouriteCartoonCharactersKeys, ...;List<> _notFavouriteCartoonCharactersKeys, ...;List<> _favouriteCarsKeys, ...;List<> _notFavouriteCarsKeys, ...;List<> _favouriteMotorcyclesKeys, ...;List<> _notFavouriteMotorcyclesKeys, ...;List<> _favouriteCountriesKeys, ...;List<> _notFavouriteCountriesKeys, ...;List<> _favouriteSportsKeys, ...;List<> _nonFavouriteSportsKeys, ...;List<> _favouriteCities, ...;List<> _prioritisedFavouriteCartoonCharacters, ...;List<> _prioritisedFavouriteCars, ...;List<> _prioritisedFavouriteCountries, ...;// Cartoon CharactersMap<> mnew LinkedHashMap<>(...)// Cars// Motorcycles// Countries// Sportsthis._favouriteSportsKeysthis._nonFavouriteSportsKeysMap<> mapList<> listnew ArrayList<>(...)add(...)this._favouriteCities// actionsString description1, ...;String description2, ...;String description3, ...;String description4, ...;this.description1this.description2this.description3this.description4List<> favouriteNumbers, ...;this.favouriteNumbersint nodeId, ...;// START SNIPPET: treeExampleDynamicJavaShow// END SNIPPET: treeExampleDynamicJavaShowimport ValueStackimport ServletActionContextimport Filelong serialVersionUID, ...;String name, ...;Date birthday, ...;Date wakeup, ...;String bio, ...;String favouriteColor, ...;List<> friends, ...;String bestFriend, ...;boolean legalAge, ...;String state, ...;String region, ...;File picture, ...;String pictureContentType, ...;String pictureFileName, ...;String favouriteLanguage, ...;String favouriteVehicalType, ...;String favouriteVehicalSpecific, ...;List<> leftSideCartoonCharacters, ...;List<> rightSideCartoonCharacters, ...;List<> favouriteLanguages, ...;List<> vehicalTypeList, ...;Map<> vehicalSpecificMap, ...;String thoughts, ...;VehicalType carnew VehicalType(...)VehicalType motorcycleList<> carsList<> motorcyclesnew Language(...)new VehicalSpecific(...)this.leftSideCartoonCharactersthis.rightSideCartoonCharactersthis.favouriteVehicalTypethis.favouriteVehicalSpecificValueStack stackgetValueStack(...)getRequest(...)Object vehicalTypefindValue(...)... && ......instanceof...List<> lCollections.EMPTY_LISTthis.namethis.birthdaythis.biothis.favouriteColorthis.friendsthis.bestFriendthis.legalAgethis.statethis.regionthis.picturethis.pictureContentTypethis.pictureFileNamethis.favouriteLanguagethis.thoughtsthis.wakeup// === inner classString description, ...;String key, ...;String style, ...;this.keythis.descriptionthis.style!...equals(...)getKey(...)hashCode(...)new HashMap<>(...)import Daoimport IdEntityimport Serializable/** AbstractCRUDAction. */Collection<> availableItems, ...;...[] toDelete, ...;...[]this.toDeletethis.availableItemsfindAll(...)getDao(...)isDebugEnabled(...)size(...)execute(...)int countint iint jtoDelete.length... < ...delete(...)...[...]/** Utility method for fetching already persistent object from storage for usage in params-prepare-params cycle. ... */IdEntity resultAbstractCRUDAction.classimport Preparableimport TestDataProviderimport EmployeeDaoimport Employeeimport Skillimport Autowiredimport Arraysimport Iterator/** JsfEmployeeAction. */EmployeeDao employeeDao, ...;Long empId, ...;Employee currentEmployee, ...;List<String> selectedSkills, ...;getCurrentEmployee(...)getOtherSkills(...)Iterator<> ititerator(...)setSelectedSkills(...)new ArrayList<String>(...)hasNext(...)getSelectedSkills(...)next(...)setEmpId(...)merge(...)setSkills(...)getEmpId(...)this.empIdthis.currentEmployeeTestDataProvider.POSITIONSasList(...)TestDataProvider.LEVELSthis.selectedSkills/** This method is called to allow the action to prepare itself. ... */Employee preFetchedfetch(...)setCurrentEmployee(...)EmployeeAction.classString CONSTANT, ...;new String[]new Book(...)Map<String,Book> booksnew HashMap<String,Book>(...)String title, ...;String author, ...;this.titlethis.authorimport Afterimport java.io.*import URL/** Will only work on containers that unzip war files */String jsp, ...;String FILE, ...;URL urlgetResource(...)getServletContext(...)BufferedWriter writernew BufferedWriter(...)new FileWriter(...)new File(...)getFile(...)write(...)close(...)Action.SUCCESSFileOutputStream outnew FileOutputStream(...)truncate(...)getChannel(...)this.jsp//write it to file//directiveimport SkillDao/** SkillAction. */SkillDao skillDao, ...;String skillName, ...;Skill currentSkill, ...;Skill preFetchedgetSkillName(...)getCurrentSkill(...)setCurrentSkill(...)setSkillName(...)this.skillNamethis.currentSkillSkillAction.classString actionChain1Property1, ...;this.actionChain1Property1String actionChain2Property1, ...;this.actionChain2Property1String actionChain3Property1, ...;this.actionChain3Property1int counter, ...;String data, ...;currentTimeMillis(...)++...this.dataString select, ...;List<String> options, ...;this.selectimport SimpleDateFormat/** @version */String gender, ...;this.genderSimpleDateFormat sdfnew SimpleDateFormat(...)Integer age, ...;this.ageimport HashMapMap<Long,Category> catMap, ...;long id, ...;List<Category> children, ...;boolean toggle, ...;this.childrennew ArrayList<Category>(...)Category childnew HashMap<Long,Category>(...)new Category(...)long catId, ...;Category category, ...;this.catId// force the roottoggle(...)getCategory(...)import CreateExceptionimport DuplicateKeyExceptionimport StorageExceptionimport UpdateExceptionimport Scopeimport Repository/** MemoryStorage. ... */Map<> memory, ...;Map<> tryMapgetEntityMap(...)new CreateException(...)new DuplicateKeyException(...)intStore(...)new UpdateException(...)new StorageException(...)create(...)update(...)Exception ethis.memory/** Storage. Interface. */import InitializingBeanimport Service/** TestDataProvider. */...[] POSITIONS, ...;...[] LEVELS, ...;...[] TEST_SKILLS, ...;...[] TEST_EMPLOYEES, ...;TEST_SKILLS.lengthisInfoEnabled(...)info(...)StorageException eerror(...)getMessage(...)TEST_EMPLOYEES.lengthaddTestSkills(...)addTestEmployees(...)addTestData(...)TestDataProvider.classnew Skill[]new Skill(...)new Employee[]new Employee(...)new Long(...)new Float(...)subList(...)import ActionContextimport ActionInvocationimport AbstractInterceptorimport SessionMapLogger LOG, ...;String USER_SESSION_KEY, ...;SessionMap<> sessiongetContext(...)ActionContext.SESSIONUser userAction.LOGINinvoke(...)ChatAuthenticationInterceptor.classErrorType ROOM_ALREADY_EXISTS, ...;ErrorType USER_ALREADY_EXISTS, ...;ErrorType NO_SUCH_ROOM_EXISTS, ...;new ErrorType(...)import HttpSession/** Authenticate showcase chat example, make sure everyone have a username. */String CHAT_USER_SESSION_KEY, ...;HttpSession sessionUser chatUsergetAttribute(...)ChatInterceptor.classimport SessionAwareChatService chatService, ...;Map<> session, ...;this.chatServicelogin(...)new User(...)ChatAuthenticationInterceptor.USER_SESSION_KEYChatException eprintStackTrace(...)addActionError(...)// === SessionAware ===this.sessionlogout(...)Date creationDate, ...;String message, ...;User creator, ...;this.creationDatethis.messagethis.creatorMap<String,User> availableUsers, ...;Map<String,Room> availableRooms, ...;new ArrayList<User>(...)new ArrayList<Room>(...)containsKey(...)new ChatException(...)ChatException.ErrorType... > ...trim(...)Room roomhasMember(...)memberExit(...)ChatException.ErrorType.NO_SUCH_ROOM_EXISTSmemberEnter(...)getChatMessages(...)addMessage(...)new ChatMessage(...)getMembers(...)new LinkedHashMap<String,User>(...)new LinkedHashMap<String,Room>(...)import WebApplicationContextimport WebApplicationContextUtilsimport HttpSessionEventimport HttpSessionListenergetSession(...)WebApplicationContext contextgetWebApplicationContext(...)ChatInterceptor.CHAT_USER_SESSION_KEYChatService servicegetBean(...)ChatSessionListener.classString UPDATE_FREQ, ...;addRoom(...)new Room(...)import StrutsTypeConverterimport ParseExceptionvalues.lengthparse(...)ParseException eDateConverter.classString roomName, ...;this.roomNameenterRoom(...)exitRoom(...)List<ChatMessage> messagesAvailableInRoom, ...;getMessagesInRoom(...)new ArrayList<ChatMessage>(...)int MAX_CHAT_MESSAGES, ...;List<ChatMessage> messages, ...;Map<String,User> members, ...;// properties// (behaviour) members// (behaviour) chat messags// messages.remove(messages.size() - 1);List<Room> availableRooms, ...;getAvailableRooms(...)sendMessageToRoom(...)/** Represends a user in the Chat example. */List<User> availableUsers, ...;getAvailableUsers(...)List<User> usersAvailableInRoom, ...;getUsersAvailableInRoom(...)String address, ...;this.addressimport LinkedHashSetimport SetSet<Address> addresses, ...;println(...)System.outthis.addressesnew LinkedHashSet<Address>(...)List<Enum<>> resultnew ArrayList<Enum<>>(...)int aEnum<> eOperationsEnum.classString resultIterator<> iOperationsEnum ADD, ...;OperationsEnum MINUS, ...;OperationsEnum DIVIDE, ...;OperationsEnum MULTIPLY, ...;OperationsEnum REMAINDER, ...;new OperationsEnum(...)import LinkedListList<OperationsEnum> selectedOperations, ...;this.selectedOperationsnew LinkedList<OperationsEnum>(...)List<Person> persons, ...;this.personsimport Storage/** AbstractDao. */Storage storage, ...;this.storagegetStorage(...)getFeaturedClass(...)/** Dao. Interface. *//** EmployeeDao. */this.skillDaoEmployee.classsetOtherSkills(...)Skill skill/** SkillDao. */Skill.class/** CreateException. *//** DeleteException. *//** DuplicateKeyException. *//** StorageException. *//** UpdateException. */import InputStream/** Demonstrates file resource download. ... */String inputPath, ...;sanitizeInputPath(...)/** As the user modifiable parameter inputPath will be used to access server side resources, we want the path to be ... */toUpperCase(...)getResourceAsStream(...)/** Show case File Upload example's action. <code>FileUploadAction</code> */String contentType, ...;File upload, ...;String fileName, ...;String caption, ...;// obtained through getter/setter of <file-tag-name>FileName// since we are using <s:file name="upload" .../> the file name will bethis.fileName// obtained through getter/setter of <file-tag-name>ContentType// since we are using <s:file name="upload" ... /> the content type will bethis.contentType// obtained through getter/setter of <file-tag-name>// since we are using <s:file name="upload" ... /> the File itself will bethis.uploadthis.caption/** Showcase action - mutiple file upload using array. ... */...[] uploads, ...;...[] uploadFileNames, ...;...[] uploadContentTypes, ...;File uString nString cthis.uploadsthis.uploadFileNamesthis.uploadContentTypes// START SNIPPET: entire-file// END SNIPPET: entire-file/** Showcase action - multiple file upload using List ... */List<File> uploads, ...;List<String> uploadFileNames, ...;List<String> uploadContentTypes, ...;new ArrayList<File>(...)import FreemarkerManagerimport ScopesHashModelimport HttpServletRequestimport HttpServletResponse/** <p> ... */CustomFreemarkerManagerUtil util, ...;this.utilpopulateContext(...)/** This class is just a simple util that gets injected into ... */import DateFormatSymbols/** Showcase action for freemarker templates. */...[] gender, ...;...[] months, ...;getMonths(...)new DateFormatSymbols(...)substring(...)StandardTagsAction.classlastIndexOf(...)this.monthsHangman hangman, ...;HangmanConstants.HANGMAN_SESSION_KEYgetCharactersAvailable(...)guessLeft(...)this.hangmanCharacter character, ...;guess(...)this.characterVocab vocab, ...;Boolean win, ...;int guessLeft, ...;List<Character> charactersAvailable, ...;List<Character> charactersGuessed, ...;new ArrayList<Character>(...)new Character[]this.vocabCharacter characterInUpperCaseboolean oknew HangmanException(...)HangmanException.TypecontainCharacter(...)... - ...containsAllCharacter(...)this.win// Arrays.asList(...) returns List that doesn't support remove(), hence// we wrap it with an ArrayList to avoid UnsupportedOperationException// when doing a remove()//return charactersAvailable;String HANGMAN_SESSION_KEY, ...;// keeps a Hangman object in HttpSessionType GAME_ENDED, ...;Type NO_VOCAB, ...;Type NO_VOCAB_SOURCE, ...;new Type(...)Type type, ...;this.typeVocabSource vocabSource, ...;this.vocabSourcenew Hangman(...)getRandomVocab(...)import PropertiesProperties prop, ...;List<Vocab> vocabs, ...;this.propreadVocab(...)long vocabIndexround(...)... * ...random(...)... <= ...List<Vocab> vocabListnew ArrayList<Vocab>(...)Entry<> eMap<>.Entry<>entrySet(...)String vocabString hintnew Vocab(...)import static HangmanConstants.HANGMAN_SESSION_KEYHangmanService service, ...;this.servicestartNewGame(...)String vocab, ...;String hint, ...;...[] characters, ...;// character this vocab is made up ofthis.hintchar[] ctoCharArray(...)c.lengthCharacter[] charsinCharacters(...)List<Character> tmpCharscontainsAll(...)Vocab vList<Character> list1List<Character> list2new Character(...)/** Employee. */String firstName, ...;//textfield w/ conversionString lastName, ...;Date birthDate, ...;Float salary, ...;//datepickerboolean married, ...;String position, ...;//checkboxSkill mainSkill, ...;//comboboxList<> otherSkills, ...;//selectString password, ...;//doubleSelectString level, ...;//passwordString comment, ...;//radio//textareathis.firstNamethis.lastNamethis.birthDatethis.salarythis.marriedthis.positionthis.mainSkillthis.otherSkillsthis.passwordthis.levelthis.comment/** IdEntity. Interface. */import StringEscapeUtils/** Skill. */escapeEcmaScript(...)escapeHtml4(...)setName(...)/** A model class to be used by the simple Model-Driven example. */int age, ...;boolean bustedBefore, ...;this.bustedBefore/** Action to demonstrate simple model-driven feature of the framework. */new Gangster(...)/** <code>EditPerson</code> */PersonManager personManager, ...;/** A default implementation that does nothing an returns "success". ... */addAll(...)getPeople(...)Person pnew ArrayList<Person>(...)List<Person> people, ...;Person person, ...;createPerson(...)this.personLong id, ...;Person personperson.idimport HashSetSet<Person> people, ...;long COUNT, ...;new HashSet<Person>(...)Person p1new Person(...)Person p2Person p3Person p4Person p5// create some imaginary personsimport Namespaceimport ParentPackageimport ClassLoaderUtilimport ServletContextAwareimport ServletContextimport BufferedReaderimport InputStreamReaderimport MalformedURLException/** Processes configuration, page, and action class paths to create snippets ... */String page, ...;String className, ...;String config, ...;List<> pageLines, ...;List<> classLines, ...;List<> configLines, ...;int configLine, ...;int padding, ...;ServletContext servletContext, ...;String rootPathgetRealPath(...)InputStream inindexOf(...)replace(...)read(...)int posparseInt(...)openStream(...)new URL(...)/** @param */this.classNamethis.configthis.pagethis.padding/** Reads in a strea, optionally only including the target line number ... */List<> snippetint startLineint endLineInteger.MAX_VALUEBufferedReader readernew BufferedReader(...)new InputStreamReader(...)int linenoString linereadLine(...)... >= ...Exception exthis.servletContext// ignoring as snippet not available isn't a big dealString text, ...;this.textString iteratorValue1, ...;String iteratorValue2, ...;this.iteratorValue1this.iteratorValue2String value, ...;Integer count, ...;String separator, ...;this.valuethis.countthis.separatorString iteratorValue, ...;Integer start, ...;this.iteratorValuethis.startimport TilesDefinitionimport TilesPutAttribute/* Licensed to the Apache Software Foundation (ASF) under one ... *//** Example to illustrate the <code>token</code> and <code>tokenSession</code> interceptor. */Integer balSourceInteger balDestInteger newSourcenew Integer(...)intValue(...)Integer newDestsleep(...)// transfer from source to destination// to simulate processing time// prepare input form// first time set up an initial account balanceimport DateRangeFieldValidatorimport EmailValidatorimport FieldExpressionValidatorimport IntRangeFieldValidatorimport RegexFieldValidatorimport RequiredFieldValidatorimport RequiredStringValidatorimport StringLengthFieldValidatorimport UrlValidator/** Example Action that shows how forms can be validated and submitted via AJAX ... *//** <!-- START SNIPPET: ajaxFormSubmit --> */String requiredValidatorField, ...;String requiredStringValidatorField, ...;Integer integerValidatorField, ...;Date dateValidatorField, ...;String emailValidatorField, ...;String urlValidatorField, ...;String stringLengthValidatorField, ...;String regexValidatorField, ...;String fieldExpressionValidatorField, ...;hasFieldErrors(...)this.dateValidatorFieldthis.emailValidatorFieldthis.integerValidatorFieldthis.regexValidatorFieldthis.requiredStringValidatorFieldthis.requiredValidatorFieldthis.stringLengthValidatorFieldthis.fieldExpressionValidatorFieldthis.urlValidatorField/** <!-- END SNIPPET: ajaxFormSubmit --> */import FieldMatchimport SkipValidationimport Emailimport NotBlankimport ScriptAssertimport javax.validation.constraints.*/** <!-- START SNIPPET: beanValidatationExample --> *//** <!-- END SNIPPET: beanValidatationExample --> *//** <!-- START SNIPPET: fieldValidatorsExample --> *//** <!-- END SNIPPET: fieldValidatorsExample --> */// START SNIPPET: nonFieldValidatorsExampleString someText, ...;String someTextRetype, ...;String someTextRetypeAgain, ...;this.someTextthis.someTextRetypethis.someTextRetypeAgain// END SNIPPET: nonFieldValidatorsExample// START SNIPPET: quizActionString answer, ...;this.answer// END SNIPPET: quizAction// START SNIPPET: visitorValidatorsExampleUser user, ...;this.user// END SNIPPET: visitorValidatorsExample/** Example to illustrate the <code>execAndWait</code> interceptor. */int time, ...;this.timeimport ServletRequestAwareImportantInfo info, ...;Map<String,String> environment, ...;HttpServletRequest servletRequest, ...;/** Captured only to show that undesired data can creep into the result. */Properties propsgetProperties(...)String classpathgetenv(...)new ImportantInfo(...)ActionSupport.SUCCESSthis.servletRequestthis.environmentthis.infoString classpath, ...;Properties systemProperties, ...;this.classpaththis.systemPropertiescheckCheckbox(...)//hit it againassertDownloadedFileEquals(...)String dategetElementTextByXPath(...)String timeassertNotNull(...)assertElementPresent(...)setScriptingEnabled(...)assertFormPresent(...)assertFormElementPresent(...)selectOption(...)assertTextInElement(...)// text box// textarea// select// checkbox list// checkbox// set fieldsimport ITBaseTestimport TestingEngineResponseExceptionfail(...)TestingEngineResponseException ex/* public void testInvalidRersources3() throws IOException { ... */import Beforeimport Testimport static Assert.assertEqualsimport static Assert.assertNullFileDownloadAction fileDownloadAction, ...;this.fileDownloadActionnew FileDownloadAction(...)import Configurationimport PackageConfigimport Injectimport BundleAccessorimport OsgiHostimport StrutsOsgiListenerimport Bundleimport BundleExceptionimport Collectionsimport ComparatorBundleAccessor bundleAccessor, ...;Configuration configuration, ...;OsgiHost osgiHost, ...;Bundle bundlegetBundles(...)start(...)view(...)stop(...)equalsIgnoreCase(...)getHeaders(...)OsgiHost.OSGI_HEADER_STRUTS_ENABLEDList<PackageConfig> pkgsnew ArrayList<PackageConfig>(...)getBundle(...)getState(...)Bundle.ACTIVEString namegetPackagesByBundle(...)PackageConfig packageConfiggetPackageConfig(...)list(...)keys(...)List<Bundle> bundlessort(...)new (...)new Comparator<Bundle>(...) { ... }boolean bundle1StrutsEnabledisStrutsEnabled(...)boolean bundle2StrutsEnabledcompareTo(...)getSymbolicName(...)isArray(...)Bundle.INSTALLEDBundle.RESOLVEDBundle.STARTINGBundle.STOPPINGBundle.UNINSTALLEDnew IllegalStateException(...)int statenew IllegalArgumentException(...)this.configurationthis.bundleAccessorStrutsOsgiListener.OSGI_HOST//start() fires a BundleEvent.STARTED, which loads the config//we need to wait until the config is loaded from that bundle but//there no easy way/elegant way to know if the bundle was processed alreadyimport ByteArrayOutputStreamimport PrintStreamimport DefaultBundleAccessorimport ShellServiceimport ServiceReference/** This action executes commands on the Felix Shell */String command, ...;String output, ...;ByteArrayOutputStream outByteStreamnew ByteArrayOutputStream(...)ByteArrayOutputStream errByteStreamPrintStream outStreamnew PrintStream(...)PrintStream errStreamString outStringString errStringexecuteCommand(...)this.commandShellService shellServicegetShellService(...)DefaultBundleAccessor bundleAcessorServiceReference refgetServiceReference(...)ShellService.classgetService(...)// get service//bundle can be de-activated, so keeping a reference aorund is not a good ideaimport ResultPathimport BundleContextAwareimport BundleContext/** This action shows how to interact with the OSGi container, using the OSGi interceptor */BundleContext bundleContext, ...;this.bundleContextMessage message, ...;StringBuilder sbnew StringBuilder(...)getText(...)/** All actions <b>may</b> implement this interface, which exposes the <code>execute()</code> method. ... */String SUCCESS, ...;/** The action execution was successful. Show result ... */String NONE, ...;/** The action execution was successful but do not ... */String ERROR, ...;/** The action execution was a failure. ... */String INPUT, ...;String LOGIN, ...;/** The action could not execute, since the ... *//** Where the logic of the action is executed. ... *//* Copyright 2002-2007,2009 The Apache Software Foundation. ... */import TextParseUtil/** <!-- START SNIPPET: description --> ... */String DEFAULT_PARAM, ...;/** The result parameter name to set the name of the action to chain to. */String CHAIN_HISTORY, ...;/** The action context key to save the chain history. */String SKIP_ACTIONS_PARAM, ...;ActionProxy proxy, ...;String actionName, ...;String namespace, ...;String methodName, ...;String skipActions, ...;/** The list of actions to skip. */ActionProxyFactory actionProxyFactory, ...;this.namespacethis.actionNamethis.methodNamethis.skipActionsthis.actionProxyFactory/** Set the action name. ... *//** sets the namespace of the Action that we're chaining to.  if namespace ... *//** Set the list of actions to skip. ... *//** Get the XWork chain history. ... */LinkedList<String> chainHistorynew LinkedList<String>(...)String finalNamespacetranslateVariables(...)String finalActionNameString finalMethodNameHashMap<String,Object> extraContextnew HashMap<String,Object>(...)getNamespace(...)getProxy(...)isInChainHistory(...)addToHistory(...)new XWorkException(...)getChainHistory(...)isEmpty(...)getActionName(...)getMethod(...)ActionContext.VALUE_STACKActionContext.PARAMETERSgetParameters(...)createActionProxy(...)ActionChainResult thatthat.actionNamethat.methodNamethat.namespaceint resultLinkedList<? extends String> chainHistory? ...Set<String> skipActionsListnew HashSet<String>(...)String finalSkipActionscommaDelimitedStringToSet(...)makeKey(...)List<String> chainHistoryActionChainResult.class/* Copyright 2002-2006,2009 The Apache Software Foundation. ... *///  Add if not exists// if the finalNamespace wasn't explicitly defined, assume the current one//  Actions to skip//  Get if key is in the chain historyimport Containerimport HttpParametersimport LocaleThreadLocal<ActionContext> actionContext, ...;String ACTION_NAME, ...;/** Constant for the name of the action being executed. */String VALUE_STACK, ...;/** Constant for the {@link com.opensymphony.xwork2.util.ValueStack OGNL value stack}. */String SESSION, ...;/** Constant for the action's session. */String APPLICATION, ...;/** Constant for the action's application context. */String PARAMETERS, ...;/** Constant for the action's parameters. */String LOCALE, ...;/** Constant for the action's locale. */String TYPE_CONVERTER, ...;/** Constant for the action's type converter. */String ACTION_INVOCATION, ...;/** Constant for the action's {@link com.opensymphony.xwork2.ActionInvocation invocation} context. */String CONVERSION_ERRORS, ...;/** Constant for the map of type conversion errors. */String CONTAINER, ...;/** Constant for the container */Map<String,Object> context, ...;/** Creates a new ActionContext initialized with another context. ... */this.context/** Sets the action invocation (the execution state). ... *//** Gets the action invocation (the execution state). ... *//** Sets the action's application context. ... *//** Returns a Map of the ServletContext when in a servlet environment or a generic application level Map otherwise. ... *//** Sets the action context for the current thread. ... */set(...)/** Returns the ActionContext specific to the current thread. ... *//** Sets the action's context map. ... */getContext(...).context/** Gets the context map. ... *//** Sets conversion errors which occurred when executing the action. ... *//** Gets the map of conversion errors which occurred when executing the action. ... */Map<String,Object> errorssetConversionErrors(...)/** Sets the Locale for the current action. ... *//** Gets the Locale of the current action. If no locale was ever specified the platform's ... */Locale localegetDefault(...)setLocale(...)/** Sets the name of the current Action in the ActionContext. ... *//** Gets the name of the current Action. ... *//** Sets the action parameters. ... *//** Returns a Map of the HttpServletRequest parameters when in a servlet environment or a generic Map of ... *//** Sets a map of action session values. ... *//** Gets the Map of HttpSession values when in a servlet environment or a generic session map otherwise. ... *//** Sets the OGNL value stack. ... *//** Gets the OGNL value stack. ... *//** Gets the container for this request ... *//** Sets the container for this request ... */Container contgetContainer(...)/** Returns a value that is stored in the current ActionContext by doing a lookup using the value's key. ... *//** Stores a value in the current ActionContext. The value can be looked up using the key. ... */new ThreadLocal<ActionContext>(...)ValueStack.VALUE_STACK/** Provides hooks for handling key action events *//** Called after an action has been created. ... *//** Called when an exception is thrown by the action ... */import PreResultListener/** An {@link ActionInvocation} represents the execution state of an {@link Action}. It holds the Interceptors and the Action instance. ... *//** Get the Action associated with this ActionInvocation. ... *//** Gets whether this ActionInvocation has executed before. ... *//** Gets the ActionContext associated with this ActionInvocation. The ActionProxy is ... *//** Get the ActionProxy holding this ActionInvocation. ... *//** If the ActionInvocation has been executed before and the Result is an instance of {@link ActionChainResult}, this method ... *//** Gets the result code returned from this ActionInvocation. ... *//** Sets the result code, possibly overriding the one returned by the ... *//** Gets the ValueStack associated with this ActionInvocation. ... *//** Register a {@link PreResultListener} to be notified after the Action is executed and ... *//** Invokes the next step in processing this ActionInvocation. ... *//** Invokes only the Action (not Interceptors or Results). ... *//** Sets the action event listener to respond to key action events. ... *//** Prepares instance of ActionInvocation to be serializable, ... *//** Performs opposite process to restore back ActionInvocation after deserialisation ... */import ActionConfig/** ActionProxy is an extra layer between XWork and the action so that different proxies are possible. ... *//** Gets the Action instance for this Proxy. ... *//** Gets the alias name this ActionProxy is mapped to. ... *//** Gets the ActionConfig this ActionProxy is built from. ... *//** Sets whether this ActionProxy should also execute the Result after executing the Action. ... *//** Gets the status of whether the ActionProxy is set to execute the Result after the Action is executed. ... *//** Gets the ActionInvocation associated with this ActionProxy. ... *//** Gets the namespace the ActionConfig for this ActionProxy is mapped to. ... *//** Execute this ActionProxy. This will set the ActionContext from the ActionInvocation into the ActionContext ... *//** Gets the method name to execute, or <tt>null</tt> if no method has been specified (meaning <code>execute</code> will be invoked). ... *//** Gets status of the method value's initialization. ... *//** The {@link ActionProxyFactory} is used to create {@link ActionProxy}s to be executed. ... *//** Creates an {@link ActionProxy} for the given namespace and action name by looking up the configuration.The ActionProxy ... */import ValidationAware/** Provides a default implementation for the most common actions. ... */ValidationAwareSupport validationAware, ...;TextProvider textProvider, ...;LocaleProvider localeProvider, ...;Container container, ...;setActionErrors(...)getActionErrors(...)setActionMessages(...)getActionMessages(...)setFieldErrors(...)getFieldErrors(...)getLocale(...)getLocaleProvider(...)isValidLocaleString(...)isValidLocale(...)hasKey(...)getTextProvider(...)/** Dedicated method to support I10N and conversion errors ... */Map<String,Object> conversionErrorsgetConversionErrors(...)String[] valsValueStack valueStackObject valgetTexts(...)hasActionErrors(...)hasActionMessages(...)hasErrors(...)/** Clears field errors. Useful for Continuations and other situations ... */clearFieldErrors(...)/** Clears action errors. Useful for Continuations and other situations ... */clearActionErrors(...)/** Clears messages. Useful for Continuations and other situations ... */clearMessages(...)/** Clears all errors. Useful for Continuations and other situations ... */clearErrors(...)/** Clears all errors and messages. Useful for Continuations and other situations ... */clearErrorsAndMessages(...)/** A default implementation that validates nothing. ... */clone(...)/** <!-- START SNIPPET: pause-method --> ... *//** If called first time it will create {@link com.opensymphony.xwork2.TextProviderFactory}, ... */TextProviderFactory tpfTextProviderFactory.classcreateInstance(...)LocaleProviderFactory localeProviderFactoryLocaleProviderFactory.classcreateLocaleProvider(...)this.containernew ValidationAwareSupport(...)/** This is a composite {@link TextProvider} that takes in an array or {@link java.util.List} of {@link TextProvider}s, it will ... */List<TextProvider> textProviders, ...;/** Instantiates a {@link CompositeTextProvider} with some predefined <code>textProviders</code>. ... */this.textProvidersthis(...)/** It will consult each individual {@link TextProvider}s and return true if either one of the {@link TextProvider}" has such a <code>key</code> else false. ... */TextProvider tp/** It will consult each {@link TextProvider}s and return the first valid message for this ... */emptyList(...)new ArrayList<Object>(...) { ... }TextProvider textProviderString msg/** It will consult each {@link TextProvider}s and return the first non-null {@link ResourceBundle}. ... */ResourceBundle bundle/** It will consult each {@link com.opensymphony.xwork2.TextProvider}s and return the first non-null {@link ResourceBundle}. ... */new ArrayList<TextProvider>(...)CompositeTextProvider.class// if there's a key in either text providers we are ok, else try the next text provider// if there's one text provider that gives us a msg not the same as defaultValue// for this key, we are ok, else try the next// text provider// if there's one text provider that gives us a non-null resource bundle for this bundleName, we are ok, else try the next// if there's one text provider that gives us a non-null resource bundle, we are ok, else try the nextimport ConfigurationExceptionimport InterceptorMappingimport ResultConfigimport Interceptorimport WithLazyParamsimport OgnlUtilimport ValueStackFactoryimport UtilTimerStackimport MethodFailedExceptionimport NoSuchPropertyException/** The Default ActionInvocation implementation ... */Object action, ...;List<PreResultListener> preResultListeners, ...;Map<String,Object> extraContext, ...;ActionContext invocationContext, ...;Iterator<InterceptorMapping> interceptors, ...;ValueStack stack, ...;Result result, ...;Result explicitResult, ...;String resultCode, ...;boolean executed, ...;boolean pushAction, ...;ObjectFactory objectFactory, ...;ActionEventListener actionEventListener, ...;ValueStackFactory valueStackFactory, ...;UnknownHandlerManager unknownHandlerManager, ...;OgnlUtil ognlUtil, ...;WithLazyParams.LazyParamInjector lazyParamInjector, ...;WithLazyParams.LazyParamInjectorthis.extraContextthis.pushActionthis.unknownHandlerManagerthis.valueStackFactorythis.objectFactorythis.actionEventListenerthis.ognlUtil/** If the DefaultActionInvocation has been executed before and the Result is an instance of ActionChainResult, this method ... */Result returnResultActionProxy aProxyResult proxyResultgetResult(...)getInvocation(...)getExecuteResult(...)isExecuted(...)this.resultCode/** Register a com.opensymphony.xwork2.interceptor.PreResultListener to be notified after the Action is executed and before the ... */new ArrayList<PreResultListener>(...)ActionConfig configgetConfig(...)Map<String,ResultConfig> resultsgetResults(...)ResultConfig resultConfigtrace(...)Result retNullPointerException ebuildResult(...)getContextMap(...)getClassName(...)hasUnknownHandlers(...)Action.NONEhandleUnknownResult(...)/** @throws */String profileKeypush(...)InterceptorMapping interceptorMappingString interceptorMsgInterceptor interceptorgetInterceptor(...)injectParams(...)getParams(...)intercept(...)DefaultActionInvocation.thispop(...)invokeActionOnly(...)Object preResultListenerPreResultListener listenerString _profileKeybeforeResult(...)executeResult(...)invokeAction(...)getAction(...)String timerKeybuildAction(...)InstantiationException eIllegalAccessException eString gripe...+=...prepare(...)Map<String,Object> contextMapcreateValueStack(...)putAll(...)ActionContext.ACTION_INVOCATIONActionContext.CONTAINER/** Uses getResult to get the final Result and executes it ... */getResultCode(...)createResult(...)new ConfigurationException(...)getLocation(...)createContextMap(...)ActionContext actionContextthis.proxysetActionInvocation(...)createAction(...)new ActionContext(...)createInterceptors(...)prepareLazyParamInjector(...)new LazyParamInjector(...)inject(...)List<InterceptorMapping> interceptorListnew ArrayList<InterceptorMapping>(...)getInterceptors(...)String methodNameObject methodResultcallMethod(...)getStack(...)MethodFailedException egetReason(...)handleUnknownMethod(...)NoSuchMethodException ignoresaveResult(...)NoSuchPropertyException eThrowable tgetCause(...)handleException(...)/** Save the result to be used later. ... */this.explicitResult/** Version ready to be serialize ... */DefaultActionInvocation thatthat.container/** Restoring Container ... */DefaultActionInvocation.class// If we've chained to other Actions, we need to find the last result// If no result is found for the given resultCode, try to get a wildcard '*' match.// this is needed because the result will be executed, then control will return to the Interceptor, which will// return above and flow through again// now execute the result, if we're supposed to// load action// In case the ValueStack was passed in// create the value stack// this also adds the ValueStack to its context// create the action context// put extraContext in//put this DefaultActionInvocation into the context map// Setting this so that other classes, like object factories, can use the ActionProxy and other// contextual information to operate// Get a new List so we don't get problems with the iterator if someone changes the original list// if reason is missing method,  try checking UnknownHandlers// throw the original one// throw the original exception as UnknownHandlers weren't able to handle invocation as well// exception isn't related to missing action method, throw it// We try to return the source exception.// Wire the result automaticallyimport StringUtils/** The Default ActionProxy implementation ... */ActionConfig config, ...;ActionInvocation invocation, ...;LocalizedTextProvider localizedTextProvider, ...;String method, ...;boolean executeResult, ...;boolean cleanupContext, ...;boolean methodSpecified, ...;/** This constructor is private so the builder methods (create*) should be used to create an DefaultActionProxy. ... */this.invocationthis.cleanupContextthis.executeResultthis.methodthis.localizedTextProviderActionContext nestedContextString retCodesetContext(...)getInvocationContext(...)getMethodName(...)ActionConfig.DEFAULT_METHODgetActionConfig(...)getRuntimeConfiguration(...)handleUnknownAction(...)getErrorMessage(...)resolveMethod(...)isAllowedMethod(...)init(...)prepareNotAllowedErrorMessage(...)findDefaultText(...)DefaultActionProxy.class// if the method is set to null, use the one from the configuration// if the one from the configuration is also null, use "execute"/** Default factory for {@link com.opensymphony.xwork2.ActionProxyFactory}. ... */ActionInvocation invcreateActionInvocation(...)new DefaultActionInvocation(...)DefaultActionProxy proxynew DefaultActionProxy(...)getSimpleName(...)import LocaleUtilsimport ParameterizedMessage/** Default implementation of {@link LocaleProvider} */ActionContext ctxtoLocale(...)trimToNull(...)IllegalArgumentException ewarn(...)new ParameterizedMessage(...)isAvailableLocale(...)DefaultLocaleProvider.classnew DefaultLocaleProvider(...)import MessageFormatimport ResourceBundle/** DefaultTextProvider gets texts from only the default resource bundles associated with the default bundles. */...[] EMPTY_ARGS, ...;String textObject[] paramstoArray(...)MessageFormat formatnew MessageFormat(...)applyPattern(...)List<Object> argsnew ArrayList<Object>(...)List<Object> valuesfindResourceBundle(...)new Object[]//we're not using the value stack hereimport UnknownHandlerConfig/** Default implementation of UnknownHandlerManager ... */ArrayList<UnknownHandler> unknownHandlers, ...;build(...)/** Builds a list of UnknownHandlers in the order specified by the configured "unknown-handler-stack". ... */Configuration configurationConfiguration.classObjectFactory factoryObjectFactory.classList<UnknownHandlerConfig> unkownHandlerStackgetUnknownHandlerStack(...)new ArrayList<UnknownHandler>(...)UnknownHandlerConfig unknownHandlerConfigUnknownHandler uhbuildUnknownHandler(...)Set<String> unknownHandlerNamesgetInstanceNames(...)UnknownHandler.classString unknownHandlerName/** Iterate over UnknownHandlers and return the result of the first one that can handle it ... */UnknownHandler unknownHandlerResult result/** Iterate over UnknownHandlers and return the result of the first one that can handle it. ... */Object resulthandleUnknownActionMethod(...)new NoSuchMethodException(...)ActionConfig result//get UnknownHandlers in the specified order//add all available UnknownHandlers/** Basic interface to access file on the File System and to monitor changes *//** Enables configs reloading when config file changed ... *//** Checks if given file changed and must be reloaded if {@link #setReloadingConfigs(boolean)} is true ... *//** Checks if file represented by provided URL should be reloaded ... *//** Loads opens the named file and returns the InputStream ... *//** Adds file to list of monitored files if {@link #setReloadingConfigs(boolean)} is true ... *//** Convert URLs to URLs with "file" protocol ... *//** Indicate if given implementation supports current OS File System ... *//** User's implementation should return false as then it will be taken in first place ... *//** Factory that creates FileManager, default to {@link com.opensymphony.xwork2.util.fs.DefaultFileManager} *//** <code>InvalidMetadataException</code> ... *//** Create a new <code>InvalidMetadataException</code> with the supplied error message. ... *//** Indicates that the implementing class can provide its own {@link Locale}. ... *//** Gets the provided locale. ... *//** Validates if provided string is a valid {@link Locale} ... *//** Validates if provided {@link Locale} is value ... *//** Allows delegate creation of {@link LocaleProvider} to another implementation provided ... *//** Create a new instance of {@link LocaleProvider}. ... *//** ModelDriven Actions provide a model object to be pushed onto the ValueStack ... *//** Gets the model to be pushed onto the ValueStack instead of the Action itself. ... */import InterceptorConfigimport TypeConverterimport com.opensymphony.xwork2.factory.*import Validator/** ObjectFactory is responsible for building the core framework objects. Users may register their ... */ClassLoader ccl, ...;ActionFactory actionFactory, ...;ResultFactory resultFactory, ...;InterceptorFactory interceptorFactory, ...;ValidatorFactory validatorFactory, ...;ConverterFactory converterFactory, ...;UnknownHandlerFactory unknownHandlerFactory, ...;this.cclthis.actionFactorythis.resultFactorythis.interceptorFactorythis.validatorFactorythis.converterFactorythis.unknownHandlerFactory/** Allows for ObjectFactory implementations that support ... *//** Utility method to obtain the class matched to className. Caches look ups so that subsequent ... */loadClass(...)/** Build an instance of the action class to handle a particular request (eg. web request) ... *//** Build a generic Java object of the given type. ... */newInstance(...)/** @param ... */buildBean(...)Class<> clazzgetClassInstance(...)Object objinjectInternalBeans(...)/** Builds an Interceptor from the InterceptorConfig and the Map of ... */buildInterceptor(...)/** Build a Result using the type in the ResultConfig and set the parameters in the ResultConfig. ... *//** Build a Validator of the given type and set the parameters on it ... */buildValidator(...)/** Build converter of given type ... */buildConverter(...)/** Builds unknown handler ... *//** Preparable Actions will have their <code>prepare()</code> method called if the {@link com.opensymphony.xwork2.interceptor.PrepareInterceptor} ... *//** Extension Interface for TextProvider to help supporting ResourceBundles. ... *//** Set the resource bundle to use. ... *//** Set the class to use for reading the resource bundle. ... *//** Set the LocaleProvider to use. ... *//** All results (except for <code>Action.NONE</code>) of an {@link Action} are mapped to a View implementation. ... *//** Represents a generic interface for all action execution results. ... *//** This factory enables users to provide and correctly initialize a custom TextProvider. */LocaleProviderFactory localeProviderFactory, ...;this.localeProviderFactoryTextProvider instancesetClazz(...)setLocaleProvider(...)setBundle(...)new TextProviderSupport(...)import ConfigurationManagerimport ConfigurationProviderimport MockConfigurationimport XWorkTestCaseHelperimport AfterTestimport BeforeTest/** Base test class for TestNG unit tests.  Provides common XWork variables ... */ConfigurationManager configurationManager, ...;setUp(...)new MockConfiguration(...)selfRegister(...)ActionProxyFactory.classtearDown(...)loadConfigurationProviders(...)getConfiguration(...)/** Provides access to {@link ResourceBundle}s and their underlying text messages. ... *//** Checks if a message key exists. ... *//** Gets a message based on a message key or if no message is found the provided key ... *//** Gets a message based on a key, or, if the message is not found, a supplied ... *//** Gets a message based on a key using the supplied obj, as defined in ... *//** Gets a message based on a key using the supplied args, as defined in ... *//** Get the named bundle, such as "com/acme/Foo". ... *//** Get the resource bundle associated with the implementing class (usually an action). ... *//** Default TextProvider implementation. ... */Class<> clazz, ...;ResourceBundle bundle, ...;/** Constructor. ... */this.clazzthis.localeProviderthis.bundle/** Checks if a key is available in the resource bundles associated with this action. ... */String messagefindText(...)/** Get a text from the resource bundles associated with this action. ... */Object[] argsArrayActionContext.LOCALE/** Get the named bundle. ... *//** Get the resource bundle associated with this action. ... *//** Get's the locale from the localeProvider. ... *//** Simple marker interface to indicate an object should <b>not</b> have its properties copied during chaining. ... *//** Handles cases when the result or action is unknown. ... *//** Handles the case when an action configuration is unknown.  Implementations can return a new ActionConfig ... *//** Handles the case when a result cannot be found for an action and result code. ... *//** Handles the case when an action method cannot be found.  This method is responsible both for finding the method and executing it. ... *//** An unknown handler manager contains a list of UnknownHandler and iterates on them by order ... *//** Tries to handle passed methodName if cannot find method should re ... *//** Provides an interface in which a call for a validation check can be done. ... *//** Performs validation. *//** Provides a default implementation of ValidationAware. Returns new collections for ... */Collection<String> actionErrors, ...;Collection<String> actionMessages, ...;Map<String,List<String>> fieldErrors, ...;this.actionErrorsinternalGetActionErrors(...)this.actionMessagesinternalGetActionMessages(...)this.fieldErrorsnew LinkedHashMap<String,List<String>>(...)internalGetFieldErrors(...)Map<String,List<String>> errorsList<String> thisFieldErrors/** Clears field errors map. ... */clear(...)/** Clears action errors list. ... *//** Clears messages list. ... *//** Clears all error list/maps. ... *//** Clears all error and messages list/maps. ... *//** Constants used across framework */String COLLECTION_CONVERTER, ...;String DATE_CONVERTER, ...;String NUMBER_CONVERTER, ...;String STRING_CONVERTER, ...;String ARRAY_CONVERTER, ...;String DEV_MODE, ...;String LOG_MISSING_PROPERTIES, ...;String ENABLE_OGNL_EXPRESSION_CACHE, ...;String ENABLE_OGNL_EVAL_EXPRESSION, ...;String RELOAD_XML_CONFIGURATION, ...;String ALLOW_STATIC_METHOD_ACCESS, ...;String XWORK_LOGGER_FACTORY, ...;String OGNL_EXCLUDED_CLASSES, ...;String OGNL_EXCLUDED_PACKAGE_NAME_PATTERNS, ...;String OGNL_EXCLUDED_PACKAGE_NAMES, ...;String ADDITIONAL_EXCLUDED_PATTERNS, ...;String ADDITIONAL_ACCEPTED_PATTERNS, ...;String OVERRIDE_EXCLUDED_PATTERNS, ...;String OVERRIDE_ACCEPTED_PATTERNS, ...;import Locatableimport Locationimport LocationUtils/** A generic runtime exception that optionally contains Location information ... */Location location, ...;/** Constructs a <code>XWorkException</code> with no detail message. *//** Constructs a <code>XWorkException</code> with the specified ... *//** Constructs a <code>XWorkException</code> with the root cause ... *//** Constructs a <code>XWorkException</code> with the root cause and target ... */this.locationLocation.UNKNOWN/** Gets the location of the error, if available ... *//** Returns a short description of this throwable object, including the ... */import com.opensymphony.xwork2.inject.*import StubConfigurationProviderimport LocatablePropertiesloadButAdd(...)Container.DEFAULT_NAMEnew StubConfigurationProvider(...) { ... }factory(...)new Factory<>(...) { ... }Scope.SINGLETONimport TestCase/** Base JUnit TestCase to extend for XWork specific JUnit tests. Uses ... *//** When implemented allows to alias already existing beans *//** XWork configuration. ... *//** The current runtime configuration. Currently, if changes have been made to the Configuration since the last ... *//** Removes a package from the the list of packages. Changes to the configuration won't take effect until buildRuntimeConfiguration ... *//** Allow the Configuration to clean up any resources that have been used. *//** @since ... */import XWorkException/** ConfigurationException ... *//** Constructs a <code>ConfigurationException</code> with no detail message. *//** Constructs a <code>ConfigurationException</code> with the specified ... *//** Constructs a <code>ConfigurationException</code> with no detail message. ... */import XWorkConstantsimport DefaultConfigurationimport XWorkConfigurationProviderimport XmlConfigurationProviderimport CopyOnWriteArrayListimport Lockimport ReentrantLock/** ConfigurationManager - central for XWork Configuration management, including ... */Lock providerLock, ...;List<ContainerProvider> containerProviders, ...;List<PackageProvider> packageProviders, ...;String defaultFrameworkBeanName, ...;boolean providersChanged, ...;boolean reloadConfigs, ...;// for the first timethis.defaultFrameworkBeanName/** @return ... */setConfiguration(...)createConfiguration(...)reloadContainer(...)getContainerProviders(...)ConfigurationException econditionalReload(...)new DefaultConfiguration(...)lock(...)new XWorkConfigurationProvider(...)new XmlConfigurationProvider(...)unlock(...)/** Set the list of configuration providers ... */this.containerProvidersnew CopyOnWriteArrayList<ContainerProvider>(...)/** adds a configuration provider to the List of ConfigurationProviders.  a given ConfigurationProvider may be added ... */ContainerProvider containerProviderclearContainerProvider(...)destroy(...)/** Destroy its managing Configuration instance */clearContainerProviders(...)/** Reloads the Configuration files if the configuration files indicate that they need to be reloaded. */List<ContainerProvider> providersboolean reloadneedReloadContainerProviders(...)needReloadPackageProviders(...)reloadProviders(...)updateReloadConfigsFlag(...)parseBoolean(...)XWorkConstants.RELOAD_XML_CONFIGURATIONPackageProvider providerneedsReload(...)ContainerProvider providernew ReentrantLock(...)new CopyOnWriteArrayList<PackageProvider>(...)ConfigurationManager.class// let's destroy the ConfigurationProvider first// let's destroy it first, before nulling it./** Interface to be implemented by all forms of XWork configuration classes. */import StringTokenizer/** ConfigurationUtil ... *//** Get the {@link PackageConfig} elements with the specified names. ... */List<String> parentPackageNamesbuildParentListFromString(...)List<PackageConfig> parentPackageConfigsString parentPackageNamePackageConfig parentPackageContext/** Splits the string into a list using a comma as the token separator. ... */StringTokenizer tokenizernew StringTokenizer(...)List<String> parentshasMoreTokens(...)String parentNamenextToken(...)isNotEmpty(...)ConfigurationUtil.classimport ContainerBuilder/** Provides beans and constants/properties for the Container ... *//** Called before removed from the configuration manager *//** Initializes with the configuration ... *//** Tells whether the ContainerProvider should reload its configuration ... *//** Registers beans and properties for the Container ... */import FileManagerFactory/** Allows to specify custom {@link FileManagerFactory} */Class<? extends FileManagerFactory> factoryClass, ...;this.factoryClassFileManagerFactory.classimport FileManager/** Allows to specify custom {@link FileManager} by user */Class<? extends FileManager> fileManagerClass, ...;this.fileManagerClassFileManager.class/** Provides configuration packages.  The separate init and loadPackages calls are due to the need to ... *//** Tells whether the PackageProvider should reload its configuration ... *//** Loads the packages for the configuration. ... *//** Exception when a reference can't be resolved. ... *//** RuntimeConfiguration ... *//** get the fully expanded ActionConfig for a specified namespace and (action) name ... *//** returns a Map of all the registered ActionConfigs.  Again, these ActionConfigs are fully expanded so that any ... *//** Dedicated interface to allow inject {@link ServletContext} and perform initialisation based in it *//** This is a lazy constructor, called just after class was initiated ... */import Located/** Contains everything needed to configure and execute an action: ... */String DEFAULT_METHOD, ...;String WILDCARD, ...;String DEFAULT_METHOD_REGEX, ...;List<InterceptorMapping> interceptors, ...;Map<String,String> params, ...;// a list of interceptorMapping Objects eg. List<InterceptorMapping>Map<String,ResultConfig> results, ...;List<ExceptionMappingConfig> exceptionMappings, ...;String packageName, ...;boolean strictMethodInvocation, ...;AllowedMethods allowedMethods, ...;this.packageNamenew LinkedHashMap<String,String>(...)new LinkedHashMap<String,ResultConfig>(...)new ArrayList<ExceptionMappingConfig>(...)/** Clones an ActionConfig, copying data into new maps and lists ... */orig.nameorig.classNameorig.methodNameorig.packageNamethis.paramsorig.paramsthis.interceptorsorig.interceptorsthis.resultsorig.resultsthis.exceptionMappingsorig.exceptionMappingsthis.allowedMethodsorig.allowedMethodsorig.location/** Returns name of the action method ... */isAllowed(...)ActionConfig actionConfigactionConfig.classNameactionConfig.nameactionConfig.interceptorsactionConfig.methodNameactionConfig.paramsactionConfig.resultsactionConfig.allowedMethods/** The builder for this object.  An instance of this object is the only way to construct a new instance.  The ... */ActionConfig target, ...;Set<String> allowedMethods, ...;String methodRegex, ...;new ActionConfig(...)getAllowedMethods(...)target.packageNametarget.nametarget.classNametarget.methodNameaddAllowedMethod(...)target.exceptionMappingstarget.interceptorstarget.paramstarget.resultsResultConfig rctarget.locationtarget.strictMethodInvocationthis.methodRegexunmodifiableMap(...)unmodifiableList(...)target.allowedMethodsimport PatternSet<AllowedMethod> allowedMethods, ...;String defaultRegex, ...;Set<AllowedMethod> allowedMethodsnew HashSet<AllowedMethod>(...)String methodboolean isPatternStringBuilder methodPatternint lenchar cint xcharAt(...)new PatternAllowedMethod(...)String patternnew LiteralAllowedMethod(...)new AllowedMethods(...)this.strictMethodInvocationthis.defaultRegexunmodifiableSet(...)AllowedMethod allowedMethodSet<String> resultoriginal(...)AllowedMethods thatthat.allowedMethodsPattern allowedMethodPattern, ...;String original, ...;this.originalcompile(...)matches(...)matcher(...)PatternAllowedMethod thatpattern(...)that.allowedMethodPatternString allowedMethod, ...;this.allowedMethodLiteralAllowedMethod thatthat.allowedMethodAllowedMethods.class/** Configuration for exception mapping. ... */String exceptionClassName, ...;String result, ...;this.exceptionClassNamethis.resulttarget.exceptionClassNametarget.resultExceptionMappingConfig exceptionMappingConfigexceptionMappingConfig.nameexceptionMappingConfig.exceptionClassNameexceptionMappingConfig.resultexceptionMappingConfig.paramsint hashCodeExceptionMappingConfig target, ...;new ExceptionMappingConfig(...)ExceptionMappingConfig resultembalmTarget(...)/** Configuration for Interceptors. ... */InterceptorConfig interceptorConfiginterceptorConfig.classNameinterceptorConfig.nameinterceptorConfig.paramsInterceptorConfig target, ...;new InterceptorConfig(...)InterceptorConfig result/** InterceptorListHolder ... *//** Defines an object that can be used to retrieve interceptor configuration *//** Gets an interceptor configuration object. ... *//** <code>InterceptorMapping</code> ... */Interceptor interceptor, ...;new HashMap<String,String>(...)this.interceptorInterceptorMapping thatthat.name/** Configuration for InterceptorStack. ... *//** A list of InterceptorMapping object *//** Creates an InterceptorStackConfig object. *//** Creates an InterceptorStackConfig object with a particular <code>name</code>. ... *//** Returns a <code>Collection</code> of InterceptorMapping objects. ... *//** Get the name of this interceptor stack configuration. ... *//** An InterceptorStackConfig object is equals with <code>o</code> only if ... */InterceptorStackConfig interceptorStackConfiginterceptorStackConfig.interceptorsinterceptorStackConfig.nameInterceptorStackConfig target, ...;new InterceptorStackConfig(...)/** Add an <code>InterceptorMapping</code> object. ... *//** Add a List of <code>InterceptorMapping</code> objects. ... */InterceptorStackConfig result/** Configuration for Package. ... */Map<String,ActionConfig> actionConfigs, ...;Map<String,ResultConfig> globalResultConfigs, ...;Set<String> globalAllowedMethods, ...;Map<String,Object> interceptorConfigs, ...;Map<String,ResultTypeConfig> resultTypeConfigs, ...;List<ExceptionMappingConfig> globalExceptionMappingConfigs, ...;List<PackageConfig> parents, ...;String defaultInterceptorRef, ...;String defaultActionRef, ...;String defaultResultType, ...;String defaultClassRef, ...;boolean isAbstract, ...;boolean needsRefresh, ...;new LinkedHashMap<String,ActionConfig>(...)new LinkedHashMap<String,Object>(...)new LinkedHashMap<String,ResultTypeConfig>(...)this.defaultInterceptorReforig.defaultInterceptorRefthis.defaultActionReforig.defaultActionRefthis.defaultResultTypeorig.defaultResultTypethis.defaultClassReforig.defaultClassReforig.namespacethis.isAbstractorig.isAbstractthis.needsRefreshorig.needsRefreshthis.actionConfigsorig.actionConfigsthis.globalResultConfigsorig.globalResultConfigsthis.globalAllowedMethodsnew LinkedHashSet<String>(...)orig.globalAllowedMethodsthis.interceptorConfigsorig.interceptorConfigsthis.resultTypeConfigsorig.resultTypeConfigsthis.globalExceptionMappingConfigsorig.globalExceptionMappingConfigsthis.parentsorig.parentsorig.strictMethodInvocation/** returns the Map of all the ActionConfigs available in the current package. ... */Map<String,ActionConfig> retMapPackageConfig parentgetAllActionConfigs(...)getActionConfigs(...)/** returns the Map of all the global ResultConfigs available in the current package. ... */Map<String,ResultConfig> retMapPackageConfig parentConfiggetAllGlobalResults(...)getGlobalResultConfigs(...)/** returns the Map of all InterceptorConfigs and InterceptorStackConfigs available in the current package. ... */Map<String,Object> retMapPackageConfig parentContextgetAllInterceptorConfigs(...)getInterceptorConfigs(...)/** returns the Map of all the ResultTypeConfigs available in the current package. ... */Map<String,ResultTypeConfig> retMapgetAllResultTypeConfigs(...)getResultTypeConfigs(...)/** returns the List of all the ExceptionMappingConfigs available in the current package. ... */List<ExceptionMappingConfig> allExceptionMappingsgetAllExceptionMappingConfigs(...)getGlobalExceptionMappingConfigs(...)String parentDefaultgetDefaultClassRef(...)getFullDefaultInterceptorRef(...)getFullDefaultActionRef(...)getFullDefaultResultType(...)/** gets the global ResultConfigs local to this package ... *//** gets the InterceptorConfigs and InterceptorStackConfigs local to this package ... *//** gets the ResultTypeConfigs local to this package ... *//** gets the ExceptionMappingConfigs local to this package ... *//** gets the GlobalAllowedMethods local to this package ... */PackageConfig thatthat.isAbstractthat.needsRefreshthat.strictMethodInvocationthat.actionConfigsthat.globalResultConfigsthat.globalAllowedMethodsthat.interceptorConfigsthat.resultTypeConfigsthat.globalExceptionMappingConfigsthat.parentsthat.defaultInterceptorRefthat.defaultActionRefthat.defaultResultTypethat.defaultClassRefPackageConfig otherString fullString otherFullother.nameother.namespacePackageConfig target, ...;boolean strictDMI, ...;new PackageConfig(...)target.isAbstracttarget.defaultInterceptorReftarget.defaultActionReftarget.defaultClassRef/** sets the default Result type for this package ... */target.defaultResultTypetarget.namespacetarget.needsRefreshtarget.actionConfigsPackageConfig configaddParent(...)target.globalResultConfigsSet<String> allowedMethodstarget.globalAllowedMethodsgetParentsAllowedMethods(...)target.parentsparent.globalAllowedMethodsgetParents(...)target.globalExceptionMappingConfigstarget.interceptorConfigstarget.resultTypeConfigsPackageConfig resultPackageConfig.class// note, this isn't perfect (could come from different parents), but it is "good enough"/** <!-- START SNIPPET: javadoc --> ... *//** Configuration for Result. ... */resultConfig.classNameresultConfig.nameresultConfig.paramsResultConfig target, ...;new ResultConfig(...)ResultConfig result/** Configuration class for result types. ... */String defaultResultParam, ...;this.defaultResultParamorig.defaultResultParamResultTypeConfig thatthat.classNamethat.paramsResultTypeConfig target, ...;new ResultTypeConfig(...)target.defaultResultParamResultTypeConfig resultimport PatternMatcherimport NumberUtils/** <p> Matches patterns against pre-compiled wildcard expressions pulled from ... *//** <p> The logging instance </p> */PatternMatcher<Object> wildcard, ...;/** <p> Handles all wildcard pattern matching. </p> */List<Mapping<E>> compiledPatterns, ...;/** <p> The compiled patterns and their associated target objects </p> */this.wildcardObject patternisLiteral(...)compilePattern(...)new Mapping<E>(...)int lastStarnew ArrayList<Mapping<E>>(...)/** <p> Matches the path against the compiled wildcard patterns. </p> ... */E configMap<String,String> varsMapping<E> mmatch(...)getPattern(...)getOriginalPattern(...)convert(...)getTarget(...)/** <p> Clones the target object and its children, replacing various ... *//** <p>Replaces parameter values</p> ... */Map<String,String> mapString keykeySet(...)convertParam(...)isNumber(...)/** <p> Inserts into a value wildcard-matched strings where specified ... */StringBuilder retString varVal/** <p> Stores a compiled wildcard pattern and the object it came ... *//** <p> The original pattern. </p> */Object pattern, ...;/** <p> The compiled pattern. </p> */E config, ...;/** <p> The original object. </p> *//** <p> Contructs a read-only Mapping instance. </p> ... */this.pattern/** <p> Gets the compiled wildcard pattern. </p> ... *//** <p> Gets the object that contains the pattern. </p> ... *//** <p> Gets the original wildcard pattern. </p> ... */AbstractMatcher<>.class//this will set the group index references, like {1}//the values map will contain entries like name->"Lex Luthor" and 1->"Lex Luthor"//now add the non-numeric valuesimport ExceptionMappingConfig/** <p> Matches paths against pre-compiled wildcard expressions pulled from ... *//** <p> Finds and precompiles the wildcard patterns from the ActionConfig ... */addPattern(...)/** <p> Clones the ActionConfig and its children, replacing various ... */String classNameString pkgNamegetPackageName(...)Map<String,String> paramsreplaceParameters(...)List<ExceptionMappingConfig> exsResultConfig raddParams(...)new Builder(...)ResultConfig.BuilderExceptionMappingConfig exgetExceptionMappings(...)String exClassNamegetExceptionClassName(...)String exResultMap<String,String> exParamsExceptionMappingConfig eExceptionMappingConfig.Builderlocation(...)addExceptionMappings(...)addInterceptors(...)setStrictMethodInvocation(...)addResultConfigs(...)isStrictMethodInvocation(...)methodName(...)ActionConfig.Builderimport com.opensymphony.xwork2.*import com.opensymphony.xwork2.config.*import com.opensymphony.xwork2.config.entities.*import EnvsValueSubstitutorimport InterceptorBuilderimport ValueSubstitutorimport com.opensymphony.xwork2.conversion.*import com.opensymphony.xwork2.conversion.impl.*import OgnlReflectionProviderimport OgnlValueStackFactoryimport CompoundRootAccessorimport com.opensymphony.xwork2.util.*import DefaultFileManagerimport DefaultFileManagerFactoryimport ReflectionProviderimport PropertyAccessorimport StrutsConstants/** DefaultConfiguration ... */Map<String,PackageConfig> packageContexts, ...;// Programmatic Action ConfigurationsRuntimeConfiguration runtimeConfiguration, ...;Set<String> loadedFileNames, ...;List<UnknownHandlerConfig> unknownHandlerStack, ...;this.unknownHandlerStackPackageConfig check/** Allows the configuration to clean up any resources used */buildRuntimeConfiguration(...)/** Calls the ConfigurationProviderFactory.getConfig() to tell it to reload the configuration and then calls ... */List<PackageProvider> packageProvidersnew ArrayList<PackageProvider>(...)ContainerProperties propsnew ContainerProperties(...)ContainerBuilder buildernew ContainerBuilder(...)Container bootstrapcreateBootstrapContainer(...)ActionContext oldContextregister(...)setConstants(...)new Factory<Configuration>(...) { ... }DefaultConfiguration.thisSet<String> packageProviderNamesPackageProvider.classloadPackages(...)rebuildRuntimeConfiguration(...)ActionContext contextValueStack vsValueStackFactory.classboolean fmFactoryRegisteredActionFactory.classDefaultActionFactory.classResultFactory.classDefaultResultFactory.classInterceptorFactory.classDefaultInterceptorFactory.classValidatorFactory.classDefaultValidatorFactory.classConverterFactory.classDefaultConverterFactory.classUnknownHandlerFactory.classDefaultUnknownHandlerFactory.classDefaultFileManager.classDefaultFileManagerFactory.classReflectionProvider.classOgnlReflectionProvider.classOgnlValueStackFactory.classXWorkConverter.classConversionPropertiesProcessor.classDefaultConversionPropertiesProcessor.classConversionFileProcessor.classDefaultConversionFileProcessor.classConversionAnnotationProcessor.classDefaultConversionAnnotationProcessor.classTypeConverterCreator.classDefaultTypeConverterCreator.classTypeConverterHolder.classDefaultTypeConverterHolder.classTypeConverter.classXWorkConstants.COLLECTION_CONVERTERCollectionConverter.classXWorkConstants.ARRAY_CONVERTERArrayConverter.classXWorkConstants.DATE_CONVERTERXWorkConstants.NUMBER_CONVERTERNumberConverter.classXWorkConstants.STRING_CONVERTERStringConverter.classTextProvider.classDefaultTextProvider.classLocalizedTextProvider.classStrutsLocalizedTextProvider.classStrutsTextProviderFactory.classDefaultLocaleProviderFactory.classTextParser.classOgnlTextParser.classObjectTypeDeterminer.classDefaultObjectTypeDeterminer.classPropertyAccessor.classCompoundRootAccessor.classCompoundRoot.classOgnlUtil.classValueSubstitutor.classEnvsValueSubstitutor.classconstant(...)XWorkConstants.DEV_MODEStrutsConstants.STRUTS_DEVMODEXWorkConstants.LOG_MISSING_PROPERTIESXWorkConstants.ENABLE_OGNL_EVAL_EXPRESSIONXWorkConstants.ENABLE_OGNL_EXPRESSION_CACHEStrutsConstants.STRUTS_I18N_RELOADMap<String,Map<String,ActionConfig>> namespaceActionConfigsnew LinkedHashMap<String,Map<String,ActionConfig>>(...)Map<String,String> namespaceConfigsPatternMatcher<int[]> matcherPatternMatcher<>.classisAbstract(...)String namespaceMap<String,ActionConfig> configsMap<String,ActionConfig> actionConfigsObject oString actionNameActionConfig baseConfigbuildFullActionConfig(...)new RuntimeConfigurationImpl(...)String defaultResultEntry<String,ResultConfig> entryMap<>.Entry<String,ResultConfig>ResultTypeConfig resultTypeConfigsetValue(...)/** Builds the full runtime actionconfig with all of the defaults and inheritance ... */new TreeMap<String,String>(...)new TreeMap<String,ResultConfig>(...)List<InterceptorMapping> interceptorsString methodRegexStrutsConstants.STRUTS_SMI_METHOD_REGEXsetDefaultResults(...)String defaultInterceptorRefNameconstructInterceptorReference(...)PackageConfig.BuilderActionConfig.DEFAULT_METHOD_REGEXsetDefaultMethodRegex(...)interceptors(...)defaultClassName(...)Map<String,Map<String,ActionConfig>> namespaceActionConfigs, ...;Map<String,ActionConfigMatcher> namespaceActionConfigMatchers, ...;NamespaceMatcher namespaceMatcher, ...;Map<String,String> namespaceConfigs, ...;this.namespaceActionConfigsthis.namespaceConfigsthis.namespaceActionConfigMatchersnew LinkedHashMap<String,ActionConfigMatcher>(...)this.namespaceMatchernew NamespaceMatcher(...)String nsnew ActionConfigMatcher(...)/** Gets the configuration information for an action name, or returns null if the ... */findActionConfigInNamespace(...)NamespaceMatch matchgetVariables(...)isNotBlank(...)Map<String,ActionConfig> actionsString defaultActionRef/** Gets the configuration settings for every action. ... */StringBuilder buffString sString oldValuesetProperty(...)Object keyobjnew LocatableConstantFactory<String>(...)getPropertyLocation(...)new LinkedHashMap<String,PackageConfig>(...)new TreeSet<String>(...)DefaultConfiguration.class// Set the bootstrap container for the purposes of factory creation// Process the configuration providers first// Then process any package providers from the plugins// fill in default if non class has been provided// try wildcarded namespaces// If config found, place all the matches found in the namespace processing in the action's parameters// fail over to empty namespace// Check wildcards// fail over to default actionimport Contextimport Factory/** Factory that remembers where a constant came from */T constant, ...;this.constantsetLocation(...)/** Attaches location information to the factory. */Class<> implementation, ...;Class<> type, ...;Scope scope, ...;this.implementationthis.scopeString fieldsnew LinkedHashMap<String,Object>(...) { ... }/** Simple configuration used for unit testing */Map<String,PackageConfig> packages, ...;Set<String> loadedFiles, ...;ContainerBuilder builder, ...;LocatableProperties propsnew LocatableProperties(...)MockConfiguration.classStrutsConstants.STRUTS_ENABLE_DYNAMIC_METHOD_INVOCATIONnew UnsupportedOperationException(...)new HashMap<String,PackageConfig>(...)/* Copyright 2002-2003,2009 The Apache Software Foundation. ... *///this cannot be done in the constructor, as it causes an infinite loop/** Represents a match from a namespace pattern matching. ... */String pattern, ...;Map<String,String> variables, ...;this.variables/** Matches namespace strings against a wildcard pattern matcher ... */new NamespaceMatch(...)/* Map<String,String> origVars = (Map<String,String>)vars; ... */DirectedGraph<T> graph, ...;Map<T,Status> marks, ...;List<T> verticesInCycles, ...;Status MARKED, ...;Status COMPLETE, ...;new Status(...)this.graphnew HashMap<T,Status>(...)new ArrayList<T>(...)T vmark(...)List<T> localCyclesStatus.MARKEDT uedgesFrom(...)Status.COMPLETE// return true;// return false;/* return statements commented out for fail slow behavior detect all nodes in cycles instead of just the first one */import NoSuchElementExceptionMap<T,Set<T>> mGraph, ...;/** Adds a new node to the graph. If the node already exists, this function is a no-op. ... */new HashSet<T>(...)/** Given a start node, and a destination, adds an arc from the start node to the destination. If an arc already exists, this operation is a no-op. ... */new NoSuchElementException(...)/** Removes the edge from start to dest from the graph. If the edge does not exist, this operation is a no-op. If either endpoint does not exist, ... *//** Given two nodes in the graph, returns whether there is an edge from the first node to the second node. If either node does not exist in the ... *//** Given a node in the graph, returns an immutable view of the edges leaving that node as a set of endpoints. ... */Set<T> arcs/** Returns an iterator that can traverse the nodes in the graph. ... *//** Returns the number of nodes in the graph. ... *//** Returns whether the graph is empty. ... */new HashMap<T,Set<T>>(...)/* If the node already exists, don't do anything. *//* Otherwise, add the node with an empty set of outgoing edges. *//* Confirm both endpoints exist. *//* Add the edge. *//* Check that the node exists. */import StrSubstitutorStrSubstitutor strSubstitutor, ...;new StrSubstitutor(...)setVariablePrefix(...)setVariableSuffix(...)setValueDelimiter(...)String substitutedreplaceSystemProperties(...)import ObjectFactoryimport InterceptorLocatorimport InterceptorStackConfig/** Builds a list of interceptors referenced by the refName in the supplied PackageConfig. ... *//** Builds a list of interceptors referenced by the refName in the supplied PackageConfig (InterceptorMapping object). ... */Object referencedConfiggetInterceptorConfig(...)List<InterceptorMapping> resultInterceptorConfig configInterceptor internew InterceptorMapping(...)ConfigurationException exInterceptorStackConfig stackConfigconstructParameterizedInterceptorReferences(...)/** Builds a list of interceptors referenced by the refName in the supplied PackageConfig overriding the properties ... */Map<String,Map<String,String>> paramsnew LinkedHashMap<String,Map<String,String>>(...)String valueObject interceptorCfgObjInterceptorConfig cfgInterceptorMapping mappingint indexInterceptorStackConfig stackCfgList<InterceptorMapping> tmpResultInterceptorMapping tmpInterceptorMappingInterceptorBuilder.class/* We strip ... *//* Now we attempt to separate out param that refers to Interceptor ... *///  interceptor-ref param refer to an interceptor// interceptor-ref param refer to an interceptor stack// If its an interceptor-stack, we call this method recursively until,// all the params (eg. interceptorStack1.interceptor1.param etc.)// are resolved down to a specific interceptor./** @since */import ActionProxyFactoryimport DefaultActionProxyFactoryimport DefaultLocaleProviderFactoryimport LocaleProviderFactoryimport StrutsTextProviderFactoryimport TextProviderFactoryimport DefaultUnknownHandlerFactoryimport UnknownHandlerFactoryimport HttpParametersPropertyAccessorimport ParameterPropertyAccessorimport AcceptedPatternsCheckerimport DefaultAcceptedPatternsCheckerimport DefaultExcludedPatternsCheckerimport DefaultTextProviderimport DefaultUnknownHandlerManagerimport ExcludedPatternsCheckerimport TextProviderimport UnknownHandlerManagerimport ConversionAnnotationProcessorimport ConversionFileProcessorimport ConversionPropertiesProcessorimport NullHandlerimport ObjectTypeDeterminerimport TypeConverterCreatorimport TypeConverterHolderimport ArrayConverterimport CollectionConverterimport DateConverterimport DefaultConversionAnnotationProcessorimport DefaultConversionFileProcessorimport DefaultConversionPropertiesProcessorimport DefaultObjectTypeDeterminerimport DefaultTypeConverterCreatorimport DefaultTypeConverterHolderimport InstantiatingNullHandlerimport NumberConverterimport StringConverterimport XWorkBasicConverterimport XWorkConverterimport ActionFactoryimport ConverterFactoryimport DefaultActionFactoryimport DefaultConverterFactoryimport DefaultInterceptorFactoryimport DefaultResultFactoryimport InterceptorFactoryimport ResultFactoryimport ObjectProxyimport OgnlReflectionContextFactoryimport ObjectAccessorimport ObjectProxyPropertyAccessorimport XWorkCollectionPropertyAccessorimport XWorkEnumerationAccessorimport XWorkIteratorPropertyAccessorimport XWorkListPropertyAccessorimport XWorkMapPropertyAccessorimport XWorkMethodAccessorimport CompoundRootimport LocalizedTextProviderimport StrutsLocalizedTextProviderimport OgnlTextParserimport TextParserimport WildcardHelperimport ReflectionContextFactoryimport ActionValidatorManagerimport AnnotationActionValidatorManagerimport DefaultActionValidatorManagerimport DefaultValidatorFactoryimport DefaultValidatorFileParserimport ValidatorFactoryimport ValidatorFileParserimport MethodAccessorimport Parameterimport EnumerationAcceptedPatternsChecker.classDefaultAcceptedPatternsChecker.classScope.PROTOTYPEExcludedPatternsChecker.classDefaultExcludedPatternsChecker.classActionValidatorManager.classDefaultActionValidatorManager.classAnnotationActionValidatorManager.classNullHandler.classInstantiatingNullHandler.classMethodAccessor.classXWorkMethodAccessor.classParameterPropertyAccessor.classHttpParametersPropertyAccessor.classObjectProxyPropertyAccessor.classXWorkCollectionPropertyAccessor.classXWorkMapPropertyAccessor.classXWorkListPropertyAccessor.classUnknownHandlerManager.classDefaultUnknownHandlerManager.classXWorkEnumerationAccessor.classXWorkIteratorPropertyAccessor.classObjectAccessor.classReflectionContextFactory.classOgnlReflectionContextFactory.classWildcardHelper.classValidatorFileParser.classDefaultValidatorFileParser.classDefaultActionProxyFactory.classIterator<>.classEnumeration<>.classList<>.classArrayList<>.classHashSet<>.classSet<>.classHashMap<>.classMap<>.classCollection<>.classObjectProxy.classHttpParameters.classParameter.classBoolean.FALSEBoolean.TRUE// silly workarounds for ognl since there is no way to flush its cachesimport ConfigurationUtilimport ResultTypeConfigimport LocatableFactoryimport ClassPathFinderimport DomHelperimport BooleanUtilsimport Documentimport Elementimport Nodeimport NodeListimport InputSourceimport Modifierimport Vector/** Looks in the classpath for an XML file, "xwork.xml" by default, ... */List<Document> documents, ...;Set<String> includedFileNames, ...;String configFileName, ...;Set<String> loadedFileUrls, ...;boolean errorIfMissing, ...;Map<String,String> dtdMappings, ...;boolean throwExceptionOnDuplicateBeans, ...;Map<String,Element> declaredPackages, ...;FileManager fileManager, ...;ValueSubstitutor valueSubstitutor, ...;Map<String,String> mappingsthis.configFileNamethis.errorIfMissingsetDtdMappings(...)this.throwExceptionOnDuplicateBeansthis.dtdMappingsthis.fileManagergetFileManager(...)this.valueSubstitutor/** Returns an unmodifiable map of DTD mappings ... */this.includedFileNamesgetLoadedFileNames(...)loadDocuments(...)XmlConfigurationProvider xmlConfigurationProviderxmlConfigurationProvider.configFileNameloadConfigurationFiles(...)Map<String,Node> loadedBeansnew HashMap<String,Node>(...)Document docElement rootElementgetDocumentElement(...)NodeList childrengetChildNodes(...)int childSizegetLength(...)Node childNodeitem(...)Element childString nodeNamegetNodeName(...)String typeString implString onlyStaticString scopeStrboolean optionalScope scopeScope.REQUESTScope.SESSIONScope.THREADClass<> classImplClass<> classTypegetDeclaredClasses(...)injectStatics(...)Location locgetDeclaredConstructors(...)new LocatableFactory<>(...)Throwable exsubstitute(...)List<UnknownHandlerConfig> unknownHandlerStacknew ArrayList<UnknownHandlerConfig>(...)NodeList unknownHandlersgetElementsByTagName(...)int unknownHandlersSizeint kElement unknownHandlerLocation locationnew UnknownHandlerConfig(...)setUnknownHandlerStack(...)List<Element> reloadsnew ArrayList<Element>(...)verifyPackageStructure(...)PackageConfig cfgaddPackage(...)isNeedsRefresh(...)loadExtraConfiguration(...)reloadRequiredPackages(...)DirectedGraph<String> graphnew DirectedGraph<String>(...)CycleDetector<String> detectornew CycleDetector<String>(...)String packageNameString extendsAttributeaddNode(...)String parentaddEdge(...)containsCycle(...)StringBuilder buildergetVerticesInCycles(...)List<Element> resultElement pkgElement rpList<PackageConfig> parentsbuildParentsFromString(...)/** Tells whether the ConfigurationProvider should reload its configuration. This method should only be called ... */String urlfileNeedsReloading(...)getLocationObject(...)buildInterceptorList(...)List<ExceptionMappingConfig> exceptionMappingsbuildExceptionMappings(...)buildAllowedMethods(...)verifyAction(...)buildResults(...)addActionConfig(...)isNoArgConstructorRequired(...)isPublic(...)getModifiers(...)getConstructor(...)new Class<>[]ClassNotFoundException eNoSuchMethodException eRuntimeException ex/** Create a PackageConfig from an XML element representing it. ... */Builder newPackagebuildPackageContext(...)NodeList actionListaddResultTypes(...)loadInterceptors(...)loadDefaultInterceptorRef(...)loadDefaultClassRef(...)loadGlobalResults(...)loadGlobalAllowedMethods(...)loadGlobalExceptionMappings(...)Element actionElementaddAction(...)loadDefaultActionRef(...)addPackageConfig(...)NodeList resultTypeListElement resultTypeElementString defverifyResultType(...)String paramNameResultTypeConfig.BuilderBuilder resultTypedefaultResultParam(...)getField(...)addResultTypeConfig(...)toBoolean(...)defaultResultType(...)Throwable e...|...NodeList interceptorRefListElement interceptorRefElementgetParentNode(...)lookupInterceptorReference(...)String abstractValboolean isAbstractdefaultString(...)boolean strictDMIBuilder cfgstrictMethodInvocation(...)namespace(...)hasAttribute(...)getPackageConfigNames(...)needsRefresh(...)addParents(...)/** Build a map of ResultConfig objects from below a given XML element. ... */NodeList resultElsElement resultElementString resultNameString resultTypeResultTypeConfig configgetResultType(...)String resultClassMap<String,String> resultParamsMap<String,String> configParamsSet<String> resultNamesSetguessResultType(...)getDefaultResultParam(...)StringBuilder paramValueString valgetNodeType(...)Node.TEXT_NODEgetNodeValue(...)boolean capNextisLowerCase(...)/** Build a list of exception mapping objects from below a given XML element. ... */NodeList exceptionMappingElsElement ehElementString emNameString exceptionClassNameString exceptionResultExceptionMappingConfig ehConfigNodeList allowedMethodsElsgetGlobalAllowedMethods(...)Node ngetFirstChild(...)ActionConfig.WILDCARDElement defaultRefElementdefaultInterceptorRef(...)defaultActionRef(...)/** Load all of the global results for this package from the XML element. ... */NodeList globalResultListElement globalResultElementaddGlobalResultConfigs(...)NodeList globalAllowedMethodsElmsSet<String> globalAllowedMethodsaddGlobalAllowedMethods(...)NodeList defaultClassRefListElement defaultClassRefElementdefaultClassRef(...)NodeList globalExceptionMappingListElement globalExceptionMappingElementaddGlobalExceptionMappingConfigs(...)InterceptorStackConfig.BuilderBuilder configNodeList interceptorStackListElement interceptorStackElementInterceptorStackConfig configloadInterceptorStack(...)addInterceptorStackConfig(...)NodeList interceptorListElement interceptorElementInterceptorConfig.BuilderaddInterceptorConfig(...)loadInterceptorStacks(...)List<Document> docsnew ArrayList<Document>(...)List<Document> finalDocsIterator<URL> urlsInputStream isIOException ioExceptiongetConfigurationUrls(...)IOException exInputSource innew InputSource(...)loadFile(...)setSystemId(...)XWorkException eIOException enew Comparator<Document>(...) { ... }getLoadOrder(...)String includeFileNameClassPathFinder wildcardFindernew ClassPathFinder(...)Vector<String> wildcardMatchesfindMatches(...)setPattern(...)String matchgetResources(...)XmlConfigurationProvider.class/** Allows subclasses to load extra information from the document ... *//** Looks up the Interceptor Class from the interceptor-ref name and creates an instance, which is added to the ... */String refNameMap<String,String> refParamsnew HashMap<String,Element>(...)// Force loading of class to detect no class def found exceptions// Print out error messages for all misconfigured inheritance packages//methodName should be null if it's not set// if there isn't a class name specified for an <action/> then try to// use the default-class-ref from the <package/>// if there is a package default-class-ref use that, otherwise use action support/* if (StringUtils.isNotEmpty(packageContext.getDefaultClassRef())) { ... */// Probably not a big deal, like request or session-scoped Spring beans that need a real request// Default to failing fast// add result types (and default result) to this package// load the interceptors and interceptor stacks for this package// load the default interceptor reference for this package// load the default class ref for this package// load the global result list for this package// load the global exception handler list for this package// get actions// load the default action reference for this package// set the default result type// Strict DMI is enabled by default, it can disabled by user// has parents, let's look it up// if you don't specify a name on <result/>, it defaults to "success"// there is no result type, so let's inherit from the parent package// now check if there is a result type now// uh-oh, we have a problem// invalid result type specified in result definition// maybe we just have a body - therefore a default parameter// if <result ...>something</result> then we add a parameter of 'something' as this is the most used result param// create new param map, so that the result param can override the config param// user defined 'allowed-methods' so used them whatever Strict DMI was enabled or not// user enabled Strict DMI but didn't defined action specific 'allowed-methods' so we use 'global-allowed-methods' only// Strict DMI is disabled so any method can be called//sort the documents, according to the "order" attribute// handleWildCardIncludes(includeFileName, docs, child);// no op/** XML utilities. ... */LinkedHashMap<String,String> paramsNodeList childNodesNode.ELEMENT_NODEElement paramElementgetContent(...)Node currentNodeString numberNumberFormatException e//no order specifiedimport TypeConversion/** Used to process {@link com.opensymphony.xwork2.conversion.annotations.TypeConversion} ... *//** Process annotation and build {@link TypeConverter} base on provided annotation ... *//** Used to process &lt;clazz&gt;-conversion.properties file to read defined Converters *//** Process conversion file to create mapping for key (property, type) and corresponding converter ... *//** Used to read converters from Properties file *//** Process given property to load converters as not required (Properties file doesn't have to exist) ... *//** Process given property to load converters as required (Properties file must exist) ... *//** Method called on target returned null. ... *//** Property in target evaluated to null.  Property can be a constant ... *///--------------------------------------------------------------------------//Copyright (c) 1998-2004, Drew Davidson and Luke Blanshard//All rights reserved.//Redistribution and use in source and binary forms, with or without//modification, are permitted provided that the following conditions are//met://Redistributions of source code must retain the above copyright notice,//this list of conditions and the following disclaimer.//Redistributions in binary form must reproduce the above copyright//notice, this list of conditions and the following disclaimer in the//documentation and/or other materials provided with the distribution.//Neither the name of the Drew Davidson nor the names of its contributors//may be used to endorse or promote products derived from this software//without specific prior written permission.//THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS//"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT//LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS//FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE//COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,//INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,//BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS//OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED//AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,//OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF//THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH//DAMAGE./** Determines what the key and and element class of a Map or Collection should be. For Maps, the elements are the ... *//** TypeConversionException should be thrown by any TypeConverters which fail to convert values ... *//** Constructs a <code>XWorkException</code> with no detail  message. ... */import Member/** Interface for accessing the type conversion facilities within a context. ... *//** Converts the given value to a given type.  The OGNL context, target, member and ... */Object NO_CONVERSION_POSSIBLE, ...;String TYPE_CONVERTER_CONTEXT_KEY, ...;//  Copyright (c) 1998-2004, Drew Davidson and Luke Blanshard//  All rights reserved.//  Redistribution and use in source and binary forms, with or without//  modification, are permitted provided that the following conditions are//  met://  Redistributions of source code must retain the above copyright notice,//  this list of conditions and the following disclaimer.//  Redistributions in binary form must reproduce the above copyright//  notice, this list of conditions and the following disclaimer in the//  documentation and/or other materials provided with the distribution.//  Neither the name of the Drew Davidson nor the names of its contributors//  may be used to endorse or promote products derived from this software//  without specific prior written permission.//  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS//  "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT//  LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS//  FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE//  COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,//  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,//  BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS//  OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED//  AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,//  OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF//  THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH//  DAMAGE./** Instantiate converter classes, if cannot create TypeConverter throws exception *//** Creates {@link TypeConverter} from given class ... *//** Holds all mappings related to {@link TypeConverter}s *//** Adds mapping for default type converters - application scoped ... *//** Checks if converter was already defined for given class ... *//** Returns instance of {@link TypeConverter} associated with given class ... *//** Target class conversion Mappings. ... *//** Assign mapping of converters for given class ... *//** Check if there is no mapping for given class to convert ... *//** Adds no mapping flag for give class ... *//** Checks if no mapping was defined for given class name ... *//** Adds no converter flag for given class name ... */import ElementTypeimport Retentionimport RetentionPolicyimport TargetElementType.TYPERetentionPolicy.RUNTIME/** Allow Type Conversions being applied at Type level. ... *//** <code>ConversionRule</code> ... */ConversionRule PROPERTY, ...;ConversionRule COLLECTION, ...;ConversionRule MAP, ...;ConversionRule KEY, ...;ConversionRule KEY_PROPERTY, ...;ConversionRule ELEMENT, ...;ConversionRule CREATE_IF_NULL, ...;new ConversionRule(...)/** <code>ConversionType</code> ... */ConversionType APPLICATION, ...;ConversionType CLASS, ...;new ConversionType(...)ElementType.METHOD/** The optional key name used within TYPE level annotations. ... *//** The ConversionType can be either APPLICATION or CLASS. ... *//** The ConversionRule can be a PROPERTY, KEY, KEY_PROPERTY, ELEMENT, COLLECTION (deprecated) or a MAP. ... *//** The class of the TypeConverter to be used as converter. ... *//** If used with ConversionRule.KEY_PROPERTY specify a value here! ... */import ArrayClass<> componentTypegetComponentType(...)TypeConverter convertergetTypeConverter(...)int lengthObject valueItemconvertValue(...)import XWorkListimport SortedSetimport TreeSetObjectTypeDeterminer objectTypeDeterminer, ...;this.objectTypeDeterminerCollection<> resultClass<> memberTypegetElementClass(...)isAssignableFrom(...)Object[] objArraycreateCollection(...)objArray.lengthObject anObjArrayObject convertedValueTypeConverter.NO_CONVERSION_POSSIBLECollection<> colObject aColnew HashSet<>(...)SortedSet<>.classnew TreeSet<>(...)new XWorkList(...)// no need to do anythingimport ConstructorDate resultString saDateFormat dfTime.classgetTimeInstance(...)Timestamp.classDate checkSimpleDateFormat dtfmtDateFormat.SHORTSimpleDateFormat fullfmttoPattern(...)SimpleDateFormat dfmtgetDateInstance(...)SimpleDateFormat[] fmtsnew SimpleDateFormat[]SimpleDateFormat fmtParseException ignoreDate.classDateFormat[] dfsgetDateFormats(...)DateFormat df1setLenient(...)Constructor<> constructorlong.classDateFormat dt1DateFormat.LONGDateFormat dt2DateFormat dt3DateFormat d1DateFormat d2DateFormat d3DateFormat rfc3339DateFormat rfc3339dateOnlynew DateFormat[]//final fallback for dates without time// let's use strict parsing (XW-341)import ConversionRuleimport ConversionType/** Default implementation of {@link ConversionAnnotationProcessor} */TypeConverterCreator converterCreator, ...;TypeConverterHolder converterHolder, ...;this.converterCreatorthis.converterHolderconverter(...)converterClass(...)type(...)ConversionType.APPLICATIONisNoneEmpty(...)addDefaultMapping(...)createTypeConverter(...)rule(...)ConversionRule.KEY_PROPERTYConversionRule.CREATE_IF_NULLvalue(...)ConversionRule.ELEMENTConversionRule.KEYConversionRule.COLLECTIONClass<?> converterClassgetContextClassLoader(...)currentThread(...)//for properties of classes//for keys of Maps//check if the converter is a type converter if it is one//then just put it in the map as is. Otherwise//put a value in for the type converter of the class//elements(values) of maps / lists/** Default implementation of {@link ConversionFileProcessor} */Properties propnew Properties(...)load(...)Entry<Object,Object> entryMap<>.Entry<Object,Object>DefaultObjectTypeDeterminer.KEY_PROPERTY_PREFIXDefaultObjectTypeDeterminer.CREATE_IF_NULL_PREFIXDefaultObjectTypeDeterminer.ELEMENT_PREFIXDefaultObjectTypeDeterminer.KEY_PREFIXDefaultObjectTypeDeterminer.DEPRECATED_ELEMENT_PREFIXTypeConverter _typeConverterClass<> converterClassClass<> _c// for keyProperty of SetloadConversionProperties(...)Iterator<URL> resourcesEntry<> entryTypeConverter typeConverterimport CreateIfNullimport Keyimport KeyPropertyimport ReflectionExceptionimport IntrospectionExceptionimport Annotationimport Fieldimport Methodimport ParameterizedTypeimport TypeString KEY_PREFIX, ...;String ELEMENT_PREFIX, ...;String KEY_PROPERTY_PREFIX, ...;String CREATE_IF_NULL_PREFIX, ...;String DEPRECATED_ELEMENT_PREFIX, ...;ReflectionProvider reflectionProvider, ...;XWorkConverter xworkConverter, ...;this.reflectionProviderthis.xworkConverter/** Determines the key class by looking for the value of @Key annotation for the given class. ... */Key annotationgetAnnotation(...)Key.classgetConverter(...)/** Determines the element class by looking for the value of @Element annotation for the given ... */Element annotationElement.class/** Determines the key property for a Collection by getting it from the @KeyProperty annotation. ... */KeyProperty annotationKeyProperty.class/** Determines the createIfNull property for a Collection or Map by getting it from the @CreateIfNull annotation. ... */CreateIfNull annotationCreateIfNull.classString configValue/** Retrieves an annotation for the specified property of field, setter or getter. ... */T annotationField fieldgetAnnotationFromSetter(...)getAnnotationFromGetter(...)/** Retrieves an annotation for the specified field of getter. ... */Method gettergetGetMethod(...)/** Retrieves an annotation for the specified field of setter. ... */Method settergetSetMethod(...)/** Returns the class for the given field via generic type check. ... */Type genericTypegetGenericType(...)getGenericParameterTypes(...)getGenericReturnType(...)ParameterizedType typegetRawType(...)Type resultTypegetActualTypeArguments(...)//check if a value is in the config//default values depend on target type//and whether this is accessed by an index//in the case of List// HINT: try with setter// HINT: try with getter// ignore// Check fields first// Try to get ParameterType from setter method// Try to get ReturnType from getter methodimport LocaleProviderimport XWorkTypeConverterWrapperimport BigDecimalimport BigInteger/** Default type conversion. Converts among numeric types and also strings.  Contains the basic ... */String MILLISECOND_FORMAT, ...;String NULL_STRING, ...;Map<Class<>,Object> primitiveDefaults, ...;TypeConverter.TYPE_CONVERTER_CONTEXT_KEYnew XWorkTypeConverterWrapper(...)/** Returns the value converted numerically to the given class type ... */int icountInteger.classInteger.TYPElongValue(...)Double.classDouble.TYPEdoubleValue(...)Boolean.classBoolean.TYPEbooleanValue(...)Byte.classByte.TYPECharacter.classCharacter.TYPEShort.classShort.TYPELong.classLong.TYPEFloat.classFloat.TYPEbigIntValue(...)BigDecimal.classbigDecValue(...)stringValue(...)Enum<>.classenumValue(...)isPrimitive(...)/** Evaluates the given object as a boolean: if it is a Boolean object, it's ... */Class<> cEnum<?> result/** Evaluates the given object as a long integer. ... */getSuperclass(...)Number.classparseLong(...)/** Evaluates the given object as a double-precision floating-point number. ... */parseDouble(...)/** Evaluates the given object as a BigInteger. ... */toBigInteger(...)charValue(...)new BigInteger(...)/** Evaluates the given object as a BigDecimal. ... */new BigDecimal(...)/** Evaluates the given object as a String and trims it if the trim flag is ... *//** Evaluates the given object as a String. ... */Map<Class<>,Object> mapnew HashMap<Class<>,Object>(...)new Double(...)// for backwards-compatibility/* If array -> array then convert components of array individually */// if ( c == String.class )// return ((String)value).length() > 0;// non-null/* For 1.1 parseDouble() is not available */// return Double.valueOf( value.toString() ).doubleValue();/** Default implementation of {@link TypeConverterCreator} */// For backwards compatibility/** Default implementation of {@link TypeConverterHolder} */HashMap<String,TypeConverter> defaultMappings, ...;/** Record class and its type converter mapping. ... */HashMap<Class<>,Map<String,Object>> mappings, ...;// non-action (eg. returned value)HashSet<Class<>> noMapping, ...;/** Unavailable target class conversion mappings, serves as a simple cache. */// actionHashSet<String> unknownMappings, ...;/** Record classes that doesn't have conversion mapping defined. ... */new HashMap<String,TypeConverter>(...)new HashMap<Class<>,Map<String,Object>>(...)new HashSet<Class<>>(...)import ReflectionContextStateimport PropertyDescriptorboolean cisCreatingNullObjects(...)String propNameObject realTargetgetRealTarget(...)Object paramcreateObject(...)PropertyDescriptor pdgetPropertyDescriptor(...)getPropertyType(...)EnumMap<>.classClass<> keyClassgetKeyClass(...)new EnumMap<>(...)// can't do much here!import DecimalFormatimport NumberFormatimport ParsePositionString stringValueconvertToBigDecimal(...)double.classconvertToDouble(...)float.classconvertToFloat(...)isInRange(...)NumberFormat numFormatParsePosition parsePosnew ParsePosition(...)Number numberisIntegerType(...)setParseIntegerOnly(...)setGroupingUsed(...)getIndex(...)NumberFormat formatgetNumberFormat(...)ParsePosition parsePositionchar separatorgetGroupingSeparator(...)getDecimalFormatSymbols(...)setParseBigDecimal(...)normalize(...)floatValue(...)getNumberInstance(...)replaceAll(...)Number bigValueNumber lowerBoundNumber upperBoundnegate(...)Double.MAX_VALUEFloat.MAX_VALUEbyte.classByte.MIN_VALUEByte.MAX_VALUEchar.classCharacter.MIN_VALUECharacter.MAX_VALUEshort.classShort.MIN_VALUEShort.MAX_VALUEint.classInteger.MIN_VALUELong.MIN_VALUELong.MAX_VALUE// pass it through DefaultTypeConverter// this is a hack as \160 isn't the same as " " (an empty space)// Double.MIN_VALUE is the smallest positive non-zero number// Float.MIN_VALUE is the smallest positive non-zero number//shoult it fail here? BigInteger doesnt seem to be so nice parsing numbers as NumberFormatList<String> convertedconvertToString(...)join(...)Collection<?> colValueisInstance(...)setMinimumFractionDigits(...)doConvertToString(...)boolean.classdoConvertToBoolean(...)doConvertToArray(...)doConvertToDate(...)Calendar.classdoConvertToCalendar(...)doConvertToCollection(...)doConvertToCharacter(...)doConvertToNumber(...)doConvertToClass(...)Object[] arrayarray.lengthDate dateResultCalendar calendarsetTime(...)String cStrString bStrforName(...)getLocalizedMessage(...)// no need to convert at all, right?/* the code below has been disabled as it causes sideffects in Struts2 (XW-512) ... */// okay use default string conversion// let's try to convert the first element only// we've already tried the types we knowimport Conversionimport MatcherString REPORT_CONVERSION_ERRORS, ...;String CONVERSION_PROPERTY_FULLNAME, ...;String CONVERSION_ERROR_PROPERTY_PREFIX, ...;String CONVERSION_COLLECTION_PREFIX, ...;String LAST_BEAN_CLASS_ACCESSED, ...;String LAST_BEAN_PROPERTY_ACCESSED, ...;String MESSAGE_INDEX_PATTERN, ...;String MESSAGE_INDEX_BRACKET_PATTERN, ...;String PERIOD, ...;Pattern messageIndexPattern, ...;TypeConverter defaultTypeConverter, ...;boolean reloadingConfigs, ...;ConversionFileProcessor fileProcessor, ...;ConversionAnnotationProcessor annotationProcessor, ...;this.defaultTypeConverterthis.reloadingConfigsprocessRequired(...)process(...)this.fileProcessorthis.annotationProcessorLocalizedTextProvider localizedTextProviderString defaultMessageList<String> indexValuesgetIndexValues(...)String getTextExpressionremoveAllIndexesInPropertyName(...)Matcher matcherList<String> indexesfind(...)Integer indexgroup(...)/** Convert value from one form to another. ... */TypeConverter tcObject[] classPropgetClassProperty(...)Object lastPropertyPathReflectionContextState.CURRENT_PROPERTY_PATHXWorkConverter.LAST_BEAN_CLASS_ACCESSEDString path...[].classlookup(...)handleConversionException(...)/** Looks for a TypeConverter in the default mappings. ... */TypeConverter resultgetDefaultMapping(...)containsUnknownMapping(...)containsDefaultMapping(...)ClassNotFoundException cnfelookupSuper(...)registerConverter(...)registerConverterNotFound(...)containsNoMapping(...)Map<String,Object> mappinggetMapping(...)Object converterbuildConverterMapping(...)String nextaddNoMapping(...)String realPropertyString fullNameActionContext.CONVERSION_ERRORSaddUnknownMapping(...)Object lastClassObject lastProperty/** Looks for converter mappings for the specified class and adds it to an existing map.  Only new converters are ... */String converterFilenamebuildConverterFilename(...)Annotation[] annotationsgetAnnotations(...)Annotation annotationConversion conversionTypeConversion tcconversions(...)key(...)Method methodgetMethods(...)resolvePropertyName(...)/** Looks for converter mappings for the specified class, traversing up its class hierarchy and interfaces and adding ... */Class<> curClazzClass<>[] interfacesgetInterfaces(...)addConverterMapping(...)Class<> anInterfaceaddMapping(...)URL fileUrl/** Recurses through a class' interfaces and class hierarchy looking for a TypeConverter in the default mapping that ... */// Process the conversion using the default mappings, if one exists// allow this method to be called without any context// i.e. it can be called with as little as "Object value" and "Class toClass"// this is to handle weird issues with setValue with a different type// ok, let's see if we can look it up by path as requested in XW-297// when converting to a string, use the source target's class's converter// when converting from a string, use the toClass's converter//Looks for super classes//Register now, the next lookup will be faster// if it isn't found, never look again (also faster)/** if it is primitive use default converter which allows to define different converters per type ... */// Process <clazz>-conversion.properties file// Process annotations// Process annotated methods// Default to the property name// check for conversion mapping associated with super classes and any implemented interfaces// add current class' mappings// check interfaces' mappings// Looks for direct interfaces (depth = 1 )// Looks for the superclass// If 'clazz' is the Object class, an interface, a primitive type or void then clazz.getSuperClass() returns nullimport PrintWriterimport StringWriter/** <code>ConversionDescription</code> ... *//** Jakarta commons-logging reference. */String MAP_PREFIX, ...;/** Key used for type conversion of maps. */String property, ...;String typeConverter, ...;String rule, ...;String fullQualifiedClassName, ...;String type, ...;/** Creates an ConversionDescription with the specified property name. ... */this.property/** Sets the class name of the type converter to be used. ... */this.typeConverterthis.ruleConversionRule.MAP/** Returns the conversion description as property entry. ... */StringWriter swnew StringWriter(...)PrintWriter writernew PrintWriter(...)print(...)flush(...)/** Returns the fullQualifiedClassName attribute is used to create the special <code>conversion.properties</code> file name. ... *//** The fullQualifiedClassName attribute is used to create the special <code>conversion.properties</code> file name. ... */this.fullQualifiedClassName/** Used by {@link com.opensymphony.xwork2.ObjectFactory} to build actions *//** Builds action instance ... *//** Dedicated interface used by {@link com.opensymphony.xwork2.ObjectFactory} to build {@link TypeConverter} *//** Default implementation */getCanonicalName(...)String interceptorClassNameMap<String,String> thisInterceptorClassParamsThrowable causeWithLazyParams.classsetProperties(...)ClassCastException eNoClassDefFoundError e// interceptor instances are long-lived and used across user sessions, so don't try to pass in any extra contextimport ReflectionExceptionHandlerString resultClassNameEntry<String,String> paramEntryMap<>.Entry<String,String>ReflectionException exhandle(...)import UnknownHandlerValidator<> validator/** Dedicated interface used by {@link com.opensymphony.xwork2.ObjectFactory} to build {@link com.opensymphony.xwork2.interceptor.Interceptor} *//** Used by {@link com.opensymphony.xwork2.ObjectFactory} to build {@link com.opensymphony.xwork2.Result} *//** Dedicated interface used by {@link com.opensymphony.xwork2.ObjectFactory} to build {@link com.opensymphony.xwork2.UnknownHandler} *//** Builds unknown handler of given name ... *//** Dedicated interface used by {@link com.opensymphony.xwork2.ObjectFactory} to build {@link Validator} */import InvocationHandlerimport InvocationTargetExceptionimport Proxy/** Context of a dependency construction. Used to manage circular references. ... */T currentReference, ...;boolean constructing, ...;List<DelegatingInvocationHandler<T>> invocationHandlers, ...;this.currentReferencethis.constructingDelegatingInvocationHandler<T> invocationHandlernew DelegatingInvocationHandler<T>(...)isInterface(...)new DependencyException(...)new ArrayList<DelegatingInvocationHandler<T>>(...)newProxyInstance(...)getClassLoader(...)setDelegate(...)T delegate, ...;new RuntimeException(...)InvocationTargetException egetTargetException(...)this.delegate/** Copyright (C) 2006 Google Inc. ... */// TODO: if I create a proxy which implements all the interfaces of// the implementation type, I'll be able to get away with one proxy// instance (as opposed to one per caller).String DEFAULT_NAME, ...;/** Default dependency name. *//** Injects dependencies into the fields and methods of an existing object. ... *//** Creates and injects a new instance of type {@code implementation}. ... *//** Gets an instance of the given dependency which was declared in ... *//** Convenience method.&nbsp;Equivalent to {@code getInstance(type, ... *//** Gets a set of all registered names for the given type ... *//** Sets the scope strategy for the current thread. ... */Scope.Strategy/** Removes the scope strategy for the current thread. *//** Builds a dependency injection {@link Container}. The combination of ... */Map<Key<?>,InternalFactory<?>> factories, ...;List<InternalFactory<?>> singletonFactories, ...;List<Class<?>> staticInjections, ...;boolean created, ...;boolean allowDuplicates, ...;InternalFactory<Container> CONTAINER_FACTORY, ...;InternalFactory<Logger> LOGGER_FACTORY, ...;/** Constructs a new builder. */Container.classLogger.class/** Maps a dependency. All methods in this class ultimately funnel through ... */InternalFactory<? extends T> scopedFactoryscopeFactory(...)getType(...)ensureNotCreated(...)checkKey(...)new InternalFactory<T>(...) { ... }setExternalContext(...)getContainerImpl(...)/** Ensures a key isn't already mapped. ... *//** Maps a factory to a given dependency type and name. ... */InternalFactory<T> internalFactoryContext externalContextgetExternalContext(...)/** Convenience method.&nbsp;Equivalent to {@code factory(type, ... *//** Convenience method.&nbsp;Equivalent to {@code factory(type, name, factory, ... *//** Maps an implementation class to a given dependency type and name. Creates ... */InternalFactory<? extends T> factoryContainerImpl.ConstructorInjector<? extends T> constructor, ...;ContainerImpl.ConstructorInjector<? extends T>this.constructorconstruct(...)Scoped scopedScoped.class/** Convenience method.&nbsp;Equivalent to {@code factory(type, name, type)}. ... *//** Convenience method.&nbsp;Equivalent to {@code factory(type, name, type, ... *//** Convenience method.&nbsp;Equivalent to {@code alias(type, Container.DEFAULT_NAME, ... */alias(...)/** Maps an existing factory to a new name. ... *//** Maps an existing dependency. All methods in this class ultimately funnel through ... *//** Maps a constant value to the given name. ... *//** Maps a class to the given name. ... *//** Maps an enum to the given name. ... */getDeclaringClass(...)/** Maps a constant value to the given type and name. ... */InternalFactory<T> factory/** Upon creation, the {@link Container} will inject static fields and methods ... *//** Convenience method.&nbsp;Equivalent to {@code contains(type, ... *//** Creates a {@link Container} instance. Injects static members for classes ... */ContainerImpl containernew ContainerImpl(...)new HashMap<Key<?>,InternalFactory<?>>(...)callInContext(...)new ContainerImpl.ContextualCallable<Void>(...) { ... }ContainerImpl.ContextualCallable<Void>InternalFactory<?> factory/** Currently we only support creating one Container instance per builder. ... *//** Implemented by classes which participate in building a container. *//** Contributes factories to the given builder. ... */new ArrayList<InternalFactory<?>>(...)new ArrayList<Class<?>>(...)new InternalFactory<Container>(...) { ... }new InternalFactory<Logger>(...) { ... }Member membergetMember(...)getAnonymousLogger(...)// In the current container as the default Container implementation.// Inject the logger for the injected member's declaring class.// This factory creates new instances of the given implementation.// We have to lazy load the constructor because the Container// hasn't been created yet.import ReferenceCacheimport java.lang.reflect.*import AccessControlExceptionimport Entry/** Default {@link Container} implementation. ... */Map<Class<?>,Set<String>> factoryNamesByType, ...;Map<Class<?>,Set<String>> mapnew HashMap<Class<?>,Set<String>>(...)this.factoriesKey<?> keySet<String> namesEntry<Class<?>,Set<String>> entrythis.factoryNamesByTypeMap<Class<?>,List<Injector>> injectors, ...;/** Field and method injectors. *//** Recursively adds injectors for fields and methods from the given class to the given list. Injects parent classes ... */addInjectors(...)addInjectorsForFields(...)getDeclaredFields(...)addInjectorsForMethods(...)getDeclaredMethods(...)List<Injector> injectorsnew ArrayList<Injector>(...)Class<?> clazznew ContextualCallable<Void>(...) { ... }Injector injectoraddInjectorsForMembers(...)new InjectorFactory<Method>(...) { ... }new MethodInjector(...)new InjectorFactory<Field>(...) { ... }new FieldInjector(...)M memberisStatic(...)Inject injectInject.classMissingDependencyException erequired(...)Field field, ...;InternalFactory<?> factory, ...;ExternalContext<?> externalContext, ...;this.fieldisAccessible(...)SecurityManager smgetSecurityManager(...)checkPermission(...)new ReflectPermission(...)setAccessible(...)AccessControlException egetFactory(...)new MissingDependencyException(...)this.externalContextExternalContext<?> previousnew AssertionError(...)/** Gets parameter injectors. ... */List<ParameterInjector<?>> parameterInjectorsnew ArrayList<ParameterInjector<?>>(...)Iterator<Annotation[]> annotationsIteratorClass<?> parameterTypeInject annotationfindInject(...)createParameterInjector(...)ExternalContext<T> externalContextnew ParameterInjector<T>(...)new ParameterInjector<>[]/** Finds the {@link Inject} annotation in an array of annotations. */annotationType(...)cast(...)Method method, ...;...[] parameterInjectors, ...;Class<?>[] parameterTypesgetParameterTypes(...)parameterTypes.lengthgetParametersInjectors(...)getParameterAnnotations(...)Map<Class<?>,ConstructorInjector<>> constructors, ...;Class<T> implementation, ...;List<Injector> injectors, ...;Constructor<T> constructor, ...;MissingDependencyException exceptionParameterInjector<?>[] parametersfindConstructorIn(...)constructParameterInjector(...)container.injectorsgetParameterTypes(...).lengthConstructor<T> foundConstructor<T>[] declaredConstructorsConstructor<T> constructorgetDeclaredConstructor(...)/** Construct an instance. Returns {@code Object} instead of {@code T} because it may return a proxy. */ConstructionContext<T> constructionContextgetConstructionContext(...)T tgetCurrentReference(...)isConstructing(...)createProxy(...)startConstruction(...)Object[] parameterssetProxyDelegates(...)finishConstruction(...)setCurrentReference(...)ReflectiveOperationException eremoveCurrentReference(...)ExternalContext<T> externalContext, ...;InternalFactory<? extends T> factory, ...;this.factoryparameterInjectors.lengthparameters.lengththis.injectorsConstructorInjector<T> constructorKey<T> keyInternalFactory<> onew ContextualCallable<T>(...) { ... }emptySet(...)ThreadLocal<Object[]> localContext, ...;/** Looks up thread local context. Creates (and removes) a new context if necessary. */Object[] referencenew InternalContext(...)call(...)/** Gets a constructor function for a given implementation class. */ThreadLocal<Object> localScopeStrategy, ...;this.localScopeStrategy/** Injects a field or method in a given object. */new ReferenceCache<Class<?>,List<Injector>>(...) { ... }new ReferenceCache<Class<?>,ConstructorInjector<>>(...) { ... }new ConstructorInjector<>(...)ContainerImpl.thisnew ThreadLocal<Object[]>(...) { ... }new ThreadLocal<Object>(...)// Add injectors for superclass first.// TODO (crazybob): Filter out overridden members.// default constructor.// If no annotated constructor is found, look for a no-arg constructor// instead.// We have a circular reference between constructors. Return a proxy.// TODO (crazybob): if we can't proxy this object, can we proxy the// other object?// If we're re-entering this factory while injecting fields or methods,// return the same instance. This prevents infinite loops.// First time through...// Store reference. If an injector re-enters this factory, they'll// get the same reference.// Inject fields and methods.// Only remove the context if this call created it.// WW-3768: ThreadLocal was not removed// Someone else will clean up this context./** Context of the current injection. ... *//** Thrown when a dependency is misconfigured. ... *//** An immutable snapshot of the current context which is safe to ... */Member member, ...;Key<T> key, ...;ContainerImpl container, ...;this.membercontainer.localScopeStrategynew ExternalContext<T>(...)/** A custom factory. Creates objects which will be injected. ... *//** Creates an object to be injected. ... */import static Container.DEFAULT_NAMEimport static ElementType.*import static RetentionPolicy.RUNTIME/** <p>Annotates members and parameters which should have their value[s] ... *//** Internal context. Used to coordinate injections and support circular ... */Map<Object,ConstructionContext<?>> constructionContexts, ...;Scope.Strategy scopeStrategy, ...;new ConstructionContext<T>(...)new HashMap<Object,ConstructionContext<?>>(...)/** Creates objects which will be injected. ... *//** Dependency mapping key. Uniquely identified by the required type and name. ... */Class<T> type, ...;int hashCode, ...;new NullPointerException(...)Key<> otherother.typenew Key<T>(...)import Callable/** Scope of an injected objects. ... */Scope PROTOTYPE, ...;/** One instance per injection. */Scope SINGLETON, ...;/** One instance per container. */Scope THREAD, ...;Scope REQUEST, ...;/** One instance per request. */Scope SESSION, ...;/** One instance per session. */Scope WIZARD, ...;/** One instance per wizard. */new Callable<T>(...) { ... }/** Wraps factory with scoping logic. ... *//** Pluggable scoping strategy. Enables users to provide custom ... *//** Finds an object for the given type and name in the request scope. ... *//** Finds an object for the given type and name in the session scope. ... *//** Finds an object for the given type and name in the wizard scope. ... */new Scope(...) { ... }T instance, ...;ThreadLocal<T> threadLocal, ...;new ThreadLocal<T>(...)Strategy strategygetScopeStrategy(...)findInRequest(...)toCallable(...)findInSession(...)findInWizard(...)/** Annotates a scoped implementation class. ... */import PhantomReference/** Phantom reference with a {@link com.opensymphony.xwork2.inject.util.FinalizableReference#finalizeReferent() finalizeReferent()} method which a ... *//** Package-private interface implemented by references that have code to run ... *//** Invoked on a background thread after the referent has been garbage ... */import Referenceimport ReferenceQueueimport Level/** Starts a background thread that cleans up after reclaimed referents. ... */Logger logger, ...;finalizeReferent(...)deliverBadNews(...)log(...)Level.SEVEREThread threadnew Thread(...) { ... }cleanUp(...)InterruptedException esetDaemon(...)ReferenceQueue<Object> instance, ...;FinalizableReferenceQueue queuenew FinalizableReferenceQueue(...)/** Gets instance. */FinalizableReferenceQueue.classcreateAndStart(...)/* ignore */import SoftReference/** Soft reference with a {@link com.opensymphony.xwork2.inject.util.FinalizableReference#finalizeReferent() finalizeReferent()} method which a background ... */import WeakReference/** Weak reference with a {@link com.opensymphony.xwork2.inject.util.FinalizableReference#finalizeReferent() finalizeReferent()} method which a background ... *//** A Function provides a transformation on an object and returns the resulting ... *//** Applies the function to an object of type {@code F}, resulting in an object ... */import ObjectInputStreamimport java.util.concurrent.*import static ReferenceType.STRONG/** Extends {@link ReferenceMap} to support lazy loading values by overriding ... */ConcurrentMap<Object,Future<V>> futures, ...;ThreadLocal<Future<V>> localFuture, ...;/** Equivalent to {@code new ReferenceCache(STRONG, STRONG)}. *//** Override to lazy load values. Use as an alternative to {@link ... */FutureTask<V> futureTasknew FutureTask<V>(...)new CallableCreate(...)Object keyReferencereferenceKey(...)Future<V> futureputIfAbsent(...)V valuerun(...)putStrategy(...)referenceValue(...)ExecutionException e/** {@inheritDoc} ... */internalCreate(...)/** Cancels the current {@link #create(Object)}. Throws {@link ... */cancel(...)K key, ...;internalGet(...)/** Returns a {@code ReferenceCache} delegating to the specified {@code ... */ensureNotNull(...)new ReferenceCache<K,V>(...) { ... }apply(...)defaultReadObject(...)this.futuresnew ConcurrentHashMap<Object,Future<V>>(...)this.localFuturenew ThreadLocal<Future<V>>(...)// use a reference so we get the same equality semantics.// winning thread.// wait for winning thread.// try one more time (a previous future could have come and gone.)// create value.import ObjectOutputStreamimport ConcurrentHashMapimport ConcurrentMap/** Concurrent hash map that wraps keys and/or values in soft or weak ... */ConcurrentMap<Object,Object> delegate, ...;ReferenceType keyReferenceType, ...;ReferenceType valueReferenceType, ...;/** Concurrent hash map that wraps keys and/or values based on specified ... */ReferenceType.PHANTOMnew ConcurrentHashMap<Object,Object>(...)this.keyReferenceTypethis.valueReferenceTypeObject valueReferencemakeKeyReferenceAware(...)dereferenceValue(...)Object referenceAwareKeyEntry<? extends K,? extends V> entryMap<>.Entry<? extends K,? extends V>/** Returns an unmodifiable set view of the keys in this map. As this method ... */dereferenceKeySet(...)/** Returns an unmodifiable set view of the values in this map. As this ... */unmodifiableCollection(...)dereferenceValues(...)putIfAbsentStrategy(...)Object referenceAwareValuemakeValueReferenceAware(...)Object referenceAwareOldValuereplaceStrategy(...)/** Returns an unmodifiable set view of the entries in this map. As this ... */Map<>.Entry<K,V>Set<Entry<K,V>> entrySetnew HashSet<Entry<K,V>>(...)Entry<K,V> dereferenceddereferenceEntry(...)/** Dereferences an entry. Returns null if the key or value has been gc'ed. */K keydereferenceKey(...)new Entry(...)/** Creates a reference for a key. */new SoftKeyReference(...)new WeakKeyReference(...)/** Converts a reference to a key. */dereference(...)/** Converts a reference to a value. *//** Returns the refererent for reference given its reference type. *//** Creates a reference for a value. */new SoftValueReference(...)new WeakValueReference(...)/** Dereferences a set of key references. */dereferenceCollection(...)/** Dereferences a collection of value references. *//** Wraps key so it can be compared to a referenced key for equality. */new KeyReferenceAwareWrapper(...)/** Wraps value so it can be compared to a referenced value for equality. */new ReferenceAwareWrapper(...)/** Dereferences elements in {@code in} using ... */Object reference/** Marker interface to differentiate external and internal references. */identityHashCode(...)/** Tests weak and soft references for identity equality. Compares references ... */Object referentunwrap(...)/** Big hack. Used to compare keys and values to referenced keys and values ... */Object wrapped, ...;this.wrapped/** Used for keys. Overrides hash code to use identity hash code. */this.hashCodekeyHashCode(...)referenceEquals(...)Object keyReference, ...;this.keyReferencePutStrategy.PUTPutStrategy.PUT_IF_ABSENTPutStrategy.REPLACEPutStrategy PUT, ...;PutStrategy REPLACE, ...;PutStrategy PUT_IF_ABSENT, ...;new PutStrategy(...) { ... }map.delegatePutStrategy defaultPutStrategy, ...;V value, ...;Entry entryReferenceMap<>.Entry<>entry.keyentry.valuedefaultWriteObject(...)writeInt(...)Object keyObject valuewriteObject(...)int sizereadInt(...)readObject(...)// TODO (crazybob) if the value has been gc'ed but the entry hasn't been// cleaned up yet, this put will fail.// cleaned up yet, this will succeed when it probably shouldn't.// compare reference to reference.// are they the same reference? used in cleanup.// do they reference identical values? used in conditional puts.// is the wrapped object identical to the referent? used in lookups.// defer to reference's equals() logic.// don't persist gc'ed entries./** Reference type. Used to specify what type of reference to keep to a ... */ReferenceType STRONG, ...;/** Prevents referent from being reclaimed by the garbage collector. */ReferenceType SOFT, ...;/** Referent reclaimed in an LRU fashion when the VM runs low on memory and ... */ReferenceType WEAK, ...;/** Referent reclaimed when no strong or soft references exist. ... */ReferenceType PHANTOM, ...;/** Similar to weak references except the garbage collector doesn't actually ... */new ReferenceType(...)/** String utilities. ... *//** Returns a string that is equivalent to the specified string with its ... */char firstchar capitalized/** Provides default implementations of optional lifecycle methods *//** Does nothing *//** Override to handle interception */import ClearableValueStackimport EvaluatedString DEFAULT_ALIAS_KEY, ...;String aliasesKey, ...;boolean devMode, ...;this.devModethis.aliasesKeyActionContext acObject actionMap<String,String> parametersString aliasExpressionValueStack newStackboolean clearableStackMap<> aliasesMap<String,Object> contextclearContextValues(...)setCreatingNullObjects(...)setDenyMethodExecution(...)setReportingConversionErrors(...)String aliasEvaluated valuenew Evaluated(...)isDefined(...)HttpParameters contextParametersRuntimeException eString developerNotificationParametersInterceptor.classAliasInterceptor.class// get the action's parameters//get secure stack//if the stack's context can be cleared, do that to prevent OGNL//from having access to objects in the stack, see XW-641//keep locale from original context// override// workaroundimport ActionChainResultimport Unchainableimport ProxyUtilString ACTION_ERRORS, ...;String FIELD_ERRORS, ...;String ACTION_MESSAGES, ...;boolean copyMessages, ...;boolean copyErrors, ...;boolean copyFieldErrors, ...;Collection<String> excludes, ...;Collection<String> includes, ...;this.copyErrorsthis.copyFieldErrorsthis.copyMessagesCompoundRoot rootgetRoot(...)shouldCopyStack(...)copyStack(...)prepareList(...)Map<String,Object> ctxMapObject objectshouldCopy(...)Class<?> editableisProxy(...)ultimateTargetClass(...)copy(...)prepareExcludes(...)Collection<String> localExcludesreverse(...)/** Gets list of parameter names to exclude ... *//** Sets the list of parameter names to exclude from copying (all others will be included). ... */this.excludes/** Gets list of parameter names to include ... *//** Sets the list of parameter names to include when copying (all others will be excluded). ... */this.includesChainingInterceptor.classString ORIGINAL_PROPERTY_OVERRIDE, ...;escape(...)escapeJava(...)ActionContext invocationContextHashMap<Object,Object> fakieEntry<String,Object> entryMap<>.Entry<String,Object>String propertyNameshouldAddError(...)getConversionErrorMessage(...)ValidationAware vanew HashMap<Object,Object>(...)getOverrideExpr(...)addPreResultListener(...)new PreResultListener(...) { ... }Map<Object,Object> fakiesetExprOverrides(...)// if there were some errors, put the original (fake) values in place right before the resultimport InputConfigimport MethodUtils...[] EMPTY_CLASS_ARRAY, ...;String inputResultName, ...;/** Set the <code>inputResultName</code> (result name to be returned when ... */this.inputResultName/** Intercept {@link ActionInvocation} and returns a <code>inputResultName</code> ... */ValidationAware validationAwareActionprocessValidationWorkflowAware(...)processInputConfig(...)processValidationErrorAware(...)/** Process {@link ValidationWorkflowAware} interface ... */getInputResultName(...)ValidationWorkflowAware.class/** Process {@link InputConfig} annotation applied to method ... */InputConfig annotationInputConfig.classinvokeMethod(...)resultName(...)/** Notify action if it implements {@link ValidationErrorAware} interface ... */actionErrorOccurred(...)ValidationErrorAware.classAction.INPUTDefaultWorkflowInterceptor.classException exception, ...;/** Holds the given exception ... */this.exception/** Gets the held exception ... *//** Gets the held exception stack trace using {@link Exception#printStackTrace()}. ... */String exceptionStackgetException(...)PrintWriter pw// Ignore exception generating stack trace.Logger categoryLogger, ...;boolean logEnabled, ...;String logCategory, ...;String logLevel, ...;this.logEnabledthis.logCategorythis.logLevelExceptionMappingConfig mappingConfigfindMappingFromExceptions(...)isLogEnabled(...)handleLogging(...)Map<String,String> mappingParamsHttpParameters parameterssetParameters(...)publishException(...)new ExceptionHolder(...)/** Handles the logging of the exception. ... */doLog(...)/** Performs the actual logging. ... */fatal(...)/** Try to find appropriate {@link ExceptionMappingConfig} based on provided Throwable ... */ExceptionMappingConfig configint deepestObject exceptionMappingint depthgetDepth(...)/** Return the depth to the superclass matching. 0 means ex matches exactly. Returns -1 if there's no match. ... */Throwable.class/** Default implementation to handle ExceptionHolder publishing. Pushes given ExceptionHolder on the stack. ... */ExceptionMappingInterceptor.class// create a mutable HashMap since some interceptors will remove parameters, and parameterMap is immutable// init category logger// Check for specific exception mappings.// Found it!// If we've gone as far as we can go and haven't found it.../** <!-- START SNIPPET: introduction --> ... *//** Called to let an interceptor clean up any resources it has allocated. *//** Called after an interceptor is created, but before any requests are processed using ... *//** Allows the Interceptor to do some processing on the request before and/or after the rest of the processing of the ... */String FINISH_MESSAGE, ...;String START_MESSAGE, ...;logMessage(...)StringBuilder messageLoggingInterceptor.classSet<String> excludeMethods, ...;Set<String> includeMethods, ...;this.excludeMethodsthis.includeMethodsapplyInterceptor(...)doIntercept(...)boolean applyMethodapplyMethod(...)/** Subclasses must override to implement the interceptor logic. ... */MethodFilterInterceptor.class// ValidationInterceptor/** Utility class contains common methods used by ... *//** Static method to decide if the specified <code>method</code> should be ... */boolean needsPatternMatchWildcardHelper wildcardnew WildcardHelper(...)String methodCopyString includeMethodString excludeMethodnew String(...)int[] compiledPatternHashMap<String,String> matchedPatternsboolean matches/** Same as {@link #applyMethod(Set, Set, String)}, except that <code>excludeMethods</code> ... */Set<String> includeMethodsSetSet<String> excludeMethodsSet// quick check to see if any actual pattern matching is needed// this section will try to honor the original logic, while // still allowing for wildcards later// test the methods using pattern matching// no method specified// run it, includeMethods takes precedence// CHECK ME: Previous implementation used include method // if found, and wasn't included earlier, don't run it// default fall-back from before changesboolean refreshModelBeforeResult, ...;this.refreshModelBeforeResultModelDriven<> modelDrivenObject modelgetModel(...)new RefreshModelBeforeResult(...)/** Refreshes the model instance on the value stack, if it has changed */Object originalModel, ...;ModelDriven<> action, ...;this.originalModelthis.actionboolean needsRefreshObject newModelObject item// Check to see if the new model instance is already on the stack// Add the new model on the stack// Clear off the old model instance/** Marker interface to indicate no auto setting of parameters. ... */import TreeMapCollection<String> allowed, ...;Collection<String> blocked, ...;Map<String,Boolean> includesExcludesMap, ...;boolean defaultBlock, ...;Map<String,Boolean> includesExcludesMapgetIncludesExcludesMap(...)String paramboolean currentAllowedisDefaultBlock(...)String currRuleisPropertySeparator(...)/** Tests if the given char is a property separator char <code>.([</code>. ... */this.includesExcludesMapnew TreeMap<String,Boolean>(...)getAllowedCollection(...)String egetBlockedCollection(...)String bthis.defaultBlockthis.blockedsetBlockedCollection(...)asCollection(...)this.allowedsetAllowedCollection(...)/** Return a collection from the comma delimited String. ... */isBlank(...)ParameterFilterInterceptor.class/** This interface is implemented by actions that want to declare acceptable parameters. Works in conjunction with {@link ... *//** Tests if the the action will accept the parameter with the given name. ... */Set<String> paramNames, ...;Set<String> paramValues, ...;/** Decide if the parameter should be removed from the parameter map based on ... */this.paramNamesString removeNameParameter parameterthis.paramValues/** Allows <code>paramNames</code> attribute to be set as comma-separated-values (csv). ... *//** Allows <code>paramValues</code> attribute to be set as a comma-separated-values (csv). ... */ParameterRemoverInterceptor.class/** This interceptor sets all parameters on the value stack. */int PARAM_NAME_MAX_LENGTH, ...;int paramNameMaxLength, ...;boolean ordered, ...;ExcludedPatternsChecker excludedPatterns, ...;AcceptedPatternsChecker acceptedPatterns, ...;this.excludedPatternsthis.acceptedPatterns/** If the param name exceeds the configured maximum length it will not be ... */this.paramNameMaxLength...--Comparator<String> rbCollator, ...;/** Compares based on number of '.' and '[' characters (fewer is higher) */retrieveParameters(...)getParameterLogMap(...)/** Gets the parameter map to apply from wherever appropriate ... *//** Adds the parameters into context's ParameterMap ... */HttpParameters paramsMap<String,Parameter> acceptableParametersboolean memberAccessStackwithParent(...)withComparator(...)getOrderedComparator(...)new TreeMap<String,Parameter>(...)isAcceptableParameter(...)MemberAccessValueStack accessValueStacksetAcceptProperties(...)getAcceptedPatterns(...)setExcludeProperties(...)getExcludedPatterns(...)Entry<String,Parameter> entryMap<>.Entry<String,Parameter>Parameter valuesetParameter(...)getObject(...)notifyDeveloperParameterException(...)addParametersToContext(...)Collection<String> messages/** Checks if name of parameter can be accepted or thrown away ... */ParameterNameAware parameterNameAwareacceptableName(...)acceptableParameterName(...)/** Gets an instance of the comparator to use for the ordered sorting.  Override this ... */StringBuilder logEntryboolean acceptedisAccepted(...)isWithinLengthLimit(...)isExcluded(...)boolean matchLengthAcceptedPatternsChecker.IsAcceptedIsAccepted resultgetAcceptedPattern(...)ExcludedPatternsChecker.IsExcludedIsExcluded resultgetExcludedPattern(...)/** Whether to order the parameters or not ... *//** Set whether to order the parameters by object depth or not ... */this.ordered/** Sets a comma-delimited list of regular expressions to match ... */setAcceptedPatterns(...)setExcludedPatterns(...)new Comparator<String>(...) { ... }int l1countOGNLCharacters(...)int l2//block or allow access to properties//see WW-2761 for more details// see https://issues.apache.org/jira/browse/WW-4066// notify only when in devMode/** PreResultListeners may be registered with an {@link ActionInvocation} to get a callback after the ... *//** This callback method will be called after the {@link com.opensymphony.xwork2.Action} execution and ... */String DEFAULT_INVOCATION_METHODNAME, ...;getPrefixedMethod(...)/** This method returns a {@link Method} in <code>action</code>. The method ... */String capitalizedMethodNamecapitalizeMethodName(...)String prefixeString prefixedMethodNamePrefixMethodInvocationUtil.class// if null returns (possible according to the docs), use the default execute // hmm -- OK, try next prefixString PREPARE_PREFIX, ...;String ALT_PREPARE_PREFIX, ...;boolean alwaysInvokePrepare, ...;boolean firstCallPrepareDo, ...;/** Sets if the <code>prepare</code> method should always be executed. ... */this.alwaysInvokePrepare/** Sets if the <code>prepareDoXXX</code> method should be called first ... */this.firstCallPrepareDoString[] prefixesinvokePrefixMethod(...)/* The invoked method threw an exception and reflection wrapped it ... *//* The cause is not an Exception or Error (must be Throwable) so ... *//** Adds the ability to set a model, probably retrieved from a given state. *//** Sets the key under which the model is stored ... */String GET_MODEL, ...;String scope, ...;Map<String,Object> scopeMapScopedModelDriven<> modelDrivenString cNameString modelNameresolveModel(...)Class<> clsgetReturnType(...)setModel(...)setScopeKey(...)import Parameterizableboolean parse, ...;boolean overwrite, ...;boolean merge, ...;this.parsethis.merge/** Overwrites already existing parameters from other sources. ... */this.overwritesetParams(...)Entry<String,String> entrygetActionInvocation(...)emptyMap(...)/** Adds the parameters into context's ParameterMap. ... */HttpParameters previousParamsHttpParameters.BuilderBuilder combinedParamswithExtraParams(...)StaticParametersInterceptor.class// for actions marked as Parameterizable, pass the static parameters directlyshouldLog(...)invokeUnderTiming(...)/** Is called to invoke the action invocation and time the execution time. ... */long startTimelong executionTimegetLoggerToUse(...)/** Determines if we should log the time. ... */isLoggerEnabled(...)/** Get's the logger to use. ... *//** Is the given logger enalbed at the given level? ... */isWarnEnabled(...)isErrorEnabled(...)isFatalEnabled(...)isTraceEnabled(...)TimerInterceptor.class// default check first// okay user have set some parameters// use info as default if not provided/** ValidationAware classes can accept Action (class level) or field level error messages. Action level messages are kept ... *//** Set the Collection of Action-level String error messages. ... *//** Get the Collection of Action-level error messages for this action. Error messages should not ... *//** Set the Collection of Action-level String messages (not errors). ... *//** Get the Collection of Action-level messages for this action. Messages should not be added ... *//** Set the field error map of fieldname (String) to Collection of String error messages. ... *//** Get the field specific errors associated with this action. Error messages should not be added ... *//** Add an Action-level error message to this Action. ... *//** Add an Action-level message to this Action. ... *//** Add an error message for a given field. ... *//** Check whether there are any Action-level error messages. ... *//** Checks whether there are any Action-level messages. ... *//** Checks whether there are any action errors or field errors. ... *//** Check whether there are any field errors associated with this action. ... *//** ValidationErrorAware classes can be notified about validation errors ... *//** Allows to notify action about occurred action/field errors ... *//** ValidationWorkflowAware classes can programmatically change result name when errors occurred ... *//** Interceptors marked with this interface won't be fully initialised during initialisation. ... */TextParser textParser, ...;TextParseUtil.ParsedValueEvaluator valueEvaluator, ...;TextParseUtil.ParsedValueEvaluatornew TextParseUtil.ParsedValueEvaluator(...) { ... }this.textParserObject paramValueevaluate(...)new char[]TextParser.DEFAULT_LOOP_COUNT// no asType !!!/** Declares that it is permitted for the field be mutated through ... */ElementType.FIELDimport ParameterFilterInterceptorimport ParametersInterceptorimport AnnotationUtils/** Annotation based version of {@link ParameterFilterInterceptor}. ... *//* (non-Javadoc) ... */peek(...)boolean blockByDefaultisAnnotationPresent(...)BlockByDefault.classList<Field> annotatedFieldsnew ArrayList<Field>(...)addAllFields(...)Allowed.classboolean allowedBlocked.class//TODO only matches exact field names.  need to change to it matches start of ognl expression//i.e take param name up to first . (period) and match against that/** Discovers annotated methods on the action and calls them according to the workflow ... */List<Method> methodsnew ArrayList<Method>(...)getMethodsListWithAnnotation(...)Before.classString invocationResultnew Comparator<Method>(...) { ... }comparePriorities(...)priority(...)Method mString resultCodeAfter.class/** Invokes any &#64;BeforeResult annotated methods ... */BeforeResult.class// methods are only sorted by priority// shortcircuit execution// invoke any @After methods/** Declares that by default fields on the {@link Action} class ... *//** Declares that the given field should NOT be able to be mutated through ... *//* Copyright 2002-2009 The Apache Software Foundation. ... *//** Mock for an {@link ActionInvocation}. ... */this.invocationContextthis.stackimport ActionProxy/** Mock for an {@link ActionProxy}. ... */boolean executedCalled, ...;String returnedResult, ...;this.returnedResultthis.methodSpecified/** Mock implementation to be used in unittests */import Assert/** Mock for an {@link com.opensymphony.xwork2.interceptor.Interceptor}. ... */String DEFAULT_FOO_VALUE, ...;String expectedFoo, ...;String foo, ...;this.expectedFoothis.fooMockInterceptor testInterceptortestInterceptor.executedtestInterceptor.expectedFootestInterceptor.fooassertNotSame(...)import OgnlExceptionimport OgnlRuntime/** Mocks the function of an ObjectTypeDeterminer for testing purposes. ... */Class<> keyClass, ...;Class<> elementClass, ...;String keyProperty, ...;boolean shouldCreateIfNew, ...;this.keyClassthis.elementClassthis.keyPropertythis.shouldCreateIfNewgetKeyProperty(...)getPropertyAccessor(...)OgnlException eisShouldCreateIfNew(...)// TODO Auto-generated catch block/** Mock for a {@link Result}. ... *//** Helper class to build error messages. */StringBuilder message, ...;new ErrorMessageBuilder(...)appenExpression(...)appendValueAsArray(...)appendValue(...)valueArray.lengthhasMoreElements(...)/** An Object to use within OGNL to proxy other Objects ... */Object value, ...;Class<> lastClassAccessed, ...;String lastPropertyAccessed, ...;this.lastClassAccessedthis.lastPropertyAccessedNullHandler wrapped, ...;nullMethodResult(...)nullPropertyValue(...)import OgnlcreateDefaultContext(...)new ReflectionException(...)getBeanMap(...)getPropertyDescriptors(...)/** Wraps an XWork type conversion class for as an OGNL TypeConverter */TypeConverter typeConverter, ...;import ognl.*import BeanInfoimport Introspector/** Utility class that provides common access to the Ognl APIs for ... */ConcurrentMap<String,Object> expressions, ...;ConcurrentMap<Class<>,BeanInfo> beanInfoCache, ...;TypeConverter defaultConverter, ...;boolean enableExpressionCache, ...;boolean enableEvalExpression, ...;Set<Class<?>> excludedClasses, ...;Set<Pattern> excludedPackageNamePatterns, ...;Set<String> excludedPackageNames, ...;boolean allowStaticMethodAccess, ...;boolean disallowProxyMemberAccess, ...;this.defaultConverternew OgnlTypeConverterWrapper(...)XWorkConstants.OGNL_EXCLUDED_CLASSESSet<String> classNamesSet<Class<?>> classesnew HashSet<Class<?>>(...)XWorkConstants.OGNL_EXCLUDED_PACKAGE_NAME_PATTERNSSet<String> packagePatternsSet<Pattern> packageNamePatternsnew HashSet<Pattern>(...)XWorkConstants.OGNL_EXCLUDED_PACKAGE_NAMESXWorkConstants.ALLOW_STATIC_METHOD_ACCESSthis.allowStaticMethodAccessStrutsConstants.STRUTS_DISALLOW_PROXY_MEMBER_ACCESSthis.disallowProxyMemberAccess/** Sets the object's properties using the default type converter, defaulting to not throw ... *//** Sets the object's properties using the default type converter. ... */Object oldRootsetTypeConverter(...)getTypeConverterFromContext(...)setRoot(...)Entry<String,?> entryMap<>.Entry<String,?>String expressioninternalSetProperty(...)/** Sets the properties on the object using the default context, defaulting to not throwing ... *//** Sets the properties on the object using the default context. ... */Map<> context/** Sets the named property to the supplied value on the Object, defaults to not throwing ... *//** Sets the named property to the supplied value on the Object. ... *//** Looks for the real target with the specified property given a root Object which may be a ... */CompoundRoot crObject targethasSetProperty(...)hasGetProperty(...)getIndexedPropertyType(...)OgnlRuntime.INDEXED_PROPERTY_NONEIntrospectionException ex/** Wrapper around Ognl.setValue() to handle type conversion for collection elements. ... */compileAndExecute(...)new OgnlTask<Void>(...) { ... }isEvalExpression(...)new OgnlException(...)isArithmeticExpression(...)SimpleNode nodeOgnlContext ognlContextisEvalChain(...)isSequence(...)isOperation(...)isSimpleMethod(...)isChain(...)new OgnlTask<Object>(...) { ... }compileAndExecuteMethod(...)Object treeT execparseExpression(...)checkEnableEvalExpression(...)checkSimpleMethod(...)/** Copies the properties in the object "from" and sets them in the object "to" ... */Map<> contextFromMap<> contextToPropertyDescriptor[] fromPdsPropertyDescriptor[] toPdsMap<String,PropertyDescriptor> toPdHashnew HashMap<String,PropertyDescriptor>(...)IntrospectionException ePropertyDescriptor toPdPropertyDescriptor fromPdgetReadMethod(...)boolean copygetWriteMethod(...)/** Get's the java beans property descriptors for the given source. ... */BeanInfo beanInfogetBeanInfo(...)/** Get's the java beans property descriptors for the given class. ... *//** Creates a Map with read properties for the given source object. ... */Map<String,Object> beanMapMap<> sourceMapPropertyDescriptor[] propertyDescriptorsPropertyDescriptor propertyDescriptorgetDisplayName(...)Method readMethod/** Get's the java bean info for the given source object. Calls getBeanInfo(Class c). ... *//** Get's the java bean info for the given source. ... */Throwable reasonThrowable exceptionClassResolver resolverSecurityMemberAccess memberAccessnew SecurityMemberAccess(...)setExcludedClasses(...)setExcludedPackageNamePatterns(...)setExcludedPackageNames(...)setDisallowProxyMemberAccess(...)new ConcurrentHashMap<String,Object>(...)new ConcurrentHashMap<Class<>,BeanInfo>(...)//special keyword, they must be cutting the stack// find real target// if cache is enabled and it's a valid expression, puts it in/* ValueStack stack = (ValueStack) context.get(ActionContext.VALUE_STACK); ... */import MemberAccessValueStack/** Ognl implementation of a value stack that allows for dynamic Ognl expressions to be evaluated against it. When evaluating an expression, ... */String THROW_EXCEPTION_ON_FAILURE, ...;String MAP_IDENTIFIER_KEY, ...;CompoundRoot root, ...;Class<> defaultType, ...;Map<Object,Object> overrides, ...;SecurityMemberAccess securityMemberAccess, ...;XWorkConverter converter, ...;boolean logMissingProperties, ...;new CompoundRoot(...)getExcludedClasses(...)getExcludedPackageNamePatterns(...)getExcludedPackageNames(...)isDisallowProxyMemberAccess(...)this.rootthis.securityMemberAccesssetClassResolver(...)setTraceEvaluations(...)setKeepLastEvaluation(...)this.logMissingProperties/** @see */this.defaultTypethis.overrides/** /** ... */trySetValue(...)handleOgnlException(...)RuntimeException rehandleRuntimeException(...)cleanUpContext(...)XWorkConverter.CONVERSION_PROPERTY_FULLNAMEerrorSettingExpressionWithValue(...)boolean shouldLogshouldLogMissingPropertyWarning(...)setupExceptionOnFailure(...)tryFindValueWhenExpressionIsNotNull(...)handleOtherException(...)tryFindValue(...)logLookupFailure(...)findInContext(...)lookupForOverrides(...)getValueUsingOgnl(...)Object ret/** Log a failed lookup, being more verbose when devMode=true. ... */Map<> setMapretrieveSetMap(...)Object topObjshouldUseOldMap(...)/** check if this is a Map put on the stack  for setting if so just use the old map (reduces waste) */XWorkConverter xworkConverterCompoundRootAccessor accessorTextProvider provboolean allowOgnlValueStack aStacknew OgnlValueStack(...)setOgnlUtil(...)getValues(...)this.converterOgnlValueStack.class//XW-281//set basically is backed by a Map pushed on the stack with a key being put on the map and the Object being the value// TODO: this should be done better//this is an OGNL ValueStack so the context will be an OgnlContext//it would be better to make context of type OgnlContext/** Creates an Ognl value stack */CompoundRootAccessor compoundRootAccessor, ...;this.textProviderValueStack resultPropertyAccessor accsetPropertyAccessor(...)setMethodAccessor(...)setNullHandler(...)new OgnlNullHandlerWrapper(...)import DefaultMemberAccess/** Allows access decisions to be made on the basis of whether a member is static or not. ... */Set<Pattern> excludeProperties, ...;Set<Pattern> acceptProperties, ...;Class<> targetClassClass<> memberClasscheckEnumAccess(...)isClassExcluded(...)isPackageExcluded(...)getPackage(...)isProxyMember(...)checkStaticMethodAccess(...)isAcceptableProperty(...)int modifiersString targetPackageNameString memberPackageNamePattern patternClass<?> excludedClassthis.acceptPropertiesthis.excludePropertiesthis.excludedClassesthis.excludedPackageNamePatternsthis.excludedPackageNamesSecurityMemberAccess.class//failed static test// Now check for standard scope rules//no match, but acceptedParams is not empty//empty acceptedParams/** Wraps an OGNL TypeConverter as an XWork TypeConverter */import OgnlValueStackimport static String.formatimport static BooleanUtils.toBoolean/** A stack that is able to call methods on objects in the stack. ... *//** Used by OGNl to generate bytecode */Map<MethodCall,Boolean> invalidMethods, ...;boolean reportErrorValueStack.REPORT_ERRORS_ON_NO_PROPMap<Object,Object> mapUnsupportedOperationException ecutStack(...)OgnlValueStack.THROW_EXCEPTION_ON_FAILUREnew NoSuchPropertyException(...)Object vobjects.lengthMap<String,PropertyDescriptor> descriptorsint maxSizeSortedSet<String> setStringBuffer sbnew StringBuffer(...)String pdNameint paddingObject aSetClass<>[] argTypesgetArgTypes(...)MethodCall mcnew MethodCall(...)NoSuchMethodException.classnew MethodFailedException(...)Object rootCompoundRoot compoundRootClass<>[] classesargs.lengthObject arg...[] args, ...;int hash, ...;this.argsthis.hashClass<> argCompoundRootAccessor.MethodCallmc.clazzmc.namemc.argsnew ConcurrentHashMap<MethodCall,Boolean>(...)// This is an unmodifiable Map, so move on to the next element in the stack//            } catch (OgnlException e) {//                if (e.getReason() != null) {//                    final String msg = "Caught an Ognl exception while setting property " + name;//                    log.error(msg, e);//                    throw new RuntimeException(msg, e.getReason());//                }// this is OK if this happens, we'll just keep trying the next//property was not found// try the next oneimport ObjectPropertyAccessorXWorkConverter.LAST_BEAN_PROPERTY_ACCESSEDupdateCurrentPropertyPath(...)import OgnlContext/** Is able to access (set/get) properties on a given object. ... */ObjectProxy proxysetupContext(...)/** Sets up the context with the last property and last class ... */setLastBeanClassAccessed(...)getLastClassAccessed(...)setLastBeanPropertyAccessed(...)getLastPropertyAccessed(...)//To change body of implemented methods use File | Settings | File Templates.import SetPropertyAccessor/** @author */String KEY_PROPERTY_FOR_CREATION, ...;ObjectPropertyAccessor _accessor, ...;//so that nothing is put in the context to screw things up//to access properties of the objects in the Set//use a basic object Ognl property accessor here/** Gets the property of a Collection by indexing the collection ... */Collection<> cClass<> lastBeanClassgetLastBeanClassAccessed(...)String lastPropertyClassgetLastBeanPropertyAccessed(...)String keyPropertyClass<> collClassClass<> keyTypeClass<> toGetTypeFromisGettingByKeyProperty(...)setGettingByKeyProperty(...)Exception excMap<> collMapgetSetMap(...)Object realKeyshouldCreateIfNew(...)getPropertyThroughIteration(...)/* Gets an indexed Map by a given key property with the key being ... */getCurrentPropertyPath(...)new SurrugateList(...)Object currTestObject currKeysetSetMap(...)/* gets a bean with the given */Class<> lastClassString lastPropertyClass<> convertToClassObject realValuegetRealValue(...)Object[] valuesnew ObjectPropertyAccessor(...)Collection<> surrugate, ...;this.surrugate//check if it is a generic type property.//if so, return the value from the//superclass which will determine this.//reset context property//get the bean that this collection is a property of//get the property name that this collection uses//if one or the other is null, assume that it isn't//set up correctly so just return whatever the//superclass would//get the key property to index the//collection with from the ObjectTypeDeterminer//get the collection class of the//this should return the XWorkList//for this set that contains new entries//then the ListPropertyAccessor will be called//to access it in the next sequence//create a new element and //set the value of keyProperty//to be the given value//set the value of the keyProperty//add the new object to the collection //add to the Map if accessed later//with getting do iteration//don't assume for now it is//optimized to create the Map//and unlike setting, there is//no easy key for the Set//TODO//none found// looks like the input game in the form of "someCollection.foo" and// we are expected to define the index values ourselves.// So let's do it:// we don't want to do the normal collection property setting now, since we've already done the work// just return insteadimport EnumerationPropertyAccessorObjectPropertyAccessor opa, ...;import IteratorPropertyAccessorimport ListPropertyAccessor/** Overrides the list property accessor so in the case of trying ... */XWorkCollectionPropertyAccessor _sAcc, ...;int autoGrowCollectionLimit, ...;this.autoGrowCollectionLimitthis._sAccXWorkCollectionPropertyAccessor.KEY_PROPERTY_FOR_CREATIONint listSizeClass<> beanClassnew XWorkCollectionPropertyAccessor(...)// looks like the input game in the form of "someList.foo" and// we don't want to do the normal list property setting now, since we've already done the work//make sure there are enough spaces in the List to setimport MapPropertyAccessor/** Implementation of PropertyAccessor that sets and gets properties by storing and looking ... */...[] INDEX_ACCESS_PROPS, ...;ClassCastException exReflectionContextState.CREATE_NULL_OBJECTSClass<> valueClassString anArrayClass<> elementClass// if this is one of the regular index access// properties then just let the superclass deal with the// get.//find the key class and convert the name to that class// nothing is specified, we assume it will be the value passed in.// return java.lang.String.class;// commented out the above -- it makes absolutely no sense for when setting basic maps!/** Allows methods to be executed under normal cirumstances, except when {@link ReflectionContextState#DENY_METHOD_EXECUTION} ... */Boolean execReflectionContextState.DENY_METHOD_EXECUTIONboolean eOgnlContext ogContextPropertyDescriptor descriptorClass<> propertyTypeObject propValPropertyAccessor accessorException oeReflectionContextState.DENY_INDEXED_ACCESS_EXECUTIONcallMethodWithDebugInfo(...)callStaticMethodWithDebugInfo(...)callStaticMethod(...)//Collection property accessing//this if statement ensures that ognl//statements of the form someBean.mySet('keyPropVal')//return the set element with value of the keyProp given//go directly through OgnlRuntime here//so that property strings are not cleared//i.e. OgnlUtil should be used initially, OgnlRuntime//thereafter//use the Collection property accessor instead of the individual property accessor, because //in the case of Lists otherwise the index property could be used//this exception should theoretically never happen//log it//HACK - we pass indexed method access i.e. setXXX(A,B) pattern// the method exists on the target object, but something went wrong// the method exists on the target class, but something went wrong//set the last set objects in the context//so if the next objects accessed are//Maps or Collections they can use the information//to determine conversion types/** Accept parameter name/value to be set on {@link com.opensymphony.xwork2.Result} *//** Used across different interceptors to check if given string matches one of the excluded patterns. *//** Checks if value matches any of patterns on exclude list ... *//** Sets excluded patterns during runtime ... *//** Set excluded patterns during runtime ... *//** Allow access list of all defined excluded patterns ... */boolean accepted, ...;String acceptedPattern, ...;new IsAccepted(...)this.acceptedthis.acceptedPattern...[] ACCEPTED_PATTERNS, ...;Set<Pattern> acceptedPatterns, ...;XWorkConstants.OVERRIDE_ACCEPTED_PATTERNSPattern.CASE_INSENSITIVEXWorkConstants.ADDITIONAL_ACCEPTED_PATTERNSPattern acceptedPatternyes(...)no(...)...[] EXCLUDED_PATTERNS, ...;Set<Pattern> excludedPatterns, ...;XWorkConstants.OVERRIDE_EXCLUDED_PATTERNSXWorkConstants.ADDITIONAL_EXCLUDED_PATTERNSsetAdditionalExcludePatterns(...)Pattern excludedPatternboolean excluded, ...;String excludedPattern, ...;new IsExcluded(...)this.excludedthis.excludedPatternimport BeansExceptionimport UnsatisfiedDependencyExceptionimport AutowireCapableBeanFactoryimport ApplicationContextimport ApplicationContextAwareimport ConfigurableApplicationContextimport ClassPathXmlApplicationContextApplicationContext appContext, ...;AutowireCapableBeanFactory autoWiringFactory, ...;int autowireStrategy, ...;Map<String,Object> classes, ...;boolean useClassCache, ...;boolean alwaysRespectAutowireStrategy, ...;boolean enableAopSupport, ...;/** This is temporary solution, after validating can be removed ... */setApplicationContext(...)new ClassPathXmlApplicationContext(...)this.enableAopSupport/** Set the Spring ApplicationContext that should be used to look beans up with. ... */this.appContextfindAutoWiringBeanFactory(...)/** Sets the autowiring strategy ... */AutowireCapableBeanFactory.AUTOWIRE_AUTODETECTthis.autowireStrategyAutowireCapableBeanFactory.AUTOWIRE_BY_NAMEAutowireCapableBeanFactory.AUTOWIRE_BY_TYPEAutowireCapableBeanFactory.AUTOWIRE_CONSTRUCTORAutowireCapableBeanFactory.AUTOWIRE_NO/** If the given context is assignable to AutowireCapbleBeanFactory or contains a parent or a factory that is, then ... */getBeanFactory(...)getParent(...)/** Looks up beans using Spring's application context before falling back to the method defined in the {@link ... */containsBean(...)Class<> beanClazzObject beancreateBean(...)injectApplicationContext(...)autoWireBean(...)initializeBean(...)autowire(...)UnsatisfiedDependencyException eautowireBeanProperties(...)/** Enable / disable caching of classes loaded by Spring. ... */this.useClassCache/** Determines if the autowire strategy is always followed when creating beans ... */this.alwaysRespectAutowireStrategySpringObjectFactory.class// Check the context// Try and grab the beanFactory// And if all else fails, try again with the parent context// Decide to follow autowire strategy or use the legacy approach which mixes injection strategies// Leave the creation up to Spring// Fall back// this cache of classes is needed because Spring sucks at dealing with situations where the// class instance changesimport NoSuchBeanDefinitionExceptionimport BeanDefinitionimport BeanDefinitionRegistryimport RootBeanDefinition/** SpringProxyableObjectFactory. ... */List<String> skipBeanNames, ...;ApplicationContext anAppContextgetApplicationContext(...)NoSuchBeanDefinitionException eBeanDefinitionRegistry registryRootBeanDefinition defnew RootBeanDefinition(...)setScope(...)BeanDefinition.SCOPE_SINGLETONregisterBeanDefinition(...)NoSuchBeanDefinitionException e2ClassNotFoundException e1/** Subclasses may override this to return a different application context. ... */SpringProxyableObjectFactory.classimport SpringObjectFactoryString APPLICATION_CONTEXT, ...;boolean initialized, ...;ApplicationContext context, ...;SpringObjectFactory factory, ...;Integer autowireStrategy, ...;ApplicationContext applicationContextgetApplication(...)WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTEnew SpringObjectFactory(...)setAutowireStrategy(...)ActionAutowiringInterceptor.class// TODO Auto-generated method stubimport ObjectUtilsimport MissingResourceExceptionString XWORK_MESSAGES_BUNDLE, ...;String STRUTS_MESSAGES_BUNDLE, ...;String TOMCAT_RESOURCE_ENTRIES_FIELD, ...;String RELOADED, ...;ConcurrentMap<String,ResourceBundle> bundlesMap, ...;boolean reloadBundles, ...;ConcurrentMap<MessageFormatKey,MessageFormat> messageFormats, ...;ConcurrentMap<Integer,List<String>> classLoaderMap, ...;Set<String> missingBundles, ...;ConcurrentMap<Integer,ClassLoader> delegatedClassLoaderMap, ...;/** Add's the bundle to the internal list of default bundles. ... */ClassLoader cclgetCurrentThreadContextClassLoader(...)List<String> bundlesnew CopyOnWriteArrayList<String>(...)StrutsConstants.STRUTS_CUSTOM_I18N_RESOURCESStringTokenizer customBundlesaddDefaultResourceBundle(...)/** Returns a localized message for the specified key, aTextName.  Neither the key nor the ... */List<String> localListgetCurrentBundleNames(...)String bundleNamereloadBundles(...)getString(...)MissingResourceException e/** Returns a localized message for the specified key, aTextName, substituting variables from the ... */String defaultTextMessageFormat mfbuildMessageFormat(...)formatWithNullDetection(...)GetDefaultMessageReturnArg resultgetDefaultMessage(...)MissingResourceException exunableToFindTextForKey(...)result.messageBoolean reloadeddefaultIfNull(...)clearMap(...)ResourceBundle.classNoSuchFieldException eclearTomcatCache(...)ClassLoader loaderClass<> clNoSuchFieldException nsfegetDeclaredField(...)Object cacheClass<> cclMethod clearMethodMessageFormatKey keynew MessageFormatKey(...)this.reloadBundles/** Finds the given resource bundle by it's name. ... */ClassLoader classLoadercreateMissesKey(...)/** Clears all the internal lists. ... *//** Determines if we found the text in the bundles. ... */result.foundInBundle/** Creates a key to used for lookup/storing in the bundle misses cache. ... */boolean foundnew GetDefaultMessageReturnArg(...)/** Traverse up class hierarchy looking for message.  Looks at class, then implemented interface, ... */findMessage(...)Locale locale, ...;this.localeMessageFormatKey thatthat.patternthat.localeboolean foundInBundle, ...;this.foundInBundlenew ConcurrentHashMap<String,ResourceBundle>(...)new ConcurrentHashMap<MessageFormatKey,MessageFormat>(...)new ConcurrentHashMap<Integer,List<String>>(...)synchronizedSet(...)new ConcurrentHashMap<Integer,ClassLoader>(...)AbstractLocalizedTextProvider.class//make sure this doesn't get added more than once// will be logged when not found in any bundle// happens in IBM JVM, that has a different ResourceBundle impl// it has a 'cache' member// now, for the true and utter hack, if we're running in tomcat, clear// it's class loader resource cache as well.// no need for compilation here.// no-op// did we find it in the bundle, then no problem?// not found in bundle// not found in bundles// defaultMessage may be null// look in properties of this class// look in properties of implemented interfaces// traverse up hierarchy/** <code>AnnotationUtils</code> ... */Pattern SETTER_PATTERN, ...;Pattern GETTER_PATTERN, ...;/** Adds all fields with the specified Annotation of class clazz and its superclasses to allFields ... */Field[] fieldsAnnotation ann/** Adds all methods with the specified Annotation of class clazz and its superclasses to allFields ... */Method[] methodsaddAllMethods(...)addAllInterfaces(...)/** Returns the property name for a method. ... */String rawtoLowerCase(...)/** Returns the annotation on the given class or the package of the class. This searchs up the ... */T annAggregateIterator<URL> iteratornew AggregateIterator<URL>(...)addEnumeration(...)ClassLoaderUtil.classClassLoader cl/** Load a given resource. ... *//** This is a convenience method to load a resource as a stream. ... */ClassNotFoundException exClassNotFoundException exc/** Prints the current classloader hierarchy - useful for debugging. */printClassLoader(...)/** Prints the classloader hierarchy from a given classloader - useful for debugging. ... *//** Aggregates Enumeration instances into one iterator and filters out duplicates.  Always keeps one ... */LinkedList<Enumeration<E>> enums, ...;Enumeration<E> cur, ...;E next, ...;Set<E> loaded, ...;nextElement(...)E prevloadNext(...)removeLast(...)determineCurrentEnumeration(...)E tmpint loadedSizenew LinkedList<Enumeration<E>>(...)new HashSet<E>(...)import FileInputStreamimport URIimport URISyntaxExceptionimport URLClassLoaderimport ZipEntryimport ZipInputStream/** This class is an utility class that will search through the classpath ... *//** The String pattern to test against. */...[] compiledPattern, ...;PatternMatcher<int[]> patternMatcher, ...;/** The PatternMatcher implementation to use */Vector<String> compared, ...;/** Builds a {@link java.util.Vector} containing Strings which each name a file ... */Vector<String> matchesnew Vector<String>(...)URLClassLoader clgetURLClassLoader(...)URL[] parentUrlsgetURLs(...)URI entryURIFile entrygetProtocol(...)toURI(...)URISyntaxException eisFile(...)endsWith(...)ZipInputStream zipnew ZipInputStream(...)new FileInputStream(...)ZipEntry zipEntrygetNextEntry(...)boolean doesMatchVector<String> resultscheckEntries(...)String listEntryFile tempFileisDirectory(...)String entryToCheckthis.patternMatcherURLClassLoader uclClassPathFinder.class/** ValueStacks implementing this interface provide a way to remove values from ... *//** Remove all values from the context *//** A Stack that is implemented using a List. ... */import LocationAttributesimport org.xml.sax.*import DefaultHandlerimport SAXParserimport SAXParserFactoryimport TransformerFactoryimport DOMResultimport SAXTransformerFactoryimport TransformerHandler/** Helper class to create and retrieve information from location-enabled ... */String XMLNS_URI, ...;/** Creates a W3C Document that remembers the location of each element in ... */SAXParserFactory factoryString parserPropSAXParser parserDOMBuilder buildernew DOMBuilder(...)ContentHandler locationHandlernew Pipe(...)LocationAttributes.PipeObjectFactory objectFactorysetValidating(...)setNamespaceAware(...)newSAXParser(...)new StartHandler(...)getDocument(...)/** The <code>DOMBuilder</code> is a utility class that will generate a W3C ... */SAXTransformerFactory FACTORY, ...;/** The default transformer factory shared by all instances */SAXTransformerFactory factory, ...;/** The transformer factory */DOMResult result, ...;/** The result */Node parentNode, ...;/** The parentNode */ContentHandler nextHandler, ...;/** Construct a new instance of this DOMBuilder. *//** Construct a new instance of this DOMBuilder. ... *//** Constructs a new instance that appends nodes to the given parent node. ... */this.parentNodesetup(...)/** Setup this instance transformer and result objects. */TransformerHandler handlernewTransformerHandler(...)new DOMResult(...)setResult(...)TransformerException local/** Return the newly built Document. ... */getNode(...)Node.DOCUMENT_NODEgetOwnerDocument(...)setDocumentLocator(...)startDocument(...)endDocument(...)startElement(...)endElement(...)startPrefixMapping(...)endPrefixMapping(...)characters(...)ignorableWhitespace(...)processingInstruction(...)skippedEntity(...)/** Create a filter that is chained to another handler. ... */String dtdFileDomHelper.classgetPublicId(...)getLineNumber(...)getColumnNumber(...)/* Copyright 1999-2005 The Apache Software Foundation. ... */// Enhance the sax stream with location information/** Provides support for localization in the framework, it can be used to read only default bundles, ... *//** Calls {@link #findText(Class aClass, String aTextName, Locale locale, String defaultMessage, Object[] args)} ... */String indexedTextNameString aString warnGlobalLocalizedTextProvider.class// calculate indexedTextName (collection[*]) if applicable// get default// could we find the text, if not log a warn/** ValueStacks implementing this interface provide a way to remove block or allow access ... *//** An implementation of a pattern matcher that uses simple named wildcards.  The named wildcards are defined using the ... */NamedVariablePatternMatcher.CompiledPattern/** Compiles the pattern. ... */StringBuilder regexList<String> varNamesStringBuilder varNamenew CompiledPattern(...)/** Tries to process the data against the compiled expression.  If successful, the map will contain ... */getVariableNames(...)/** Stores the compiled pattern and the variable names matches will correspond to. */Pattern pattern, ...;List<String> variableNames, ...;this.variableNames/** OGNL implementation of {@link TextParser} */char openint loopCountString lookupCharsint startint endString varString leftString rightString middleconcat(...)max(...)// deal with the "pure" expressions first!//expression = expression.trim();//this creates an implicit StringBuffer and shouldn't be used in the inner loop// translateVariables prevent infinite loop / expression recursive evaluation// the variable doesn't exist, so don't display anything/** Compiles and matches a pattern against a value ... *//** Determines if the pattern is a simple literal string or contains wildcards that will need to be processed ... *//** <p> Translate the given <code>String</code> into an object ... *//** Match a pattern against a string ... */List<String> commentLines, ...;/** Stores the comment lines for the currently processed property. */String propertyName, ...;/** Stores the name of the last read property. */String propertyValue, ...;/** Stores the value of the last read property. */char delimiter, ...;/** Stores the list delimiter character. */String COMMENT_CHARS, ...;/** Constant for the supported comment characters. */int HEX_RADIX, ...;/** Constant for the radix of hex numbers. */int UNICODE_LEN, ...;/** Constant for the length of a unicode literal. */...[] SEPARATORS, ...;/** The list of possible key/value separators */...[] WHITE_SPACE, ...;/** The white space characters used as key/value separators. *//** Creates a new instance of <code>PropertiesReader</code> and sets ... *//** Tests whether a line is a comment, i.e. whether it starts with a comment ... *//** Reads a property line. Returns null if Stream is ... */StringBuilder bufferisCommentLine(...)checkCombineLines(...)/** Parses the next property from the input stream and stores the found ... */readProperty(...)String[] propertyparseProperty(...)unescapeJava(...)/** Returns the comment lines that have been read for the last property. ... *//** Returns the name of the last read property. This method can be called ... *//** Returns the value of the last read property. This method can be ... *//** Checks if the passed in line should be combined with the following. ... */int bsCountint idx... % .../** Parse a property line and return the key and the value in an array. ... */String[] resultStringBuilder keyStringBuilder value/** <p>Unescapes any Java literals found in the <code>String</code> to a ... */int szStringBuilder outStringBuffer unicodeboolean hadSlashboolean inUnicodechar chint valuesetLength(...)NumberFormatException nfe/** <p>Checks if the object is in the given array.</p> ... */char anArray/** <p>Unescapes any Java literals found in the <code>String</code>. ... */StringWriter writerIOException ioe/* Licensed to the Apache Software Foundation (ASF) under one or more ... */// blanc lines are also treated as comment lines// EOF// parse the line// sorry for this spaghetti code, please replace it as soon as// possible with a regexp when the Java 1.3 requirement is dropped// state of the automaton:// 0: key parsing// 1: antislash found while parsing the key// 2: separator crossing// 3: value parsing// switch to the separator crossing state// switch to the value parsing state// this is an escaped separator or white space// another escaped character, the '\' is preserved// return to the key parsing state// do nothing, eat all white spaces// any other character indicates we encoutered the beginning of the value// if in unicode, then we're reading unicode// values in somehow// unicode now contains the four hex digits// which represents our unicode character// handle an escaped value// uh-oh, we're in unicode country....// then we're in the weird case of a \ at the end of the// string, let's output it anyway.// this should never ever happen while writing to a StringWriterimport ConstructorUtilsimport FieldUtils/** <code>ProxyUtil</code> ... */String SPRING_ADVISED_CLASS_NAME, ...;String SPRING_SPRINGPROXY_CLASS_NAME, ...;String SPRING_SINGLETONTARGETSOURCE_CLASS_NAME, ...;String SPRING_TARGETCLASSAWARE_CLASS_NAME, ...;Map<Class<?>,Boolean> isProxyCache, ...;Map<Member,Boolean> isProxyMemberCache, ...;/** Determine the ultimate target class of the given instance, traversing ... */Class<?> resultisSpringAopProxy(...)springUltimateTargetClass(...)/** Check whether the given object is a proxy. ... */Boolean flagboolean isProxy/** Check whether the given member is a proxy member of a proxy object. ... */boolean isProxyMemberisSpringProxyMember(...)/** Determine the ultimate target class of the given spring bean instance, traversing ... */Object currentimplementsInterface(...)Throwable ignoredgetSingletonTarget(...)isCglibProxyClass(...)/** Check whether the given object is a Spring proxy. ... */isProxyClass(...)/** Check whether the given member is a member of a spring proxy. ... */ProxyUtil.classClassNotFoundException ignored/** Obtain the singleton target object behind the given spring proxy, if any. ... */Object targetSource/** Check whether the specified class is a CGLIB-generated class. ... *//** Check whether the given class implements an interface with a given class name. ... */Class<?> ifaceClass/** Check whether the given class has a given member. ... */getMatchingMethod(...)getMatchingAccessibleConstructor(...)new ConcurrentHashMap<Class<?>,Boolean>(...)new ConcurrentHashMap<Member,Boolean>(...)/* Copyright 2017 The Apache Software Foundation. ... */import URLDecoderimport JarEntryimport JarInputStream/** <p>ResolverUtil is used to locate classes that are available in the/a class path and meet ... *//** An instance of Log to use for logging in this class. *//** A simple interface that specifies how to test classes to determine if they ... *//** Will be called repeatedly with candidate classes. ... *//** A Test that checks to see if each class is assignable to the provided class. Note ... */Class<> parent, ...;/** Constructs an IsA test using the supplied Class as the parent class/interface. ... */this.parent/** A Test that checks to see if each class name ends with the provided suffix. */String suffix, ...;/** Constructs a NameEndsWith test using the supplied suffix. ... */this.suffix/** A Test that checks to see if each class is annotated with a specific annotation. If it ... */Class<? extends Annotation> annotation, ...;/** Constructs an AnnotatedWith test for the specified annotation type. ... */this.annotationgetPath(...)Set<Class<? extends T>> classMatches, ...;/** The set of matches being accumulated. */Set<URL> resourceMatches, ...;ClassLoader classloader, ...;/** The ClassLoader to use when looking for classes. If null then the ClassLoader returned ... *//** Provides access to the classes discovered so far. If no calls have been made to ... *//** Returns the classloader that will be used for scanning for classes. If no explicit ... *//** Sets an explicit ClassLoader that should be used when scanning for classes. If none ... */this.classloader/** Attempts to discover classes that are assignable to the type provided. In the case ... */Test testnew IsA(...)String pkgfindInPackage(...)/** Attempts to discover classes who's name ends with the provided suffix. Accumulated classes can be ... */new NameEndsWith(...)/** Attempts to discover classes that are annotated with to the annotation. Accumulated ... */new AnnotatedWith(...)new NameIs(...)/** Attempts to discover classes that pass the test. Accumulated ... *//** Scans for classes starting at the package provided and descending into subpackages. ... */Enumeration<URL> urlsString urlPathFile filedecode(...)loadImplementationsInDirectory(...)loadImplementationsInJar(...)/** Finds matches in a physical directory on a filesystem.  Examines all ... */File[] fileslistFiles(...)String packageOrClassisTestApplicable(...)addIfMatching(...)doesMatchResource(...)doesMatchClass(...)/** Finds matching classes within a jar files that contains a folder structure ... */JarEntry entryJarInputStream jarStreamnew JarInputStream(...)getNextJarEntry(...)/** Add the class designated by the fully qualified class name provided to the set of ... */String externalNameClass<> typenew HashSet<Class<? extends T>>(...)new HashSet<URL>(...)ResolverUtil<>.class/* Copyright 2005-2006 Tim Fennell ... */// If it's a file in a directory, trim the stupid file: spec// Else it's in a JAR, grab the path to the jarimport ReflectionProviderFactory/** Clears the internal list of resource bundles. ... *//** Builds a {@link java.util.Locale} from a String of the form en_US_foo into a Locale ... */String languageString countrynew Locale(...)ModelDriven<>.classActionInvocation actionInvocationString basePackageNameString newKeyString propXWorkConverter.CONVERSION_ERROR_PROPERTY_PREFIXObject actionObj// search up class hierarchy// search up model's class hierarchy// ActionInvocation may be null if we're being run from a Sitemesh filter, so we won't get model texts if this is null// nothing still? alright, search the package hierarchy now// see if it's a child property/** Utility class for text parsing. ... *//** Converts all instances of ${...}, and %{...} in <code>expression</code> to the value returned ... *//** Function similarly as {@link #translateVariables(char, String, ValueStack)} ... *//** Converts all instances of ${...} in <code>expression</code> to the value returned ... *//** Converted object from variable translation. ... */ParsedValueEvaluator ognlEvalnew ParsedValueEvaluator(...) { ... }TextParser parser/** @see ... */translateVariablesCollection(...)/** Resolves given expression on given ValueStack. If found element is a ... */Collection<String> resultColCollection<Object> castedXWorkConverter convObject elementString stringElementshallBeIncluded(...)String resultStr/** Tests if given string is not null and not empty when excluding of empty ... *//** Returns a set from comma delimited Strings. ... */Set<String> setString[] splitsplit(...)String aSplitString trimmed/** Evaluated the value parsed by Ognl value stack. ... *//** Used to parse expressions like ${foo.bar} or %{bar.foo} but it is up tp the TextParser's ... */int DEFAULT_LOOP_COUNT, ...;/** ValueStack allows multiple beans to be pushed in and dynamic EL expressions to be evaluated against it. When ... */String REPORT_ERRORS_ON_NO_PROP, ...;/** Gets the context for this value stack. The context holds all the information in the value stack and it's surroundings. ... *//** Sets the default type to convert to if no type is provided when getting a value. ... *//** Set a override map containing <code> key -&gt; values </code> that takes precedent when doing find operations on the ValueStack. ... *//** Gets the override map if anyone exists. ... *//** Get the CompoundRoot which holds the objects pushed onto the stack ... *//** Attempts to set a property on a bean in the stack with the given expression using the default search order. ... *//** Find a value by evaluating the given expression against the stack in the default search order. ... *//** Get the object on the top of the stack <b>without</b> changing the stack. ... *//** Get the object on the top of the stack and <b>remove</b> it from the stack. ... *//** Put this object onto the top of the stack ... *//** Sets an object on the stack with the given key ... *//** Get the number of objects in the stack ... *//** Factory that creates a value stack, defaulting to the OgnlValueStackFactory *//** Get a new instance of {@link com.opensymphony.xwork2.util.ValueStack} ... *//** This class is an utility class that perform wilcard-patterns matching and ... */int MATCH_FILE, ...;/** The int representing '*' in the pattern <code>int []</code>. */int MATCH_PATH, ...;/** The int representing '**' in the pattern <code>int []</code>. */int MATCH_BEGIN, ...;/** The int representing begin in the pattern <code>int []</code>. */int MATCH_THEEND, ...;/** The int representing end in pattern <code>int []</code>. */int MATCH_END, ...;/** The int value that terminates the pattern <code>int []</code>. *//** Determines if the pattern contains any * characters ... *//** <p> Translate the given <code>String</code> into a <code>int []</code> ... */int[] exprnew int[]char[] buffint yboolean slashbuff.length/** Match a pattern agains a string and isolates wildcard replacement into ... */char[] rsltexpr.lengthint charposint exprposint buffposint rsltposint offsetint mcountboolean matchBeginint exprchrint prevchrmatchArray(...)indexOfArray(...)lastIndexOfArray(...)/** Get the offset of a part of an int array within a char array. <br> This ... */d.length/** Get the offset of a last occurance of an int array within a char array. ... */int l/** Matches elements of array r from rpos to rend with array d, starting ... */// Prepare the arrays// Prepare variables for the translation loop// Must start from beginning// Main translation loop// If the previous char was '\' simply copy this char.// If the previous char was not '\' we have to do a bunch of// checks// If this char is '\' declare that and continue// If this char is '*' check the previous one// If the previous character als was '*' match a path// Must match end at the end// Allocate the result buffer// The previous and current position of the expression character// (MATCH_*)// The position in the expression, input, translation and result arrays// The matching count// We want the complete data be in {0}// First check for MATCH_BEGIN// Search the fist expression character (except MATCH_BEGIN - already// skipped)// The expression charater (MATCH_*)// Check if the data in the expression array before the current// expression character matches the data in the input buffer// Check for MATCH_BEGIN// Advance buffpos// Check for END's// Don't care about rest of input buffer// Check that we reach buffer's end// Search the next expression character// We have here prevchr == * or **.// Copy the data from the source buffer into the result buffer// to substitute the expression character// Matching file, don't copy '/'// Check if pos and len are legal// If we need to match a zero length string return current dpos//?? dpos?// If we need to match a 1 char length string do it simply// Search for the specified character// Main string matching loop. It gets executed if the characters to// match are less then the characters left in the d buffer// Set current startpoint in d// Check every character in d for equity. If the string is matched// return dpos// Increase dpos to search for the same string at next offset// The remaining chars in d buffer were not enough or the string// wasn't matched// Decrease l to search for the same string at next offset/** Helper class to convert wildcard expression to regular expression *//** Convert wildcard pattern to Pattern ... */StringBuilder bufinsert(...)needsBackslashToBeLiteralInRegex(...)String theSpecialRegexCharList, ...;/* Copyright 2010 Yahoo, Inc.  All rights reserved. ... */// skip backslash, too/** A simple list that guarantees that inserting and retrieving objects will always work regardless ... */Object nextElementboolean trimgetObjectFactory(...)// convert to correct type/** Generic test setup methods to be used with any unit testing framework. */ConfigurationManager configurationManagernew ConfigurationManager(...)Configuration configContainer containeraddContainerProvider(...)new ContainerProvider(...) { ... }setAllowDuplicates(...)ConfigurationProvider provsetThrowExceptionOnDuplicateBeans(...)destroyConfiguration(...)// Reset the value stack// clear out localization//container.getInstance(LocalizedTextUtil.class).reset();//ObjectFactory.setObjectFactory(container.getInstance(ObjectFactory.class));//  clear out configurationFile file, ...;this.fileJarResourceStore.class/* Copyright 2002-2015 The Apache Software Foundation. ... *//** Reads a class from disk ... */FileInputStream fisbyte[] datanew byte[]closeQuietly(...)String fileNameFile.separatorCharFileResourceStore.classimport ZipFile/** Read resources from a jar file */ZipFile jarFilenew ZipFile(...)ZipEntry entrygetEntry(...)ByteArrayOutputStream outgetInputStream(...)toByteArray(...)byte[] bufferlong countint n//read into byte arrayClassLoader parent, ...;...[] stores, ...;ClassLoader delegate, ...;Set<Pattern> acceptClasses, ...;URL parentRootFileManager fileManagerURL rootnormalizeToFileProtocol(...)new ResourceStore[]new FileResourceStore(...)new ResourceStoreClassLoader(...)stores.lengthResourceStore[] newStoresarraycopy(...)clearAssertionStatus(...)setClassAssertionStatus(...)setDefaultAssertionStatus(...)setPackageAssertionStatus(...)this.acceptClassesReloadingClassLoader.class// see WW-3121// TODO: Fix this for a reloading mechanism to be marked as stable// FIXME: this should be improved with a Map// find the pStore and index position with var i// pStore was not found// if stores length > 1 then array copy old values, else create new empty store/** *interface taken from Apache JCI *//** class taken from Apache JCI */pStores.lengthResourceStore storebyte[] clazzBytesdefinePackage(...)defineClass(...)clazzBytes.lengthfindLoadedClass(...)fastFindClass(...)ClassLoader parentnew ClassNotFoundException(...)resolveClass(...)/** Define the package information associated with a class. ... */int classIndeximport AnnotatedElement/** ClassFinder searches the classpath of the specified ClassLoaderInterface for ... */intern(...)List<AnnotationInfo> annotations, ...;new AnnotationInfo(...)new ArrayList<AnnotationInfo>(...)ClassInfo info, ...;Package pkg, ...;this.pkgnew ClassInfo(...)List<MethodInfo> methods, ...;List<MethodInfo> constructors, ...;String superType, ...;List<String> interfaces, ...;List<String> superInterfaces, ...;List<FieldInfo> fields, ...;Class<?> clazz, ...;ClassFinder classFinder, ...;ClassNotFoundException notFound, ...;Class<> superclassthis.classFinderthis.superTypegetClassLoaderInterface(...)ClassNotFoundException notFoundgetClassesNotLoaded(...)this.notFoundnew ArrayList<MethodInfo>(...)new ArrayList<FieldInfo>(...)ClassInfo declaringClass, ...;String returnType, ...;List<List<AnnotationInfo>> parameterAnnotations, ...;this.declaringClassthis.returnTypeList<AnnotationInfo> annotationInfosnew ArrayList<List<AnnotationInfo>>(...)/** Allows create different ClassFinders which should help support different Java versions *//** Classes implementing this interface can find resources and load classes, usually delegating to a class ... */String CLASS_LOADER_INTERFACE, ...;//key used to add the current ClassLoaderInterface to ActionContext/** Default implementation of ClassLoaderInterface, which delegates to an actual ClassLoader */ClassLoader classLoader, ...;this.classLoadernew ClassLoaderInterfaceDelegate(...)import BufferedInputStreamimport java.net.*import JarFile...[] urls, ...;String path, ...;ClassLoaderInterface classLoaderInterface, ...;List<String> resourcesNotLoaded, ...;trimToEmpty(...)this.paththis.classLoaderInterfaceurls.lengthMalformedURLException ethis.urlsString file// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *//   FindString fullUriEnumeration<URL> resourcesList<URL> listnew ArrayList<URL>(...)/** Reads the contents of the URL as a {@link String}'s and returns it. ... *///   Find StringURL resourcenew IOException(...)readContents(...)/** Reads the contents of the found URLs as a list of {@link String}'s and returns them. ... */String fulluriList<String> stringsString string/** Reads the contents of the found URLs as a Strings and returns them. ... */IOException notAvailabletoExternalForm(...)Map<String,String> stringsMap<String,URL> resourcesMapgetResourcesMap(...)Entry<String,URL> entryMap<>.Entry<String,URL>/** Executes {@link #findString(String)} assuming the contents URL found is the name of ... *///   Find ClassfindString(...)List<Class<>> classesnew ArrayList<Class<>>(...)findAllStrings(...)findAvailableStrings(...)Exception notAvailableMap<String,Class<>> classesnew HashMap<String,Class<>>(...)mapAllStrings(...)mapAvailableStrings(...)//   Find ImplementationClass<> implnew ClassCastException(...)List<Class<>> implementationsMap<String,Class<>> implementations//   Find PropertiesloadProperties(...)List<Properties> propertiesnew ArrayList<Properties>(...)Map<String,Properties> propertiesMapnew HashMap<String,Properties>(...)Map<String,URL> mapProperties properties//   Map ResourcesString basePathMap<String,URL> resourcesnew HashMap<String,URL>(...)URL locationreadJarEntries(...)readDirectoryEntries(...)Set<String> resourcesreadJarDirectoryEntries(...)readSubDirectories(...)convertPathsToPackages(...)Map<URL,Set<String>> resultnew HashMap<URL,Set<String>>(...)Set<String> packageNamesString resourceremoveEnd(...)File dirtoURL(...)/** Reads subdirectories of a file. The output is a list of subdirectories, relative to the basepath */String subNameJarURLConnection connopenConnection(...)JarFile jarfileEnumeration<JarEntry> entriesentries(...)getJarFile(...)//read directories in the jar that start with the basePathInputStream readernew BufferedInputStream(...)int bfindResource(...)Vector<URL> resourcesnew Vector<URL>(...)elements(...)search.lengthURL currentUrlJarFile jarFileString protocolURL jarURLgetJarFileURL(...)String entryNameJarURLConnection jucint sepIdxtargetURL(...)String baseFileString hostgetHost(...)int hostLengthString fixedResNameString filenameFile file2exists(...)URL resourceURLURLConnection urlConnectionint codegetResponseCode(...)SecurityException egetPort(...)ResourceFinder.class/* If the connection for currentUrl or resURL is ... */// Don't look for this jar file again// Invalid URL, don't look here again// baseFile always ends with '/'// Do not create a UNC path, i.e. \\host// HTTP can return a stream on a non-existent file// So check for the return code;// Keep iterating through the URL list/** This is the testing interface that is used to accept or reject resources. *//** The test method. ... */Map<String,URL> urls, ...;Set<String> protocols, ...;getUrls(...)this.protocols/** Ignores all URLs that are not "jar" or "file" ... */Map<String,URL> urlsurlSet.urlsnew UrlSet(...)Map<String,URL> parentUrlsexclude(...)relative(...)matching(...)/** Calls excludePaths(System.getProperty("java.ext.dirs")) ... */excludePaths(...)/** Calls excludePaths(System.getProperty("java.endorsed.dirs")) ... */File javagetParentFile(...)String[] pathsFile.pathSeparatorUrlSet urlSet/** Try to find a classes directory inside a war file add its normalized url to this set ... */Enumeration<URL> rootUrlEnumerationString externalFormURL warUrlURL normalizedUrlURL finalUrlMap<String,URL> newUrlssubstringBefore(...)ArrayList<URL> urlsUrlSet.class//if it is inside a war file, get the url to the file//find jars//build a URL pointing to the jar, instead of the META-INF dir//usually the "classes" dir/** Default implementation of {@link FileManager} */Pattern JAR_PATTERN, ...;int JAR_FILE_PATH, ...;Map<String,Revision> files, ...;Revision revisionneedsReloading(...)openFile(...)monitorFile(...)isJarURL(...)/** Check if given URL is matching Jar pattern for different servers ... */Matcher jarMatchersynchronizedMap(...)new HashMap<String,Revision>(...)// no revision yet and we keep the revision history, so// return whether the file needs to be loaded for the first time// it's already a file// allow other implementation to be used firstFileManagerHolder fileManagerHolder, ...;FileManager systemFileManager, ...;this.systemFileManagerStrutsConstants.STRUTS_CONFIGURATION_XML_RELOADlookupFileManager(...)setReloadingConfigs(...)new FileManagerHolder(...)Set<FileManager> internalsnew HashSet<FileManager>(...)Set<FileManager> usersString fmNameFileManager fminternal(...)support(...)/** Represents file resource revision, used for file://* resources */long lastModified, ...;canRead(...)long lastModifiedlastModified(...)new FileRevision(...)this.lastModifiedimport FileUtils/** Represents jar resource revision, used for jar://* resource */String JAR_FILE_NAME_SEPARATOR, ...;String JAR_FILE_EXTENSION_END, ...;String jarFileName, ...;String fileNameInJar, ...;String jarFileNameint separatorIndexString fileNameInJarnew JarFile(...)toFile(...)new JarEntryRevision(...)this.jarFileNamethis.fileNameInJarJarEntryRevision.class// File within a Jar// Find separator index of jar filename and filename within jar// Split file name/** Class represents common revision resource, should be used as default class when no other option exists */new Revision(...)/** A interface that should be implemented by objects knowning their location (i.e. where they ... *//** Get the location of this object ... *//* Copyright 2005 The Apache Software Foundation. ... */import PropertiesReaderimport Reader/** Properties implementation that remembers the location of each property.  When ... */Map<String,Location> propLocations, ...;this.propLocationsnew HashMap<String,Location>(...)Reader readerPropertiesReader prnew PropertiesReader(...)nextProperty(...)getPropertyName(...)getPropertyValue(...)int lineString descconvertCommentsToString(...)getCommentLines(...)new LocationImpl(...)getURI(...)/** Base class for location aware objects *//** Set the location of this object ... *//** A location in a resource. The location is composed of the URI of the resource, and ... */Location UNKNOWN, ...;/** Constant for unknown locations. *//** Get the description of this location ... *//** Get the URI of this location ... *//** Get the line number of this location ... *//** Get the column number of this location ... *//** Gets a source code snippet with the default padding ... */LocationImpl.UNKNOWNimport Attrimport Attributesimport ContentHandlerimport Locatorimport SAXExceptionimport AttributesImplString PREFIX, ...;/** Prefix for the location namespace */String URI, ...;/** Namespace URI for location attributes */String SRC_ATTR, ...;/** Attribute name for the location URI */String LINE_ATTR, ...;/** Attribute name for the line number */String COL_ATTR, ...;/** Attribute name for the column number */String Q_SRC_ATTR, ...;/** Attribute qualified name for the location URI */String Q_LINE_ATTR, ...;/** Attribute qualified name for the line number */String Q_COL_ATTR, ...;/** Attribute qualified name for the column number */// Private constructor, we only have static methods/** Add location attributes to a set of SAX attributes. ... */AttributesImpl newAttrsnew AttributesImpl(...)addAttribute(...)getSystemId(...)/** Returns the {@link Location} of an element (SAX flavor). ... */String srcgetLine(...)getColumn(...)/** Returns the location of an element (SAX flavor). If the location is to be kept ... */LocationUtils.UNKNOWN_STRING/** Returns the URI of an element (SAX flavor) ... *//** Returns the line number of an element (SAX flavor) ... *//** Returns the column number of an element (SAX flavor) ... */String col/** Returns the {@link Location} of an element (DOM flavor). ... */Attr srcAttrgetAttributeNodeNS(...)/** Same as <code>getLocation(elem, null)</code>. ... *//** Returns the location of an element that has been processed by this pipe (DOM flavor). ... */getAttributeNS(...)/** Returns the URI of an element (DOM flavor) ... */Attr attr/** Returns the line number of an element (DOM flavor) ... *//** Returns the column number of an element (DOM flavor) ... *//** Remove the location attributes from a DOM element. ... */removeAttributeNS(...)Node child/** A SAX filter that adds the information available from the <code>Locator</code> as attributes. ... */Locator locator, ...;/** Create a filter. It has to be chained to another handler to be really useful. */this.locatorLocationAttributes.PREFIXLocationAttributes.URIaddLocationAttributes(...)// Nothing// No location information known, or already has it// Get an AttributeImpl so that we can add new attributes.// Add location attributes to the element/** A simple immutable and serializable implementation of {@link Location}. */String uri, ...;int line, ...;int column, ...;LocationImpl UNKNOWN, ...;// Package private: outside this package, use Location.UNKNOWN./** Build a location for a given URI, with unknown line and column numbers. ... *//** Build a location for a given URI and line and column numbers. ... */this.urithis.linethis.column/** Copy constructor. ... */getDescription(...)/** Create a location from an existing one, but with a different description ... *//** Obtain a <code>LocationImpl</code> from a {@link Location}. If <code>location</code> is ... */List<String> snippetint errnoLocation othertestEquals(...)int hash... ^ ......^=.../** Ensure serialized unknown location resolve to {@link Location#UNKNOWN}. ... */import SAXParseExceptionimport SourceLocatorimport TransformerException/** Location-related utility methods. */String UNKNOWN_STRING, ...;/** The string representation of an unknown location: "<code>[unknown location]</code>". */List<WeakReference<LocationFinder>> finders, ...;/** An finder or object locations *//** Get the location of an object ... *//** Builds a string representation of a location, in the ... */StringBuilder resultString descriptionString uri/** Parse a location string of the form "<code><em>uri</em>:<em>line</em>:<em>column</em></code>" (e.g. ... */int uriStartint colSepint columnint lineSep/** Checks if a location is known, i.e. it is not null nor equal to {@link Location#UNKNOWN}. ... *//** Checks if a location is unknown, i.e. it is either null or equal to {@link Location#UNKNOWN}. ... *//** Add a {@link LocationFinder} to the list of finders that will be queried for an object's ... */LocationFinder.classList<WeakReference<LocationFinder>> newFindersnew ArrayList<WeakReference<LocationFinder>>(...)new WeakReference<LocationFinder>(...)/** Get the location of an object. Some well-known located classes built in the JDK are handled ... */List<WeakReference<LocationFinder>> currentFindersSAXParseException speTransformerException exSourceLocator locatorgetLocator(...)Locator locatorWeakReference<LocationFinder> refLocationFinder finderLocation resultStackTraceElement[] stackgetStackTrace(...)stack.lengthStackTraceElement tracegetFileName(...)LocationUtils.class// Forbid instanciation// Do we have a description?// lastIndexOf to allow the separator to be in the description// strip " - "// unkonwn?// Ignore: handled below// Update a clone of the current finder list to avoid breaking// any iteration occuring in another thread.// Check some well-known locatable exceptions// Keep the current list// This finder was garbage collected: update finders// Update a clone of the current list to avoid breaking current iterations/** Main logger interface for logging things ... */import CommonsLoggerFactoryimport JdkLoggerFactoryimport Log4j2LoggerFactoryimport Slf4jLoggerFactoryimport ReadWriteLockimport ReentrantReadWriteLock/** Creates loggers.  Static accessor will lazily try to decide on the best factory if none specified. ... */ReadWriteLock lock, ...;LoggerFactory factory, ...;List<LoggerClass<>> loggers, ...;writeLock(...)LoggerFactory.factorygetLoggerImpl(...)getLoggerFactory(...)readLock(...)createLoggerFactory(...)String userLoggerFactoryXWorkConstants.XWORK_LOGGER_FACTORYnew JdkLoggerFactory(...)LoggerClass<> loggerisSupported(...)String loggerClazzName, ...;Class<T> loggerImplClazz, ...;this.loggerClazzNamethis.loggerImplClazzClassNotFoundException ignorenew ReentrantReadWriteLock(...)new LinkedList<LoggerClass<>>(...) { ... }new LoggerClass<CommonsLoggerFactory>(...)CommonsLoggerFactory.classnew LoggerClass<Slf4jLoggerFactory>(...)Slf4jLoggerFactory.classnew LoggerClass<Log4j2LoggerFactory>(...)Log4j2LoggerFactory.class/** Logging utility methods ... *//** Formats messages using parameters. For example, the call: ... */boolean isArgisDigit(...)int valgetNumericValue(...)List<String> strArgsimport LoggerUtilsimport Log/** Simple logger that delegates to commons logging ... */Log log, ...;this.logimport LoggerFactoryimport LogFactory/** Creates commons-logging-backed loggers ... */new CommonsLogger(...)getLog(...)/** Delegates to jdk logger.  Maps fatal to Level.SEVERE along with error. ... */Level.INFOisLoggable(...)Level.WARNINGLevel.FINELevel.FINEST/** Creates jdk loggers ... */new JdkLogger(...)/** Simple logger that delegates to log4j2 logging ... *//** Creates log4j2-logging-backed loggers ... */new Log4j2Logger(...)/** Simple logger that delegates to slf4j logging ... *//** Fatal is not support by Slf4j *//** Creates slf4j-logging-backed loggers ... */new Slf4jLogger(...)/** @author ... */isActive(...)InvocationHandler timerHandlernew TimerInvocationHandler(...)/** A profiled call {@link Method#invoke(java.lang.Object, java.lang.Object[])}. If {@link UtilTimerStack#isActive() } ... */String logLinegetTrimmedClassName(...)Object returnValue/** Given a method, get the Method name, with no package information. ... */String classname/** @deprecated */Object target, ...;this.targetprofiledInvoke(...)/* Copyright (c) 2002-2003, Atlassian Software Systems Pty Ltd All rights reserved. ... *///if we are not active - then do nothing//this should always be true - you shouldn't be passing something that isn't an interface//if the return value is an interface then we should also proxy it!/** Bean to contain information about the pages profiled ... */List<ProfilingTimerBean> children, ...;ProfilingTimerBean parent, ...;String resource, ...;long startTime, ...;long totalTime, ...;this.resourcethis.startTimethis.totalTimegetPrintable(...)ProfilingTimerBean aChildrennew ArrayList<ProfilingTimerBean>(...)//only print the value if we are larger or equal to the min time./** <p>A timer stack.</p> ... */ThreadLocal<ProfilingTimerBean> current, ...;// A reference to the current ProfilingTimerBeanString ACTIVATE_PROPERTY, ...;/** System property that controls whether this timer should be used or not.  Set to &quot;true&quot; activates ... */String MIN_TIME, ...;/** System property that controls the min time, that if exceeded will cause a log (at INFO level) to be ... */boolean active, ...;/** Initialized in a static block, it can be changed at runtime by calling setActive(...) *//** Create and start a performance profiling with the <code>name</code> given. Deal with ... */ProfilingTimerBean newTimernew ProfilingTimerBean(...)ProfilingTimerBean currentTimersetStartTime(...)addChild(...)/** End a performance profiling with the <code>name</code> given. Deal with ... */ProfilingTimerBean parentsetEndTime(...)printTimes(...)/** Do a log (at INFO level) of the time taken for this particular profiling. ... */getMinTime(...)/** Get the min time for this profiling, it searches for a System property ... *//** Determine if profiling is being activated, by searching for a system property ... */clearProperty(...)UtilTimerStack.activedoProfiling(...)/** A callback interface where code subjected to profile is to be executed. This eliminates the need ... *//** Method that execute the code subjected to profiling. ... */new ThreadLocal<ProfilingTimerBean>(...)UtilTimerStack.class//create a new timer and start it//if there is a current timer - add the new timer as a child of it//set the new timer to be the current timer//if the timers are matched up with each other (ie push("a"); pop("a"));//if we are the root timer, then print out the times//for those servers that use thread pooling//if timers are not matched up, then print what we have, and then print warning.//prevent printing multiple times/** Creates and returns a new standard naming context for evaluating an OGNL ... *//** Manages variables in the reflection context and returns values ... */String GETTING_BY_KEY_PROPERTY, ...;String SET_MAP_KEY, ...;String CURRENT_PROPERTY_PATH, ...;String FULL_PROPERTY_PATH, ...;String CREATE_NULL_OBJECTS, ...;String DENY_METHOD_EXECUTION, ...;String DENY_INDEXED_ACCESS_EXECUTION, ...;getBooleanProperty(...)setBooleanValue(...)XWorkConverter.REPORT_CONVERSION_ERRORSString currentPathMap<Object,Map<Object,Object>> mapOfSetMapsnew HashMap<Object,Map<Object,Object>>(...)Boolean myBoolnew Boolean(...)// TODO Auto-generated constructor stub/** Declares a class that wants to handle its own reflection exceptions *//** Handles a reflection exception ... *//** This method returns a PropertyDescriptor for the given class and property name using ... *//** Sets the named property to the supplied value on the Object, ... *//** Evaluates the given OGNL expression to extract a value from the given root ... *//** Evaluates the given OGNL expression to insert a value into the object graph ... *//** ActionValidatorManager is the main interface for validation managers (regular and annotation based). ... *//** Returns a list of validators for the given class, context, and method. This is the primary ... *//** Returns a list of validators for the given class and context. This is the primary ... *//** Validates the given object using action and its context. ... *//** Validates an action give its context and a validation context. ... *//** Validates the given object using an action, its context, and the name of the method being invoked on the action. ... *//** AnnotationActionValidatorManager is the entry point into XWork's annotations-based validator framework. ... */String VALIDATION_CONFIG_SUFFIX, ...;/** The file suffix for any validation file. */Map<String,List<ValidatorConfig>> validatorCache, ...;Map<String,List<ValidatorConfig>> validatorFileCache, ...;ValidatorFileParser validatorFileParser, ...;TextProviderFactory textProviderFactory, ...;this.validatorFileParserthis.textProviderFactorygetValidators(...)String validatorKeybuildValidatorKey(...)List<ValidatorConfig> cfgsArrayList<Validator<>> validatorsnew ArrayList<Validator<>>(...)buildValidatorConfigs(...)new ArrayList<ValidatorConfig>(...)ValidatorConfig cfggetValidator(...)removeParam(...)ValidatorConfig.BuildersetValidatorType(...)setValueStack(...)validate(...)ValidatorContext validatorContextnew DelegatingValidatorContext(...)List<Validator<>> validatorsSet<String> shortcircuitedFieldsFieldValidator fValidatorString fullFieldNamesetValidatorContext(...)getFullFieldName(...)getValidatorContext(...)getFieldName(...)isShortCircuit(...)List<String> errsCollection<String> fieldErrorsCollection<String> actionErrorsCollection<String> errCol/** Builds a key for validators - used when caching validators. ... */ActionInvocation invocationActionProxy proxyString configNameList<ValidatorConfig> resultAnnotationValidationConfigurationBuilder buildernew AnnotationValidationConfigurationBuilder(...)List<ValidatorConfig> annotationResultbuildAnnotationClassValidatorConfigs(...)/** <p>This method 'collects' all the validator configurations for a given ... */List<ValidatorConfig> validatorConfigsClass<> anInterface1buildClassValidatorConfigs(...)buildAliasValidatorConfigs(...)List<ValidatorConfig> retListparseActionValidatorConfigs(...)new HashMap<String,List<ValidatorConfig>>(...)// get the set of validator configs// create clean instances of the validators for the caller's use// get number of existing errors// the key needs to use the name of the action from the config file,// instead of the url, so wild card actions will have the same validator// see WW-2996// UPDATE:// WW-3753 Using the config name instead of the context only for// wild card actions to keep the flexibility provided// by the original design (such as mapping different contexts// to the same action and method if desired)// WW-4536 Using NameVariablePatternMatcher allows defines actions// with patterns enclosed with '{}', it's similar case to WW-3753// look for validators for implemented interfacesimport com.opensymphony.xwork2.validator.annotations.*/** <code>AnnotationValidationConfigurationBuilder</code> ... */String fieldNameAnnotation aprocessValidationAnnotation(...)Validation vvalidations(...)Validations valExpressionValidator vValidatorConfig tempprocessExpressionValidatorAnnotation(...)CustomValidator vprocessCustomValidatorAnnotation(...)ConversionErrorFieldValidator vprocessConversionErrorFieldValidatorAnnotation(...)DateRangeFieldValidator vprocessDateRangeFieldValidatorAnnotation(...)EmailValidator vprocessEmailValidatorAnnotation(...)CreditCardValidator vprocessCreditCardValidatorAnnotation(...)FieldExpressionValidator vprocessFieldExpressionValidatorAnnotation(...)IntRangeFieldValidator vprocessIntRangeFieldValidatorAnnotation(...)LongRangeFieldValidator vprocessLongRangeFieldValidatorAnnotation(...)ShortRangeFieldValidator vprocessShortRangeFieldValidatorAnnotation(...)DoubleRangeFieldValidator vprocessDoubleRangeFieldValidatorAnnotation(...)RequiredFieldValidator vprocessRequiredFieldValidatorAnnotation(...)RequiredStringValidator vprocessRequiredStringValidatorAnnotation(...)StringLengthFieldValidator vprocessStringLengthFieldValidatorAnnotation(...)UrlValidator vprocessUrlValidatorAnnotation(...)ConditionalVisitorFieldValidator vprocessConditionalVisitorFieldValidatorAnnotation(...)VisitorFieldValidator vprocessVisitorFieldValidatorAnnotation(...)RegexFieldValidator vprocessRegexFieldValidatorAnnotation(...)Validations validationsCustomValidator[] cvcustomValidators(...)ExpressionValidator[] evexpressions(...)ConversionErrorFieldValidator[] cefconversionErrorFields(...)DateRangeFieldValidator[] drfvdateRangeFields(...)EmailValidator[] emvemails(...)CreditCardValidator[] ccvcreditCards(...)FieldExpressionValidator[] fevfieldExpressions(...)IntRangeFieldValidator[] irfvintRangeFields(...)LongRangeFieldValidator[] lrfvlongRangeFields(...)RegexFieldValidator[] rfvregexFields(...)RequiredFieldValidator[] rvrequiredFields(...)RequiredStringValidator[] rsvrequiredStrings(...)StringLengthFieldValidator[] slfvstringLengthFields(...)UrlValidator[] uvurls(...)ConditionalVisitorFieldValidator[] cvfvconditionalVisitorFields(...)VisitorFieldValidator[] vfvvisitorFields(...)String validatorTypeMap<String,Object> paramsexpression(...)lookupRegisteredValidatorType(...)messageParams(...)messageKey(...)defaultMessage(...)shortCircuit(...)message(...)addParam(...)Annotation[] recursedAnnotationsparameters(...)fieldName(...)Annotation a2ValidationParameter parameterString parameterNamename(...)String parameterValueregex(...)regexExpression(...)caseSensitiveExpression(...)caseSensitive(...)trimExpression(...)context(...)appendPrefix(...)urlRegex(...)urlRegexExpression(...)maxLength(...)minLength(...)maxLengthExpression(...)minLengthExpression(...)SimpleDateFormat d0SimpleDateFormat d1SimpleDateFormat d2SimpleDateFormat d3SimpleDateFormat[] dfsSimpleDateFormat dfmin(...)maxExpression(...)minExpression(...)minInclusive(...)maxInclusive(...)minExclusive(...)maxExclusive(...)minInclusiveExpression(...)maxInclusiveExpression(...)minExclusiveExpression(...)maxExclusiveExpression(...)Date minDateparseDateString(...)dateFormat(...)Date maxDaterepopulateField(...)List<ValidatorConfig> tempprocessAnnotations(...)// Process collection of custom validations// Process single custom validator// Process ConversionErrorFieldValidator// Process DateRangeFieldValidator// Process EmailValidator// Process CrediCardValidator// Process FieldExpressionValidator// Process IntRangeFieldValidator// Process LongRangeFieldValidator// Process ShortRangeFieldValidator// Process DoubleRangeFieldValidator// Process RequiredFieldValidator// Process RequiredStringValidator// Process StringLengthFieldValidator// Process UrlValidator// Process ConditionalVisitorFieldValidator// Process VisitorFieldValidator// Process RegexFieldValidatorimport FilenameFilter/** Default validator factory ... */Map<String,String> validators, ...;parseValidators(...)setMessageKey(...)getMessageKey(...)setDefaultMessage(...)setMessageParameters(...)getMessageParams(...)setShortCircuit(...)List<File> filesString resourceNameURL uURI urinew URI(...)isOpaque(...)getScheme(...)File fFilenameFilter filternew FilenameFilter(...) { ... }File[] ffff.lengthSecurityException seZipInputStream zipInputStreamInputStream inputStreamretrieveValidatorConfiguration(...)parseValidatorDefinitions(...)// instantiate the validator, and set configured parameters//todo - can this use the ThreadLocal?// set other configured properties// lookup the validator class mapped to the type name// Get custom validator configurations via the classpath// First check if this is a directory// If yes, then just do a "list" to get all files in this directory// and match the filenames with *-validators.xml. If the filename// matches then add to the list of files to be parsed// If this is not a directory, then get hold of the inputstream.// If its not a ZipInputStream, then create a ZipInputStream out// of it. The intention is to allow nested jar files to be scanned// for *-validators.xml.// Ex: struts-app.jar -> MyApp.jar -> Login-validators.xml should be// parsed and loaded.//cleanup// Parse default validator configurations// Overwrite and extend defaults with application specific validator configurations// Add custom (plugin) specific validator configurationsimport XmlHelperimport org.w3c.dom.*/** Parse the validation file. (eg. MyAction-validation.xml, MyAction-actionAlias-validation.xml) ... */String DEFAULT_MULTI_TEXTVALUE_SEPARATOR, ...;String MULTI_TEXTVALUE_SEPARATOR_CONFIG_KEY, ...;String multiTextvalueSeparator, ...;List<ValidatorConfig> validatorCfgsMap<String,String> dtdMappingsNodeList fieldNodesNodeList validatorNodesaddValidatorConfigs(...)Element fieldElementMap<String,Object> extraParamsNodeList nodesElement validatorElement/** Extract trimmed text value from the given DOM element, ignoring XML comments. Appends all CharacterData nodes ... */NodeList nlboolean firstCDataFoundNode itemString nodeValuegetMultiTextvalueSeparator(...)Builder vCfgNodeList messageNodesElement messageElementNode defaultMessageNodeMap<String,String> messageParamsIllegalArgumentException exTreeMap<Integer,String> sortedMessageParametersnew TreeMap<Integer,String>(...)Entry<String,String> messageParamEntryint _order// BUG: xw-305: Let validator be parsed first and hence added to // the beginning of list and therefore evaluated first, so short-circuting// it will not cause field-level validator to be kicked off.// catch any problems here// ensure that the type is valid...// Get the default message when pattern 2 is used. We are only interested in the// i18n message parameters when an i18n message key is specified.// pattern 1:// <message key="someKey">Default message</message>// pattern 2:// <message key="someKey">//     <param name="1">'param1'</param>//     <param name="2">'param2'</param>//     <param name="defaultMessage>The Default Message</param>// </message>// Sort the message param. those with keys as '1', '2', '3' etc. (numeric values)// are i18n message parameter, others are excluded.// ignore if its not numeric.// we are i18n message parameters defined but no i18n message,// let's warn the user./** A default implementation of the {@link ValidatorContext} interface. ... */ValidationAware validationAware, ...;/** Creates a new validation context given a ValidationAware object, and a text and locale provider. These objects ... */this.validationAware/** Creates a new validation context given an object - usually an Action. The internal objects ... */makeLocaleProvider(...)makeValidationAware(...)makeTextProvider(...)/** Create a new validation context given a Class definition. The locale provider, text provider and ... */new ActionContextLocaleProvider(...)new StrutsTextProviderFactory(...)new LoggingValidationAware(...)new CompositeTextProvider(...)new TextProvider[]DelegatingValidatorContext.class/** An implementation of LocaleProvider which gets the locale from the action context. *//** An implementation of ValidationAware which logs errors and messages. */Object errorMessageObject messageEntry<String,List<String>> entryMap<>.Entry<String,List<String>>// the object argument passed through here will most probably be an ActionSupport descendant which does// implements TextProvider./** The FieldValidator interface defines the methods to be implemented by FieldValidators. ... *//** Sets the field name to validate with this FieldValidator ... *//** Gets the field name to be validated ... *//** This interface should be implemented by validators that can short-circuit the validator queue ... *//** Sets whether this field validator should short circuit the validator queue ... *//** Gets whether this field validator should short circuit the validator queue ... *//** ValidationException. ... *//** Constructs an <code>Exception</code> with no specified detail message. *//** Constructs an <code>Exception</code> with the specified detail message. ... */import MethodFilterInterceptorimport PrefixMethodInvocationUtilString VALIDATE_PREFIX, ...;String ALT_VALIDATE_PREFIX, ...;boolean validateAnnotatedMethodOnly, ...;ActionValidatorManager actionValidatorManager, ...;boolean alwaysInvokeValidate, ...;boolean programmatic, ...;boolean declarative, ...;this.actionValidatorManager/** Determines if {@link Validateable}'s <code>validate()</code> should be called, ... */this.programmatic/** Determines if validation based on annotations or xml should be performed. Defaults ... */this.declarative/** Determines if {@link Validateable}'s <code>validate()</code> should always ... */this.alwaysInvokeValidate/** Gets if <code>validate()</code> should always be called or only per annotated method. ... *//** Determine if <code>validate()</code> should always be called or only per annotated method. ... */this.validateAnnotatedMethodOnly/** Gets the current action and its context and delegates to {@link ActionValidatorManager} proper validate method. ... */String contextgetValidationContext(...)Exception exceptionValidateable validateabledoBeforeInvocation(...)ValidationInterceptor.class//the action name has to be from the url, otherwise validators that use aliases, like//MyActio-someaction-validator.xml will not be found, see WW-3194//UPDATE:  see WW-3753// keep exception that might occured in validateXXX or validateDoXXX// If any exception occurred while doing reflection, we want // validate() to be executed// rethrow if something is wrong while doing validateXXX / validateDoXXX // This method created for WW-3753/** <!-- START SNIPPET: validatorFlavours --> ... *//** Sets the default message to use for validation failure ... *//** Gets the default message used for validation failures ... *//** Gets the validation failure message for the given object ... *//** Sets a resource bundle key to be used for lookup of validation failure message ... *//** Gets the resource bundle key used for lookup of validation failure message ... *//** Sets the message parameters to be used when parsing i18n messages ... *//** Gets the message parameters to be used when parsing i18n messages ... *//** This method will be called before validate with a non-null ValidatorContext. ... *//** Gets the validation context used ... *//** The validation implementation must guarantee that setValidatorContext will ... *//** Sets the validator type to use (see class javadoc). ... *//** Gets the validator type used (see class javadoc). ... *//** Sets the value stack to use to resolve values and parameters ... *//** Holds the necessary information for configuring an instance of a Validator. ... */Map<String,Object> params, ...;String defaultMessage, ...;String messageKey, ...;boolean shortCircuit, ...;...[] messageParams, ...;orig.typethis.defaultMessageorig.defaultMessagethis.messageKeyorig.messageKeythis.shortCircuitorig.shortCircuitthis.messageParamsorig.messageParams/** Builds a ValidatorConfig */ValidatorConfig target, ...;new ValidatorConfig(...)target.shortCircuittarget.defaultMessagetarget.messageParamstarget.messageKeyValidatorConfig result/** The context for validation. This interface extends others to provide methods for reporting ... *//** Translates a simple field name into a full field name in OGNL syntax. ... *//** ValidatorFactory ... *//** Get a Validator that matches the given configuration. ... *//** Registers the given validator to the existing map of validators. ... *//** Lookup to get the FQ classname of the given validator name. ... *//** This class serves 2 purpose : ... *//** Parse resource for a list of ValidatorConfig objects (configuring which validator(s) are ... *//** Parses validator definitions (register various validators with XWork). ... *//** Determines the context to use for validating the Object property. ... *//** Determines whether the field name of this field validator should be prepended to the field name of ... *//** If this is activated, the validator will be used as short-circuit. ... *//** This validator checks that a field is a valid credit card. *//** Date property. ... *//** Double property. ... *//** Integer property. ... *//** Long property. ... *//** Regex used to evaluate field against it ... *//** Defines regex as an expression which first will be evaluated against the Value Stack to get proper regex. ... *//** To trim or not the value, default true - trim ... *//** Allows specify trim as an expression which will be evaluated during validation ... *//** Match the value in case sensitive manner, default true ... *//** Allows specify caseSensitive as an expression which will be evaluated during validation ... *//** Boolean property. ... *//** Short property. ... *//** This validator checks that a field is a valid URL. ... *//** Used for class or interface validation rules. ... *//** Custom Validation rules. ... *//** <code>ValidatorType</code> ... */ValidatorType FIELD, ...;ValidatorType SIMPLE, ...;new ValidatorType(...)import ValidationExceptionString expression, ...;this.expression/** If expression evaluates to true, invoke visitor validation. ... */validateExpression(...)/** Validate the expression contained in the "expression" paramter. ... */Boolean answergetFieldValue(...)ValidationException eConditionalVisitorFieldValidator.class// let this pass, but it will be logged right below/** CreditCardFieldValidator checks that a given String/Array/Collection field, ... */String CREDIT_CARD_PATTERN, ...;setRegex(...)setCaseSensitive(...)validateFieldValue(...)deleteWhitespace(...)// Visa// MasterCard// American Express// Diners Club// Discover// JCBDouble maxInclusive, ...;Double minInclusive, ...;Double minExclusive, ...;Double maxExclusive, ...;String minInclusiveExpression, ...;String maxInclusiveExpression, ...;String minExclusiveExpression, ...;String maxExclusiveExpression, ...;Double maxInclusiveToUsegetMaxInclusive(...)Double minInclusiveToUsegetMinInclusive(...)Double maxExclusiveToUsegetMaxExclusive(...)Double minExclusiveToUsegetMinExclusive(...)validateCollection(...)Collection<> valuesvalidateValue(...)Object objValueDouble valuesetCurrentValue(...)this.maxInclusivethis.minInclusivethis.minExclusivethis.maxExclusivethis.minInclusiveExpressionthis.maxInclusiveExpressionthis.minExclusiveExpressionthis.maxExclusiveExpressionDoubleRangeFieldValidator.classString EMAIL_ADDRESS_PATTERN, ...;ExpressionValidator.classFieldExpressionValidator.classimport FieldValidator/** Base class for field validators. ... */String fieldName, ...;Object currentValue, ...;this.fieldNamethis.currentValue/** Base class for range based validators. Use this class to develop any other custom range validators. */T min, ...;String minExpression, ...;T max, ...;String maxExpression, ...;T mingetMin(...)T maxgetMax(...)Collection<?> valuesthis.mingetT(...)this.minExpressionthis.maxthis.maxExpressionRangeValidatorSupport<>.class// if there is no value - don't do comparison// if a value is required, a required validator should be added to the field// only check for a minimum value if the min parameter is set// only check for a maximum value if the max parameter is setimport ObjectsString regex, ...;String regexExpression, ...;Boolean caseSensitive, ...;String caseSensitiveExpression, ...;Boolean trim, ...;String trimExpression, ...;String regexToUsegetRegex(...)String strString compareisCaseSensitive(...)isTrimed(...)this.regexthis.regexExpressionthis.caseSensitivethis.caseSensitiveExpressionthis.trim/** Allows specify trim param as an OGNL expression ... */this.trimExpressionRegexFieldValidator.class// string must not be empty// match against expressionboolean repopulateField, ...;this.repopulateFielddoValidate(...)Map<Object,Object> fakeParamsnew LinkedHashMap<Object,Object>(...)boolean doExprOverrideString[] tmpValuetmpValue.lengthString tmpValueRepopulateConversionErrorFieldValidatorSupport.class// take the first element, if possible// opps... it should be boolean trim, ...;Object fieldValueString stingValueint maxLength, ...;int minLength, ...;String maxLengthExpression, ...;String minLengthExpression, ...;this.maxLengththis.maxLengthExpressionthis.minLengththis.minLengthExpressionint minLengthToUsegetMinLength(...)int maxLengthToUsegetMaxLength(...)isTrim(...)StringLengthFieldValidator.class/** URLValidator checks that a given field is a String and a valid URL ... */String DEFAULT_URL_REGEX, ...;String urlRegexExpression, ...;Pattern urlPattern, ...;getUrlPattern(...)String regex/** This is used to support client-side validation, it's based on ... */this.urlRegexExpressionURLValidator.classimport com.opensymphony.xwork2.validator.*/** Abstract implementation of the Validator interface suitable for subclassing. ... */String EMPTY_STRING, ...;ValidatorContext validatorContext, ...;...[] messageParameters, ...;boolean popList<Object> parsedMessageParametersString messageParameterthis.messageParametersthis.validatorContext/** Parse <code>expression</code> passed in against value stack. ... *//** Return the field value named <code>name</code> from <code>object</code>, ... */Object retValValidatorSupport.class// if there's an exception in parsing, we'll just treat the expression itself as the// parameterimport CompositeTextProviderimport DelegatingValidatorContextimport ValidatorContextString context, ...;boolean appendPrefix, ...;this.appendPrefixString visitorContextCollection<> collvalidateArrayElements(...)validateObject(...)ValidatorContext parentnew AppendingValidatorContext(...)createTextProvider(...)CompositeTextProvider textProviderList<TextProvider> textProvidersnew LinkedList<TextProvider>(...)String field, ...;ValidatorContext parent, ...;/** Translates a simple field name into a full field name in Ognl syntax ... */VisitorFieldValidator.AppendingValidatorContextgetFieldNameWithField(...)VisitorFieldValidator.classimport FastDateFormatimport TimeZone/** Request handling utility class. */TimeZone GMT, ...;String FORMAT_PATTERN_RFC1123, ...;String FORMAT_PATTERN_RFC1036, ...;String FORMAT_PATTERN_ASCTIME, ...;...[] IF_MODIFIED_SINCE_FORMATS, ...;/** Retrieves the current request servlet path. ... */String servletPathgetServletPath(...)String requestUrigetRequestURI(...)int startIndexgetContextPath(...)int endIndexgetPathInfo(...)/** Gets the uri from the request ... *//** Parse input string as date in formats defined for If-Modified-Since header, ... */FastDateFormat fastDateFormatRequestUtils.classgetTimeZone(...)new FastDateFormat[]Locale.US// Detecting other characters that the servlet container cut off (like anything after ';')// this should not happen// handle http dispatcher includes.import ActionMappingimport PageContext/** Web-specific context information for actions. This class subclasses <tt>ActionContext</tt> which ... */String STRUTS_VALUESTACK_KEY, ...;String ACTION_MAPPING, ...;/** Gets the current action context ... *//** Gets the current value stack for this request ... *//** Gets the action mapping for this context ... *//** Returns the HTTP page context. ... *//** Sets the HTTP servlet request object. ... *//** Gets the HTTP servlet request object. ... *//** Sets the HTTP servlet response object. ... *//** Gets the HTTP servlet response object. ... *//** Gets the servlet context. ... *//** Sets the current servlet context object ... */import CompositeActionMapper/** This class provides a central location for framework configuration keys ... */String STRUTS_DEVMODE, ...;/** Whether Struts is in development mode or not */String STRUTS_I18N_RELOAD, ...;/** Whether the localization messages should automatically be reloaded */String STRUTS_I18N_ENCODING, ...;/** The encoding to use for localization messages */String STRUTS_CONFIGURATION_XML_RELOAD, ...;/** Whether to reload the XML configuration or not */String STRUTS_ACTION_EXTENSION, ...;/** The URL extension to use to determine if the request is meant for a Struts action */String STRUTS_ACTION_EXCLUDE_PATTERN, ...;/** Comma separated list of patterns (java.util.regex.Pattern) to be excluded from Struts2-processing */String STRUTS_TAG_ALTSYNTAX, ...;/** Whether to use the alterative syntax for the tags or not */String STRUTS_URL_HTTP_PORT, ...;/** The HTTP port used by Struts URLs */String STRUTS_URL_HTTPS_PORT, ...;/** The HTTPS port used by Struts URLs */String STRUTS_URL_INCLUDEPARAMS, ...;/** The default includeParams method to generate Struts URLs */String STRUTS_URL_RENDERER, ...;String STRUTS_OBJECTFACTORY, ...;/** The com.opensymphony.xwork2.ObjectFactory implementation class */String STRUTS_OBJECTFACTORY_ACTIONFACTORY, ...;String STRUTS_OBJECTFACTORY_RESULTFACTORY, ...;String STRUTS_OBJECTFACTORY_CONVERTERFACTORY, ...;String STRUTS_OBJECTFACTORY_INTERCEPTORFACTORY, ...;String STRUTS_OBJECTFACTORY_VALIDATORFACTORY, ...;String STRUTS_OBJECTFACTORY_UNKNOWNHANDLERFACTORY, ...;String STRUTS_FILE_MANAGER_FACTORY, ...;/** The com.opensymphony.xwork2.util.FileManager implementation class */String STRUTS_FILE_MANAGER, ...;/** The com.opensymphony.xwork2.util.fs.FileManager implementation class */String STRUTS_OBJECTTYPEDETERMINER, ...;/** The com.opensymphony.xwork2.util.ObjectTypeDeterminer implementation class */String STRUTS_CONTINUATIONS_PACKAGE, ...;/** The package containing actions that use Rife continuations */String STRUTS_CONFIGURATION, ...;/** The org.apache.struts2.config.Configuration implementation class */String STRUTS_LOCALE, ...;/** The default locale for the Struts application */String STRUTS_DISPATCHER_PARAMETERSWORKAROUND, ...;/** Whether to use a Servlet request parameter workaround necessary for some versions of WebLogic */String STRUTS_FREEMARKER_MANAGER_CLASSNAME, ...;/** The org.apache.struts2.views.freemarker.FreemarkerManager implementation class */String STRUTS_FREEMARKER_TEMPLATES_CACHE_UPDATE_DELAY, ...;/** Update freemarker templates cache in seconds */String STRUTS_FREEMARKER_BEANWRAPPER_CACHE, ...;/** Cache model instances at BeanWrapper level */String STRUTS_FREEMARKER_MRU_MAX_STRONG_SIZE, ...;/** Maximum strong sizing for MruCacheStorage for freemarker */String STRUTS_VELOCITY_MANAGER_CLASSNAME, ...;/** org.apache.struts2.views.velocity.VelocityManager implementation class */String STRUTS_VELOCITY_CONFIGFILE, ...;/** The Velocity configuration file path */String STRUTS_VELOCITY_TOOLBOXLOCATION, ...;/** The location of the Velocity toolbox */String STRUTS_VELOCITY_CONTEXTS, ...;/** List of Velocity context names */String STRUTS_UI_TEMPLATEDIR, ...;/** The directory containing UI templates.  All templates must reside in this directory. */String STRUTS_UI_THEME, ...;/** The default UI template theme */String STRUTS_UI_THEME_EXPANSION_TOKEN, ...;/** Token to use to indicate start of theme to be expanded. */String STRUTS_MULTIPART_MAXSIZE, ...;/** The maximize size of a multipart request (file upload) */String STRUTS_MULTIPART_SAVEDIR, ...;/** The directory to use for storing uploaded files */String STRUTS_MULTIPART_BUFFERSIZE, ...;/** Declares the buffer size to be used during streaming multipart content to disk. Used only with {@link org.apache.struts2.dispatcher.multipart.JakartaStreamMultiPartRequest} */String STRUTS_MULTIPART_PARSER, ...;/** The org.apache.struts2.dispatcher.multipart.MultiPartRequest parser implementation ... */String STRUTS_MULTIPART_ENABLED, ...;/** A global switch to disable support for multipart requests */String STRUTS_MULTIPART_VALIDATION_REGEX, ...;String STRUTS_OBJECTFACTORY_SPRING_AUTOWIRE, ...;/** How Spring should autowire.  Valid values are 'name', 'type', 'auto', and 'constructor' */String STRUTS_OBJECTFACTORY_SPRING_AUTOWIRE_ALWAYS_RESPECT, ...;/** Whether the autowire strategy chosen by STRUTS_OBJECTFACTORY_SPRING_AUTOWIRE is always respected.  Defaults ... */String STRUTS_OBJECTFACTORY_SPRING_USE_CLASS_CACHE, ...;/** Whether Spring should use its class cache or not */String STRUTS_OBJECTFACTORY_SPRING_ENABLE_AOP_SUPPORT, ...;/** Uses different logic to construct beans, see https://issues.apache.org/jira/browse/WW-4110 */String STRUTS_XSLT_NOCACHE, ...;/** Whether or not XSLT templates should not be cached */String STRUTS_CUSTOM_PROPERTIES, ...;/** Location of additional configuration properties files to load */String STRUTS_CUSTOM_I18N_RESOURCES, ...;/** Location of additional localization properties files to load */String STRUTS_MAPPER_CLASS, ...;/** The org.apache.struts2.dispatcher.mapper.ActionMapper implementation class */String PREFIX_BASED_MAPPER_CONFIGURATION, ...;/** A prefix based action mapper that is capable of delegating to other ... */String STRUTS_SERVE_STATIC_CONTENT, ...;/** Whether the Struts filter should serve static content or not */String STRUTS_SERVE_STATIC_BROWSER_CACHE, ...;/** If static content served by the Struts filter should set browser caching header properties or not */String STRUTS_ENABLE_DYNAMIC_METHOD_INVOCATION, ...;/** Allows one to disable dynamic method invocation from the URL */String STRUTS_ENABLE_SLASHES_IN_ACTION_NAMES, ...;/** Whether slashes in action names are allowed or not */String STRUTS_MAPPER_COMPOSITE, ...;/** Prefix used by {@link CompositeActionMapper} to identify its containing {@link org.apache.struts2.dispatcher.mapper.ActionMapper} class. */String STRUTS_ACTIONPROXYFACTORY, ...;String STRUTS_FREEMARKER_WRAPPER_ALT_MAP, ...;String STRUTS_XWORKCONVERTER, ...;/** The name of the xwork converter implementation */String STRUTS_ALWAYS_SELECT_FULL_NAMESPACE, ...;String STRUTS_XWORKTEXTPROVIDER, ...;/** XWork default text provider */String STRUTS_LOCALE_PROVIDER, ...;/** The {@link com.opensymphony.xwork2.LocaleProvider} implementation class ... */String STRUTS_LOCALE_PROVIDER_FACTORY, ...;/** The {@link com.opensymphony.xwork2.LocaleProviderFactory} implementation class */String STRUTS_ID_PARAMETER_NAME, ...;/** The name of the parameter to create when mapping an id (used by some action mappers) */String STRUTS_ALLOW_STATIC_METHOD_ACCESS, ...;/** The name of the parameter to determine whether static method access will be allowed in OGNL expressions or not */String STRUTS_ACTIONVALIDATORMANAGER, ...;/** The com.opensymphony.xwork2.validator.ActionValidatorManager implementation class */String STRUTS_VALUESTACKFACTORY, ...;/** The {@link com.opensymphony.xwork2.util.ValueStackFactory} implementation class */String STRUTS_REFLECTIONPROVIDER, ...;/** The {@link com.opensymphony.xwork2.util.reflection.ReflectionProvider} implementation class */String STRUTS_REFLECTIONCONTEXTFACTORY, ...;/** The {@link com.opensymphony.xwork2.util.reflection.ReflectionContextFactory} implementation class */String STRUTS_PATTERNMATCHER, ...;/** The {@link com.opensymphony.xwork2.util.PatternMatcher} implementation class */String STRUTS_STATIC_CONTENT_LOADER, ...;/** The {@link org.apache.struts2.dispatcher.StaticContentLoader} implementation class */String STRUTS_UNKNOWN_HANDLER_MANAGER, ...;/** The {@link com.opensymphony.xwork2.UnknownHandlerManager} implementation class */String STRUTS_EL_THROW_EXCEPTION, ...;/** Throw RuntimeException when a property is not found, or the evaluation of the espression fails */String STRUTS_LOG_MISSING_PROPERTIES, ...;/** Logs properties that are not found (very verbose) * */String STRUTS_ENABLE_OGNL_EXPRESSION_CACHE, ...;/** Enables caching of parsed OGNL expressions * */String STRUTS_ENABLE_OGNL_EVAL_EXPRESSION, ...;/** Enables evaluation of OGNL expressions * */String STRUTS_DISABLE_REQUEST_ATTRIBUTE_VALUE_STACK_LOOKUP, ...;/** Disables {@link org.apache.struts2.dispatcher.StrutsRequestWrapper} request attribute value stack lookup (JSTL accessibility) * */String STRUTS_URL_HELPER, ...;/** The{@link org.apache.struts2.views.util.UrlHelper} implementation class * */String STRUTS_CONVERTER_COLLECTION, ...;/** {@link com.opensymphony.xwork2.conversion.impl.XWorkBasicConverter} * */String STRUTS_CONVERTER_ARRAY, ...;String STRUTS_CONVERTER_DATE, ...;String STRUTS_CONVERTER_NUMBER, ...;String STRUTS_CONVERTER_STRING, ...;String STRUTS_HANDLE_EXCEPTION, ...;/** Enable handling exceptions by Dispatcher - true by default * */String STRUTS_CONVERTER_PROPERTIES_PROCESSOR, ...;String STRUTS_CONVERTER_FILE_PROCESSOR, ...;String STRUTS_CONVERTER_ANNOTATION_PROCESSOR, ...;String STRUTS_CONVERTER_CREATOR, ...;String STRUTS_CONVERTER_HOLDER, ...;String STRUTS_EXPRESSION_PARSER, ...;String STRUTS_ALLOWED_ACTION_NAMES, ...;/** actions names' whitelist * */String STRUTS_DEFAULT_ACTION_NAME, ...;/** default action name to use when action didn't match the whitelist * */String STRUTS_ALLOWED_METHOD_NAMES, ...;/** methods names' whitelist * */String STRUTS_DEFAULT_METHOD_NAME, ...;/** default method name to use when method didn't match the whitelist * */String STRUTS_MAPPER_ACTION_PREFIX_ENABLED, ...;/** enables action: prefix * */String STRUTS_MAPPER_ACTION_PREFIX_CROSSNAMESPACES, ...;/** enables access to actions in other namespaces than current with action: prefix * */String DEFAULT_TEMPLATE_TYPE_CONFIG_KEY, ...;String STRUTS_DISPATCHER_ERROR_HANDLER, ...;/** Allows override default DispatcherErrorHandler * */String STRUTS_EXCLUDED_CLASSES, ...;/** Comma delimited set of excluded classes and package names which cannot be accessed via expressions * */String STRUTS_EXCLUDED_PACKAGE_NAME_PATTERNS, ...;String STRUTS_EXCLUDED_PACKAGE_NAMES, ...;String STRUTS_EXCLUDED_PATTERNS_CHECKER, ...;/** Dedicated services to check if passed string is excluded/accepted * */String STRUTS_ACCEPTED_PATTERNS_CHECKER, ...;String STRUTS_OVERRIDE_EXCLUDED_PATTERNS, ...;/** Constant is used to override framework's default excluded patterns * */String STRUTS_OVERRIDE_ACCEPTED_PATTERNS, ...;String STRUTS_ADDITIONAL_EXCLUDED_PATTERNS, ...;String STRUTS_ADDITIONAL_ACCEPTED_PATTERNS, ...;String STRUTS_CONTENT_TYPE_MATCHER, ...;String STRUTS_SMI_METHOD_REGEX, ...;String STRUTS_TEXT_PROVIDER_FACTORY, ...;String STRUTS_LOCALIZED_TEXT_PROVIDER, ...;String STRUTS_DISALLOW_PROXY_MEMBER_ACCESS, ...;/** A generic runtime exception that optionally contains Location information *//** Constructs a <code>StrutsException</code> with no detail message. *//** Constructs a <code>StrutsException</code> with the specified ... *//** Constructs a <code>StrutsException</code> with the root cause ... *//** Constructs a <code>StrutsException</code> with the root cause and target ... */String HTTP_REQUEST, ...;/** Constant for the HTTP request object. */String HTTP_RESPONSE, ...;/** Constant for the HTTP response object. */String SERVLET_DISPATCHER, ...;/** Constant for an HTTP {@link javax.servlet.RequestDispatcher request dispatcher}. */String SERVLET_CONTEXT, ...;/** Constant for the {@link javax.servlet.ServletContext servlet context} object. */String PAGE_CONTEXT, ...;/** Constant for the JSP {@link javax.servlet.jsp.PageContext page context}. */String STRUTS_PORTLET_CONTEXT, ...;/** Constant for the PortletContext object */String STRUTS_ACTION_TAG_INVOCATION, ...;/** Set as an attribute in the request to let other parts of the framework know that the invocation is happening inside an ... */import StrutsExceptionimport StrutsStaticsimport Dispatcherimport RequestMapimport ActionMapperimport StrutsTagimport StrutsTagAttributeimport TagUtilsimport WriterHttpServletResponse res, ...;HttpServletRequest req, ...;boolean ignoreContextParams, ...;boolean flush, ...;boolean rethrowException, ...;this.reqthis.resthis.actionMapperboolean endend(...)executeAction(...)getVar(...)popComponentStack(...)HttpParameters newParamscreateParametersForContext(...)PageContext pageContextServletActionContext.PAGE_CONTEXTMap<> sessionMap<> applicationDispatcher duMap<String,Object> extraContextnew RequestMap(...)/** Creates parameters map using parameters from the value stack and component parameters.  Any non-String array ... */HttpParameters parentParamsBuilder builderMap<String,String[]> paramsnew HashMap<String,String[]>(...)/** Execute the requested action.  If no namespace is provided, we'll ... */String actualNameActionMapping mappinggetMappingFromActionName(...)new StrutsException(...)buildNamespace(...)createExtraContext(...)setAttribute(...)ServletActionContext.STRUTS_VALUESTACK_KEYStrutsStatics.STRUTS_ACTION_TAG_INVOCATIONremoveAttribute(...)putInContext(...)this.ignoreContextParamsthis.flushthis.rethrowExceptionActionComponent.class// add page context, such that ServletDispatcherResult will do an include// handle "name!method" convention.// get the old value stack from the request// execute at this point, after params have been set// set the new stack into the request for the taglib to use// set the old stack back on the requestString TEMPLATE, ...;boolean escape, ...;boolean isEmptyListCollection<String> actionMessagesaddParameter(...)this.escapeString OPEN_TEMPLATE, ...;String COMPONENT_NAME, ...;String href, ...;UrlProvider urlProvider, ...;UrlRenderer urlRenderer, ...;boolean processingTagBody, ...;Map<> urlParameters, ...;//these params are passed by the Param tagnew ComponentUrlProvider(...)this.urlParameterssetHttpServletRequest(...)setHttpServletResponse(...)evaluateExtraParams(...)ensureAttributeSafelyNotEscaped(...)String builtHrefbeforeRenderUrl(...)renderUrl(...)StrutsConstants.STRUTS_URL_INCLUDEPARAMSsetUrlIncludeParams(...)setUrlRenderer(...)this.urlRenderersetExtraParameterProvider(...)boolean resultthis.processingTagBody/** Overrides to be able to render body in a template rather than always before the template */evaluateParams(...)mergeTemplate(...)buildTemplateName(...)getDefaultTemplate(...)addAllParameters(...)this.hrefsetIncludeParams(...)setScheme(...)setAction(...)setNamespace(...)setMethod(...)setEncode(...)setIncludeContext(...)setPortletMode(...)setWindowState(...)setPortletUrlType(...)setAnchor(...)setEscapeAmp(...)setForceAddSchemeHostAndPort(...)Anchor.class//no href, build it from URL attributes/* the parameters added by this method are used in the template. this method is also ... */import UnnamedParametricimport AppendIteratorFilterimport MakeIteratorAppendIteratorFilter appendIteratorFilter, ...;List<> _parameters, ...;new AppendIteratorFilter(...)Iterator<> paramEntriesObject iteratorEntryObjisIterable(...)setSource(...)// UnnamedParametric implementation --------------------------------------setVar(...)AppendIterator.classObject bean, ...;String beanNameBean.class// push bean on stack// store for reference laterString fieldValue, ...;this.fieldValue// for checkboxes, everything needs to end up as a Boolean/** ClosingUIBean is the standard superclass for UI components such as div etc. */String openTemplate, ...;this.openTemplategetDefaultOpenTemplate(...)ClosingUIBean.classString list, ...;String listKey, ...;String listValue, ...;String headerKey, ...;String headerValue, ...;String emptyOption, ...;findListValue(...)Collection<> tmpMap<> tmpthis.listthis.emptyOptionthis.headerKeythis.headerValuethis.listKeythis.listValue// also covers "if (value.getClass().isArray())"import ComponentUtilsimport FastByteArrayOutputStreamimport UrlHelper/** Base class to extend for UI components. ... */String COMPONENT_STACK, ...;ConcurrentMap<Class<?>,Collection<String>> standardAttributesMap, ...;/** Caches information about common tag's attributes to reduce scanning for annotation @StrutsTagAttribute */Map<> parameters, ...;ActionMapper actionMapper, ...;boolean throwExceptionOnELFailure, ...;UrlHelper urlHelper, ...;this.parametersgetComponentStack(...)/** Gets the name of this component. ... */int dotStrutsConstants.STRUTS_EL_THROW_EXCEPTIONthis.throwExceptionOnELFailurethis.urlHelper/** Gets the OGNL value stack associated with this component. ... *//** Gets the component stack of this component. ... */Stack<Component> componentStacknew Stack<Component>(...)/** Callback for the start tag of this component. ... *//** Callback for the end tag of this component. ... *//** Pops the component stack. *//** Finds the nearest ancestor of this component stack. ... */Stack<> componentStackint currPositionsearch(...)Component component/** Evaluates the OGNL stack to find a String value. ... */fieldError(...)/** Constructs a <code>RuntimeException</code> based on the given information. ... */getComponentName(...)/** Finds a value from the OGNL stack based on the given expression. ... */stripExpressionIfAltSyntax(...)/** If altsyntax (%{...}) is applied, simply strip the "%{" and "}" off. ... *//** See <code>struts.properties</code> where the altSyntax flag is defined. ... */altSyntax(...)/** Adds the surrounding %{ } to the expression for proper processing. ... *//** This check is needed for backwards compatibility with 2.1.x ... */Exception problem/** Evaluates the OGNL stack to find an Object of the given type. Will evaluate ... */containsExpression(...)/** Renders an action URL by consulting the {@link org.apache.struts2.dispatcher.mapper.ActionMapper}. ... */String finalActionString finalMethoddetermineNamespace(...)new ActionMapping(...)getUriFromActionMapping(...)buildUrl(...)/** Determines the namespace of the current page being renderdd. Useful for Form, URL, and href generations. ... *//** Pushes this component's parameter Map as well as the component itself on to the stack ... *//** Constructs a string representation of the given exception. ... */FastByteArrayOutputStream boutnew FastByteArrayOutputStream(...)PrintWriter wrt/** Gets the parameters. ... *//** Adds all the given parameters to this component's own parameters. ... *//** Adds the given key and value to this component's own parameter. ... */Map<> params/** Overwrite to set if body should be used. ... *//** Checks if provided name is a valid tag's attribute ... */getStandardAttributes(...)/** If needed caches all methods annotated by given annotation to avoid further scans ... */Class<> clzCollection<String> standardAttributesCollection<Method> methodsStrutsTagAttribute.classuncapitalize(...)Component.classnew ConcurrentHashMap<Class<?>,Collection<String>>(...)//for (int i = componentStack.size() - 2; i >= 0; i--) {// UI component attributes may contain hypens (e.g. data-ajax), but ognl// can't handle that, and there can't be a component property with a hypen// so into the parameters map it goes. See WW-4493/** Default implementation of UrlProvider */HttpServletRequest httpServletRequest, ...;HttpServletResponse httpServletResponse, ...;String includeParams, ...;String scheme, ...;String action, ...;boolean encode, ...;boolean includeContext, ...;boolean escapeAmp, ...;String portletMode, ...;String windowState, ...;String portletUrlType, ...;String anchor, ...;boolean forceAddSchemeHostAndPort, ...;String urlIncludeParams, ...;ExtraParameterProvider extraParameterProvider, ...;Component component, ...;this.componentdetermineActionURL(...)this.httpServletRequestthis.httpServletResponsethis.includeParamsthis.schemeisPutInContext(...)this.encodethis.includeContextthis.escapeAmpthis.portletModethis.windowStatethis.portletUrlTypethis.anchorthis.forceAddSchemeHostAndPortthis.urlIncludeParamsthis.extraParameterProvider/** Base class for control and data tags */String var, ...;this.varString DATETAG_PROPERTY, ...;/** Property name to fall back when no format is specified */String DATETAG_PROPERTY_PAST, ...;/** Property name that defines the past notation (default: {0} ago) */String DATETAG_DEFAULT_PAST, ...;String DATETAG_PROPERTY_FUTURE, ...;/** Property name that defines the future notation (default: in {0}) */String DATETAG_DEFAULT_FUTURE, ...;String DATETAG_PROPERTY_SECONDS, ...;/** Property name that defines the seconds notation (default: in instant) */String DATETAG_DEFAULT_SECONDS, ...;String DATETAG_PROPERTY_MINUTES, ...;/** Property name that defines the minutes notation (default: {0,choice,1#one minute|1&lt;{0} minutes}) */String DATETAG_DEFAULT_MINUTES, ...;String DATETAG_PROPERTY_HOURS, ...;/** Property name that defines the hours notation (default: {0,choice,1#one hour|1&lt;{0} hours}{1,choice,0#|1#, one ... */String DATETAG_DEFAULT_HOURS, ...;String DATETAG_PROPERTY_DAYS, ...;/** Property name that defines the days notation (default: {0,choice,1#one day|1&lt;{0} days}{1,choice,0#|1#, one hour|1&lt;, ... */String DATETAG_DEFAULT_DAYS, ...;String DATETAG_PROPERTY_YEARS, ...;/** Property name that defines the years notation (default: {0,choice,1#one year|1&lt;{0} years}{1,choice,0#|1#, one ... */String DATETAG_DEFAULT_YEARS, ...;String format, ...;boolean nice, ...;String timezone, ...;/** Calculates the difference in time from now to the given date, and outputs it nicely. <br> An example: <br> ... */Date nowList<> argslong secsabs(...)... / ...long minslong secint minlong hoursint hourint daysint dayint yearsbefore(...)Date dateObject dateObjectfindProviderInStack(...)formatTime(...)TimeZone tzString globalFormatsetTimeZone(...)String actualTimezonethis.formatthis.nicethis.timezone// looks like this date is passed// find the name on the valueStack//support Calendar also//try to find the format on the stack// if the format is not specified, fall back using the// defined property DATETAG_PROPERTY// if tp.getText can not find the property then the// returned string is the same as input =// DATETAG_PROPERTY/** The name of the default template for the DateTextFieldTag */Iterator<> iterList<> stackValuesMap<> valuesnew DebugMapEntry(...)Object key, ...;Object oldValString multiple, ...;String size, ...;String doubleList, ...;String doubleListKey, ...;String doubleListValue, ...;String doubleListCssClass, ...;String doubleListCssStyle, ...;String doubleListTitle, ...;String doubleName, ...;String doubleValue, ...;String formName, ...;String doubleId, ...;String doubleDisabled, ...;String doubleMultiple, ...;String doubleSize, ...;String doubleHeaderKey, ...;String doubleHeaderValue, ...;String doubleEmptyOption, ...;String doubleCssClass, ...;String doubleCssStyle, ...;String doubleOnclick, ...;String doubleOndblclick, ...;String doubleOnmousedown, ...;String doubleOnmouseup, ...;String doubleOnmouseover, ...;String doubleOnmousemove, ...;String doubleOnmouseout, ...;String doubleOnfocus, ...;String doubleOnblur, ...;String doubleOnkeypress, ...;String doubleOnkeydown, ...;String doubleOnkeyup, ...;String doubleOnselect, ...;String doubleOnchange, ...;String doubleAccesskey, ...;Object tmpDoubleListClass<> valueClazzgetValueClassType(...)Form formfindAncestor(...)Form.classthis.doubleNameComponent formfindStringIfAltSyntax(...)this.doubleListthis.doubleListKeythis.doubleListValuethis.doubleListCssClassthis.doubleListCssStylethis.doubleListTitlethis.doubleValuethis.formNamethis.doubleCssClassthis.doubleCssStylethis.doubleHeaderKeythis.doubleHeaderValuethis.doubleEmptyOptionthis.doubleDisabledthis.doubleIdthis.doubleMultiplethis.doubleOnblurthis.doubleOnchangethis.doubleOnclickthis.doubleOndblclickthis.doubleOnfocusthis.doubleOnkeydownthis.doubleOnkeypressthis.doubleOnkeyupthis.doubleOnmousedownthis.doubleOnmousemovethis.doubleOnmouseoutthis.doubleOnmouseoverthis.doubleOnmouseupthis.doubleOnselectthis.doubleSizethis.multiplethis.sizethis.doubleAccesskey//Object doubleName = null;// ok, let's look it up// this check is needed for backwards compatibility with 2.1.x// TODO: Passing a Collection may work too?StringBuilder onchangeParamthis.onchange// force the onchange parameterBoolean ifResultIf.ANSWERBoolean answer, ...;String test, ...;this.test//make the comparisonList<String> errorFieldNames, ...;String accept, ...;String encTypethis.acceptFile.class// uh oh, this isn't good! Let's warn the developerimport RuntimeConfigurationimport MethodFilterInterceptorUtilimport VisitorFieldValidatorint sequence, ...;String onsubmit, ...;String onreset, ...;String target, ...;String enctype, ...;String validate, ...;String acceptcharset, ...;String focusElement, ...;/* Revised for Portlet actionURL as form action, and add wwAction as hidden ... */String id/** Form component determine the its HTML element id as follows:- ... */renderFormUrl(...)/** Evaluate client side JavaScript Enablement. ... */Boolean validateRuntimeConfiguration runtimeConfigurationValidationInterceptor validationInterceptorSet<> excludeMethodsgetExcludeMethodsSet(...)Set<> includeMethodsgetIncludeMethodsSet(...)Class<> actionClassString formActionValueList<Validator<>> actionValidatorsisValidateAnnotatedMethodOnly(...)findFieldValidators(...)String actionNamespaceFieldValidator fieldValidatorVisitorFieldValidator vfValidatorgetVisitorReturnType(...)List<Validator<>> visitorValidatorsString vPrefixisAppendPrefix(...)FieldVisitorValidatorWrapper wrapnew FieldVisitorValidatorWrapper(...)/* Class is public because Freemarker has problems accessing properties. *//** Wrap field validator, add visitor's field prefix to the field name. ... */FieldValidator fieldValidator, ...;String namePrefix, ...;this.fieldValidatorthis.namePrefixgetMessageParameters(...)setFieldName(...)/** Return type of visited object. ... */capitalize(...)/** Get a incrementing sequence unique to this <code>Form</code> component. ... */this.onsubmitthis.onresetthis.enctypethis.validatethis.acceptcharsetthis.focusElement//make the name the same as the id// keep a collection of the tag names for anything special the templates might want to do (such as pure client// side validation)// we have this if check so we don't do this twice (on open and close of the template)// if no id given, it will be tried to generate it from the action attribute// by the urlRenderer implementation// Only evaluate if Client-Side js is to be enable when validate=true//fixing field name for js side/** FormButton. */String BUTTONTYPE_INPUT, ...;String BUTTONTYPE_BUTTON, ...;String BUTTONTYPE_IMAGE, ...;//public void evaluateParams() {String submitTypesupportsImageType(...)setExtension(...)/** Override UIBean's implementation, such that component Html id is determined ... */String _tmp_idgetSequence(...)/** Indicate whether the concrete button supports the type "image". ... *///super.evaluateParams();// if form is null, this component is used, without a form, i guess// there's not much we could do then.import ContainUtilString encoding, ...;StrutsConstants.STRUTS_I18N_ENCODINGthis.encodingboolean pushed, ...;TextProvider defaultTextProvider, ...;this.defaultTextProviderLocaleProvider localeProviderI18n.classString ANSWER, ...;import RequestUtilsimport RequestDispatcherimport ServletExceptionimport ServletOutputStreamimport ServletRequestimport HttpServletResponseWrapperimport URLEncoderString systemEncoding, ...;String defaultEncoding, ...;String pageStringBuilder urlBufString concatObject nextObject nameList<> valuesencode(...)UnsupportedEncodingException einclude(...)String returnValueHttpServletRequest hrequestStack<> stacknew Stack<>(...)StringTokenizer pathPartsStringBuilder flatPathBufferString partelementAt(...)List<> currentValues/** Include a resource in a response. ... */String resourcePathgetContextRelativePath(...)RequestDispatcher rdgetRequestDispatcher(...)PageResponse pageResponsenew PageResponse(...)new ServletException(...)writeTo(...)/** Implementation of ServletOutputStream that stores all data written ... */FastByteArrayOutputStream buffer, ...;/** Return all data that has been written to this OutputStream. */PrintWriter pagePrintWriter, ...;ServletOutputStream outputStream, ...;PageOutputStream pageOutputStream, ...;/** Create PageResponse wrapped around an existing HttpServletResponse. *//** Return the content buffered inside the {@link PageOutputStream}. ... */getBuffer(...)getOutputStream(...)/** Return instance of {@link PageOutputStream} ... */new PageOutputStream(...)/** Return PrintWriter wrapper around PageOutputStream. */new OutputStreamWriter(...)getCharacterEncoding(...)Include.class// Add URL// Add request parameters// Set parameters// Include// .. is illegal in an absolute path according to the Servlet Spec and will cause// known problems on Orion application servers.// don't use the default implementation of addParameter,// instead, include tag requires that each parameter be a list of objects,// just like the HTTP servlet interfaces are (String[])// Include the resource// Use given encoding//use the platform specific encoding//if we are using a writer, we need to flush the//data to the underlying outputstream.//most containers do this - but it seems Jetty 4.0.5 doesn'tString allowRemoveAll, ...;String allowUpDown, ...;String leftTitle, ...;String rightTitle, ...;String buttonCssClass, ...;String buttonCssStyle, ...;String addLabel, ...;String removeLabel, ...;String removeAllLabel, ...;String upLabel, ...;String downLabel, ...;Form formAncestorMap<> formInputtransferselectIdsString tmpIdString tmpHeaderKeyenableAncestorFormCustomOnsubmit(...)this.allowRemoveAllthis.allowUpDownthis.leftTitlethis.rightTitlethis.buttonCssClassthis.buttonCssStylethis.addLabelthis.removeLabelthis.removeAllLabelthis.upLabelthis.downLabelInputTransferSelect.class// allowUpDown// allowRemoveAll// leftTitle// rightTitle// buttonCssClass// buttonCssStyle// addLabel// removeLabel// removeAllLabel// upLabel// leftDownLabel// inform the form component our select tag infos, so they know how to select// its elements upon onSubmit// inform ancestor form that we are having a customOnSubmit (see form-close.ftl [simple theme])// key -> select tag id, value -> headerKey (if exists)// init lists// idimport IteratorStatusIterator<> iterator, ...;IteratorStatus status, ...;Object oldStatus, ...;IteratorStatus.StatusState statusState, ...;IteratorStatus.StatusStateString statusAttr, ...;String beginStr, ...;Integer begin, ...;String endStr, ...;Integer end, ...;String stepStr, ...;Integer step, ...;Object iteratorTargetnew StatusState(...)new IteratorStatus(...)new CounterIterator(...)Object currentValuesetLast(...)int step, ...;int end, ...;int currentIndex, ...;List<Object> values, ...;this.endthis.stepthis.currentIndexthis.valuesint nextpeekNextIndex(...)int nextIndexnew IndexOutOfBoundsException(...)this.statusAttrthis.beginStrthis.endStrthis.stepStrIteratorComponent.class//Create an iterator status if the status attribute was set.//default step to 1//classic for loop from 'begin' to 'end'//only arrays and lists are supported//so the iterator is not based on an array or a list// get the first// Status object// Update status// Increase counter// Reset status object in case someone else uses the same name in another iterator tag instanceimport TextProviderHelperString forAttr, ...;Object nameValueString providedLabelString exprcompleteExpressionIfAltSyntax(...)this.forAttr// try value, then key, then name (this overrides the default behavior in the superclass)// get the label from a TextProvider (default value is the key)Object list, ...;String listValueKey, ...;String listLabelKey, ...;String listCssClass, ...;String listCssStyle, ...;String listTitle, ...;boolean throwExceptionOnNullValueAttribute, ...;// indicate if an exception is to be thrown when value attribute is nullthis.listValueKeythis.listLabelKeythis.listCssClassthis.listCssStylethis.listTitlethis.throwExceptionOnNullValueAttribute// will throw an exception if not found// ww-1010, allows value with null value to be compatible with ww// 2.1.7 behaviour// don't convert nameValue to anything, we need the raw valueimport MergeIteratorFilterMergeIteratorFilter mergeIteratorFilter, ...;new MergeIteratorFilter(...)// == UnnamedParametric interface implementation ---------------------MergeIterator.class// if id exists, we put it in the stack's contextimport RoundingModeimport CurrencyString NUMBERTAG_PROPERTY, ...;String currency, ...;Boolean groupingUsed, ...;Integer maximumFractionDigits, ...;Integer maximumIntegerDigits, ...;Integer minimumFractionDigits, ...;Integer minimumIntegerDigits, ...;Boolean parseIntegerOnly, ...;String roundingMode, ...;findNumberName(...)findCurrency(...)setNumberFormatParameters(...)setRoundingMode(...)// try to find the currency, percentage and integer on the stackObject currencyValuesetCurrency(...)IllegalArgumentException iaesetMaximumFractionDigits(...)setMaximumIntegerDigits(...)setMinimumIntegerDigits(...)Object numberObjectRoundingMode.CEILINGRoundingMode.DOWNRoundingMode.FLOORRoundingMode.HALF_DOWNRoundingMode.HALF_EVENRoundingMode.HALF_UPRoundingMode.UNNECESSARYRoundingMode.UPgetCurrencyInstance(...)getIntegerInstance(...)getPercentInstance(...)this.currencythis.groupingUsedthis.maximumFractionDigitsthis.maximumIntegerDigitsthis.minimumFractionDigitsthis.minimumIntegerDigitsthis.parseIntegerOnlythis.roundingMode// suport Calendar alsoString INTERNAL_LIST_UI_BEAN_LIST_PARAMETER_KEY, ...;ListUIBean internalUiBean, ...;new ListUIBean(...) { ... }Select selectSelect.classList<> listUiBeanssetLabel(...)setDisabled(...)setList(...)setListKey(...)setListValue(...)OptGroup.classString allowAddToLeft, ...;String allowAddToRight, ...;String allowAddAllToLeft, ...;String allowAddAllToRight, ...;String allowSelectAll, ...;String allowUpDownOnLeft, ...;String allowUpDownOnRight, ...;String addToLeftLabel, ...;String addToRightLabel, ...;String addAllToLeftLabel, ...;String addAllToRightLabel, ...;String selectAllLabel, ...;String leftUpLabel, ...;String leftDownlabel, ...;String rightUpLabel, ...;String rightDownLabel, ...;String addToLeftOnclick, ...;String addToRightOnclick, ...;String addAllToLeftOnclick, ...;String addAllToRightOnclick, ...;String selectAllOnclick, ...;String upDownOnLeftOnclick, ...;String upDownOnRightOnclick, ...;Object doubleValueMap<> formOptiontransferselectIdsMap<> formOptiontransferselectDoubleIdsString tmpDoubleIdString tmpDoubleHeaderKeythis.addAllToLeftLabelthis.addAllToRightLabelthis.addToLeftLabelthis.addToRightLabelthis.allowAddAllToLeftthis.allowAddAllToRightthis.allowAddToLeftthis.allowAddToRightthis.allowUpDownOnLeftthis.allowUpDownOnRightthis.allowSelectAllthis.selectAllLabelthis.leftUpLabelthis.leftDownlabelthis.rightUpLabelthis.rightDownLabelthis.addAllToLeftOnclickthis.addAllToRightOnclickthis.addToLeftOnclickthis.addToRightOnclickthis.upDownOnLeftOnclickthis.upDownOnRightOnclickthis.selectAllOnclickOptionTransferSelect.class// override DoubleListUIBean's// allowSelectAll// allowAddToLeft// allowAddToRight// allowAddAllToLeft// allowAddAllToRight// allowUpDownOnLeft// allowUpDownOnRight// addToLeftLabel// addToRightLabel// addAllToLeftLabel// addAllToRightLabel// selectAllLabel// leftUpLabel// rightUpLabel// rightDownlabel// selectAllOnclick// addToLeftOnclick// addToRightOnclick// addAllToLeftOnclick// addAllToRightOnclick// upDownOnLeftOnclick// upDownOnRightOnclick// its elements upon onsubmit// inform ancestor form that we are having a customOnsubmit (see form-close.ftl [simple theme])// doubleIdboolean suppressEmptyParameters, ...;this.suppressEmptyParameters/** Adds the given value as a parameter to the outer tag. ... */String showPassword, ...;this.showPasswordString defaultValue, ...;boolean escapeHtml, ...;boolean escapeJavaScript, ...;boolean escapeXml, ...;boolean escapeCsv, ...;this.defaultValuethis.escapeHtmlthis.escapeJavaScriptthis.escapeCsvthis.escapeXmlString actualValueescapeXml(...)escapeCsv(...)Property.class// exception: don't call findString(), since we don't want the//            expression parsed in this one case. it really//            doesn't make sense, in fact.// need to ensure push is assigned, otherwise we may have a leftover valueString src, ...;Reset.TEMPLATEthis.src/** Implementation of the {@link UrlRenderer} interface that creates URLs suitable in a servlet environment. *//** Provide a logging instance. *//** {@inheritDoc} */String schemegetHttpServletRequest(...)ActionInvocation aiString anchorgetAnchor(...)getHttpServletResponse(...)isIncludeContext(...)isEncode(...)isForceAddSchemeHostAndPort(...)isEscapeAmp(...)String actionisMethodSpecified(...)String _valueformComponent.namespaceformComponent.requestMap<> actionParamsActionMapping nameMappingString actionMethodformComponent.configurationformComponent.actionString queryStringparseQueryString(...)formComponent.parametersformComponent.responseformComponent.includeContextformComponent.actionMapperformComponent.objectFactoryformComponent.nameint slashevaluateClientSideJsEnablement(...)String includeParamsUrlProvider.GETgetUrlIncludeParams(...)getIncludeParams(...)UrlProvider.NONEmergeRequestParameters(...)UrlProvider.ALLgetParameterMap(...)includeGetParameters(...)includeExtraParameters(...)getQueryString(...)getExtraParameterProvider(...)getExtraParameters(...)String queryextractQueryString(...)/** Merge request parameters into current parameters. If a parameter is ... */Map<String,Object> mergedParamsServletUrlRenderer.class// both are null, we will default to the current action// We don't include the request parameters cause they would have been// prioritised before this [in start(Writer) method]// add to the request and page scopes as well// no action supplied? ok, then default to the current request// (action or general URL)// hmm, ok, we need to just assume the current URL cut down// let's try to get the actual action class and name// this can be used for getting the list of validators// this is OK, we'll just move on// if the name isn't specified, use the action name// if the id isn't specified, use the action name// Since we can't find an action alias in the configuration, we just// assume the action attribute supplied is the path to be used as// the URI this form is submitting to.// Warn user that the specified namespace/action combo// was not found in the configuration.// namespace: cut out anything between the start and the last /// name/id: cut out anything between / and . should be the id and// name// WW-1284// evaluate if client-side js is to be enabled. (if validation// interceptor does allow validation eg. method is not filtered out)// no explicit url set so attach params from current url, do// this at start so body params can override any of these they wish.// ww-1266// for ALL also include GET parameters// Parse the query string to make sure that the parameters come from the query, and not some posted data// Remove possible #foobar suffix// Merge contextParameters (from current request) with parameters specified in value attribute// eg. value="someAction.action?id=someId&venue=someVenue"// where the parameters specified in value attribute takes priority.// Merge parameters specified in value attribute// with parameters specified though param tag// eg. <param name="id" value="%{'someId'}" />// where parameters specified through param tag takes priority.Submit.classParam.UnnamedParametricString actualName, ...;String searchStack, ...;this.searchStackBoolean doSearchStackText.class// overriding this to true such that EVAL_BODY_BUFFERED is return and// bodyContent will be valid hence, text between start & end tag will// be honoured as default message (WW-1268)String cols, ...;String readonly, ...;String rows, ...;String wrap, ...;this.colsthis.readonlythis.rowsthis.wrap/** The name of the default template for the TextFieldTag */String maxlength, ...;this.maxlengthimport TokenHelper/** First looks for the token in the PageContext using the supplied name (or {@link org.apache.struts2.util.TokenHelper#DEFAULT_TOKEN_NAME} ... */String tokenNameMap<> parametersString tokenbuildToken(...)TokenHelper.DEFAULT_TOKEN_NAMETokenHelper.TOKEN_NAME_FIELDObject myTokensetToken(...)import Templateimport TemplateEngineimport TemplateEngineManagerimport TemplateRenderingContextimport ContextUtilHttpServletRequest request, ...;HttpServletResponse response, ...;this.requestthis.responsethis.templateSuffixgetTemplateSuffix(...)String templateSuffix, ...;// The templateSuffic to use, overrides the default one if not null.String template, ...;// The template to use, overrides the default one.String templateDir, ...;// templateDir and theme attributesString theme, ...;// shortcut, sets label, name, and valueString cssClass, ...;String cssStyle, ...;String cssErrorClass, ...;String cssErrorStyle, ...;String disabled, ...;String label, ...;String labelPosition, ...;String labelSeparator, ...;String requiredPosition, ...;String errorPosition, ...;String requiredLabel, ...;String tabindex, ...;String onclick, ...;// HTML scripting events attributesString ondblclick, ...;String onmousedown, ...;String onmouseup, ...;String onmouseover, ...;String onmousemove, ...;String onmouseout, ...;String onfocus, ...;String onblur, ...;String onkeypress, ...;String onkeydown, ...;String onkeyup, ...;String onselect, ...;String onchange, ...;String accesskey, ...;// common html attributesString tooltip, ...;// javascript tooltip attributeString tooltipConfig, ...;String javascriptTooltip, ...;String tooltipDelay, ...;String tooltipCssClass, ...;String tooltipIconPath, ...;Map<String,Object> dynamicAttributes, ...;// dynamic attributesString defaultTemplateDir, ...;String defaultUITheme, ...;String uiThemeExpansionToken, ...;TemplateEngineManager templateEngineManager, ...;StrutsConstants.STRUTS_UI_TEMPLATEDIRthis.defaultTemplateDirStrutsConstants.STRUTS_UI_THEMEthis.defaultUIThemeStrutsConstants.STRUTS_UI_THEME_EXPANSION_TOKENthis.uiThemeExpansionTokenthis.templateEngineManager/** A contract that requires each concrete UI Tag to specify which template should be used as a default.  For ... */String templateString templateDirgetTemplateDir(...)String themegetTheme(...)new Template(...)TemplateEngine enginegetTemplateEngine(...)TemplateRenderingContext contextnew TemplateRenderingContext(...)renderTemplate(...)this.templateDirthis.themethis.labelevaluateNameValue(...)populateComponentHtmlId(...)List<String> tagsMap<> tooltipConfigMapgetTooltipConfig(...)String jsTooltipEnabledString tooltipIconString tooltipDelayParamMap<> overallTooltipConfigMapthis.javascriptTooltipthis.tooltipIconPaththis.tooltipDelayBoolean jsTooltipsthis.tooltipCssClass/** Ensures an unescaped attribute value cannot be vulnerable to XSS attacks ... */Object tooltipConfigObjMap<String,String> tooltipConfigString tooltipConfigStrString[] tooltipConfigArrayString aTooltipConfigArrayString[] configEntryconfigEntry.lengthcomponent.javascriptTooltipcomponent.tooltipIconPathcomponent.tooltipDelay/** Create HTML id element for the component and populate this component parameter ... */String tryIdString generatedId/** Get's the id for referencing element. ... */this.templatethis.cssClassthis.cssStylethis.cssErrorClassthis.cssErrorStylethis.disabledthis.labelSeparatorthis.labelPositionthis.requiredPositionthis.errorPositionthis.requiredLabelthis.tabindexthis.onclickthis.ondblclickthis.onmousedownthis.onmouseupthis.onmouseoverthis.onmousemovethis.onmouseoutthis.onfocusthis.onblurthis.onkeypressthis.onkeydownthis.onkeyupthis.onselectthis.accesskeythis.tooltipthis.tooltipConfigisValidTagAttribute(...)copyParams(...)UIBean.class// If templateDir is not explicitly given,// try to find attribute which states the dir set to use// Default template set// Defaults to 'template'// If theme set is not explicitly given,// try to find attribute which states the theme set to use// Default theme set// lookup the label from a TextProvider (default value is the key)// label found via a TextProvider// see if the value was specified as a parameter already// create HTML id element// list should have been created by the form component// tooltip & tooltipConfig// inform the containing form that we need tooltip javascript included// tooltipConfig defined in component itself will take precedence// over those defined in the containing form// override parent form's tooltip config//TODO: this is to keep backward compatibility, remove once when tooltipConfig is dropped//TODO use a Boolean model when tooltipConfig is dropped// escape any possible values that can make the ID painful to work with in JavaScript// we get this if its configured using// 1] UI component's tooltipConfig attribute  OR// 2] <param name="tooltip" value="" /> param tag value attribute// <param name="tooltipConfig"> ... </param> tag's body//fix for https://issues.apache.org/jira/browse/WW-4299//do not assign value to id if tryId is null/** supports dynamic attributes for freemarker ui tags ... */String allowMoveUp, ...;String allowMoveDown, ...;String moveUpLabel, ...;String moveDownLabel, ...;Form ancestorFormthis.allowMoveUpthis.allowMoveDownthis.moveUpLabelthis.moveDownLabelUpDownSelect.class// override Select's default// inform our form ancestor about this UpDownSelect so the form knows how to// auto select all options upon it submission// inform form ancestor that we are using a custom onSubmit// map with key -> id ,  value -> headerKey/** Implemntations of this interface can be used to build a URL *//** The includeParams attribute may have the value 'none', 'get' or 'all'. ... */String GET, ...;String ALL, ...;/** Implementations of this interface are responsible for rendering/creating URLs for a specific ... *//** Preprocessing step ... *//** Render a URL. ... *//** Render a Form URL. ... *//** Base class for template engines. */String DEFAULT_THEME_PROPERTIES_FILE_NAME, ...;/** The default theme properties file name. Default is 'theme.properties' */Map<String,Properties> themeProps, ...;readNewProperties(...)buildPropertyFilename(...)tryToLoadPropertiesFromStream(...)tryReadingPropertyFileFromFileSystem(...)readPropertyFromClasspath(...)readPropertyUsingServletContext(...)ServletContext servletContext/** if its not in filesystem. let's try the classpath */tryCloseStream(...)IOException iogetThemePropertiesFileName(...)getDir(...)/** WW-1292 let's try getting it from the filesystem */File propFilecreateFileInputStream(...)FileNotFoundException egetAbsolutePath(...)String tgetSuffix(...)new ConcurrentHashMap<String,Properties>(...)BaseTemplateEngine.classimport SimpleHash/** Freemarker based template engine. */Class<> bodyContent, ...;FreemarkerManager freemarkerManager, ...;this.freemarkerManagerServletActionContext.SERVLET_CONTEXTHttpServletRequest reqServletActionContext.HTTP_REQUESTHttpServletResponse resServletActionContext.HTTP_RESPONSEList<Template> templatesgetPossibleTemplates(...)getTemplate(...)Template templateString templateNameSimpleHash modelbuildTemplateModel(...)getObjectWrapper(...)Writer writergetWriter(...)Writer wrappedTemplate tgetFinalTemplateName(...)getTemplateLoader(...)getTag(...)getThemeProps(...)new Writer(...) { ... }FreemarkerTemplateEngine.class// this is OK -- this just means JSP isn't even being used here, which is perfectly fine.// we need this class in environments that use JSP to know when to wrap the writer// and ignore flush() calls. In JSP, it is illegal for a BodyContent writer to be flushed(),// so we have to take caution here.// get the various items required from the stack// prepare freemarker// get the list of templates we can use// find the right template// try to load, and if it works, stop at the first one// template was found but was invalid - always report this.// FileNotFoundException is anticipated - report the first IOException if no template found// the BodyContent JSP writer doesn't like it when FM flushes automatically --// so let's just not do it (it will be flushed eventually anyway)// nothing!import Includeimport UIBean/** JSP based template engine. */UIBean tagboolean successgetOut(...)getResponse(...)JspTemplateEngine.classString dir, ...;this.dirList<Template> listnew ArrayList<Template>(...)String parentThemetemplate.themeCloneNotSupportedException e/** Constructs a string in the format <code>/dir/theme/name</code>. ... */template.dirtemplate.name// do nothing/** Any template language which wants to support UI tag templating needs to provide an implementation of this interface ... *//** Renders the template ... *//** Get's the properties for the given template. ... *//** The TemplateEngineManager will return a template engine for the template */String DEFAULT_TEMPLATE_TYPE, ...;/** The default template extension is <code>ftl</code>. */Map<String,EngineFactory> templateEngines, ...;String defaultTemplateType, ...;StrutsConstants.DEFAULT_TEMPLATE_TYPE_CONFIG_KEYthis.defaultTemplateTypeMap<String,EngineFactory> mapnew HashMap<String,EngineFactory>(...)Set<String> prefixesTemplateEngine.classString prefixnew LazyEngineFactory(...)this.templateEnginesnew EngineFactory(...) { ... }String templateType/** Abstracts loading of the template engine *//** Allows the template engine to be loaded at request time, so that engines that are missing ... *//** Context used when rendering templates. */Template template, ...;UIBean tag, ...;Writer writer, ...;/** Constructor ... */this.writerthis.tagimport VelocityManagerimport VelocityEngine/** Velocity based template engine. */VelocityManager velocityManager, ...;this.velocityManagerMap<> actionContextVelocityEngine velocityEnginegetVelocityEngine(...)Context contextcreateContext(...)Writer outputWriterVelocityTemplateEngine.class// prepare velocityimport BeanSelectionProvider/** TODO lukaszlenart: write a JavaDoc */String DEFAULT_BEAN_NAME, ...;String foundNamenew ObjectFactoryDelegateFactory(...)ObjectFactory objFactoryAbstractBeanSelectionProvider.class// NO-OP// Perhaps a spring bean id, so we'll delegate to the object factory at runtime// Probably an optional bean, will ignoreimport UrlRendererimport DispatcherErrorHandlerimport StaticContentLoaderimport MultiPartRequestimport ContentTypeMatcher/** Selects the implementations of key framework extension points, using the loaded ... */StrutsConstants.STRUTS_OBJECTFACTORYStrutsConstants.STRUTS_OBJECTFACTORY_ACTIONFACTORYStrutsConstants.STRUTS_OBJECTFACTORY_RESULTFACTORYStrutsConstants.STRUTS_OBJECTFACTORY_CONVERTERFACTORYStrutsConstants.STRUTS_OBJECTFACTORY_INTERCEPTORFACTORYStrutsConstants.STRUTS_OBJECTFACTORY_VALIDATORFACTORYStrutsConstants.STRUTS_OBJECTFACTORY_UNKNOWNHANDLERFACTORYStrutsConstants.STRUTS_FILE_MANAGER_FACTORYStrutsConstants.STRUTS_XWORKCONVERTERStrutsConstants.STRUTS_CONVERTER_COLLECTIONStrutsConstants.STRUTS_CONVERTER_ARRAYStrutsConstants.STRUTS_CONVERTER_DATEStrutsConstants.STRUTS_CONVERTER_NUMBERStrutsConstants.STRUTS_CONVERTER_STRINGStrutsConstants.STRUTS_CONVERTER_PROPERTIES_PROCESSORStrutsConstants.STRUTS_CONVERTER_FILE_PROCESSORStrutsConstants.STRUTS_CONVERTER_ANNOTATION_PROCESSORStrutsConstants.STRUTS_CONVERTER_CREATORStrutsConstants.STRUTS_CONVERTER_HOLDERStrutsConstants.STRUTS_XWORKTEXTPROVIDERStrutsConstants.STRUTS_TEXT_PROVIDER_FACTORYStrutsConstants.STRUTS_LOCALE_PROVIDER_FACTORYStrutsConstants.STRUTS_LOCALIZED_TEXT_PROVIDERStrutsConstants.STRUTS_ACTIONPROXYFACTORYStrutsConstants.STRUTS_OBJECTTYPEDETERMINERActionMapper.classStrutsConstants.STRUTS_MAPPER_CLASSMultiPartRequest.classStrutsConstants.STRUTS_MULTIPART_PARSERFreemarkerManager.classStrutsConstants.STRUTS_FREEMARKER_MANAGER_CLASSNAMEVelocityManager.classStrutsConstants.STRUTS_VELOCITY_MANAGER_CLASSNAMEUrlRenderer.classStrutsConstants.STRUTS_URL_RENDERERStrutsConstants.STRUTS_ACTIONVALIDATORMANAGERStrutsConstants.STRUTS_VALUESTACKFACTORYStrutsConstants.STRUTS_REFLECTIONPROVIDERStrutsConstants.STRUTS_REFLECTIONCONTEXTFACTORYStrutsConstants.STRUTS_PATTERNMATCHERContentTypeMatcher<>.classStrutsConstants.STRUTS_CONTENT_TYPE_MATCHERStaticContentLoader.classStrutsConstants.STRUTS_STATIC_CONTENT_LOADERStrutsConstants.STRUTS_UNKNOWN_HANDLER_MANAGERUrlHelper.classStrutsConstants.STRUTS_URL_HELPERStrutsConstants.STRUTS_EXPRESSION_PARSERDispatcherErrorHandler.classStrutsConstants.STRUTS_DISPATCHER_ERROR_HANDLERStrutsConstants.STRUTS_EXCLUDED_PATTERNS_CHECKERStrutsConstants.STRUTS_ACCEPTED_PATTERNS_CHECKERswitchDevMode(...)convertIfExist(...)StrutsConstants.STRUTS_LOG_MISSING_PROPERTIESStrutsConstants.STRUTS_ENABLE_OGNL_EXPRESSION_CACHEStrutsConstants.STRUTS_ENABLE_OGNL_EVAL_EXPRESSIONStrutsConstants.STRUTS_ALLOW_STATIC_METHOD_ACCESSStrutsConstants.STRUTS_EXCLUDED_CLASSESStrutsConstants.STRUTS_EXCLUDED_PACKAGE_NAME_PATTERNSStrutsConstants.STRUTS_EXCLUDED_PACKAGE_NAMESStrutsConstants.STRUTS_ADDITIONAL_EXCLUDED_PATTERNSStrutsConstants.STRUTS_ADDITIONAL_ACCEPTED_PATTERNSStrutsConstants.STRUTS_OVERRIDE_EXCLUDED_PATTERNSStrutsConstants.STRUTS_OVERRIDE_ACCEPTED_PATTERNS/** Enables/disables devMode and related settings if they aren't explicit set in struts.xml/struts.properties ... */StrutsConstants.STRUTS_FREEMARKER_TEMPLATES_CACHE_UPDATE_DELAYDefaultBeanSelectionProvider.class/** Checker is used mostly in interceptors, so there be one instance of checker per interceptor with Scope.PROTOTYPE * */// Convert Struts properties into XWork properties// Convert struts properties into ones that xwork expects/** Loads the default properties, separate from the usual struts.properties loading */PropertiesSettings defaultSettingsnew PropertiesSettings(...)loadSettings(...)/** DefaultSettings implements optional methods of Settings. ... */Settings delegate, ...;/** The Settings object that handles API calls. *//** Constructs an instance by loading the standard property files, ... */ArrayList<Settings> listnew ArrayList<Settings>(...)String filesStrutsConstants.STRUTS_CUSTOM_PROPERTIESnew DelegatingSettings(...)StringTokenizer customPropertiesDefaultSettings.class// stuts.properties, default.properties// struts.custom.properties/** DelegatingSettings stores an internal list of {@link Settings} objects ... */List<Settings> delegates, ...;/** The Settings objects. *//** Creates a new DelegatingSettings object utilizing the list of {@link Settings} objects. ... */this.delegatesSettings delegateboolean workedAtAllSet<Object> settingListnew HashSet<Object>(...)Iterator<> listUnsupportedOperationException ex// Try next delegate/** Null result to get around annotation defaults that can't be null */DefaultSettings settingsnew DefaultSettings(...)import LocationImpl/** A class to handle settings via a properties file. */LocatableProperties settings, ...;/** Creates a new properties config given the name of a properties file. The name is expected to NOT have ... */URL settingsUrl/** Gets a property from the properties file. ... *//** Gets the location of a property from the properties file. ... *//** Lists all keys in the properties file. ... */PropertiesSettings.class// Load settings/** Settings retrieves and exposes default values used by the framework. *//** Retrieve value for provided name ... *//** Returns {@link com.opensymphony.xwork2.util.location.Location} of given setting ... *//** Returns {@link java.util.Iterator} with all values ... *//** Override Xwork class so we can use an arbitrary config file */File baseDir, ...;String filename, ...;String reloadKey, ...;/** Constructs the configuration provider ... */getDtdMappings(...)this.filenamethis.baseDirServletContext.classnew Factory<ServletContext>(...) { ... }/** Look for the configuration file on the classpath and in the file system ... */findInFileSystem(...)/** Overrides needs reload to ensure it is only checked once per request */StrutsXmlConfigurationProvider.class// Trying relative path to original fileimport DefaultTypeConverterimport UploadedFileUploadedFile.classUploadedFile fileUploadedFileConverter.class/** A simple implementation of the {@link java.util.Map} interface to handle a collection of attributes and ... */ServletContext context, ...;Set<Object> entries, ...;/** Creates a new map object given the servlet context. ... *//** Removes all entries from the Map and removes all attributes from the servlet context. */Enumeration<> egetAttributeNames(...)/** Creates a Set of all servlet context attributes as well as context init parameters. ... */Enumeration<> enumerationnew Map<>.Entry<>(...) { ... }getInitParameterNames(...)getInitParameter(...)/** Returns the servlet context attribute or init parameter based on the given key. If the ... */String keyString/** Sets a servlet context attribute given a attribute name and value. ... */Object oldValue/** Removes the specified servlet context attribute. ... */// Add servlet context attributes// Add servlet context init params// Try context attributes first, then init params// This gives the proper shadowing effects/** Simple class to hold Container instance per thread to minimise number of attempts ... */ThreadLocal<Container> instance, ...;ContainerHolder.instancenew ThreadLocal<Container>(...)/** A simple action support class that sets properties to be able to serve */String successResultValue, ...;/** Constructor */HttpServletRequest requestString requestedUrlthis.successResultValue/** Default implementation of {@link org.apache.struts2.dispatcher.DispatcherErrorHandler} ... */Boolean devModeOverridegetDevModeOverride(...)handleErrorInDevMode(...)sendErrorResponse(...)HttpServletResponse.SC_INTERNAL_SERVER_ERRORsendError(...)IOException e1List<Throwable> chainnew ArrayList<Throwable>(...)Throwable curcreateReportData(...)setContentType(...)Exception expHashMap<String,Object> datanew Locator(...)Dispatcher.LocatorDefaultDispatcherErrorHandler.class// WW-1977: Only put errors in the request when code is a 500 error// WW-4103: Only logs error when application error occurred, not Struts error// send a http error response to use the servlet defined error handler// make the exception available to the web.xml defined error page// for compatibility// send the error response// we're already sending an error, not much else we can do if more stuff breaksimport OutputStreamimport UnsupportedEncodingExceptionList<String> pathPrefixes, ...;/** Store set of path prefixes to use with static resources. */boolean serveStatic, ...;/** Store state of StrutsConstants.STRUTS_SERVE_STATIC_CONTENT setting. */boolean serveStaticBrowserCache, ...;/** Store state of StrutsConstants.STRUTS_SERVE_STATIC_BROWSER_CACHE setting. */Calendar lastModifiedCal, ...;/** Provide a formatted date for setting heading information when caching static content. *//** Store state of StrutsConstants.STRUTS_I18N_ENCODING setting. */StrutsConstants.STRUTS_SERVE_STATIC_CONTENT/** Modify state of StrutsConstants.STRUTS_SERVE_STATIC_CONTENT setting. ... */this.serveStaticStrutsConstants.STRUTS_SERVE_STATIC_BROWSER_CACHE/** Modify state of StrutsConstants.STRUTS_SERVE_STATIC_BROWSER_CACHE ... */this.serveStaticBrowserCache/** Modify state of StrutsConstants.STRUTS_I18N_ENCODING setting. ... */String packagesgetAdditionalPackages(...)this.pathPrefixesList<String> packages/** Create a string array from a comma-delimited list of packages. ... */List<String> pathPrefixesStringTokenizer stString pathPrefixcleanupPath(...)URL resourceUrlbuildPath(...)String pathEndingHttpServletResponse.SC_NOT_FOUNDlong ifModifiedSincelong lastModifiedMillisgetTimeInMillis(...)long nowlong expiresString contentTypegetContentType(...)getDateHeader(...)getHeader(...)Calendar.DAY_OF_MONTHsetDateHeader(...)setStatus(...)HttpServletResponse.SC_NOT_MODIFIEDsetHeader(...)/** Look for a static resource in the classpath. ... *//** Determine the content type for the resource name. ... *//** Copy bytes from the input stream to the output stream. ... */DefaultStaticContentLoader.class//check that the resource path is under the pathPrefix path// just ignore it//not inside the try block, as this could throw IOExceptions also// check for if-modified-since, prior to any other headers// not modified, content is not sent - only basic// headers and status SC_NOT_MODIFIED// set the content-type header// set heading information for caching static content// NOT using the code provided activation.jar to avoid adding yet another dependency// this is generally OK, since these are the main files we server up//path will start with "/struts" or "/static", remove themimport DefaultBeanSelectionProviderimport DefaultPropertiesProviderimport PropertiesConfigurationProviderimport StrutsXmlConfigurationProviderimport MultiPartRequestWrapperimport AttributeMapimport ObjectFactoryDestroyableimport JBossFileManager/** A utility class the actual dispatcher delegates most of its tasks to. Each instance ... */String REQUEST_POST_METHOD, ...;/** {@link HttpServletRequest#getMethod()} */String MULTIPART_FORM_DATA_REGEX, ...;ThreadLocal<Dispatcher> instance, ...;/** Provide a thread local instance. */List<DispatcherListener> dispatcherListeners, ...;/** Store list of DispatcherListeners. *//** Store state of StrutsConstants.STRUTS_DEVMODE setting. */boolean disableRequestAttributeValueStackLookup, ...;/** Store state of StrutsConstants.DISABLE_REQUEST_ATTRIBUTE_VALUE_STACK_LOOKUP setting. */String defaultLocale, ...;/** Store state of StrutsConstants.STRUTS_LOCALE setting. */String multipartSaveDir, ...;/** Store state of StrutsConstants.STRUTS_MULTIPART_SAVEDIR setting. */String multipartHandlerName, ...;/** Stores the value of {@link StrutsConstants#STRUTS_MULTIPART_PARSER} setting */boolean multipartSupportEnabled, ...;/** Stores the value of {@link StrutsConstants#STRUTS_MULTIPART_ENABLED} */Pattern multipartValidationPattern, ...;/** A regular expression used to validate if request is a multipart/form-data request */String DEFAULT_CONFIGURATION_PATHS, ...;/** Provide list of default configuration files. */boolean paramsWorkaroundEnabled, ...;boolean handleException, ...;/** Indicates if Dispatcher should handle exception and call sendError() ... */DispatcherErrorHandler errorHandler, ...;/** Interface used to handle internal errors or missing resources *//** Store ConfigurationManager instance, set on init. *//** Provide the dispatcher instance for the current thread. ... *//** Store the dispatcher instance for this thread. ... */Dispatcher.instance/** Add a dispatcher lifecycle listener. ... *//** Remove a specific dispatcher lifecycle listener. ... *//** Keeps current reference to external world and must be protected to support class inheritance */Map<String,String> initParams, ...;/** Create the Dispatcher instance for a given ServletContext and set of initialization parameters. ... */this.initParams/** Modify state of StrutsConstants.STRUTS_DEVMODE setting. ... */StrutsConstants.STRUTS_DISABLE_REQUEST_ATTRIBUTE_VALUE_STACK_LOOKUP/** Modify state of StrutsConstants.DISABLE_REQUEST_ATTRIBUTE_VALUE_STACK_LOOKUP setting. ... */this.disableRequestAttributeValueStackLookupStrutsConstants.STRUTS_LOCALE/** Modify state of StrutsConstants.STRUTS_LOCALE setting. ... */StrutsConstants.STRUTS_MULTIPART_SAVEDIR/** Modify state of StrutsConstants.STRUTS_MULTIPART_SAVEDIR setting. ... */StrutsConstants.STRUTS_MULTIPART_ENABLEDthis.multipartSupportEnabledStrutsConstants.STRUTS_MULTIPART_VALIDATION_REGEXthis.multipartValidationPatternStrutsConstants.STRUTS_HANDLE_EXCEPTIONthis.handleExceptionthis.errorHandler/** Releases all instances bound to this dispatcher instance. */Set<Interceptor> interceptorsnew HashSet<Interceptor>(...)Collection<PackageConfig> packageConfigsgetPackageConfigs(...)DispatcherListener ldispatcherDestroyed(...)Object configStrutsConstants.STRUTS_FILE_MANAGERString fileManagerClassNameClass<FileManager> fileManagerClassnew FileManagerProvider(...)JBossFileManager.classString fileManagerFactoryClassNameClass<FileManagerFactory> fileManagerFactoryClassnew FileManagerFactoryProvider(...)new DefaultPropertiesProvider(...)new PropertiesConfigurationProvider(...)String configPathsString[] filescreateStrutsXmlConfigurationProvider(...)new StrutsXmlConfigurationProvider(...)String configProvsString[] classesString cnameinitWithContext(...)new ConfigurationProvider(...) { ... }new DefaultBeanSelectionProvider(...)getServerInfo(...)StrutsConstants.STRUTS_DISPATCHER_PARAMETERSWORKAROUND/** Load configurations, including both XML and zero-configuration strategies, ... */createConfigurationManager(...)init_PreloadConfiguration(...)init_FileManager(...)init_DefaultProperties(...)init_TraditionalXmlConfigurations(...)init_LegacyStrutsProperties(...)init_CustomConfigurationProviders(...)init_FilterInitParameters(...)init_AliasStandardObjects(...)init_CheckWebLogicWorkaround(...)dispatcherInitialized(...)boolean nullStacklogConfigurationException(...)/** Performs logging of missing action/result configuration exception ... *//** Create a context map containing all the wrapped request objects ... */Map<> requestMapnew SessionMap<>(...)new ApplicationMap(...)ServletActionContext.ACTION_MAPPING/** Merge all application and servlet attributes into a single <tt>HashMap</tt> to represent the entire ... */AttributeMap attrMapnew AttributeMap(...)ActionContext.APPLICATIONStrutsStatics.HTTP_REQUESTStrutsStatics.HTTP_RESPONSEStrutsStatics.SERVLET_CONTEXT/** Return the path to save uploaded files to (this is configurable). ... */String saveDirFile tempdirsetMultipartSaveDir(...)File multipartSaveDirmkdirs(...)String logMessagegetCanonicalPath(...)/** Prepare a request, including setting the encoding and locale. ... */String encodingapplyEncoding(...)getParameter(...)setCharacterEncoding(...)isMultipartSupportEnabled(...)isMultipartRequest(...)MultiPartRequest multiPartRequestgetMultiPartRequest(...)new MultiPartRequestWrapper(...)getSaveDir(...)new StrutsRequestWrapper(...)/** Checks if support to parse multipart requests is enabled ... *//** Checks if request is a multipart request (a file upload request) ... */String httpMethodLocale.ENGLISH/** On each request it must return a new instance as implementation could be not thread safe ... */MultiPartRequest mprSet<String> multiNamesString multiName/** Removes all the files created by MultiPartRequestWrapper. ... */MultiPartRequestWrapper multiWrapper/** Send an HTTP error response code. ... */handleError(...)/** Cleanup any resources used to initialise Dispatcher *//** Provide an accessor class for static XWork utility. *//** Expose the ConfigurationManager instance. ... *//** Expose the dependency injection container. ... */ConfigurationManager mgrgetConfigurationManager(...)store(...)Dispatcher.classnew ThreadLocal<Dispatcher>(...)new CopyOnWriteArrayList<DispatcherListener>(...)// clean up ObjectFactory// catch any exception that may occurred during destroy() and log it// clean up Dispatcher itself for this thread// clean up DispatcherListeners// clean up all interceptors by calling their destroy() method// Clear container holder when application is unloaded / server shutdown//cleanup action context// clean up configuration// add any other Struts 2 provided implementations of FileManager// test whether param-access workaround needs to be enabled// [1]// [2]// [3]// [5]// [6]// [7]// If there was a previous value stack, then create a new copy and pass it in to be used by the new Action// if the ActionMapping says to go straight to a result, do it!// If there was a previous value stack then set it back onto the request// WW-2874 Only log error if in devMode// request map wrapping the http request objects// parameters map wrapping the http parameters.  ActionMapping parameters are now handled and applied separately// session map wrapping the http session// application map wrapping the ServletContext// helpers to get access to request/session/application scope// check for Ajax request to use UTF-8 encoding strictly http://www.w3.org/TR/XMLHttpRequest/#the-send-method// simply read any parameter (existing or not) to "prime" the request// if the encoding is already correctly set and the parameters have been already read// do not try to set encoding because it is useless and will cause an error// don't wrap more than once//check for alternate implementations of MultiPartRequest/** Implementation of this interface is used to handle internal errors or missing resources. ... *//** Init instance after creating {@link org.apache.struts2.dispatcher.Dispatcher} ... *//** Handle passed error code or exception ... *//** A interface to tag those that want to execute code on the init and ... *//** Called when the dispatcher is initialized ... *//** Called when the dispatcher is destroyed ... *//** Contains execution operations for filters */Dispatcher dispatcher, ...;this.dispatcher/** Tries to execute a request for a static resource ... */StaticContentLoader staticResourceLoadercanHandle(...)findStaticResource(...)/** Executes an action ... */serviceAction(...)/* $Id: DefaultActionSupport.java 651946 2008-04-27 13:41:38Z apetrelli $ ... */// there is no action in this request, should we look for a static resource?// The framework did its job here// this is a normal request, let it pass through/** Abstraction for host configuration information such as init params or the servlet context. */import ParameterAwareMap<String,Parameter> parameters, ...;new HashSet<String>(...) { ... }/** Access to this method will be restricted with the next versiob ... */Map<String,String[]> resultgetMultipleValues(...)toMap(...)containsValue(...)new Empty(...)Parameter.Emptynew IllegalAccessError(...)Map<String,Object> requestParameterMap, ...;HttpParameters parent, ...;this.requestParameterMapnew TreeMap<String,Object>(...)Map<String,Parameter> parametersnew HashMap<String,Parameter>(...)parent.parametersnew Request(...)Parameter.Requestnew HttpParameters(...)/** Contains initialization operations *//** Initializes the internal Struts logging ... */String factoryNameLoggerFactory facsetLoggerFactory(...)System.err/** Creates and initializes the dispatcher ... */Dispatcher dispatchercreateDispatcher(...)/** Initializes the static content loader with the filter configuration ... */StaticContentLoader loadersetHostConfig(...)/** Create a {@link Dispatcher} ... */Iterator<> enew Dispatcher(...)/** Extract a list of patterns to exclude from request filtering ... */buildExcludedPatternsList(...)StrutsConstants.STRUTS_ACTION_EXCLUDE_PATTERNList<Pattern> listnew ArrayList<Pattern>(...)String[] tokensString textKey, ...;this.textKeyint primeLocalizedMessage otherother.argsother.clazzother.defaultMessageother.textKeyConfigurationManager copyConfigurationManager, ...;this.copyConfigurationManagerthis.configurationManagerString[] valuestoStringArray(...)String[] strValuestoStringArray(...).lengthRequest.class/** Contains preparation operations for a request before execution */ThreadLocal<Boolean> devModeOverride, ...;/** Maintains per-request override of devMode configuration. */String STRUTS_ACTION_MAPPING_KEY, ...;String CLEANUP_RECURSION_COUNTER, ...;/** Creates the action context and initializes the thread local ... */Integer counterInteger oldCounter/** Cleans up a request of thread locals ... */Integer counterVal...-=...cleanUpRequest(...)setInstance(...)/** Assigns the dispatcher to the dispatcher thread local *//** Sets the request encoding and locale on the response ... *//** Wraps the request with the Struts wrapper that handles multipart requests better ... */wrapRequest(...)setRequest(...)/** Finds and optionally creates an {@link ActionMapping}.  It first looks in the current request to see if one ... */findActionMapping(...)/** Finds and optionally creates an {@link ActionMapping}.  if forceLookup is false, it first looks in the current request to see if one ... */isHandleException(...)isDevMode(...)/** Cleans up the dispatcher instance */cleanup(...)/** Check whether the request matches a list of exclude patterns. ... */getUri(...)/** Set an override of the static devMode value.  Do not set this via a ... */PrepareOperations.classnew InheritableThreadLocal<Boolean>(...)// detected existing context, so we are probably in a forward// always clean up the thread request, even if an action hasn't been executed// Wrap request first, just in case it is multipart/form-data// parameters might not be accessible through before encoding (ww-1278)import AbstractMap/** A simple implementation of the {@link java.util.Map} interface to handle a collection of request attributes. *//** Saves the request to use as the backing for getting and setting values ... *//** Removes all attributes from the request as well as clears entries in this map. */Enumeration<> keys/** Returns a Set of attributes from the http request. ... */new Entry<>(...) { ... }/** Returns the request attribute associated with the given key or <tt>null</tt> if it doesn't exist. ... *//** Saves an attribute in the request. ... *//** Removes the specified request attribute. ... *//** A simple implementation of the {@link java.util.Map} interface to handle a collection of HTTP session ... */HttpSession session, ...;Set<Entry<K,V>> entries, ...;/** Creates a new session map given a http servlet request. Note, ths enumeration of request ... *//** Invalidate the http session. */invalidate(...)/** Removes all attributes from the session as well as clears entries in this ... */Enumeration<String> attributeNamesEnum/** Returns a Set of attributes from the http session. ... */Enumeration<?> enumerationnew Map<>.Entry<K,V>(...) { ... }Entry<K,V> entry/** Returns the session attribute associated with the given key or <tt>null</tt> if it doesn't exist. ... *//** Saves an attribute in the session. ... */V oldValue/** Removes the specified session attribute. ... *//** Checks if the specified session attribute with the given key exists. ... */// note, holding on to this request and relying on lazy session initalization will not work// if you are running your action invocation in a background task, such as using the// "execAndWait" interceptor/** Interface for loading static resources, based on a path. After implementing your own static content loader ... *//** Locate a static resource and copy directly to the response, setting the ... */import HttpServletRequestWrapperimport static BooleanUtils.isTrueString REQUEST_WRAPPER_GET_ATTRIBUTE, ...;/** The constructor ... *//** Gets the object, looking in the value stack if not found ... */Object attributeboolean alreadyInisTrue(...)// don't bother with the standard javax.servlet attributes, we can short-circuit this// see WW-953 and the forums post linked in that issue for more info// note: we don't let # come through or else a request for// #attr.foo or #request.foo could cause an endless loop// If not found, then try the ValueStackimport FilterConfigimport HostConfig/** Host configuration that wraps FilterConfig */FilterConfig config, ...;import ExecuteOperationsimport InitOperationsimport PrepareOperationsimport javax.servlet.*/** Executes the discovered request information.  This filter requires the {@link StrutsPrepareFilter} to have already ... */PrepareOperations prepare, ...;ExecuteOperations execute, ...;FilterConfig filterConfig, ...;this.filterConfigInitOperations initnew InitOperations(...)findDispatcherOnThread(...)initStaticContentLoader(...)new FilterHostConfig(...)new PrepareOperations(...)new ExecuteOperations(...)HttpServletResponse responseInteger recursionCounterPrepareOperations.CLEANUP_RECURSION_COUNTERexcludeUrl(...)doFilter(...)lazyInit(...)boolean handledexecuteStaticResourceRequest(...)StrutsPrepareFilter.REQUEST_EXCLUDED_FROM_ACTION_MAPPING// This is necessary since we need the dispatcher instance, which was created by the prepare filter//if recursion counter is > 1, it means we are in a "forward", in that case a mapping will still be//in the request, if we handle it, it will lead to an infinite loop, see WW-3077import Filterimport FilterChainimport ServletResponse/** Handles both the preparation and execution phases of the Struts dispatching process.  This filter is better to use ... */List<Pattern> excludedPatterns, ...;createInitOperations(...)FilterHostConfig configinitLogging(...)initDispatcher(...)createPrepareOperations(...)createExecuteOperations(...)postInit(...)cleanUpAfterInit(...)/** Creates a new instance of {@link InitOperations} to be used during ... *//** Creates a new instance of {@link PrepareOperations} to be used during ... *//** Creates a new instance of {@link ExecuteOperations} to be used during ... *//** Callback for post initialization ... */isUrlExcluded(...)setEncodingAndLocale(...)createActionContext(...)assignDispatcherToThread(...)cleanupRequest(...)cleanupDispatcher(...)StrutsPrepareAndExecuteFilter.class/** Prepares the request for execution by a later {@link org.apache.struts2.dispatcher.filter.StrutsExecuteFilter} filter instance. */String REQUEST_EXCLUDED_FROM_ACTION_MAPPING, ...;new Object(...)StrutsPrepareFilter.class/** Host configuration that just holds a ServletContext */import ServletContextEventimport ServletContextListener/** Servlet listener for Struts.  The preferred way to use Struts is as a filter via the ... */ListenerHostConfig confignew ListenerHostConfig(...)StrutsStatics.SERVLET_DISPATCHER/** Expose the ActionMapping for the current request ... *//** Expose the ActionMapping for the specified action name ... *//** Convert an ActionMapping into a URI string ... *//** Simple class that holds the action mapping information used to invoke a ... */String extension, ...;/** Constructs an ActionMapping *//** Constructs an ActionMapping with a default result ... *//** Constructs an ActionMapping with its values ... */this.extensionList<ActionMapper> actionMappers, ...;StrutsConstants.STRUTS_MAPPER_COMPOSITEString[] arrActionMapper actionMapperActionMapping actionMappingnew LinkedList<ActionMapper>(...)CompositeActionMapper.classimport PrefixTrieString METHOD_PREFIX, ...;String ACTION_PREFIX, ...;boolean allowDynamicMethodCalls, ...;boolean allowSlashesInActionNames, ...;boolean alwaysSelectFullNamespace, ...;PrefixTrie prefixTrie, ...;Pattern allowedActionNames, ...;String defaultActionName, ...;Pattern allowedMethodNames, ...;String defaultMethodName, ...;boolean allowActionPrefix, ...;boolean allowActionCrossNamespaceAccess, ...;List<String> extensions, ...;new PrefixTrie(...) { ... }new ParameterAction(...) { ... }cleanupMethodName(...)cleanupActionName(...)int bang/** Adds a parameter action.  Should only be called during initialization ... */this.allowDynamicMethodCallsStrutsConstants.STRUTS_ENABLE_SLASHES_IN_ACTION_NAMESthis.allowSlashesInActionNamesStrutsConstants.STRUTS_ALWAYS_SELECT_FULL_NAMESPACEthis.alwaysSelectFullNamespaceStrutsConstants.STRUTS_ALLOWED_ACTION_NAMESthis.allowedActionNamesStrutsConstants.STRUTS_DEFAULT_ACTION_NAMEthis.defaultActionNameStrutsConstants.STRUTS_ALLOWED_METHOD_NAMESthis.allowedMethodNamesStrutsConstants.STRUTS_DEFAULT_METHOD_NAMEthis.defaultMethodNameStrutsConstants.STRUTS_MAPPER_ACTION_PREFIX_ENABLEDthis.allowActionPrefixStrutsConstants.STRUTS_MAPPER_ACTION_PREFIX_CROSSNAMESPACESthis.allowActionCrossNamespaceAccessStrutsConstants.STRUTS_ACTION_EXTENSIONList<String> listthis.extensionsparseActionName(...)int indexOfSemicolondropExtension(...)parseNameAndNamespace(...)handleSpecialParameters(...)int exclamation/** Special parameters, as described in the class-level comment, are searched ... */Set<String> uniqueParametersMap<> parameterMapParameterAction parameterAction/** Parses the name and namespace from the uri ... */int lastSlashboolean rootAvailable/** Checks action name against allowed pattern if not matched returns default action name ... *//** Checks method name (when DMI is enabled) against allowed pattern if not matched returns default action name ... *//** Drops the extension from the action name, storing it in the mapping for later use ... */String extString extensionStringBuilder urihandleNamespace(...)handleName(...)handleDynamicMethod(...)handleExtension(...)handleParams(...)lookupExtension(...)getExtension(...)ActionMapping origgetDefaultExtension(...)String paramsnew ArrayList<String>(...) { ... }DefaultActionMapper.class// handle special parameter prefixes.// Strip off the image button location info, if found// Ensure a parameter doesn't get processed twice// ww-1046, assume it is the root namespace, it will fallback to// default// namespace anyway if not found in root namespace.// Simply select the namespace as everything before the last slash// Try to find the namespace in those defined, defaulting to ""// Find the longest matching namespace, defaulting to the default// Still none found, use root namespace if found// This should also handle cases such as /foo/bar-1.0/description. It is tricky to// distinquish /foo/bar-1.0 but perhaps adding a numeric check in the future could// work// See WW-3965// Append the method as no bang found// Look for the current extension, if available/** Defines a parameter action prefix.  This is executed when the configured prefix key is matched in a parameter ... */Map<String,ActionMapper> actionMappers, ...;StrutsConstants.PREFIX_BASED_MAPPER_CONFIGURATIONString[] mappersString mapperString[] thisMapperthisMapper.lengthString mapperPrefixString mapperNameint lastIndexEntry<String,Object> mappingParameterEntrynew HashMap<String,ActionMapper>(...)PrefixBasedActionMapper.classimport URLDecoderUtil/** Extended version of {@link RestfulActionMapper}, see documentation for more details ... */String HTTP_METHOD_PARAM, ...;String idParameterName, ...;setSlashesInActionNames(...)isSlashesInActionNames(...)int lastSlashPosint actionSlashPosisGet(...)isPost(...)isDelete(...)isPut(...)HashMap<String,String> parametersboolean isNameTokString paramValueStrutsConstants.STRUTS_ID_PARAMETER_NAMEthis.idParameterNameRestful2ActionMapper.class// Only try something if the action name is specified// If a method hasn't been explicitly named, try to guess using ReST-style patterns// Index e.g. foo/// Creating a new entry on POST e.g. foo/// Viewing the form to create a new item e.g. foo/new// Viewing an item e.g. foo/1// Removing an item e.g. foo/1// Updating an item e.g. foo/1    // Try to determine parameters from the url before the action name/** Simple Restfull Action Mapper to support REST application ... */int nextSlashMap<String,Object> parameterscountTokens(...)StringBuilder retValRestfulActionMapper.class// check if we have the first parameter nameimport LocalizedMessage/** Abstract class with some helper methods, it should be used ... */int BUFFER_SIZE, ...;/** Defines the internal buffer size used during streaming operations. */List<LocalizedMessage> errors, ...;/** Internal list of raised errors to be passed to the the Struts2 framework. */long maxSize, ...;/** Specifies the maximum size of the entire request. */boolean maxSizeProvided, ...;int bufferSize, ...;/** Specifies the buffer size to use during streaming. */Locale defaultLocale, ...;/** Localization to be used regarding errors. */StrutsConstants.STRUTS_MULTIPART_BUFFERSIZEthis.bufferSizethis.defaultEncodingStrutsConstants.STRUTS_MULTIPART_MAXSIZEthis.maxSizeProvidedthis.maxSize/** Build error message. ... */String errorKeynew LocalizedMessage(...)int forwardSlashint backwardSlashnew ArrayList<LocalizedMessage>(...)AbstractMultiPartRequest.classimport FileItemimport FileUploadBaseimport FileUploadExceptionimport RequestContextimport DiskFileItemimport DiskFileItemFactoryimport ServletFileUpload/** Multipart form data request adapter for Jakarta Commons Fileupload package. */Map<String,List<FileItem>> files, ...;// maps parameter name -> List of FileItem objectsMap<String,List<String>> params, ...;// maps parameter name -> List of param values/** Creates a new request wrapper to handle multi-part data using methods adapted from Jason Pell's ... */processUpload(...)FileUploadException eLocalizedMessage errorMessageFileUploadBase.SizeLimitExceededExceptionSizeLimitExceededException exbuildErrorMessage(...)getPermittedSize(...)getActualSize(...)isMultipartContent(...)FileItem itemparseRequest(...)isFormField(...)processNormalFormField(...)processFileField(...)List<FileItem> valuesnew ArrayList<FileItem>(...)List<String> valuesDiskFileItemFactory faccreateDiskFileItemFactory(...)ServletFileUpload uploadcreateServletFileUpload(...)createRequestContext(...)new ServletFileUpload(...)setSizeMax(...)new DiskFileItemFactory(...)setSizeThreshold(...)setRepository(...)enumeration(...)List<FileItem> itemsList<String> contentTypesFileItem fileItemList<UploadedFile> fileListnew ArrayList<UploadedFile>(...)File storeLocationgetStoreLocation(...)isInMemory(...)createNewFile(...)new StrutsUploadedFile(...)new UploadedFile[]List<String> fileNamesList<String> v/** Creates a RequestContext needed by Jakarta Commons Upload. ... */new RequestContext(...) { ... }getContentLength(...)new HashMap<String,List<FileItem>>(...)new HashMap<String,List<String>>(...)JakartaMultiPartRequest.class// Skip file uploads that don't have a file name - meaning that no file was selected.// note: see http://jira.opensymphony.com/browse/WW-633// basically, in some cases the charset may be null, so// we're just going to try to "other" method (no idea if this// will work)// Make sure that the data is written to fileimport FileItemIteratorimport FileItemStreamimport FileSizeLimitExceededExceptionimport Streams/** Multi-part form data request adapter for Jakarta Commons FileUpload package that ... */Map<String,List<FileInfo>> fileInfos, ...;/** Map between file fields and file data. */Map<String,List<String>> parameters, ...;/** Map between non-file fields and values. */FileInfo fileInfoList<FileInfo> infosList<String> typesList<UploadedFile> filesList<String> namesgetOriginalName(...)/** Processes the upload. ... */boolean requestSizePermittedisRequestSizePermitted(...)ServletFileUpload servletFileUploadFileItemIterator igetItemIterator(...)FileItemStream itemStreamprocessFileItemStreamAsFormField(...)addFileSkippedError(...)processFileItemStreamAsFileField(...)/** Defines whether the request allowed based on content length. ... */long requestSize/** Add a file skipped message notification for action messages. ... */String exceptionMessageFileSizeLimitExceededException exceptionnew FileSizeLimitExceededException(...)FileUploadBase.FileSizeLimitExceededExceptiongetRequestSize(...)LocalizedMessage message/** Processes the FileItemStream as a Form Field. ... */String fieldValueasString(...)/** Processes the FileItemStream as a file field. ... */createTemporaryFile(...)streamFileToDisk(...)createFileInfoFromItemStream(...)/** Creates a temporary file based on the given filename and location. ... */String suffixcreateTempFile(...)randomUUID(...)/** Streams the file upload stream to the specified file. ... */InputStream inputOutputStream outputnew BufferedOutputStream(...)/** Creates an internal <code>FileInfo</code> structure used to pass information ... */new FileInfo(...)new ArrayList<FileInfo>(...)/** Internal data structure used to store a reference to information needed ... */String originalName, ...;/** Default constructor. ... */this.originalNamenew HashMap<String,List<FileInfo>>(...)JakartaStreamMultiPartRequest.class// Sanity check that the request is a multi-part/form-data request.// Sanity check on request size.// Interface with Commons FileUpload API// Using the Streaming API// Iterate the file items// If the file item stream is a form field, delegate to the// field item stream handler// Delegate the file item stream for a file field to the// file item stream handler, but delegation is skipped// if the requestSizePermitted check failed based on the// complete content-size of the request.// prevent processing file field item if request size not allowed.// also warn user in the logs.// if maxSize is specified as -1, there is no sanity check and it's// safe to return true for any request, delegating the failure// checks later in the upload process.// Create the temporary upload file.// gather attributes from file upload stream.// create internal structure// append or create new entry./** <p>Abstract wrapper class HTTP requests to handle multi-part data. </p> *//** Returns an enumeration of the parameter names for uploaded files ... *//** Returns the content type(s) of the file(s) associated with the specified field name ... *//** Returns a {@link UploadedFile} object for the filename specified or <tt>null</tt> if no files ... *//** Returns a String[] of file names for files associated with the specified input field name ... *//** Returns the file system name(s) of files associated with the given field name or ... *//** Returns the specified request parameter. ... *//** Returns an enumeration of String parameter names. ... *//** Returns a list of all parameter values associated with a parameter name. If there is only ... *//** Returns a list of error messages that may have occurred while processing the request. ... *//** Cleans up all uploaded file, should be called at the end of request */import StrutsRequestWrapperCollection<LocalizedMessage> errors, ...;MultiPartRequest multi, ...;/** Process file downloads and log any errors. ... */LocalizedMessage errorgetErrors(...)addError(...)/** Get an enumeration of the parameter names for uploaded files ... */getFileParameterNames(...)/** Get an array of content encoding for the specified input field name or <tt>null</tt> if ... *//** Get a {@link java.io.File[]} for the given input field name. ... *//** Get a String array of the file names for uploaded files ... */getFileNames(...)/** Get the filename(s) of the file(s) uploaded for the given input field name. ... */getFilesystemName(...)Map<String,String[]> mapgetParameterNames(...)getParameterValues(...)mergeParams(...)/** Returns <tt>true</tt> if any errors occured when parsing the HTTP multipart request, <tt>false</tt> otherwise. ... *//** Returns a collection of any errors generated when parsing the multipart request. ... *//** Adds an error message when it isn't already added. ... *//** Merges 2 enumeration of parameters as one. ... */Vector<> tempnew Vector<>(...)MultiPartRequestWrapper.class/** Virtual representation of a uploaded file used by {@link MultiPartRequest} */import ServletConfig/** Host configuration that wraps a ServletConfig */ServletConfig config, ...;import ServletHostConfigimport HttpServlet/** Servlet dispatcher for Struts.  The preferred way to use Struts is as a filter via the ... */ServletHostConfig confignew ServletHostConfig(...)Map<String,ActionProxyFactory> actionProxyFactories, ...;ActionProxyFactory defaultFactory, ...;this.defaultFactoryString[] factoriesString factoryString[] thisFactorythisFactory.lengthString factoryPrefixActionProxyFactory objActionProxyFactory actionProxyFactorynew HashMap<String,ActionProxyFactory>(...)PrefixBasedActionProxyFactory.classimport DefaultActionProxyActionContext previousString contextPath// Copyright 2006 Google Inc. All Rights Reserved.// This is for the new API://            return RequestContextImpl.callInContext(invocation, new Callable<String>() {//                public String call() throws Exception {//                    return invocation.invoke();//            });StrutsActionProxy proxynew StrutsActionProxy(...)import ParamNameAwareResult/** Default implementation which uses {@link com.opensymphony.xwork2.result.ParamNameAwareResult} to accept or throw away parameters *//** Sets the map of application properties in the implementing class. ... *//** Background thread to be executed by the ExecuteAndWaitInterceptor. */boolean done, ...;/** Constructs a background process ... */Thread tnew Thread(...)new Runnable(...) { ... }beforeInvocation(...)afterInvocation(...)setPriority(...)/** Called before the background thread determines the result code ... *//** Called after the background thread determines the result code ... *//** Retrieves the action. ... *//** Retrieves the action invocation. ... *//** Gets the result of the background process. ... *//** Gets the exception if any was thrown during the execution of the background process. ... *//** Returns the status of the background process. ... *//** Auto-generated serialization id */String uncheckedValue, ...;Map<String,Parameter> extraParamsString checkboxNameisMultiple(...)appendAll(...)/** Overrides the default value for an unchecked checkbox ... */this.uncheckedValueCheckboxInterceptor.class// is this checkbox checked/submitted?// if not, let's be sure to default the value to falseClearSessionInterceptor.classimport CookieString ACCEPTED_PATTERN, ...;Set<String> cookiesNameSet, ...;Set<String> cookiesValueSet, ...;ExcludedPatternsChecker excludedPatternsChecker, ...;AcceptedPatternsChecker acceptedPatternsChecker, ...;this.excludedPatternsCheckerthis.acceptedPatternsCheckerthis.cookiesNameSetthis.cookiesValueSet/** Set the <code>acceptCookieNames</code> pattern of allowed names of cookies ... */Map<String,String> cookiesMapCookie[] cookiesgetCookies(...)Cookie cookieisAcceptableName(...)populateCookieValueIntoStack(...)injectIntoCookiesAwareAction(...)/** Checks if name of Cookie doesn't contain vulnerable code ... *//** Checks if name/value of Cookie is acceptable ... */IsAccepted accepted/** Checks if name/value of Cookie is excluded ... */IsExcluded excluded/** Hook that populate cookie value into value stack (hence the action) ... *//** Hook that set the <code>cookiesMap</code> into action that implements ... */setCookiesMap(...)CookieInterceptor.class// contains selected cookies// inject the cookiesMap, even if we don't have any cookies// If the interceptor is configured to accept any cookie value// OR// no cookiesValue is defined, so as long as the cookie name match// we'll inject it into Struts' action// if cookiesValues is specified, the cookie's value must match before we// inject them into Struts' action/** Action can create cookies which will be stored in response ... *//** Return cookies which should be send to client ... *//** Do what name suggests ... */Set<Cookie> cookiesgetDomain(...)addCookie(...)addCookiesToResponse(...)CookieProviderInterceptor.class/** Actions implementing the CookiesAware interface will receive ... *//** Sets a map of filtered cookies. ... */HttpSession httpSessionsetSession(...)new SessionMap<String,Object>(...)CreateSessionInterceptor.classDateWord S, ...;DateWord s, ...;DateWord m, ...;DateWord H, ...;DateWord d, ...;DateWord M, ...;DateWord y, ...;Integer length, ...;String dateType, ...;DateWord.classnew DateWord(...)Map<String,Map<String,String>> datesnew HashMap<String,Map<String,String>>(...)DateWord[] dateWordsMap<String,Parameter> newParamsSet<Entry<String,Map<String,String>>> dateEntriesDateWord dateWordString dateKeyParameter paramgetDateType(...)Entry<String,Map<String,String>> dateEntrySet<Entry<String,String>> dateFormatEntriesString dateFormatString dateValueEntry<String,String> dateFormatEntrySimpleDateFormat formatterDate valueDateTextFieldInterceptor.class// Get all the values of date type// Create all the date objectsimport FreemarkerResultString KEY, ...;String WAIT, ...;int delay, ...;int delaySleepInterval, ...;boolean executeAfterValidationPass, ...;// default sleep 100 millis before checking if background process is doneint threadPriority, ...;/** Creates a new background process ... */new BackgroundProcess(...)/** Returns the name to associate the background process.  Override to change the way background processes ... */getBackgroundProcessName(...)Boolean secondTimeBackgroundProcess bpgetNewBackgroundProcess(...)performInitialDelay(...)isDone(...)getToken(...)Map<> resultssetSessionToken(...)getTokenName(...)FreemarkerResult waitResultnew FreemarkerResult(...)int stepsint step/** Sets the thread priority of the background process. ... */this.threadPriority/** Sets the initial delay in millis (msec). ... */this.delay/** Sets the sleep interval in millis (msec) when performing the initial delay. ... */this.delaySleepInterval/** Whether to start the background process after the second pass (first being validation) ... */this.executeAfterValidationPassThread.NORM_PRIORITYExecuteAndWaitInterceptor.class//sync on the real HttpSession as the session from the context is a wrap that is created//on every request// first time let some time pass before showing wait page// no wait result? hmm -- let's try to do dynamically put it in for you!//we used to add a fake "wait" result here, since the configuration is unmodifiable, that is no longer//an option, see WW-3068// if an exception occured during action execution, throw it here// this is the first instance of the interceptor and there is no existing action// already run in the background, so let's just let this pass through. We assume// the action invocation will be run in the background on the subsequent pass through// this interceptorLong maximumSize, ...;Set<String> allowedTypesSet, ...;Set<String> allowedExtensionsSet, ...;ContentTypeMatcher<> matcher, ...;this.matcher/** Sets the allowed extensions ... *//** Sets the allowed mimetypes ... *//** Sets the maximum size of an uploaded file ... */this.maximumSizeValidationAware validationEnumeration<> fileParameterNamesgetTextMessage(...)String errorMessagegetTextKey(...)getArgs(...)String inputNameString[] contentTypegetContentTypes(...)isNonEmpty(...)String[] fileNameUploadedFile[] filesgetFiles(...)files.lengthList<UploadedFile> acceptedFilesList<String> acceptedContentTypesList<String> acceptedFileNamesString contentTypeNameString fileNameNameacceptFile(...)Parameter.File/** Override for added functionality. Checks if the proposed file is acceptable based on contentType and size. ... */boolean fileIsAcceptableString errMsggetMaximumSizeStr(...)containsItem(...)hasAllowedExtension(...)String lowercaseFilenamematchesWildcard(...)FileUploadInterceptor.class// bind allowed Files// get the value of this input tag// get the content type// get the name of the file from the input tag// get a File object for the uploaded File// invoke action// If it's null the upload failed/** Sets the HTTP parameters in the implementing class. ... *//** An interceptor that handles setting the locale specified in a session as the locale for the current action request. */String DEFAULT_SESSION_ATTRIBUTE, ...;String DEFAULT_PARAMETER, ...;String DEFAULT_REQUEST_ONLY_PARAMETER, ...;String DEFAULT_COOKIE_ATTRIBUTE, ...;String DEFAULT_COOKIE_PARAMETER, ...;String parameterName, ...;String requestOnlyParameterName, ...;String attributeName, ...;String requestCookieParameterName, ...;// Request-Only = NoneStorage COOKIE, ...;Storage SESSION, ...;Storage NONE, ...;new Storage(...)this.parameterNamethis.attributeNamethis.requestOnlyParameterNamethis.requestCookieParameterNameStorage.NONEStorage.SESSIONLocaleHandler localeHandlergetLocaleHandler(...)shouldStore(...)useLocale(...)/** Override this method to use your own implementation of {@link LocaleHandler} ... */Storage.COOKIEnew CookieLocaleHandler(...)new SessionLocaleHandler(...)new RequestOnlyLocaleHandler(...)/** Creates a Locale object from the request param, which might ... */String localeStrLocale defaultLocaleParameter requestedLocale/** Save the given locale to the ActionInvocation. ... *//** Uses to handle reading/storing Locale from/in different locations */ActionInvocation actionInvocation, ...;boolean shouldStore, ...;findLocaleParameter(...)getLocaleFromParam(...)Locale requestOnlyLocaleMap<String,Object> sessionString sessionIdObject sessionLocaleLocale requestOnlySessionLocalenew Cookie(...)setMaxAge(...)I18nInterceptor.class// no overriding locale definition found, stay with current invocation (=browser) locale//save it in session//[WW-4741] Do not force session creation while this is a read operation// two weeksimport ServletRedirectResultString AUTOMATIC_MODE, ...;String STORE_MODE, ...;String RETRIEVE_MODE, ...;boolean allowRequestParameterSwitch, ...;String requestParameterSwitch, ...;String operationMode, ...;String fieldErrorsSessionKey, ...;String actionErrorsSessionKey, ...;String actionMessagesSessionKey, ...;this.allowRequestParameterSwitchthis.requestParameterSwitchthis.operationModeMessageStorePreResultListener preResultListenercreatePreResultListener(...)new MessageStorePreResultListener(...)/** Handle the retrieving of field errors / action messages / field errors, which is ... */String reqOperationModegetRequestOperationMode(...)Collection<> actionErrorsCollection<> actionMessagesMap<> fieldErrorsCollection<> mergedActionErrorsmergeCollection(...)Collection<> mergedActionMessagesMap<> mergedFieldErrorsmergeMap(...)/** Get the operationMode through request parameter, if <code>allowRequestParameterSwitch</code> ... */HttpParameters reqParams/** Merge <code>col1</code> and <code>col2</code> and return the composite ... */Collection<> _col1Collection<> _col2/** Merge <code>map1</code> and <code>map2</code> and return the composite ... */Map<> _map1Map<> _map2MessageStoreInterceptor.class// retrieve error / message from sessionimport Redirectable/** This listener is used by {@link MessageStoreInterceptor} to store messages in HttpSession ... */MessageStoreInterceptor interceptor, ...;boolean isCommittedisCommitted(...)boolean isInvalidatedisInvalidated(...)boolean isRedirectisRedirect(...)MessageStoreInterceptor.STORE_MODEgetOperationModel(...)MessageStoreInterceptor.AUTOMATIC_MODEMessageStoreInterceptor.actionErrorsSessionKeyMessageStoreInterceptor.actionMessagesSessionKeyMessageStoreInterceptor.fieldErrorsSessionKeyRedirectable.classMessageStorePreResultListener.class/** Just as the CheckboxInterceptor checks that if only the hidden field is present, so too does this interceptor. If ... *//** Just as the CheckboxInterceptor checks that if only the hidden field is present, so too does this interceptor. ... *//* $Id: BackgroundProcess.java 651946 2008-04-27 13:41:38Z apetrelli $ ... */// is this multi-select box submitted?// if not, let's be sure to default the value to an empty string array/** Interceptor that does nothing, used in the "empty" stack */NoOpInterceptor.class/** This marker interface should be implemented by actions that do not want any parameters set on ... *//** Sets the  map of input parameters in the implementing class. ... *//** Actions that want access to the Principal information from HttpServletRequest object ... */import Principal/** Proxy interface used together with PrincipalAware interface. It allows indirect ... *//** True if the user is in the given role ... *//** Gets the user principal ... *//** Gets the user id ... *//** Is the request using https? ... */String profilingKey, ...;this.profilingKeyParameter valString svalboolean enablesetActive(...)/** Sets the Map of request attributes in the implementing class. ... */boolean isProperlyConfigured, ...;List<String> allowedRoles, ...;List<String> disallowedRoles, ...;stringToList(...)checkRoles(...)areRolesValid(...)handleRejection(...)/** Splits a string into a List ... */String[] list/** Determines if the request should be allowed for the action ... */String roleisUserInRole(...)/** Handles a rejection by sending a 403 HTTP error ... */HttpServletResponse.SC_FORBIDDEN/** Extension point for sub-classes to test if configured roles are known valid roles. ... */RolesInterceptor.classimport IdentityHashMap...[] application, ...;...[] session, ...;boolean autoCreateSession, ...;String sessionReset, ...;boolean reset, ...;/** Sets a list of application scoped properties ... *//** Sets a list of session scoped properties ... *//** Sets if the session should be automatically created ... */this.autoCreateSession/** The constructor */// Since 2.0.7. Avoid null references on session serialization (WW-1803).Object NULL, ...;Map<> locks, ...;Object previousnotify(...)wait(...)Map<> sesMap<> appnullConvert(...)boolean ends/** Sets the type of scope operation ... */this.sessionResetafter(...)this.resetScopeInterceptor.classnew NULLClass(...)new IdentityHashMap<>(...)// All instances of this class are equivalent//if( value != null)// Null value should be scoped tooimport ServletPrincipalProxy/** Sets action properties based on the interfaces an action implements. Things like application properties, ... */setServletRequest(...)setServletResponse(...)applyParameters(...)setApplication(...)setPrincipalProxy(...)new ServletPrincipalProxy(...)setServletContext(...)// We are in servtlet environment, so principal information resides in HttpServletRequest/** Sets the HTTP request object in implementing classes. ... *//** Sets the HTTP response object in implementing classes. ... *//** Sets the Map of session attributes in the implementing class. ... */import ConversionErrorInterceptor/** Returns <tt>false</tt> if the value is null, "", or {""} (array of size 1 with a blank element). Returns ... */String[] arrayString INVALID_TOKEN_CODE, ...;String INVALID_TOKEN_MESSAGE_KEY, ...;String DEFAULT_ERROR_MESSAGE, ...;handleToken(...)validToken(...)handleInvalidToken(...)handleValidToken(...)/** Determines what to do if an invalid token is provided. If the action implements {@link ValidationAware} ... *//** Called when a valid token is found. This method invokes the action by can be changed to do something more ... */TokenInterceptor.class//see WW-2902: we need to use the real HttpSession here, as opposed to the map//that wraps the session, because a new wrap is created on every requestimport InvocationSessionStoreString sessionTokenNamebuildTokenSessionAttributeName(...)ActionInvocation savedInvocationloadInvocation(...)ActionContext savedContextsetExecuteResult(...)storeInvocation(...)// set the valuestack to the request scope// turn off execution of this invocations result// we know the token name and token must be there...[] ignorePrefixes, ...;...[] _ignoreKeys, ...;HashSet<String> ignoreKeys, ...;String XML_MODE, ...;String CONSOLE_MODE, ...;String COMMAND_MODE, ...;String BROWSER_MODE, ...;String SESSION_KEY, ...;String DEBUG_PARAM, ...;String OBJECT_PARAM, ...;String EXPRESSION_PARAM, ...;String DECORATE_PARAM, ...;boolean enableXmlWithConsole, ...;boolean consoleEnabled, ...;boolean actionOnlyboolean contboolean devModeprintContext(...)String xmlFreemarkerResult resultnew PrettyPrintWriter(...)setFreemarkerManager(...)setParse(...)String cmdString rootObjectExpressionString decorateObject rootObjectObjectToHTMLWriter htmlWriternew ObjectToHTMLWriter(...)String html/** Gets a single string from the request parameters ... *//** Prints the current context to the response in XML format. */PrettyPrintWriter writer/** Prints the current request to the existing writer. ... */Map<> ctxMapstartNode(...)serializeIt(...)boolean printString ignorePrefixeendNode(...)filterValueStack(...)/** Recursive function to serialize objects to XML. Currently it will ... */String clsNameBeanInfo infoPropertyDescriptor[] propsPropertyDescriptor propthis.enableXmlWithConsoleList<Object> filterObject valueStackDebuggingInterceptor.class//allows it to be embedded on another page//on the first request, response can be decorated//but we need plain text on the other ones// Check stack for this object// Push object onto stack.// Don't push null objects ( handled below)// It depends on the object and it's value what todo next:// Iterate through components, and call ourselves to process// elements// Loop through keys and call ourselves// It's an array, loop through it and keep calling ourselves// Not java.lang, so we can call ourselves with this object's// values// Call ourselves with the result of the method// invocation// Remove object from stack/** Writes an object as a table, where each field can be expanded if it is an Object/Collection/Array */PrettyPrintWriter prettyWriter, ...;this.prettyWritersetEscape(...)Entry<> propertywriteProperty(...)Set<> setObject[] objectsMap<String,Object> propertiesEntry<String,Object> propertyisEmptyCollection(...)isEmptyMap(...)(...).lengthwriteValue(...)/** Some maps, like AttributeMap will throw an exception when isEmpty() is called *//** Some collections might throw an exception when isEmpty() is called *///print properties//name cell//value cell//if is is an empty collection or array, don't write a link//type cell//close trimport StackPrintWriter writer, ...;Stack<String> elementStack, ...;...[] lineIndenter, ...;boolean tagInProgress, ...;int depth, ...;boolean readyForNewLine, ...;boolean tagIsEmpty, ...;String newLine, ...;...[] NULL, ...;...[] AMP, ...;...[] LT, ...;...[] GT, ...;...[] SLASH_R, ...;...[] QUOT, ...;...[] APOS, ...;...[] CLOSE, ...;this.lineIndenterthis.newLinefinishTag(...)writeText(...)writeAttributeValue(...)endOfLine(...)new Stack<String>(...)//for some reason IE just doesn't like this when we use it from ObjectToHtmlWriter//it works on FF and Operaimport PrincipalProxy/** PrincipalProxy implementation for using HttpServletRequest Principal related methods. *//** Constructs a proxy ... */getUserPrincipal(...)getRemoteUser(...)isSecure(...)import ValidationInterceptor/** Extends the xwork validation interceptor to also check for a @SkipValidation ... */getActionMethod(...)SkipValidation.classAnnotationValidationInterceptor.classimport static ElementType.METHOD/** Marks an Action method to not be validated *//** This result type doesn't have a default param, null is ok to reduce noise in logs */Map<String,String> headers, ...;int status, ...;String error, ...;String errorMessage, ...;this.status/** Sets the http servlet error code that should be set on the response ... */this.error/** Sets the error message that should be set on the reponse ... */this.errorMessage/** Returns a Map of all HTTP headers. ... *//** Sets whether or not the HTTP header values should be evaluated against the ValueStack (by default they are). ... *//** Sets the http servlet response status code that should be set on a response. ... *//** Adds an HTTP header to the response ... *//** Sets the optional HTTP response status code and also re-sets HTTP headers after they've ... */String finalValueaddHeader(...)int errorCodeString finalMessageHttpHeaderResult.classimport CharsetString charSet, ...;/** Set the character set ... */this.charSetCharset charsetreadCharset(...)String locationadjustLocation(...)applyCharset(...)applyAdditionalHeaders(...)InputStream resourceAsStreamreadStream(...)InputStreamReader readerdefaultCharset(...)logWrongStream(...)sendStream(...)char[] bufferint charReadPlainTextResult.class// verify charsetboolean prependServletContext, ...;boolean cache, ...;writeFormElements(...)writePrologueScript(...)String postbackUrimakePostbackUri(...)/** Determines if the specified form input element should be included. ... */conditionalParse(...)/** Sets the name of the destination action. ... *//** Stores the option to cache the rendered intermediate page. The default ... */this.cache/** Sets the method of the destination action. ... *//** Sets the namespace of the destination action. ... */this.prependServletContextString encNameString encValueisElementIncluded(...)writeFormElement(...)/** Outputs the script after the form has been emitted. The default script ... */// Cache?// HTTP 1.1// HTTP 1.0// Proxies//set contenttype @see ww-4564// Render// Do not prepend if the URL is a FQN// If the URL is relative to the servlet context, prepend the servlet context path/** Marking interface for results which perform browser redirection *//* The default parameter */String tmpLocation/** Sets the action name ... *//** Sets the namespace ... *//** Sets the method ... *//** Dispatches to the given location. Does its forward via a RequestDispatcher. If the ... */getPageContext(...)RequestDispatcher dispatcherBoolean insideActionTagMap<String,Object> queryParamsforward(...)ServletDispatcherResult.class//add parameters passed on the location to #parameters// see WW-2120// put to extraContext, see Dispatcher#createContextMap// if the view doesn't exist, let's do a 404//if we are inside an action tag, we always need to do an include// If we're included, then include the view// Otherwise do forward// This allow the page to, for example, set content typeimport static HttpServletResponse.SC_FOUNDint statusCode, ...;Map<String,Object> requestParameters, ...;this.statusCode/** Set the optional anchor value. ... *//** Sets whether or not to prepend the servlet context path to the redirected ... *//** Redirects to the location specified by calling ... */StringBuilder tmpLocationisPathUrl(...)Map<String,String> resultConfigParamsList<String> prohibitedResultParamsgetProhibitedResultParams(...)Entry<String,String> eCollection<String> valuesconditionalParseCollection(...)buildParametersString(...)encodeRedirectURL(...)sendRedirect(...)/** Sends the redirection. Can be overridden to customize how the redirect is ... *//** Checks if url is simple path or either full url ... */String rawUrlisAbsolute(...)URL validUrl/** Sets the suppressEmptyParameters option ... *//** Adds a request parameter to be added to the redirect url ... */ServletRedirectResult.class// if the URL's are relative to the servlet context, append the servlet context path// add the anchor// Only log as debug as they are probably parameters to be appended to the urlString contentLength, ...;String contentDisposition, ...;String contentCharSet, ...;String inputName, ...;InputStream inputStream, ...;boolean allowCaching, ...;this.inputStream/** Set allowCaching to <tt>false</tt> to indicate that the client should be requested not to cache the data stream. ... */this.allowCachingthis.contentLengththis.contentDispositionthis.contentCharSetthis.inputNameOutputStream oOutputHttpServletResponse oResponsebyte[] oBuffint iSizeString _contentLengthint _contentLengthAsIntsetContentLength(...)StreamResult.class// Flush/** The default parameter */String DEFAULT_URL_ENCODING, ...;/** use UTF-8 as this is the recommended encoding by W3C to avoid incompatibilities. */String location, ...;String lastFinalLocation, ...;/** The location to go to after action execution. This could be a JSP page or another action. ... *//** Gets the location it was created with, mainly for testing ... *//** Returns the last parsed and encoded location value ... *//** Set parse to <tt>true</tt> to indicate that the location should be parsed as an OGNL expression. This ... *//** Set encode to <tt>true</tt> to indicate that the location should be url encoded. This is set to ... *//** Implementation of the <tt>execute</tt> method from the <tt>Result</tt> interface. This will call ... */doExecute(...)/** Parses the parameter for OGNL expressions against the valuestack ... */new EncodingParsedValueEvaluator(...)/** As {@link #conditionalParse(String, ActionInvocation)} but does not ... */Collection<String> collection/** {@link com.opensymphony.xwork2.util.TextParseUtil.ParsedValueEvaluator} to do URL encoding for found values. To be ... *//** Executes the result given a final location (jsp page, action, etc) and the action invocation ... */StrutsResultSupport.classimport JspSupportServletimport Servletimport JspFactoryimport OutputStreamWriterJspFactory jspFactory, ...;/** Creates a Velocity context from the action, loads a Velocity template and executes the ... */Servlet servletJspSupportServlet.jspSupportServletboolean usedJspFactorygetEncoding(...)releasePageContext(...)/** Retrieve the content type for this template. ... *//** Retrieve the encoding for this template. ... *//** Given a value stack, a Velocity engine, and an action invocation, this method returns the appropriate ... *//** Creates the VelocityContext that we'll use to render this page. ... */getDefaultFactory(...)VelocityResult.class// always flush the writer (we used to only flush it if this was a jspWriter, but someone asked// to do it all the time (WW-829). Since Velocity support is being deprecated, we'll oblige :)/** A bean that takes several iterators and outputs them in sequence ... */List<> iterators, ...;List<> sources, ...;// Attributes ----------------------------------------------------// Public --------------------------------------------------------// Action implementation -----------------------------------------Object sourcegetIterator(...)// Iterator implementation ---------------------------------------// Make source transformations/** A Map that holds 4 levels of scope. ... */String UNSUPPORTED, ...;Map<> context, ...;Collections.EMPTY_SETPageContext pcMap<> requestfindAttribute(...)NullPointerException npetoStringSafe(...)/** Various static methods used with components *//** If altSyntax (%{...}) is applied, simply strip the "%{" and "}" off. ... */isExpression(...)/** Is the altSyntax enabled? [TRUE] ... */isUseAltSyntax(...)/** Check if object is expression base on altSyntax ... */// does the expression start with %{ and end with }? if so, just cut it off!/** <code>ContainUtil</code> will check if object 1 contains object 2. ... *//** Determine if <code>obj2</code> exists in <code>obj1</code>. ... *//** Matches content type of uploaded files, similar to {@link com.opensymphony.xwork2.util.PatternMatcher} ... *//** A bean that can be used to keep track of a counter. ... */boolean wrap, ...;long first, ...;long current, ...;long interval, ...;long last, ...;this.currentthis.firstthis.intervalthis.lastlong nextgetNext(...)// Do nothing/** A bean that can be used to format dates */Date date, ...;DateFormat format, ...;DateFormat parser, ...;this.parserthis.datesetDate(...)PatternMatcher<int[]> matcher, ...;import JspWriterimport ByteBufferimport CharBufferimport CharsetDecoderimport CoderResultimport CodingErrorAction/** A speedy implementation of ByteArrayOutputStream. It's not synchronized, and it ... */int DEFAULT_BLOCK_SIZE, ...;LinkedList<byte[]> buffers, ...;...[] buffer, ...;int index, ...;int size, ...;int blockSize, ...;boolean closed, ...;this.blockSizebyte[] bytes/** This is a patched method (added for common Writer, needed for tests) ... */CharsetDecoder decodergetDecoder(...)CharBuffer charBufferallocate(...)buffer.lengthfloat bytesPerCharmaxBytesPerChar(...)newEncoder(...)charset(...)ByteBuffer byteBufferdecodeAndWriteOut(...)bytes.lengthwriteOut(...)onUnmappableCharacter(...)onMalformedInput(...)CodingErrorAction.REPLACEnewDecoder(...)CodingErrorAction.REPORT/** This is a patched method (standard) ... */writeToFile(...)/** This method is need only for debug. And needed for tests generated files. */FileOutputStream fileOutputStreamflip(...)decodeAndWriteBuffered(...)CoderResult resultdecodeAndWrite(...)hasRemaining(...)compact(...)isOverflow(...)isError(...)isMalformed(...)getSize(...)int positionnew LinkedList<byte[]>(...)addLast(...)addBuffer(...)data.lengthint copyLength// Create buffer for characters decoding// Create buffer for bytes// Ignore// Append bytes to current buffer// Previous data maybe partially decoded, this part will appended to previous// To begin of data// Decode// Check that all data are decoded// Move remaining to top of buffer// Not all buffer chars decoded, spin it again// Set to begin// Clean up buffer// To begin of decoded data// Output// clear output to avoid infinitive loops, see WW-4383/** InvocationSessionStore */String INVOCATION_MAP_KEY, ...;/** Checks the Map in the Session for the key and the token. If the ... */InvocationContext invocationContextgetInvocationMap(...)invocationContext.invocationinvocationContext.tokendeserialize(...)/** Stores the DefaultActionInvocation and ActionContext into the Session using the provided key for loading later using ... */new InvocationContext(...)serialize(...)Map<> invocationMapsetInvocationMap(...)String token, ...;this.token/** A base class for iterator filters */// Protected implementation --------------------------------------// Wrapper for enumerationsEnumeration<> enumeration, ...;/** A bean that generates an iterator filled with a given object depending on the count, ... */List<> values, ...;Converter converter, ...;int count, ...;int currentCount, ...;StringTokenizer tokensObject convertedObj/** Interface for converting each separated token into an Object of choice. */// Inner class --------------------------------------------------IteratorGenerator.class// make sure things, goes on, we just ignore the bad ones// Count default is the size of the list of values/** Entry in a list. */boolean isSelected, ...;this.isSelectedimport EnumerationIterator/** MakeIterator. *//** Determine whether a given object can be made into an <code>Iterator</code> ... */Iterator<> iteratorArrayList<> listnew EnumerationIterator(...)//need ability to support primitives; therefore, cannot//use Object[] casting./** A bean that takes several iterators and outputs the merge of them. Used by ... */int idx, ...;/** An interface to be implemented by any ObjectFactory implementation ... *//** Quickly matches a prefix to an object. */int SIZE, ...;// supports 7-bit chars.Node root, ...;Node currentcurrent.nextnew Node(...)current.value...[] next, ...;new Node[]Pattern PATTERN, ...;Map<Integer,String> paramsnew HashMap<Integer,String>(...)String newPatternnew RegexPatternMatcherExpression(...)groupCount(...)/* $Id: ServletContextAware.java 651946 2008-04-27 13:41:38Z apetrelli $ ... *///check if it is a regex//generate a new pattern used to match URIs//replace {X:B} by (B)//replace {X} by (.*?)//extract values and get param names from the expression//by name//by index so the old {1} still works/** Holds a compiled expression to match URLs ... *///pattern that matches the whole stringMap<Integer,String> params, ...;//maps group index (from pattern) to parameter names/** For components that have a dependence on the Servlet context. *//** A bean that takes a source and comparator then attempt to sort the source ... */Comparator<> comparator, ...;List<> list, ...;Object source, ...;this.comparator// Sort itnew DispatcherWrapper(...)setDispatcherErrorHandler(...)new MockErrorHandler(...)convertFromString(...)performFallbackConversion(...)/** Hook to perform a fallback conversion if every default options failed. By default ... *//** Converts one or more String values to the specified class. ... *//** Converts the specified object to a String. ... */import OgnlTool/** Struts base utility class, for use in Velocity and Freemarker templates */Map<String,Class<>> classes, ...;OgnlTool ognl, ...;this.ognlOgnlTool.classStrutsUtil.classBoolean retValResponseWrapper responseWrappernew ResponseWrapper(...)getData(...)/* @return the url ContextPath. An empty string if one does not exist. *//** the selectedList objects are matched to the list.listValue ... */List<> selectListCollection<> selectedItemsObject iCollection<> itemsboolean isSelectednew ListEntry(...)StringWriter strout, ...;ServletOutputStream sout, ...;new ServletOutputStreamWrapper(...)StringWriter writer, ...;new Hashtable<String,Class<>>(...)// treat it is a single item/** A bean that takes an iterator and outputs a subset of it. */Decider decider, ...;int start, ...;this.deciderSubsetIteratorFilter.classObject currentElementdecide(...)/** A decider determines if the given element should be added to the list or not. */// inner class ---------------------------------------------------/** Should the object be added to the list? ... */// protected -----------------------------------------------------boolean okToAdd// Calculate iterator filter// Read away <start> items// now let Decider decide if element should be added (if a decider exist)// Don't have to check this in the iterator code/** A bean that helps implement a tabbed pane */String tabAlign, ...;Vector<> content, ...;int selectedIndex, ...;this.contentthis.selectedIndexthis.tabAlign/** Helper methods to access text from TextProviders *//** <p>Get a message from the first TextProvider encountered in the stack. ... */TextProviderHelper.class// evaluate the defaultMessage as an OGNL expression// use the defaultMessage literal value/** A bean that can be used to time execution of pages */long start, ...;long time// Return how long time has passed since last check point// Reset so that next time we get from this point// Reset start so that next time we get from this pointimport SecureRandomimport Random/** TokenHelper */String TOKEN_NAMESPACE, ...;/** The default namespace for storing token session values */String DEFAULT_TOKEN_NAME, ...;/** The default name to map the token value */String TOKEN_NAME_FIELD, ...;/** The name of the field which will hold the token name */Random RANDOM, ...;/** Sets a transaction token into the session using the default token name. ... *//** Sets a transaction token into the session based on the provided token name. ... */generateGUID(...)/** Put a given named token into the session map. The token will be stored with a namespace prefix prepended. ... */IllegalStateException e/** Build a name-spaced token session attribute name based on the given token name. ... *//** Gets a transaction token from the params in the ServletActionContext using the default token name. ... *//** Gets the Token value from the params in the ServletActionContext using the given name ... *//** Gets the token name from the Parameters in the ServletActionContext ... *//** Checks for a valid transaction token in the current request params. If a valid token is found, it is ... */String tokenSessionNameString sessionTokenTokenHelper.classnew SecureRandom(...)// WW-1182 explain to user what the problem is// remove the token so it won't be used againimport DefaultUrlHelper/** A bean that can generate a URL. */HashMap<String,String> params, ...;DefaultUrlHelper.classMap<String,Object> fullParamsgetURL(...)// all this trickier with maps is to reduce the number of objects created// No particular page requested, so go to "same page"// Add query params to parameters// added parameters override, just like in URLTagimport UDecoder/** URLDecoderUtil serves as a facade for a correct URL decoding implementation. ... *//** Decodes a <code>x-www-form-urlencoded</code> string. ... */URLDecode(...)import CharArrayWriterimport MethodInvocationExceptionimport ParseErrorExceptionimport ResourceNotFoundException/** Struts velocity related util. */Context ctx, ...;VelocityEngine velocityEngine, ...;this.ctxthis.velocityEngineCharArrayWriter writernew CharArrayWriter(...)import FileRevisionimport JarEntryRevisionimport Revision/** FileManager implementation used with JBoss AS */String JBOSS5_VFS, ...;String JBOSS5_VFSZIP, ...;String JBOSS5_VFSMEMORY, ...;String JBOSS5_VFSFILE, ...;String VFS_JBOSS7, ...;String VFS_JBOSS5, ...;boolean supportsisJBoss7(...)isJBoss5(...)isJBossUrl(...)getJBossPhysicalUrl(...)getAllJBossPhysicalUrls(...)getAllPhysicalUrls(...)/** Check if given URL is pointing to JBoss 5 VFS resource ... *//** Try to determine physical file location. ... */Object contentString classContentFile physicalFilereadJBossPhysicalFile(...)readJBoss5Url(...)List<URL> urlsreadFile(...)URL physicalUrlgetDeclaredMethod(...)Object handleraddIfAbsent(...)// JBoss 7 and probably 6// JBoss 5/** This class implements some basic ASCII character handling functions. ... */...[] toUpper, ...;/* Character translation tables. */...[] toLower, ...;...[] isAlpha, ...;/* Character type tables. */...[] isUpper, ...;...[] isLower, ...;...[] isWhite, ...;...[] isDigit, ...;long OVERFLOW_LIMIT, ...;/** Returns the upper case equivalent of the specified ASCII character. ... */... & .../** Returns the lower case equivalent of the specified ASCII character. *//** Returns true if the specified ASCII character is upper or lower case. ... *//** Returns true if the specified ASCII character is upper case. ... *//** Returns true if the specified ASCII character is lower case. ... *//** Returns true if the specified ASCII character is white space. ... *//** Returns true if the specified ASCII character is a digit. *//** Parses an unsigned integer from the specified subarray of bytes. ... */int cnew NumberFormatException(...)--.../** Parses an unsigned long from the specified subarray of bytes. ... */long nlong mnew boolean[]int lcint ucint d/* Initialize character translation and type tables. */// Overflow/** NIO based character decoder. */Map<String,Charset> encodingToCharsetCache, ...;Charset ISO_8859_1, ...;Charset UTF_8, ...;int LEFTOVER_SIZE, ...;// Protected so unit tests can use itString lowerCaseEncgetCharsetLower(...)/** Only to be used when it is known that the encoding name is in lower case. */new UnsupportedEncodingException(...)CharsetDecoder decoder, ...;ByteBuffer bb, ...;CharBuffer cb, ...;ByteBuffer leftovers, ...;/** Leftover buffer used for incomplete characters. */byte[] leftCodingErrorAction actiongetCharset(...)wrap(...)new Utf8Decoder(...)/** Reset the decoder state. */reset(...)position(...)/** Convert the given bytes to characters. ... */array(...)getStart(...)limit(...)getEnd(...)getBuffer(...).lengthsubstractB(...)array(...).lengthisUnderflow(...)throwException(...)setOffset(...)setEnd(...)substract(...)new HashMap<String,Charset>(...)Charset iso88591Charset utf8availableCharsets(...)aliases(...)// Impossible. All JVMs must support these.// Encoding names should all be ASCII// Pre-population of the cache means this must be invalid// Special case. Use the Apache Harmony based UTF-8 decoder because it// - a) rejects invalid sequences that the JVM decoder does not// - b) fails faster for some invalid sequences// Create a new byte buffer if anything changed// Initialize the byte buffer// Create a new char buffer if anything changed// Initialize the char buffer// Parse leftover if any are present// Loop until one char is decoded or there is a decoder error// Do the decoding and get the results into the byte chunk and the char// chunk// Propagate current positions to the byte chunk and char chunk, if// this continues the char buffer will get resized// Propagate current positions to the byte chunk and char chunk// Put leftovers in the leftovers byte buffer/** This class is used to represent a chunk of bytes, and ... */// inside this way it could provide the search/etc on ByteBuffer, as a helper.// TODO: This class could either extend ByteBuffer, or better a ByteBuffer/* In a server it is very important to be able to operate on ... *//** Input interface, used when the buffer is empty ... *//** Read new bytes ( usually the internal conversion buffer ). ... *//** Same as java.nio.channel.WrittableByteChannel. *//** Send the bytes ( usually the internal conversion buffer ). ... */Charset DEFAULT_CHARSET, ...;/** Default encoding used to convert to strings. It should be UTF8, ... */// --------------------...[] buff, ...;// byte[]Charset charset, ...;boolean isSet, ...;int limit, ...;// How much can it grow, when data is added// XXXByteInputChannel in, ...;ByteOutputChannel out, ...;boolean optimizedWrite, ...;/** Creates a new, uninitialized ByteChunk object. *//** Resets the message buff to an uninitialized state. */// -------------------- Setup --------------------this.limit/** Sets the message bytes to the specified subarray of bytes. ... */this.optimizedWritethis.charset/** Returns the message bytes. *//** Returns the start offset of the bytes. ... *//** Returns the length of the bytes. ... *//** Maximum amount of data in this buffer. ... *//** When the buffer is empty, read the data from the input channel. */this.in/** When the buffer is full, write the data to the output channel. ... */this.out/** Append a char, by casting it to byte. This IS NOT intended for unicode. ... */// -------------------- Adding data to the buffer --------------------makeSpace(...)flushBuffer(...)getBytes(...)/** Add data to the buffer */int availint remainrealWriteBytes(...)// -------------------- Removing data from the buffer --------------------realReadBytes(...)/** Send the buffer to the sink. Called by append() when the limit is ... *//** Make space for len chars. If len is small, allocate a reserve space too. ... */byte[] tmpint newSizeint desiredSize// -------------------- Conversion and getters --------------------CharBuffer cbarrayOffset(...)/** Compares the message bytes to the specified String object. ... */// -------------------- equals --------------------byte[] bint blenint bofftoLower(...)byte[] b1int off1getChars(...)/** Returns true if the message bytes starts with the specified string. ... *//** Returns true if the message bytes start with the specified byte array. ... */b2.lengthint offint srcEndint myPosint srcPos// normal hash.// -------------------- Hash code  --------------------hashBytes(...)hashBytesIC(...)int maxbyte[] bb/** Returns the first instance of the given character in this ByteChunk ... */int ret/** Returns the first instance of the given character in the given byte array ... */byte b/** Returns the first instance of the given byte in the byte array between ... *//** Returns the first instance of any of the given bytes in the byte array ... */b.length/** Returns the first instance of any byte that is not one of the given bytes ... *//** Convert specified String to a byte array. This ONLY WORKS for ascii, UTF ... */byte[] resultB2CConverter.ISO_8859_1// buff==null;//        buff = null;// couldn't make space// will grow, up to limit// if we don't have limit: makeSpace can grow as it wants// assert: makeSpace made enough space// Optimize on a common case.// If the buffer is empty and the source is going to fill up all the// space in buffer, may as well write it directly to the output,// and avoid an extra copy// if we have limit and we're below// makeSpace will grow the buffer to the limit,// so we have space// need more space than we can afford, need to flush// buffer// the buffer is already at ( or bigger than ) limit// We chunk the data into slices fitting in the buffer limit, although// if the data is written directly if it doesn't fit//assert out!=null// Can't grow above the limit// take a minimum// limit < buf.length ( the buffer is already big )// or we already have space XXX// grow in larger chunks// new String(byte[], int, int, Charset) takes a defensive copy of the// entire byte array. This is expensive if only a small subset of the// bytes will be used. The code below is from Apache Harmony.// XXX ENCODING - this only works if encoding is UTF8-compat// ( ok for tomcat, where we compare ascii - header names, etc )!!!// XXX works only for enc compatible with ASCII/UTF !!!// Works only if enc==UTF// Look for first char// found first char, now look for a match// found it/** Utilities to manipulate char chunks. While String is ... */// Input interface, used when the buffer is emptied./** When we need more space we'll either ... */boolean hasHashCode, ...;// did we compute the hashcode ?// char[]// maximum amount to be cached// -1: grow indefinitelyCharInputChannel in, ...;CharOutputChannel out, ...;/** Creates a new, uninitialized CharChunk object. *//** Resets the message bytes to an uninitialized state. */// compat/** Returns the start offset of the bytes. *//** Returns the length of the bytes. */// -------------------- Adding data --------------------getOffset(...)realWriteChars(...)/** Append a string to the buffer */int sOffint sEndrealReadChars(...)/** Make space for len chars. If len is small, allocate ... */char[] tmpchar[] b1/** Returns true if the message bytes end with the specified string. ... */hash(...)char b// -------------------- utils// Char sequence implCharChunk result//XXX//        buff=null;// If the source is going to fill up all the space in buffer, may// as well write it directly to the output, and avoid an extra copy// Optimization:// If len-avail < length ( i.e. after we fill the buffer with// what we can, the remaining will fit in the buffer ) we'll just// copy the first part, flush, then copy the second part - 1 write// and still have some space for more. We'll still have 2 writes, but// we write more on the first./* If the request length exceeds the size of the output buffer, ... */// len > buf.length + avail// long write - flush the buffer and write the rest// directly from source// Cannot happen/** Tables useful when converting byte arrays to and from strings of hexadecimal ... */...[] DEC, ...;/** Table for HEX to DEC byte translation. */// -------------------------------------------------------------- Constants...[] HEX, ...;/** Table for DEC to HEX byte translation. */...[] hex, ...;/** Table for byte to hex string translation. */// --------------------------------------------------------- Static MethodsArrayIndexOutOfBoundsException ex... << ...... >> ...char[] inputCharsresult.lengthint upperNibblegetDec(...)int lowerNibble// Fast for correct values, slower for incorrect ones// Odd number of characters// Non hex character/** This class is used to represent a subarray of bytes in an HTTP message. ... */int type, ...;// primary type ( whatever is set as original value )int T_NULL, ...;int T_STR, ...;/** getType() is T_STR if the the object used to create the MessageBytes ... */int T_BYTES, ...;int T_CHARS, ...;ByteChunk byteC, ...;// Internal objects to represent array + offset, and specific methodsCharChunk charC, ...;String strValue, ...;// Stringboolean hasStrValue, ...;// strValue!=null is the same// true if a String value was computed. Probably not needed,/** Creates a new, uninitialized MessageBytes object. ... *//** Construct a new MessageBytes instance */isNull(...)/** Resets the message bytes to an uninitialized (NULL) state. */recycle(...)/** Sets the content to the specified subarray of bytes. ... */setBytes(...)/** Sets the content to be a char[] ... */setChars(...)/** Set the content to be a string *//** Compute the string value *//** Return the type of the original content. Can be ... *///----------------------------------------/** Returns the byte chunk, representing the byte[] and offset/length. ... *//** Returns the char chunk, representing the char[] and offset/length. ... *//** Returns the string value. ... *//** Get the Charset used for string&lt;-&gt;byte conversions. *//** Set the Charset used for string&lt;-&gt;byte conversions. */setCharset(...)/** Do a char-&gt;byte conversion. */ByteBuffer result/** Convert to char[] and fill the CharChunk. ... */char[] cccc.length/** Returns the length of the original buffer. ... */mb.typemb.charCmb.byteCstartsWithIgnoreCase(...)// round of tune-up// Inefficient initial implementation. Will be replaced on the nextString upperString sU/** Copy the src into this MessageBytes, allocating more space if ... */ByteChunk bcgetByteChunk(...)CharChunk ccgetCharChunk(...)String scMessageBytes.T_BYTESMessageBytes.T_CHARSMessageBytes.T_STRsetString(...)long longValue, ...;// XXX used only for headers - shouldn't be stored here.// efficient long// -------------------- Deprecated code --------------------boolean hasLongValue, ...;/** Set the buffer to the representation of an long */long currentbyte[] bufint digitgetHex(...)byte temp/** Convert the buffer to an long, cache the value */// Used for headers conversiongetLong(...)MessageBytesFactory factory, ...;// -------------------- Future may be different --------------------new MessageBytes(...)new ByteChunk(...)new CharChunk(...)new MessageBytesFactory(...)// should we check also hasStrValue ???// bytes==null && strValue==null;// inefficient// it's a string or int/date string value// mb is either CHARS or BYTES.// this is either CHARS or BYTES// Deal with the 4 cases ( in fact 3, one is symmetric)// can't happen// We need to use the same hash function// Inverting buffer/** This class implements a String cache for ByteChunk and CharChunk. ... */boolean byteEnabled, ...;/** Enabled ? */// ------------------------------------------------------- Static Variablesboolean charEnabled, ...;int trainThreshold, ...;int cacheSize, ...;int maxStringSize, ...;HashMap<ByteEntry,int[]> bcStats, ...;/** Statistics hash map for byte chunk. */int bcCount, ...;/** toString count for byte chunk. */...[] bcCache, ...;/** Cache for byte chunk. */HashMap<CharEntry,int[]> ccStats, ...;/** Statistics hash map for char chunk. */int ccCount, ...;/** toString count for char chunk. */...[] ccCache, ...;/** Cache for char chunk. */int accessCount, ...;/** Access count. */int hitCount, ...;/** Hit count. */// ------------------------------------------------------------ PropertiesStringCache.cacheSizeStringCache.byteEnabledStringCache.charEnabledStringCache.trainThreshold// -------------------------------------------------- Public Static MethodstoStringInternal(...)long t1TreeMap<Integer,ArrayList<ByteEntry>> tempMapnew TreeMap<Integer,ArrayList<ByteEntry>>(...)ByteEntry[] tempbcCachenew ByteEntry[]ByteChunk tempChunkEntry<ByteEntry,int[]> itemByteEntry entryint[] countAInteger countArrayList<ByteEntry> listnew ArrayList<ByteEntry>(...)lastKey(...)int insertPosfindClosest(...)entry.nameentry.name.lengthlong t2new ByteEntry(...)int[] countentry.charsetTreeMap<Integer,ArrayList<CharEntry>> tempMapnew TreeMap<Integer,ArrayList<CharEntry>>(...)CharEntry[] tempccCachenew CharEntry[]CharChunk tempChunkEntry<CharEntry,int[]> itemCharEntry entryArrayList<CharEntry> listnew ArrayList<CharEntry>(...)new CharEntry(...)/** Compare given byte chunk with byte array. ... */// ----------------------------------------------------- Protected MethodscompareTo.length/** Find an entry given its name in the cache and return the associated ... */bcCache.lengthcompare(...)...[...].name...[...].charset...[...].value/** Find an entry given its name in a sorted array of map elements. ... */... >>> ...int result2/** Compare given char chunk with char array. ... */ccCache.length// -------------------------------------------------- ByteEntry Inner Class...[] name, ...;(...).value// -------------------------------------------------- CharEntry Inner ClassStringCache.classnew HashMap<ByteEntry,int[]>(...)new HashMap<CharEntry,int[]>(...)// If the cache is null, then either caching is disabled, or we're// still training// If training, everything is synced// If the cache has been generated on a previous invocation// while waiting for the lock, just return the toString// value we just calculated// Two cases: either we just exceeded the train count, in// which case the cache must be created, or we just update// the count for the string// Sort the entries according to occurrence// Add to the list for that count// Create list// Allocate array of the right size// Fill it up using an alphabetical order// and a dumb insert sort// Allocate new ByteEntry for the lookup// Create byte array and copy bytes// Set encoding// Initialize occurrence count to one// Set in the stats hash map// Find the corresponding String// Note: We don't care about safety for the stats// Allocate new CharEntry for the lookup// Create char array and copy chars// Special cases: -1 and 0import CharConversionException/** All URL decoding happens here. This way we can reuse, review, optimize ... */boolean ALLOW_ENCODED_SLASH, ...;IOException EXCEPTION_EOF, ...;/** Unexpected end of data. */IOException EXCEPTION_NOT_HEX_DIGIT, ...;/** %xx with not-hex digit */IOException EXCEPTION_SLASH, ...;/** %-encoded slash is forbidden in resource path *//** URLDecode, will modify the source. */byte[] bufffindByte(...)int idx2boolean noSlashbyte b1byte b2int resx2c(...)isHexDigit(...)/** In-buffer processing - the buffer will be modified */// XXX What do we do about charset ????// -------------------- Additional methods --------------------int cendchar b1char b2/** URLDecode, will modify the source */String strValueCharChunk charCByteChunk bytesCnew DecodeException(...)// XXX Old code, needs to be replaced !!!!StringBuilder decint strPosint strLenensureCapacity(...)int laPoschar metaCharchar laCharchar res/** Decode and return the specified URL-encoded String. ... *//** Decode and return the specified URL-encoded String. It is assumed the ... */UnsupportedEncodingException uee/** Decode and return the specified URL-encoded byte array. ... */int ixint oxconvertHexDigit(...)...*=...UDecoder.class// This class does not provide a stack trace// idx will be the smallest positive index ( first % or + )// read next 2 digits//        log( "Converting a char chunk ");// invalid// decoded string output// lookahead position// look ahead to next URLencoded metacharacter, if any// if there were non-metacharacters, copy them all as a block// shortcut out of here if we're at the end of the string// process next metacharacter// We throw the original exception - the super will deal with// it//                try {// use the specified encoding to extract bytes out of the// given string so that the encoding is not lost. If an// encoding is not specified, use ISO-8859-1// Get byte to test/** Decodes bytes to UTF-8. Extracted from Apache Harmony and modified to reject ... */...[] remainingBytes, ...;// 1111ouuu 1ouuzzzz 1oyyyyyy 1oxxxxxx 000uuuuu zzzzyyyy yyxxxxxx// 111ozzzz 1oyyyyyy 1oxxxxxx          00000000 zzzzyyyy yyxxxxxx// 11oyyyyy 1oxxxxxx                   00000000 00000yyy yyxxxxxx// oxxxxxxx                            00000000 00000000 0xxxxxxx// -------------------------------------------------------------------// 0 1 2 3 Value// Please note, o means 0, actually.// For information please visit http://www.ietf.org/rfc/rfc3629.txt// correspondence of 1st byte to the length of sequence// The next table contains information about UTF-8 charset and...[] remainingNumbers, ...;...[] lowerEncodingLimit, ...;B2CConverter.UTF_8hasArray(...)decodeHasArray(...)decodeNotHasArray(...)int outRemainingremaining(...)int limitint jcharCoderResult.OVERFLOWint tailint nextBytemalformedForLength(...)CoderResult.UNDERFLOWunmappableForLength(...)byte[] bArrchar[] cArrint inIndexLimitint inIndexint outIndexint tailAvailable// 1owwwwww// 11oyyyyy// 111ozzzz// 1111ouuu// > 11110111// 0 1 2 3// (01o00000b << 6)+(1o000000b)// (011o0000b << 12)+(1o000000b << 6)+(1o000000b)// (0111o000b << 18)+(1o000000b << 12)+(1o000000b <<// 6)+(1o000000b)// No early test for invalid sequences here as peeking// at the next byte is harder// Should have been encoded in a fewer octets// Apache Tomcat added test// if someone would change the limit in process,// he would face consequences// If first byte is invalid, tail will be set to -1// Additional checks to detect invalid sequences ASAP// Checks derived from Unicode 6.2, Chapter 3, Table 3-7// Check 2nd byte// First byte C2..DF, second byte 80..BF// First byte E0, second byte A0..BF// First byte E1..EC, second byte 80..BF// First byte ED, second byte 80..9F// First byte EE..EF, second byte 80..BF// First byte F0, second byte 90..BF// First byte F1..F3, second byte 80..BF// First byte F4, second byte 80..8F// Check third byte if present and expected// Check fourth byte if present and expected// Should have been encoded in fewer octetsimport StrutsModelsimport ActionDirectiveimport ActionErrorDirectiveimport ActionMessageDirectiveimport AnchorDirectiveimport BeanDirectiveimport CheckBoxDirectiveimport CheckBoxListDirectiveimport ComboBoxDirectiveimport ComponentDirectiveimport DateDirectiveimport DoubleSelectDirectiveimport FieldErrorDirectiveimport FileDirectiveimport FormDirectiveimport HeadDirectiveimport HiddenDirectiveimport I18nDirectiveimport IncludeDirectiveimport LabelDirectiveimport OptionTransferSelectDirectiveimport ParamDirectiveimport PasswordDirectiveimport PropertyDirectiveimport PushDirectiveimport RadioDirectiveimport ResetDirectiveimport SelectDirectiveimport SetDirectiveimport SubmitDirectiveimport TextAreaDirectiveimport TextDirectiveimport TextFieldDirectiveimport TokenDirectiveimport URLDirectiveimport UpDownSelectDirective/** The default Struts tag library */new StrutsModels(...)Class<>[] directivesActionDirective.classBeanDirective.classCheckBoxDirective.classCheckBoxListDirective.classComboBoxDirective.classComponentDirective.classDateDirective.classDoubleSelectDirective.classFileDirective.classFormDirective.classHeadDirective.classHiddenDirective.classAnchorDirective.classI18nDirective.classIncludeDirective.classLabelDirective.classParamDirective.classPasswordDirective.classPushDirective.classPropertyDirective.classRadioDirective.classSelectDirective.classSetDirective.classSubmitDirective.classResetDirective.classTextAreaDirective.classTextDirective.classTextFieldDirective.classTokenDirective.classURLDirective.classActionErrorDirective.classActionMessageDirective.classFieldErrorDirective.classOptionTransferSelectDirective.classUpDownSelectDirective.classgetModels(...)getDirectiveClasses(...)JspSupportServlet jspSupportServlet, ...;/** Provides Velocity implementation classes for a tag library *//** Gets a list of Velocity directive classes for the tag library.  Called once on framework ... *//** Provides Freemarker implementation classes for a tag library *//** Gets a Java object that contains getters for the tag library's Freemarker models. ... *//* $Id: TagLibrary.java 651946 2008-04-27 13:41:38Z apetrelli $ ... *//** An annotation to document a Struts jsp/freemarker/velocity tag *//** Documents an attribute to a Struts tag *//** Marks a class as the top class in the class hierarchy scanned for tag annotations */import freemarker.cache.*import TemplateClassResolverimport TaglibFactoryimport HttpRequestHashModelimport HttpRequestParametersHashModelimport HttpSessionHashModelimport ServletContextHashModelimport freemarker.template.*import StringUtilimport TagLibraryModelProviderimport GenericServletString INITPARAM_TEMPLATE_PATH, ...;// copied from freemarker servlet - so that there is no dependency on itString INITPARAM_NOCACHE, ...;String INITPARAM_CONTENT_TYPE, ...;String DEFAULT_CONTENT_TYPE, ...;String INITPARAM_DEBUG, ...;String KEY_REQUEST, ...;String KEY_INCLUDE, ...;String KEY_REQUEST_PRIVATE, ...;String KEY_REQUEST_PARAMETERS, ...;String KEY_SESSION, ...;String KEY_APPLICATION, ...;String KEY_APPLICATION_PRIVATE, ...;String KEY_JSP_TAGLIBS, ...;String ATTR_REQUEST_MODEL, ...;// Note these names start with dot, so they're essentially invisible from  a freemarker script.String ATTR_REQUEST_PARAMETERS_MODEL, ...;String ATTR_APPLICATION_MODEL, ...;String ATTR_JSP_TAGLIBS_MODEL, ...;String ATTR_TEMPLATE_MODEL, ...;// for sitemeshString KEY_REQUEST_PARAMETERS_STRUTS, ...;// for Struts// template model stored in request for siteMeshString KEY_HASHMODEL_PRIVATE, ...;String EXPIRATION_DATE, ...;boolean contentTypeEvaluated, ...;/** Adds individual settings. ... */// end freemarker definitions...String CONFIG_SERVLET_CONTEXT_KEY, ...;String KEY_EXCEPTION, ...;String templatePath, ...;boolean nocache, ...;boolean debug, ...;Configuration config, ...;ObjectWrapper wrapper, ...;boolean noCharsetInContentType, ...;boolean altMapWrapper, ...;boolean cacheBeanWrapper, ...;int mruMaxStrongSize, ...;String templateUpdateDelay, ...;Map<String,TagLibraryModelProvider> tagLibraries, ...;FreemarkerThemeTemplateLoader themeTemplateLoader, ...;StrutsConstants.STRUTS_FREEMARKER_WRAPPER_ALT_MAPStrutsConstants.STRUTS_FREEMARKER_BEANWRAPPER_CACHEStrutsConstants.STRUTS_FREEMARKER_MRU_MAX_STRONG_SIZEMap<String,TagLibraryModelProvider> mapnew HashMap<String,TagLibraryModelProvider>(...)TagLibraryModelProvider.classthis.tagLibrariesthis.themeTemplateLoaderTemplateException esetTemplateExceptionHandler(...)TemplateExceptionHandler.HTML_DEBUG_HANDLERcreateObjectWrapper(...)setObjectWrapper(...)configureTemplateLoader(...)createTemplateLoader(...)/** Sets the Freemarker Configuration's template loader with the FreemarkerThemeTemplateLoader ... */setTemplateLoader(...)/** Create the instance of the freemarker Configuration object. ... */new Configuration(...)Configuration.VERSION_2_3_0setSetting(...)Configuration.CACHE_STORAGE_KEYConfiguration.TEMPLATE_UPDATE_DELAY_KEYsetDefaultEncoding(...)setLocalizedLookup(...)setWhitespaceStripping(...)setNewBuiltinClassResolver(...)TemplateClassResolver.SAFER_RESOLVERScopesHashModel modelnew ScopesHashModel(...)HttpRequestHashModel requestModelHttpRequestParametersHashModel reqParametersModelServletContextHashModel servletContextModelGenericServlet servletTaglibFactory taglibsnew TaglibFactory(...)new ServletContextHashModel(...)putUnlistedModel(...)new HttpSessionHashModel(...)new HttpRequestHashModel(...)new HttpRequestParametersHashModel(...)StrutsBeanWrapper wrappernew StrutsBeanWrapper(...)setUseCache(...)/** Create the template loader. The default implementation will create a ... */TemplateLoader templatePathLoadernew ClassTemplateLoader(...)new FileTemplateLoader(...)new MultiTemplateLoader(...)new TemplateLoader[]new WebappTemplateLoader(...)new StrutsClassTemplateLoader(...)/** Load the settings from the /freemarker.properties file on the classpath ... */Properties paddSetting(...)getYesNo(...)isWhitespace(...)buildScopesHashModel(...)Map<> standardgetStandardContext(...)GregorianCalendar expirationnew GregorianCalendar(...)SimpleDateFormat httpDate// Generate expiration date that is one year from now in the past// store this configuration in the servlet context// Set defaults:// Process object_wrapper init-param out of order:// Process TemplatePath init-param out of order:// Create hash model wrapper for servlet context (the application). We need one thread, once per servlet context// first try a JSP support servlet.  If it fails, default to the servlet.// Create hash model wrapper for session// Create hash model wrapper for the request attributes// Create hash model wrapper for request parameters// substring(7) is intentional as we "reuse" the last slash// presume that most apps will require the class and webapp template loader// if people wish to// Process all other init-params://place the model in the request using the special parameter.  This can be retrieved for freemarker and velocity.// put the same objects into the context that the velocity result uses// support for JSP exception pages, exposing the servlet or JSP exceptionimport ObjectWrapperimport TemplateExceptionimport TemplateExceptionHandlerimport TemplateModelimport TemplateModelExceptionimport StrutsResultSupport/** Renders a view using the Freemarker template engine. */Boolean writeIfCompleted, ...;/* Struts results are constructed for each result execution ... */String pContentType, ...;String PARENT_TEMPLATE_WRITER, ...;/** allow parameterization of the contentType ... *//** Execute this result, using the specified template locationArg. ... */String absoluteLocationdeduceLocale(...)TemplateModel modelcreateModel(...)this.wrapperpreTemplateProcess(...)boolean willWriteIfCompletedisWriteIfCompleted(...)getTemplateExceptionHandler(...)TemplateExceptionHandler.RETHROW_HANDLERCharArrayWriter parentCharArrayWriterboolean isTopTemplatepostTemplateProcess(...)/** The default writer writes directly to the response writer. ... *//** Build the instance of the ScopesHashModel, including JspTagLib support ... *//** Returns the locale used for the {@link Configuration#getTemplate(String, Locale)} call. The base implementation ... *//** the default implementation of postTemplateProcess applies the contentType parameter ... *//** Called before the execution is passed to template.process(). ... */Object attrContentTypegetCustomAttribute(...)isInsideActionTag(...)this.writeIfCompletedFreemarkerResult.class// Give subclasses a chance to hook into preprocessing// Process the template//this is the top template//set it in the request because when the "action" tag is used a new VS and ActionContext is created// Give subclasses a chance to hook into postprocessing//Added for NullPointException//trigger com.opensymphony.module.sitemesh.filter.PageResponseWrapper.deactivateSiteMesh()import TemplateLoader/** When loading a template, if sees theme token in path, does a template search through ... */TemplateLoader parentTemplateLoader, ...;String themeExpansionToken, ...;// InjectedTemplateEngine templateEngine, ...;/** Initialize the loader for the given parent. ... */this.parentTemplateLoaderint tokenIndexint themeEndIndexList<Template> possibleTemplatesfindTemplateSource(...)Template possibleTemplateObject templateSourcegetLastModified(...)getReader(...)closeTemplateSource(...)this.templateEngine// no parent theme, no way to fetch parent templateMap<String,TemplateModel> unlistedModels, ...;Object parametersCache, ...;// This constructor is for Freemarker Sitemesh integration where the model is somehow lost.../** Stores a model in the hash so that it doesn't show up in <tt>keys()</tt> ... */findValueOnStack(...)Object parametersLocalnew HashMap<String,TemplateModel>(...)// Lookup in default scope// ok, then try the context// Lookup in request scope// Lookup in session scope// Lookup in application scope// Look in unlisted modelsimport CollectionAndSequenceimport BeansWrapperimport MapModelimport ModelFactoryimport SimpleSequenceimport TemplateCollectionModelimport TemplateHashModelExthis.altMapWrapperFriendlyMapModel.FACTORYgetModelFactory(...)/** Attempting to get the best of both worlds of FM's MapModel and SimpleMapModel, by reimplementing the isEmpty(), ... */ModelFactory FACTORY, ...;new CollectionAndSequence(...)new SimpleSequence(...)new ModelFactory(...) { ... }new FriendlyMapModel(...)// attempt to get the best of both the SimpleMapModel and the MapModel of FM.import URLTemplateLoaderimport ActionErrorimport Componentnew ActionError(...)import ActionMessagenew ActionMessage(...)import ActionComponentnew ActionComponent(...)import Anchornew Anchor(...)import Beannew Bean(...)import TransformControlComponent bean, ...;StringWriter body, ...;boolean afterBody, ...;this.beanusesBody(...)this.bodyimport CheckboxListnew CheckboxList(...)import Checkboxnew Checkbox(...)import ComboBoxnew ComboBox(...)import GenericUIBeannew GenericUIBean(...)/** <code>DateModel</code> */import DoubleSelectnew DoubleSelect(...)import ElseIfnew ElseIf(...)import Elsenew Else(...)import FieldErrornew FieldError(...)import Formnew Form(...)import Headnew Head(...)import Hiddennew Hidden(...)import I18nnew I18n(...)import Ifnew If(...)new Include(...)import InputTransferSelectnew InputTransferSelect(...)import IteratorComponentnew IteratorComponent(...)import Labelnew Label(...)import OptGroup/** Freemarker's TransformModel for OptGroup component. */new OptGroup(...)import OptionTransferSelectnew OptionTransferSelect(...)import Paramnew Param(...)import Passwordnew Password(...)import Propertynew Property(...)import Pushnew Push(...)import Radionew Radio(...)import Resetnew Reset(...)import Selectnew Select(...)new Set(...)/** Provides @s.tag access for various tags. */ActionModel action, ...;BeanModel bean, ...;CheckboxModel checkbox, ...;CheckboxListModel checkboxlist, ...;ComboBoxModel comboBox, ...;ComponentModel component, ...;DateModel date, ...;DoubleSelectModel doubleselect, ...;FileModel file, ...;FormModel form, ...;HeadModel head, ...;HiddenModel hidden, ...;AnchorModel a, ...;I18nModel i18n, ...;IncludeModel include, ...;LabelModel label, ...;PasswordModel password, ...;PushModel push, ...;ParamModel param, ...;RadioModel radio, ...;SelectModel select, ...;SetModel set, ...;SubmitModel submit, ...;ResetModel reset, ...;TextAreaModel textarea, ...;TextModel text, ...;TextFieldModel textfield, ...;TokenModel token, ...;URLModel url, ...;PropertyModel property, ...;IteratorModel iterator, ...;ActionErrorModel actionerror, ...;ActionMessageModel actionmessage, ...;FieldErrorModel fielderror, ...;OptionTransferSelectModel optiontransferselect, ...;UpDownSelectModel updownselect, ...;OptGroupModel optGroupModel, ...;IfModel ifModel, ...;ElseModel elseModel, ...;ElseIfModel elseIfModel, ...;InputTransferSelectModel inputtransferselect, ...;new CheckboxListModel(...)new CheckboxModel(...)new ComboBoxModel(...)new ComponentModel(...)new DoubleSelectModel(...)new FileModel(...)new FormModel(...)new HeadModel(...)new HiddenModel(...)new LabelModel(...)new PasswordModel(...)new RadioModel(...)new SelectModel(...)new SubmitModel(...)new ResetModel(...)new TextAreaModel(...)new TextFieldModel(...)new DateModel(...)new TokenModel(...)new URLModel(...)new IncludeModel(...)new ParamModel(...)new ActionModel(...)new AnchorModel(...)new TextModel(...)new BeanModel(...)new I18nModel(...)new PushModel(...)new SetModel(...)new PropertyModel(...)new IteratorModel(...)new ActionErrorModel(...)new ActionMessageModel(...)new FieldErrorModel(...)new OptionTransferSelectModel(...)new UpDownSelectModel(...)new OptGroupModel(...)new IfModel(...)new ElseModel(...)new ElseIfModel(...)new InputTransferSelectModel(...)import Submitnew Submit(...)import SimpleNumberimport TemplateTransformModelComponent beanMap<> unwrappedParametersunwrapParameters(...)new CallbackWriter(...)BeansWrapper objectWrappergetDefaultInstance(...)TemplateModelException eHashMap<> mapcomplexType(...)getWrappedObject(...)getAsNumber(...)toList(...)TagModel.class// the value should ALWAYS be a descendant of TemplateModel// if it doesn't, we'll do it the old way by just returning the toString() representationimport TextAreanew TextArea(...)import TextFieldnew TextField(...)import Textnew Text(...)import Tokennew Token(...)import UpDownSelectnew UpDownSelect(...)ActionComponent actionpopulateParams(...)setIgnoreContextParams(...)setFlush(...)setRethrowException(...)ActionComponent acBeanTag.classimport JspExceptiongetBody(...)boolean evalBodyimport ContextBeanContextBean beanDate dsetFormat(...)setNice(...)setTimezone(...)setTest(...)getComponent(...)/** The iterator tag can export an IteratorStatus object so that ... */StatusState state, ...;state.indexstate.lastboolean last, ...;String begin, ...;String end, ...;String step, ...;IteratorComponent tagsetBegin(...)setStep(...)this.beginboolean againgetEnclosingWriter(...)new JspException(...)import Numbernew Number(...)Number nsetType(...)Param paramsetSuppressEmptyParameters(...)Property tagsetDefault(...)setEscapeHtml(...)setEscapeJavaScript(...)setEscapeXml(...)setEscapeCsv(...)Set setimport BodyTagSupport/** Contains common functonalities for Struts JSP Tags. *///return translateVariables(expr, getStack());import ApplicationMap// also tie this stack/context to the ThreadLocal// let's make sure that the current page context is in the action context// well, if the ActionMapper can't tell us, and there is no existing action invocation,// let's just go with a default guess that the namespace is the last the path minus the// last part (/foo/bar/baz.xyz -> /foo/bar)String searchValueStack, ...;Text textsetSearchValueStack(...)this.searchValueStackString encode, ...;String includeContext, ...;String escapeAmp, ...;String forceAddSchemeHostAndPort, ...;import AppendIteratorimport ContextBeanTag/** Append a list of iterators. The values of the iterators will be merged ... */new AppendIterator(...)import IteratorGeneratorimport Converterimport StrutsBodyTagSupportString DEFAULT_SEPARATOR, ...;String countAttr, ...;String separatorAttr, ...;String valueAttr, ...;String converterAttr, ...;IteratorGenerator iteratorGenerator, ...;/** {@literal @}s.tagattribute required="true" type="String" ... *//** {@literal @}s.tagattribute required="true" ... */String separatorConverter converterObject countObjnew IteratorGenerator(...)setValues(...)setCount(...)setSeparator(...)setConverter(...)IteratorGeneratorTag.class// value// separator// TODO: maybe this could be put into an Util class, or there is already one?// count// converter// Push resulting iterator on stack and put into// stack context if we have a "var" specified.// pop resulting iterator from stack at end tag// clean upimport MergeIteratornew MergeIterator(...)import SortIteratorFilterString comparatorAttr, ...;String sourceAttr, ...;SortIteratorFilter sortIteratorFilter, ...;Object srcToSortObject comparatorObjComparator<> cnew SortIteratorFilter(...)setComparator(...)int returnValdoEndTag(...)// Source// see if source is Iteratable// Comparator// SortIteratorFilter// push sorted iterator into stack, so nexted tag have access to it// pop sorted list from stack at the end of tagimport SubsetIteratorFilterimport DeciderString startAttr, ...;String deciderAttr, ...;SubsetIteratorFilter subsetIteratorFilter, ...;/** {@literal @}s.tagattribute required="false" type="Integer" ... */Decider deciderObject startObjObject deciderObjDecider.classnew SubsetIteratorFilter(...)setDecider(...)setStart(...)SubsetIteratorTag.class// source// start// deciderimport ClosingUIBeansetOpenTemplate(...)import DoubleListUIBeanDoubleListUIBean beansetDoubleList(...)setDoubleListKey(...)setDoubleListValue(...)setDoubleListCssClass(...)setDoubleListCssStyle(...)setDoubleListTitle(...)setDoubleName(...)setDoubleValue(...)setFormName(...)setDoubleId(...)setDoubleDisabled(...)setDoubleMultiple(...)setDoubleSize(...)setDoubleHeaderKey(...)setDoubleHeaderValue(...)setDoubleEmptyOption(...)setDoubleCssClass(...)setDoubleCssStyle(...)setDoubleOnclick(...)setDoubleOndblclick(...)setDoubleOnmousedown(...)setDoubleOnmouseup(...)setDoubleOnmouseover(...)setDoubleOnmousemove(...)setDoubleOnmouseout(...)setDoubleOnfocus(...)setDoubleOnblur(...)setDoubleOnkeypress(...)setDoubleOnkeydown(...)setDoubleOnkeyup(...)setDoubleOnselect(...)setDoubleOnchange(...)setDoubleAccesskey(...)setEmptyOption(...)setHeaderKey(...)setHeaderValue(...)setMultiple(...)setSize(...)import ListUIBeanListUIBean listUIBeansetListValueKey(...)setListLabelKey(...)setListCssClass(...)setListCssStyle(...)setListTitle(...)setThrowExceptionOnNullValueAttribute(...)import ComponentTagSupportimport DynamicAttributes/** Abstract base class for all UI tags. */String labelposition, ...;// tooltip attributes// dynamic attributes.UIBean uiBeansetCssClass(...)setCssStyle(...)setCssErrorClass(...)setCssErrorStyle(...)setTitle(...)setLabelSeparator(...)setLabelposition(...)setRequiredPosition(...)setErrorPosition(...)setRequiredLabel(...)setTabindex(...)setTemplate(...)setTheme(...)setTemplateDir(...)setOnclick(...)setOndblclick(...)setOnmousedown(...)setOnmouseup(...)setOnmouseover(...)setOnmousemove(...)setOnmouseout(...)setOnfocus(...)setOnblur(...)setOnkeypress(...)setOnkeydown(...)setOnkeyup(...)setOnselect(...)setOnchange(...)setTooltip(...)setTooltipConfig(...)setJavascriptTooltip(...)setTooltipCssClass(...)setTooltipDelay(...)setTooltipIconPath(...)setAccesskey(...)setKey(...)setDynamicAttributes(...)this.labelpositionimport SimpleBeanInfo/** Describes properties supported by the AbstractUITag - base class for all UI tags ... */List<PropertyDescriptor> descriptorsnew ArrayList<PropertyDescriptor>(...)Method classSetterAbstractUITag.classMethod styleSetterPropertyDescriptor[] arraynew PropertyDescriptor[]new PropertyDescriptor(...)String setterNameAbstractUITagBeanInfo.class// Add the tricky one first// This is crazy talk, we're only doing things that should always succeed/** ActionError Tag. */ActionError error/** ActionMessage Tag. */ActionMessage messageAnchor tagsetHref(...)setFieldValue(...)import DateTextFieldnew DateTextField(...)DateTextField textFieldimport Debugnew Debug(...)DoubleSelect doubleSelect/** FieldError Tag. */FieldError fieldErrorsetAccept(...)setTarget(...)setEnctype(...)setValidate(...)setOnreset(...)setOnsubmit(...)setAcceptcharset(...)setFocusElement(...)/** InputTransferSelect jsp tag. */InputTransferSelect inputTransferSelectsetAllowRemoveAll(...)setAllowUpDown(...)setLeftTitle(...)setRightTitle(...)setButtonCssClass(...)setButtonCssStyle(...)setAddLabel(...)setRemoveLabel(...)setRemoveAllLabel(...)setUpLabel(...)setDownLabel(...)setFor(...)OptGroup optGroup/** OptionTransferSelect jsp tag. */String leftDownLabel, ...;OptionTransferSelect optionTransferSelectsetAllowAddToLeft(...)setAllowAddToRight(...)setAllowAddAllToLeft(...)setAllowAddAllToRight(...)setAllowSelectAll(...)setAllowUpDownOnLeft(...)setAllowUpDownOnRight(...)setAddToLeftLabel(...)setAddToRightLabel(...)setAddAllToLeftLabel(...)setAddAllToRightLabel(...)setSelectAllLabel(...)setLeftUpLabel(...)setLeftDownLabel(...)setRightUpLabel(...)setRightDownLabel(...)setAddToLeftOnclick(...)setAddToRightOnclick(...)setAddAllToLeftOnclick(...)setAddAllToRightOnclick(...)setSelectAllOnclick(...)setUpDownOnLeftOnclick(...)setUpDownOnRightOnclick(...)this.leftDownLabelsetShowPassword(...)Reset resetsetSrc(...)Submit submitTextField textFieldsetMaxlength(...)setReadonly(...)TextArea textAreasetCols(...)setRows(...)setWrap(...)UpDownSelect csetAllowMoveUp(...)setAllowMoveDown(...)setMoveUpLabel(...)setMoveDownLabel(...)import StrutsUtil/** Value Stack's Context related Utilities. */String REQUEST, ...;String REQUEST2, ...;String RESPONSE, ...;String RESPONSE2, ...;String BASE, ...;String STACK, ...;String OGNL, ...;String STRUTS, ...;String ACTION, ...;new StrutsUtil(...)/** Return true if either Configuration's altSyntax is on or the stack context's useAltSyntax is on ... */StrutsConstants.STRUTS_TAG_ALTSYNTAX/** Returns a String for overriding the default templateSuffix if templateSuffix is on the stack ... */// We didn't make altSyntax static cause, if so, struts.configuration.xml.reload will not work// plus the Configuration implementation should cache the properties, which the framework's// configuration implementation does/** Default implementation of UrlHelper */String HTTP_PROTOCOL, ...;String HTTPS_PROTOCOL, ...;int httpPort, ...;int httpsPort, ...;StrutsConstants.STRUTS_URL_HTTP_PORTthis.httpPortStrutsConstants.STRUTS_URL_HTTPS_PORTthis.httpsPortStringBuilder linkboolean changedSchemeisValidScheme(...)String reqSchemegetServerName(...)int reqPortgetServerPort(...)String requestURIcontainsIgnoreCase(...)encodeURL(...)Iterator<Entry<String,Object>> iterbuildParameterSubstring(...)StringUtils.EMPTY/** Encodes the URL using {@link java.net.URLEncoder#encode} with the encoding specified in the configuration. ... *//** Decodes the URL using {@link URLDecoderUtil#decode(String, String)} with the encoding specified in the configuration. ... *//** Decodes the URL using {@link URLDecoderUtil#decode(String, String, boolean)} with the encoding specified in the configuration. ... */String[] paramsString[] tmpParamstmpParams.lengthString translatedParamValueObject currentParamString[] currentParamValuesList<String> paramList// only append scheme if it is different to the current scheme *OR*// if we explicity want it to be appended by having forceAddSchemeHostAndPort = true// If switching schemes, use the configured port for the particular scheme.// Else use the port from the current request.// Check if context path needs to be added// Add path to absolute links// (Applicable to Servlet 2.4 containers)// If the request was forwarded, the attribute below will be set with the original URL// If the attribute wasn't found, default to the value in the request object// Add page// Go to "same page"// If neither request attributes were found, default to the value in the request object//if the action was not explicitly set grab the params from the request// Set params// WW-1619 append new param value to existing value(s)/** Helper class used to build Urls or parse request params */int DEFAULT_HTTP_PORT, ...;/** Default HTTP port (80). */int DEFAULT_HTTPS_PORT, ...;/** Default HTTPS port (443). */String AMP, ...;import ClasspathResourceLoader/** Loads resource from the Thread's context ClassLoader. */new ResourceNotFoundException(...)StrutsResourceLoader.classimport VelocityContext...[] chainedContexts, ...;this.chainedContextsboolean containsinternalContainsKey(...)chainedContexts.length// first let's check to see if we contain the requested key// if not, let's search for the key in the ognl value stack// if we still haven't found it, le's search through our chained contexts// nope, i guess it's really not here// first, let's check to see if have the requested value// still no luck?  let's look against the value stack// finally, if we're chained to other contexts, let's look in themimport VelocityStrutsUtilimport TagLibraryDirectiveProviderimport Velocityimport ToolboxManagerimport ChainedContextimport ServletToolboxManager/** Manages the environment for Velocity result types */String KEY_VELOCITY_STRUTS_CONTEXT, ...;String PARENT, ...;/** the parent JSP tag */String TAG, ...;/** the current JSP tag */ToolboxManager toolboxManager, ...;/** A reference to the toolbox manager. */String toolBoxLocation, ...;...[] chainedContextNames, ...;/** Names of contexts that will be chained on every request */Properties velocityProperties, ...;String customConfigFile, ...;List<TagLibraryDirectiveProvider> tagLibraries, ...;List<TagLibraryDirectiveProvider> listnew ArrayList<TagLibraryDirectiveProvider>(...)TagLibraryDirectiveProvider.classContext resultVelocityContext[] chainedContextsprepareChainedContexts(...)StrutsVelocityContext contextnew StrutsVelocityContext(...)Map<> standardMapServletContext ctxnew VelocityStrutsUtil(...)ChainedContext chainednew ChainedContext(...)setToolbox(...)getToolbox(...)/** constructs contexts for chaining on this request.  This method does not ... */List<> contextListthis.chainedContextNameschainedContextNames.lengthVelocityContext velocityContextVelocityContext[] extraContextsnew VelocityContext[]/** initializes the VelocityManager.  this should be called during the initialization process, say by ... */newVelocityEngine(...)initToolbox(...)/** load optional velocity properties using the following loading strategy ... */String defaultUserDirectiveString configfileString resourceLocationString userdirectiveapplyDefaultConfiguration(...)this.velocityPropertiesIterator<> keysStrutsConstants.STRUTS_VELOCITY_CONFIGFILEthis.customConfigFileStrutsConstants.STRUTS_VELOCITY_TOOLBOXLOCATIONthis.toolBoxLocationStrutsConstants.STRUTS_VELOCITY_CONTEXTS/** allow users to specify via the struts.properties file a set of additional VelocityContexts to chain to the ... */List<String> contextListString[] chainedContexts/** Initializes the ServletToolboxManager for this servlet's ... */loadConfiguration(...)new VelocityEngine(...)setApplicationAttribute(...)/** once we've loaded up the user defined configurations, we will want to apply Struts specification configurations. ... */String directivesVelocity.RESOURCE_LOADERTagLibraryDirectiveProvider tagLibraryList<Class<>> directivesClass<> directiveaddDirective(...)char[] string2char[] newString2int oLengthstring2.length// in case this was used outside the lifecycle of struts servlet// now apply our systemic defaults, then allow user to override/** if the user has specified an external velocity configuration file, we'll want to search for it in the ... */// 1. relative to context path, i.e. /velocity.properties// 2. if nothing was found relative to the context path, search relative to the WEB-INF directory// 3. finally, if there's no physical file, how about something in our classpath// if we've got something, load 'er up// overide with programmatically set properties// for debugging purposes, allows users to dump out the properties that have been configured// we expect contexts to be a comma separated list of classnames/* if we have a toolbox, get a manager for it *///  Set the velocity attribute for the servlet context//  if this is not set the webapp loader WILL NOT WORK// ensure that caching isn't overly aggressive/** Load a default resource loader definition if there isn't one present. ... *//** If there's a "real" path add it for the strutsfile resource loader. ... */// remove strutsfile from resource loader property/** Refactored the Velocity templates for the Struts taglib into the classpath from the web path.  This will ... */// components// If the newString is null, just return the string since there's nothing to replace.// Make sure that oldString appears at least once before doing any processing.// Use char []'s, as they are more efficient to deal with.// Replace all remaining instances of oldString with newString.import InternalContextAdapterimport DirectivegetBeanName(...)createPropertyMap(...)Node bodyjjtGetChild(...)jjtGetNumChildren(...)render(...)Map<> propertyMapint childrenNode firstChildObject firstValueputProperty(...)/** adds a given Node's key/value pair to the propertyMap.  For example, if this Node contained the value "rows=20", ... */String propertynew ParseErrorException(...)// get the bean// get the parameters//bean.addAllParameters(params);// Velocity supports an on-the-fly Map-definition syntax that leads// to more readable and faster code://    #url({'id':'url', 'action':'MyAction'})// We support this syntax by checking for a single Map argument// to any directive and using that as the property map instead// of building one from individual name-value pair strings.// node.value uses the StrutsValueStack to evaluate the directive's value parameter/** <code>DateDirective</code> *//** OptGroup velocity directive. */import DOMExceptionimport TypeInfo/** AbstractAdapterElement extends the abstract Node type and implements ... */Map<> attributeAdapters, ...;operationNotSupported(...)buildAttributeAdapters(...)/** No attributes, return empty attributes if asked. */getNamedItem(...)getAttributes(...)getTagName(...)/** AbstractAdapterNode is the base for childAdapters that expose a read-only view ... */NamedNodeMap EMPTY_NAMEDNODEMAP, ...;List<Node> childAdapters, ...;Object propertyValue, ...;// The domain object that we are adaptingAdapterNode parent, ...;AdapterFactory adapterFactory, ...;setAdapterFactory(...)setParent(...)setPropertyName(...)setPropertyValue(...)/** subclasses override to produce their children ... */new ArrayList<Node>(...)/** Lazily initialize child childAdapters ... */buildChildAdapters(...)List<> adaptersgetChildAdapters(...)int siblingIndexgetChildBeforeOrAfter(...)LinkedList<Node> filteredChildrennew LinkedList<Node>(...)Node adapterNodenew SimpleNodeList(...)// Begin Node methodsthis.propertyValueNode nextgetChildAfter(...)getChildBefore(...)this.propertyNamethis.adapterFactory// Begin DOM 3 methods// End node methodsnew NamedNodeMap(...) { ... }/* after */Map<Class<>,Class<>> adapterTypes, ...;/** Register an adapter type for a Java class type. ... *//** Create a top level Document adapter for the specified Java object. ... */new SimpleAdapterDocument(...)/** Create an Node adapter for a child element. ... */Class<> adapterClassgetAdapterForValue(...)Class<> valueTypeconstructAdapterInstance(...)proxyNode(...)ArrayAdapter.classStringAdapter.classCollectionAdapter.classMapAdapter.classBeanAdapter.classnew ProxyElementAdapter(...)new ProxyTextNodeAdapter(...)Node.ATTRIBUTE_NODEnew ProxyAttrAdapter(...)new ProxyNamedNodeMap(...)/** Create an instance of an adapter dynamically and set its context via ... */NoSuchMethodException e1AdapterNode adapterNode/** Create an appropriate adapter for a null value. ... */new StringAdapter(...)//TODO: implement Configuration option to provide additional adapter classesnew HashMap<Class<>,Class<>>(...)// If the property is a Document, "unwrap" it to the root element// If the property is already a Node, proxy it// Check other supported types or default to generic JavaBean introspecting adapter// Unsupported Node type - ignore for now// Check to see if the class has a no-args constructor/** The adapter factory that created this node. ... *//** The parent adapter node of this node. Note that our parent must be another adapter node, but our children may be any ... *//** The child node before the specified sibling ... *//** The child node after the specified sibling ... *//** The name of the Java object (property) that we are adapting ... *//** The Java object (property) that we are adapting ... */List<Node> childrenNode childAdapteradaptNode(...)getAdapterFactory(...)/** This class is the most general type of adapter, utilizing reflective introspection to present a DOM view of all of ... */...[] NULLPARAMS, ...;//Static fields/initializerMap<Class<>,PropertyDescriptor[]> propertyDescriptorCache, ...;/** Cache can savely be static because the cached information is the same for all instances of this class. *///Instance fields//Constructors//MethodsList<Node> newAdaptersprops.lengthObject propertyValueadaptNullValue(...)/** Caching facade method to Introspector.getBeanInfo(Class, Class).getPropertyDescriptors(); */new HashMap<Class<>,PropertyDescriptor[]>(...)// Log child nodes for debug://FIXME: write only property or indexed access/* Unwrap any invocation target exceptions and log them. ... */// No properties found/** MapAdapter adapters a java.util.Map type to an XML DOM with the following ... */map(...)EntryElement childnew EntryElement(...)/* we have two values *//** ProxyAttrAdapter is a pass-through adapter for objects which already ... */// convenience// Proxied Attr methodsattr(...)getSpecified(...)// DOM level 3// End Proxied Attr methods// end DOM level 3List<Node> adaptersnode(...)Node adapter// Proxied Element methodselement(...)hasAttributeNS(...)getAttributeNode(...)// I'm overriding this just for clarity.  The base impl is correct.getElementsByTagNameNS(...)// Unsupported mutators of Element// unsupported DOM level 3 methods// end proxied Element methods// end DOM level 3 methodsimport NamedNodeMap/** A NamedNodeMap that wraps the Nodes returned in their proxies. ... */NamedNodeMap nodes, ...;this.nodesgetNamedItemNS(...)/** ProxyNodeAdapter is a read-only delegating adapter for objects which already ... */proxyNamedNodeMap(...)// Proxied Node methods//}//  return ((ProxyNodeAdapter)child).node();//protected Node unwrap( Node child ) {//protected NodeList wrap( NodeList nl ) { }NamedNodeMap nnmhasChildNodes(...)getNamespaceURI(...)getPrefix(...)getLocalName(...)hasAttributes(...)// End proxied Node methods/* propname unused */// Is this ok?  What kind of features are they asking about?/** ProxyTextNodeAdapter is a pass-through adapter for objects which already ... */text(...)substringData(...)import Sourceimport URIResolverimport StreamSource/** ServletURIResolver is a URIResolver that can retrieve resources from the servlet context using the scheme "response". ... */String PROTOCOL, ...;ServletContext sc, ...;this.scString resnew TransformerException(...)new StreamSource(...)import CDATASectionimport Commentimport DOMConfigurationimport DOMImplementationimport DocumentFragmentimport DocumentTypeimport EntityReferenceimport ProcessingInstruction/** SimpleAdapterDocument adapted a Java object and presents it as ... */Element rootElement, ...;/** Lazily construct the root element adapter from the value object. */Node nodegetRootElement(...)new NodeList(...) { ... }// recreate the root elementList<Node> nodes, ...;SimpleNodeList.classgetStringValue(...)import StringReaderboolean parseStringAsXML, ...;getParseStringAsXML(...)new StringReader(...)new SimpleTextNode(...)/** When set to true the StringAdapter will interpret its String value ... */this.parseStringAsXML// Parse the String to a DOM, then proxy that as our child// Create a Text node as our childimport javax.xml.transform.*import DOMSourceimport StreamResult/** XSLTResult uses XSLT to transform an action object to XML. *//** Log instance for this result. *//** 'stylesheetLocation' parameter.  Points to the xsl. */Map<String,Templates> templatesCache, ...;/** Cache of all templates. */boolean noCache, ...;/** Determines whether or not the result should allow caching. */// Configurable ParametersString stylesheetLocation, ...;/** Indicates the location of the xsl template. */String matchingPattern, ...;/** Indicates the property name patterns which should be exposed to the xml. */String excludingPattern, ...;/** Indicates the property name patterns which should be excluded from the xml. */String exposedValue, ...;/** Indicates the ognl expression representing the bean which is to be exposed as xml. *//** Indicates the status to return in the response */setStylesheetLocation(...)StrutsConstants.STRUTS_XSLT_NOCACHEthis.noCachethis.stylesheetLocationthis.exposedValuegetStylesheetLocation(...)Templates templatesTransformer transformerString mimeTypeSource xmlSourcegetDOMSourceForStack(...)getTemplates(...)newTransformer(...)setURIResolver(...)getURIResolver(...)setErrorListener(...)buildErrorListener(...)getOutputProperties(...)OutputKeys.MEDIA_TYPEtransform(...)new StreamResult(...)new ErrorListener(...) { ... }new AdapterFactory(...)new ServletURIResolver(...)TransformerFactory factorynewTemplates(...)new DOMSource(...)adaptDocument(...)XSLTResult.classnew HashMap<String,Templates>(...)// Create a transformer for the stylesheet.// no stylesheet, raw xml// guess (this is a servlet, so text/html might be the best guess)// Transform the source XML to System.out.// ...and flush.../** Default constructor. */// from action's bundle// from default bundle// nonexistant/** Unit test for {@link ActionContext}. ... */String APPLICATION_KEY, ...;String PARAMETERS_KEY, ...;ActionContext context, ...;Map<String,Object> applicationActionContext.ACTION_NAMEActionContext threadContextString actionErrorMessageMap<String,Object> appMap<String,Object> mapsetContextMap(...)Map<String,Object> errors2ActionContext context2/** Simple Test ActionContext's ThreadLocal ... */import MockResultActionProxy baseActionProxyActionProxy commandActionProxySimpleAction.COMMAND_RETURN_CODEnew UnknownHandler(...) { ... }ActionSupport.classnew MockResult(...)UnknownHandlerManagerMock uhmnew UnknownHandlerManagerMock(...)DefaultActionProxy baseActionProxyaddUnknownHandler(...)setUnknownHandlerManager(...)SimpleAction.resultCalledHashMap<String,Object> paramsXmlConfigurationProvider configurationProvider// ensure we're using the default configuration, not simple config/** ActionNestingTest ... */String VALUE, ...;String NESTED_VALUE, ...;String NESTED_KEY, ...;String NAMESPACE, ...;String SIMPLE_ACTION_NAME, ...;String NO_STACK_ACTION_NAME, ...;String STACK_ACTION_NAME, ...;new NestedTestConfigurationProvider(...)PackageConfig packageContextaddResultConfig(...)SimpleAction.classMockResult.classAction.ERRORNestedAction.class/** Tells whether the ConfigurationProvider should reload its configuration ... *//** Unit test for {@link ActionSupport}. ... */ActionSupport as, ...;MyActionSupport mas, ...;new ActionSupport(...)new MyActionSupport(...)pause(...)input(...)List<String> errorsLocale defLocaleLocale.ITALYcheckGetTexts(...)MyActionSupport masList<> nullListString[] nullStringsString[] argsMyActionSupport.classResourceBundle rbString formattedgetFormatted(...)setVal(...)Double val, ...;this.val// success!// can not find a bundle// does not count as a error// will never return null, if no locale is set then default is returned// ActionContext will create a new context, when it was set to null before// no args in bundle// only 1 arg in bundle// to have code coverageimport Validations/** AnnotatedTestBean ... */Date birth, ...;//~ Instance fields //////////////////////////////////////////////////////////~ Constructors /////////////////////////////////////////////////////////////~ Methods ////////////////////////////////////////////////////////////////this.birthimport MockActionChainResult resultnew ActionChainResult(...)String expectedActionNameString expectedNamespaceMap<String,Object> valuesMock actionProxyMocknew Mock(...)ActionProxy.classActionProxyFactory testActionProxyFactorynew NamespaceActionNameTestActionProxyFactory(...)proxy(...)setActionName(...)expect(...)setActionProxyFactory(...)ActionContext testContextverify(...)ActionProxy returnVal, ...;String expectedActionName, ...;String expectedNamespace, ...;this.expectedNamespacethis.expectedActionNamethis.returnVal/* Created on 28/02/2004 ... *//** <code>CompositeTextProviderTest</code> ... */CompositeTextProvider textProvider, ...;assertFalse(...)// we should get the text from the 1st text provider// we should get the first resource bundle where 'car' and 'bike' has a i18n msgimport MockActionProxyimport MockContainerimport MockInterceptorimport MockLazyInterceptor/** A partial test of DefaultActionInvocation. ... *//** Tests interceptor chain invoke. ... */List<InterceptorMapping> interceptorMappingsMockInterceptor mockInterceptor1new MockInterceptor(...)MockInterceptor mockInterceptor2MockInterceptor mockInterceptor3DefaultActionInvocation defaultActionInvocationnew DefaultActionInvocationTester(...)setFoo(...)setExpectedFoo(...)defaultActionInvocation.stackDefaultActionInvocation actionInvocationDefaultActionInvocation serializablesetContainer(...)new MockContainer(...)actionInvocation.containerserializable.containerMockContainer mockContainerDefaultActionInvocation deserializabledeserializable.containerDefaultActionInvocation dainew DefaultActionInvocation(...) { ... }new StubValueStack(...)SimpleAction actionnew SimpleAction(...) { ... }MockActionProxy proxynew MockActionProxy(...)dai.proxydai.ognlUtilnew OgnlUtil(...)UnknownHandlerManager uhmnew DefaultUnknownHandlerManager(...) { ... }Throwable actualdai.unknownHandlerManagernew SimpleAction(...)ActionProxy actionProxygetBlah(...)MockActionProxy actionProxysetConfig(...)// given// when// thenimport MockActionInvocationimport StrutsInternalTestCaseDefaultActionProxy dapnew MockActionInvocation(...)/** <code>WildCardResultTest</code> ... *//** Unit test for {@link DefaultTextProvider}. ... */DefaultTextProvider tp, ...;List<Object> nullListLocale.CANADATextProviderSupportTest.classDefaultTextProviderTest.class// always returns nullFoo foo, ...;/* Created on Nov 11, 2003 ... *//** <code>GenericsBean</code> ... */List<Double> blubb, ...;List<Double> getterList, ...;Map<Double,Integer> genericMap, ...;Map<Double,List<Integer>> extendedMap, ...;this.blubbthis.genericMapnew ArrayList<Double>(...)this.extendedMapnew HashMap<Double,Integer>(...)new HashMap<Double,List<Integer>>(...)import MockConfigurationProvider/** LocaleAwareTest ... */MockConfigurationProvider.FOO_ACTION_NAMETextProvider localeAwareLocale.GERMANYnew MockConfigurationProvider(...)/** ModelDrivenAction ... */TestBean model, ...;new TestBean(...)/** ModelDrivenAnnotationAction ... */AnnotatedTestBean model, ...;new AnnotatedTestBean(...)/** NestedAction ... */String nestedProperty, ...;ActionNestingTest.KEYActionNestingTest.NESTED_VALUEActionNestingTest.NESTED_KEYActionNestingTest.VALUE// Action + DefaultTextProvider on the stack//DefaultTextProvider, NestedActionTest pushed on by the test, and the NestedAction/** Need by the ProxyInvocationTest *//** Contribed by: Ruben Inoto *//** Sets a ProxyObjectFactory as ObjectFactory (so the FooAction will always be retrieved ... */createDummyContext(...)/** Needed for the creation of the action proxy *//** ObjectFactory that returns a FooProxy in the buildBean if the clazz is FooAction *//** It returns an instance of the bean except if the class is FooAction. ... */ProxyInvocationAction.classnew ProxyInvocationProxy(...)/** Simple proxy that just invokes the method on the target on the invoke method *//** DOCUMENT ME! ... */String COMMAND_RETURN_CODE, ...;ArrayList<String> someList, ...;Properties settings, ...;String blah, ...;TestBean bean, ...;boolean throwException, ...;int bar, ...;int baz, ...;int foo, ...;long longFoo, ...;short shortFoo, ...;double percentage, ...;Map<Integer,String> indexedProps, ...;String aliasSource, ...;String aliasDest, ...;Map<String,String> protectedMap, ...;Map<String,String> existingMap, ...;List<TestBean> beanList, ...;boolean resultCalled, ...;this.existingMapthis.barthis.percentagethis.bazthis.blahthis.settingsthis.aliasDestthis.aliasSourcethis.someListthis.throwExceptionnew Result(...) { ... }new Exception(...)this.longFoothis.shortFoothis.beanList/** Simple Test Action for annotaton processing. ... *///~ Static fields/initializers /////////////////////////////////////////////AnnotatedTestBean bean, ...;ValidatorType.FIELDValidatorType.SIMPLEInteger id, ...;/** Stub value stack for testing */Map<String,Object> ctx, ...;/** TestBean ... */TestChildBean child, ...;this.childnew TestChildBean(...)/** TestBean */setBirth(...)/** TestInterceptor ... *//** Called after an Interceptor is created, but before any requests are processed using the intercept() methodName. This ... */import TestListenerAdapterimport TestNGTestListenerAdapter tlanew TestListenerAdapter(...)TestNG testngnew TestNG(...)setTestClasses(...)RunTest.classsetOutputDirectory(...)addListener(...)getPassedTests(...)getFailedTests(...)RunTest.ranRunTest.mgrboolean ran, ...;ConfigurationManager mgr, ...;String issueId, ...;this.issueId/** Unit test for {@link TextProviderSupport}. ... */TextProviderSupport tp, ...;ResourceBundle rb, ...;LocalizedTextProvider ltunew LocaleProvider(...) { ... }/* Utility class for testing DefaultUnknownHandlerManager, which does not allow to add ... */this.unknownHandlers/** <code>UserSpecifiedDefaultAction</code> ... *//** A sample action to test validation order. ... */String username, ...;String confirmPassword, ...;String city, ...;String province, ...;String country, ...;String postalCode, ...;String email, ...;String website, ...;String passwordHint, ...;this.citythis.confirmPasswordthis.countrythis.emailthis.passwordHintthis.postalCodethis.provincethis.usernamethis.websiteVoidResult.class// mo message so it returns nullimport Cimport XWorkTestCase/** ConfigurationManagerTest ... */Mock configProviderMock, ...;expectAndReturn(...)isA(...)C.ANY_ARGSmatchAndReturn(...)State statenew State(...)boolean isDestroyed1, ...;boolean isDestroyed2, ...;state.isDestroyed1state.isDestroyed2ConfigurationProvider mockProviderConfigurationProvider.class//import org.easymock.MockControl;// now check that it reloads// this will be called in teardown// now check that it doesn't try to reload//the first time it always initsimport SimpleActionHashMap<String,String> paramsRuntimeConfiguration configurationMap<String,String> pgetExpectedFoo(...)reload(...)Mock mockContainerProviderContainerProvider.classXmlConfigurationProvider providerMyPackageProvider.classboolean called, ...;// this is what we expected// check entityTest package// check inheritance from Default// check that it has configuration from xml// check that it has configuration from MockConfigurationProvider// to start from scratch// to build basic configuration// the order of providers must be changed as just first is checked if reload is needed/** ActionConfigTest */ActionConfig cfgSet<String> literalsAllowedMethods allowedMethodsPackageConfig cfg1PackageConfig cfg2PackageConfig childMap<String,ActionConfig> configMap, ...;// ----------------------------------------------------- Instance VariablesActionConfigMatcher matcher, ...;// ----------------------------------------------------- Setup and TeardownbuildActionConfigMap(...)// ---------------------------------------------------------- match()// ------------------------------------------------------- Individual TestsActionConfig matchedActionConfig mActionConfigMatcher matcherMap<String,ActionConfig> mapnew HashMap<String,ActionConfig>(...)addInterceptor(...)addExceptionMapping(...)// exact match// Missing last wildcard// Simple mappingNamespaceMatcher matchermatcher.compiledPatterns/** ConfigurationTestBase ... */XmlConfigurationProvider provString expectedValueSubstitutor substitutornew EnvsValueSubstitutor(...)String actual/** <code>InterceptorBuilderTest</code> ... *//** Try to test this ... */InterceptorStackConfig interceptorStackConfig1InterceptorConfig interceptorConfig1InterceptorConfig interceptorConfig2List<> interceptorMappingsnew LinkedHashMap<String,String>(...) { ... }MockInterceptor1.classgetParam1(...)getParam2(...)MockInterceptor2.classInterceptorStackConfig interceptorStackConfig2InterceptorStackConfig interceptorStackConfig3InterceptorStackConfig interceptorStackConfig4InterceptorStackConfig interceptorStackConfig5String param1, ...;String param2, ...;this.param1this.param2String paramOne, ...;String paramTwo, ...;this.paramOnethis.paramTwoimport ModelDrivenInterceptorimport StaticParametersInterceptor/** MockConfigurationProvider provides a simple configuration class without the need for xml files, etc. for simple testing. ... */String FOO_ACTION_NAME, ...;String MODEL_DRIVEN_PARAM_TEST, ...;String MODEL_DRIVEN_PARAM_FILTER_TEST, ...;String PARAM_INTERCEPTOR_ACTION_NAME, ...;String VALIDATION_ACTION_NAME, ...;String VALIDATION_ALIAS_NAME, ...;String VALIDATION_SUBPROPERTY_NAME, ...;String EXPRESSION_VALIDATION_ACTION, ...;Map<String,String> EMPTY_STRING_MAP, ...;Builder defaultPackageContextnew HashMap<String,ResultConfig>(...)Map<String,String> successParamsActionConfig fooActionConfigActionConfig paramInterceptorActionConfigActionConfig modelParamActionConfigModelDrivenAction.classActionConfig validationActionConfigActionConfig percentageActionConfigActionConfig barActionConfigActionConfig expressionValidationActionConfignew ParametersInterceptor(...)ModelDrivenInterceptor.class//List paramFilterInterceptor=new ArrayList();//paramFilterInterceptor.add(new ParameterFilterInterC)//ActionConfig modelParamFilterActionConfig = new ActionConfig(null, ModelDrivenAction.class, null, null, interceptors);//Explicitly set an out-of-range date for DateRangeValidatorTest// We need this actionconfig to be the final destination for action chaining/** Action with no public constructor taking no args. ... *//** Action with no public constructor. ... */// should be private, no constructorActionConfig actionConfig, ...;String actionMethodResult, ...;this.actionConfigthis.actionMethodResultimport TimerInterceptorConfigurationProvider providerbuildConfigurationProvider(...)ActionConfig barActionInterceptorConfig timerInterceptorConfigActionConfig fooActionActionConfig wildcardActionExceptionMappingConfig exceptionConfigActionConfig fooBarActionHashMap<String,String> interceptorParamsInterceptorConfig mockInterceptorConfigMockInterceptor.classActionConfig intActionActionConfig intOverActionPackageConfig pkgMap<> actionConfigsMockInterceptor.DEFAULT_FOO_VALUEString testDefaultClassNameActionConfig barWithPackageDefaultClassRefConfigActionConfig barWithoutClassNameConfig// setup expectations// bar action is very simple, just two params// foo action is a little more complex, two params, a result and an interceptor stack// wildcard action is simple wildcard example// fooBar action is a little more complex, two params, a result and an interceptor stack// TestInterceptorParam action tests that an interceptor worked// TestInterceptorParamOverride action tests that an interceptor with a param override worked// execute the configuration// assertions// it worked correctlyActionConfig actionString fooString userString homeString osString unknownString devMode/** User: Matthew E. Porter (matthew dot porter at metissian dot com) ... */HashMap<String,ResultConfig> resultsActionConfig expectedAction/** <code>XmlConfigurationProviderGlobalResultInheritenceTest</code> ... */ActionConfig parentActionConfigActionConfig anotherActionConfigActionConfig childActionConfigResultConfig parentResultConfig1ResultConfig parentResultConfig2ResultConfig anotherResultConfig1ResultConfig anotherResultConfig2ResultConfig childResultConfig1ResultConfig childResultConfig2import ContainerProviderDefaultConfiguration confXmlConfigurationProvider pDefaultFileManagerFactory factorynew DefaultFileManagerFactory(...)RuntimeConfiguration rtConfActionConfig actionOneActionConfig actionTwoList<InterceptorMapping> actionOneInterceptorsList<InterceptorMapping> actionTwoInterceptorsInterceptorMapping actionOneInterceptorMapping1InterceptorMapping actionOneInterceptorMapping2InterceptorMapping actionOneInterceptorMapping3InterceptorMapping actionTwoInterceptorMapping1InterceptorMapping actionTwoInterceptorMapping2InterceptorMapping actionTwoInterceptorMapping3setFileManager(...)new DefaultFileManager(...)setFileManagerFactory(...)new ArrayList<ContainerProvider>(...) { ... }getParamOne(...)getParamTwo(...)/** <code>XmlConfigurationProviderInterceptorStackParamOverridingTest</code> ... */List<> actionOneInterceptorsList<> actionTwoInterceptorsimport MutablePropertyValuesimport StaticApplicationContext/** Created by IntelliJ IDEA. ... */InterceptorConfig timerInterceptor, ...;StaticApplicationContext sac, ...;Map<> interceptorConfigsInterceptorConfig seenregisterSingleton(...)new MutablePropertyValues(...)new StaticApplicationContext(...)// Expect a ConfigurationException to be thrown if the interceptor reference// cannot be resolved// assertions for size// assertions for interceptors//SpringObjectFactory objFactory = new SpringObjectFactory();//objFactory.setApplicationContext(sac);//ObjectFactory.setObjectFactory(objFactory);import LoggingInterceptorInterceptorConfig loggingInterceptor, ...;InterceptorConfig mockInterceptor, ...;InterceptorConfig paramsInterceptorInterceptorStackConfig defaultStackInterceptorStackConfig derivativeStackArrayList<InterceptorMapping> interceptorsActionConfig actionWithOwnRefActionConfig actionWithDefaultRefActionConfig actionWithNoRefActionConfig anotherActionWithOwnRefRuntimeConfiguration runtimeConfigInterceptorStackConfig inheritedStackPackageConfig defaultPkgPackageConfig subPkgPackageConfig subSubPkgInterceptorStackConfig defaultStack2ActionConfig acActionConfig ac2// the test interceptor with a parameter// the default interceptor stack// the derivative interceptor stack// assertions for interceptor stacks// expectations - the inherited interceptor stack// default package// sub package// this should inherit/** XmlConfigurationProviderInvalidFileTest ... */// this is what we expect/** Verify that Interceptor inheritance is happy for multi-level package derivations ... *//** attempt to load an xwork.xml file that has multilevel levels of inheritance and verify that the interceptors are ... *//** for this test, we expect the action named, action3, in the namespace, namespace3, to have a single ... */PackageConfig expectedNamespacePackagePackageConfig expectedAbstractPackagePackageConfig expectedPackageConfigPackageConfig defaultPackagePackageConfig abstractPackagePackageConfig singlePackagePackageConfig multiplePackageList<PackageConfig> multipleParentsPackageConfig parentBelowList<PackageConfig> parentBelowParentsString hasDefaultClassRefPkgNameString noDefaultClassRefPkgNameString testDefaultClassRefPackageConfig expectedDefaultClassRefPackagePackageConfig expectedNoDefaultClassRefPackage// Expected// setup our expectations// test expectations/** Test XmlConfigurationProvider's <result-types> ... </result-types> ... */ConfigurationProvider configurationProviderMap<> resultTypesConfigMapResultTypeConfig result1ResultTypeConfigMap<> result1ParamsMapResultTypeConfig result2ResultTypeConfigMap<> result2ParamsMapMap<> actionConfigMapActionConfig action1ActionConfigActionConfig action2ActionConfigResultConfig action1ResultResultConfig action2ResultMap<> action1ResultMapMap<> action2ResultMapResultTypeConfig chainResultResultTypeConfig mockResultMap<> resultTypesgetDefaultResultType(...)Map<String,ResultConfig> resultConfigs// expectationsnew XmlConfigurationProvider(...) { ... }getDocuments(...)setObjectFactory(...)long FILE_TS_WAIT_IN_MS, ...;long origlong maxwaitlong currsetLastModified(...)changeFileTime(...)PackageConfig namespace1PackageConfig namespace2PackageConfig namespace4PackageConfig namespace5testProvider(...)String fullPathString jarString configFileSet<String> loadedFileNames// Revision exists and timestamp didn't changeUnknownHandlerManager unknownHandlerManagernew DefaultUnknownHandlerManager(...)PackageConfig defaultWildcardPackagePackageConfig defaultOnePackagePackageConfig defaultTwoPackageimport static EasyMock.*/** <code>XmlHelperTest</code> ... */Node mockNodecreateMock(...)Node.classNodeList mockNodeListNodeList.classElement mockElementandStubReturn(...)replay(...)Node mockNode1Node mockNode2Node mockNode3Node mockNode4Node mockNode5Node mockNode6Node.COMMENT_NODENodeList mockNodeList1Element mockParamElement1NodeList mockNodeList2Element mockParamElement2NodeList mockElementNodeListElement element// set up Node// set up NodeList// set up Element// <param name="param1">value1</param>// <param name="param2">value2</param>// <some_element>//   ...// </some_element>/** <code>ConversionTestAction</code> ... */String convertInt, ...;String convertDouble, ...;List<> users, ...;HashMap<> keyValues, ...;this.convertIntthis.convertDoublethis.usersthis.keyValuesimport AnnotationUserimport ModelDrivenAnnotationAction2import BarActionContext ac, ...;//    }//        assertSame(originalList,userList);//        assertEquals(paramList,userList);//        assertEquals(3,userList.size());//        List userList = user.getList();//        stack.setValue("list", param);//        stack.push(user);//        user.setList(originalList);//        AnnotationUser user = new AnnotationUser();//        originalList.add("mno");//        originalList.add("jkl");//        List originalList = new ArrayList();//        List paramList = Arrays.asList(param);//        String[] param = new String[] {"abc", "def", "ghi"};//        stackContext.put(XWorkConverter.REPORT_CONVERSION_ERRORS, Boolean.TRUE);//        stackContext.put(XWorkMethodAccessor.DENY_METHOD_EXECUTION, Boolean.TRUE);//        stackContext.put(InstantiatingNullHandler.CREATE_NULL_OBJECTS, Boolean.TRUE);//        Map stackContext = stack.getContext();//        ValueStack stack = ValueStackFactory.getFactory().createValueStack();//    public void testConversionToSetKeepsOriginalSetAndReplacesContents() {String[] valueDate sqlDateSimpleDateFormat formatString dateStrDate date2SimpleAnnotationAction actionnew SimpleAnnotationAction(...)Map<String,Object> ognlStackContextMap<> conversionErrorssetBean(...)OgnlRuntime.NoConversionPossibleModelDrivenAnnotationAction actionnew ModelDrivenAnnotationAction(...)ModelDrivenAnnotationAction2 actionnew ModelDrivenAnnotationAction2(...)Bar.classBar bgetSomethingElse(...)getTitle(...)String dateStringLong[] longsInteger[] intsDouble[] doublesFloat[] floatsBoolean[] booleansnew Long[]new Integer[]new Double[]new Float[]new Boolean[]long[] longsint[] intsdouble[] doublesfloat[] floatsboolean[] booleansnew long[]new double[]new float[]Set<String> list// TODO: Fixme... This test does not work with GenericsObjectDeterminer!Map<String,Object> stackContextAnnotationUser usernew AnnotationUser(...)getList(...)Bar barnew FooBarConverter(...)Bar1 barBar1.classnew Foo1(...)GenericsBean gbnew GenericsBean(...)getDoubles(...)getGenericMap(...)getGetterList(...)// FIXME: Implement nested Generics such as: List of Generics List, Map of Generic keys/values, etc...getExtendedMap(...)new Bar1Impl(...)// the converter needs to be registered as the Bar.class converter// it won't be detected from the Foo-conversion.properties// because the Foo-conversion.properties file is only used when converting a property of Fooimport AnnotatedCatimport CatString valueStrint locString titleString restnew Bar(...)setSomethingElse(...)Cat catnew Cat(...)AnnotatedCat.classAnnotatedCat catnew AnnotatedCat(...)StringBuilder r/* public void testInheritance() { ... */import SimpleFooActionNumberConverter converternew NumberConverter(...)SimpleFooAction foonew SimpleFooAction(...)/** <code>ParentClass</code> ... */NestedEnum TEST, ...;NestedEnum TEST2, ...;NestedEnum TEST3, ...;new NestedEnum(...)NestedEnum value, ...;StringConverter converternew StringConverter(...)import Person/** Test case for XWorkBasicConverter ... */XWorkBasicConverter basicConverter, ...;// object -> return null when empty string is passed// primitive -> conversion error when empty string is passed// take into account of empty string// TODO: test for every possible conversionObject convertedObjectString referencecompareDates(...)Calendar cal1Calendar.MONTHCalendar.JANUARYObject[] objobj.length/* the code below has been disabled as it causes sideffects in Strtus2 (XW-512) ... */NumberConverter numberConverterFloat valueParentClass.NestedEnum.classParentClass.NestedEnum.TESTParentClass.NestedEnumPerson onew Person[]Class<> toType// we must not get XWorkException as that will caused a conversion error// we MUST get this exception as this is a conversion errorimport ModelDrivenAction2import Userimport Fooimport FurColorimport TimestampOgnlValueStack stack, ...;//        User user = new User();SimpleDateFormat formattTime datetnew Time(...)String datetStrDate date3Timestamp tsTime time1Date dateWithTimeDate dateRfc3339Date dateRfc3339DateOnlyModelDrivenAction actionnew ModelDrivenAction(...)Object resModelDrivenAction2 actionnew ModelDrivenAction2(...)setContextClassLoader(...)new ClassLoader(...) { ... }new Enumeration<URL>(...) { ... }Double.MIN_VALUEFloat.MIN_VALUEFurColor.BLACKFurColor.class// Testing for null result on non-primitive Number types supplied as empty String or Class<> clazz2Collection<String> namesassertSame(...)new Timestamp(...)new Foo(...)getNumber(...)getFoo(...)String[] col1Object convertednew ListAction(...)List<Integer> ints, ...;this.intsnew ArrayList<Integer>(...)// see XW-341// us date format is used in context// and test a date that is passable// us date format// the converter needs to be registered as the Bar.class converter // WRONG: locale separator is wrongly placed// WRONG: locale separator is wrongly placed // only supports string values// Ognl converter will default to true/** ContainerImpl Tester. ... */Container c, ...;ContainerBuilder cb/** Inject values into field */FieldCheck fieldChecknew FieldCheck(...)DependencyException expected/** Inject values into method */MethodCheck methodChecknew MethodCheck(...)/** Inject values into field under SecurityManager */setSecurityManager(...)new SecurityManager(...)/** Inject values into method under SecurityManager */// that was expected// not needed, already set//System.setSecurityManager(new SecurityManager());/** AliasInterceptorTest ... */SimpleAction actionOnesetAliasSource(...)setBar(...)getAliasSource(...)getAliasDest(...)Action actionMockActionInvocation maiMockActionProxy mapAliasInterceptor ainew AliasInterceptor(...)setProxy(...)setInvocationContext(...)setAliasesKey(...)/** Unit test for {@link ChainingInterceptor}. ... */ChainingInterceptor interceptor, ...;Mock mockInvocation, ...;SimpleAction action1SimpleAction action2setCopyErrors(...)setCopyMessages(...)TestBean beanTestBeanAction actionnew TestBeanAction(...)getBirth(...)getCount(...)String excludessetExcludes(...)getExcludes(...)ActionInvocation.classnew ChainingInterceptor(...)// we should not get NPE, but instead get a warning logged.import TestResult/** Unit test for {@link ChainingInterceptor} with a configuration provider. */String CHAINED_ACTION, ...;String CHAINTO_ACTION, ...;SimpleAction chainedActionsetBlah(...)HashMap<> successParams1HashMap<> successParams2InterceptorConfig chainingInterceptorConfigsingletonList(...)TestResult.class/** Unit test for {@link ConversionErrorInterceptor}. ... */ConversionErrorInterceptor interceptor, ...;Map<String,Object> conversionErrors, ...;ActionSupport action/** See WW-3668 ... */setStack(...)new ConversionErrorInterceptor(...)PreResultListener.class// This fails!// assume that the original value is resetimport EasyMockimport IAnswer/** Unit test for {@link DefaultWorkflowInterceptor}. ... */DefaultWorkflowInterceptor interceptor, ...;Action action, ...;setExcludeMethods(...)setIncludeMethods(...)createNiceMock(...)ValidateAction.classnew DefaultWorkflowInterceptor(...)anyTimes(...)andReturn(...)andAnswer(...)new IAnswer<String>(...) { ... }/** Unit test for ExceptionMappingInterceptor. ... */ExceptionMappingInterceptor interceptor, ...;Mock actionAction.classExceptionHolder holdersetUpWithExceptionMappings(...)expectAndThrow(...)getExceptionStack(...)new ValidationException(...)setupWithoutExceptionMappings(...)setLogEnabled(...)setLogCategory(...)setLogLevel(...)getLogLevel(...)getLogCategory(...)Mock actionProxynew ExceptionMappingInterceptor(...)// is on top of the root// to invoke the method for unit test// successHashSet<String> includedHashSet<String> excluded// test expected behavior// test precedenceimport ConstraintMatcherMock mockActionInvocation, ...;ModelDrivenInterceptor modelDrivenInterceptor, ...;Object model, ...;PreResultListener preResultListener, ...;Object topOfStacknew ConstraintMatcher(...) { ... }setRefreshModelBeforeResult(...)new ModelDrivenInterceptor(...)// nothing should happen// any object will do/** Unit test for {@link ParameterFilterInterceptor}. ... */ParameterFilterInterceptor interceptor, ...;Map<String,Object> contextMap, ...;new ParameterFilterInterceptor(...)runFilterTest(...)setAllowed(...)setBlocked(...)setDefaultBlock(...)setUpParameters(...)runAction(...)new SampleAction(...)ParameterRemoverInterceptor interceptornew ParameterRemoverInterceptor(...)setParamNames(...)setParamValues(...)import SecurityMemberAccess/** Unit test for {@link ParametersInterceptor}. ... */ParametersInterceptor picreateParametersInterceptor(...)Map<String,Object> actualinjectValueStackFactory(...)createStubValueStack(...)Map<String,Object> expectednew HashMap<String,Object>(...) { ... }Object anew ParameterNameAware(...) { ... }ValidateAction actionnew ValidateAction(...)String msg1getActionMessage(...)String msg2String msg3String pollution1String pollution2Map<String,Boolean> excludednew HashMap<String,Boolean>(...)new ParametersInterceptor(...) { ... }String pollution3MockConfigurationProvider.MODEL_DRIVEN_PARAM_TESTString fooValString nameValTestBean modelMockConfigurationProvider.PARAM_INTERCEPTOR_ACTION_NAMEHashMap<String,Object> sessionString pollution4String pollution5String pollution6boolean allowMethodAccessgetAllowStaticMethodAccess(...)getMemberAccess(...)Map<String,String> existingMapgetTheProtectedMap(...)ParametersInterceptor parametersInterceptordoTestParameterNameLengthRestriction(...)ParametersInterceptor.PARAM_NAME_MAX_LENGTHsetParamNameMaxLength(...)setValueStackFactory(...)createValueStackFactory(...)setExcludeParams(...)setAcceptParamNames(...)getBaz(...)/** This test demonstrates a vulnerability which allows to execute arbitrary code. ... */File pwnboolean dirExistsboolean deletedgetTheExistingMap(...)String actionMessagesingletonMap(...)ParametersInterceptor interceptornew NoParametersAction(...)isOrdered(...)setOrdered(...)injectValueStack(...)getBeanList(...)OgnlValueStackFactory factorynew OgnlValueStackFactory(...) { ... }new OgnlValueStack(...) { ... }/* public void testIndexedParameters() throws Exception { ... */List<String> messages, ...;//then// is not ordered// should be ordered so user.name should be first/** PreResultListenerTest ... */Mock preResultListenerMock1args(...)eq(...)CountPreResultListener listener1new CountPreResultListener(...)CountPreResultListener listener2getMyOrder(...)SimpleFooAction.class/** Tells whether the ConfigurationProvider should reload its configuration */Integer myOrder, ...;/** Test case for PrefixMethodInovcationUtil. ... */// === capitalizeMethodName ===// === getPrefixMethod ===new Action1(...)PrefixMethodInvocationUtilTest.Action1// === invokePrefixMethod === Action1 actionActionProxy mockActionProxyActionInvocation mockActionInvocationaction.prepareSaveInvokedaction.prepareDoSaveInvokedaction.prepareSubmitInvokedaction.prepareDoCancelInvoked/** Just a simple object for testing method invocation on its methods. ... */boolean prepareSaveInvoked, ...;boolean prepareDoSaveInvoked, ...;boolean prepareSubmitInvoked, ...;boolean prepareDoCancelInvoked, ...;// save// submit// cancel// ActionProxy// ActionInvocation/** Unit test for PrepareInterceptor. ... */Mock mock, ...;PrepareInterceptor interceptor, ...;ActionInterface mockAction, ...;MockActionProxy mockActionProxysetAlwaysInvokePrepare(...)setFirstCallPrepareDo(...)PrepareInterceptor interceptornew PrepareInterceptor(...)prepareSubmit(...)times(...)expectLastCall(...)IllegalAccessException illegalAccessExceptionnew IllegalAccessException(...)matchAndThrow(...)ActionInterface.class/** Simple interface to test prefix action invocation ... */import EquidaeScopedModelDrivenInterceptor inter, ...;/** Set up instance variables required by this test case. */new ScopedModelDrivenInterceptor(...)new ProxyObjectFactory(...)ScopedModelDriven<> actionnew MyUserScopedModelDrivenAction(...)getScopeKey(...)new MyEquidaeScopedModelDrivenAction(...)setClassName(...)User model, ...;Equidae model, ...;// no scope key as nothing happended// nothing happends/** Unit test of {@link StaticParametersInterceptor}. ... */StaticParametersInterceptor interceptor, ...;Mock mockParameterizable.classint beforesetMerge(...)getMyAge(...)user.agegetMyEmail(...)user.emailnew StaticParametersInterceptor(...)/** Unit test for {@link TimerInterceptor}. ... */MyTimerInterceptor interceptor, ...;MockActionInvocation mai, ...;MockActionProxy ap, ...;TimerInterceptor realnew TimerInterceptor(...)interceptor.messagenew MyTimerInterceptor(...)this.logger// no default logging at trace level// no default logging at debug levelString actionResult, ...;ValidateErrorAction actionValidateErrorAction.classActionContext contexanyObject(...)/** Test ValidationInterceptor's prefix method invocation capabilities. ... */ValidateAction action, ...;ValidationInterceptor interceptorString job, ...;this.jobString m1, ...;String m2, ...;import StubValueStack/** Only "name" should remain in the parameter map.  All others ... */Map<String,Object> parameterMapnew BlockingByDefaultAction(...)Mock mockInvocationAnnotationParameterFilterInterceptor interceptornew AnnotationParameterFilterInterceptor(...)/** "name" should be removed from the map, as it is blocked. ... */new AllowingByDefaultAction(...)new BlockingByDefaultModel(...)new AllowingByDefaultModel(...)String ANNOTATED_ACTION, ...;String SHORTCIRCUITED_ACTION, ...;AnnotationWorkflowInterceptor annotationWorkflow, ...;AnnotatedAction actionaction.logShortcircuitedAction actionAnnotatedAction.classShortcircuitedAction.classnew AnnotationWorkflowInterceptor(...)String log, ...;import ChainingInterceptorString dogNameOwner ownernew Owner(...)Map<> propsOwner.classnew NullHandler(...) { ... }String gettergetDog(...)Object expr0Object expr2setEnableExpressionCache(...)EmailAction actionnew EmailAction(...)Map<String,Object> propsaction.emailFoo foo1Foo foo2Calendar.FEBRUARYsetNumber(...)setPoints(...)setBirthday(...)setUseful(...)getPoints(...)getBirthday(...)isUseful(...)List<String> excludesBar b1Bar b2List<String> includesCalendar.MAYFoo foogetBar(...)TestObject testObjectnew TestObject(...)getALong(...)/** Test that type conversion is performed on indexed collection properties. */String[] fooLocale.UKCalendar.OCTOBERCalendar.HOUR_OF_DAYCalendar.MINUTECalendar.SECONDgetEvent(...)Calendar.SEPTEMBERgetMeeting(...)Calendar.DECEMBERgetCalendar(...)getPoints(...).lengthChainingInterceptor fooChainingInterceptor foo2OgnlContext contextSimpleNode expressionObject result2setIncludesCollection(...)getIncludes(...)setALong(...)Object topMap<> beansMyWriteBar barnew MyWriteBar(...)/** XW-281 */Map<> stackContextsetDevMode(...)Exception expectedNoSuchPropertyException.classOgnlException.classInappropriateExpressionException.classRuntime.classMethodFailedException.classInteger myIntegerProperty, ...;Long myLongProperty, ...;String myStrProperty, ...;this.myIntegerPropertythis.myLongPropertythis.myStrPropertyList<> email, ...;new OgnlList(...)Email.classint id, ...;// these values should remain unchanged in foo2// these values should be changed/copied// includes properties got copied// id properties did not//this used to fail in OGNL versions < 2.7//expected// indexed string w/ existing array// US style test//UK style test//test RFC 3339 date format for JSON//test setting a calendar property// top should be root// not found// just do some of the 15 tests// it's okeimport TestBean2/** Unit test for OgnlValueStack. */OgnlValueStack stacksetAllowStaticMethodAccess(...)Map<> expr1OgnlValueStack vsMap<> expr2Dog dognew Dog(...)setAge(...)setChildAges(...)testValuesFromContextAreConverted(...)String propertyValuetestNullValueFromContextGetsConverted(...)BarJunior barjrnew BarJunior(...)setBarJunior(...)setThrowException(...)setHates(...)setDeity(...)/** Allow access Enums without enabling access to static methods */getStrings(...)TestBean2 tb2new TestBean2(...)Map<> myContextgetCat(...)String outputFoo foo3Foo fooAFoo fooBFoo fooCsetChild(...)setRelatives(...)new Foo[]String a_keyString a_valueString b_keyString b_valueDog dog1Dog dog2BadJavaBean beannew BadJavaBean(...)ByteArrayOutputStream baosObjectOutputStream oosnew ObjectOutputStream(...)ByteArrayInputStream baisnew ByteArrayInputStream(...)ObjectInputStream oisnew ObjectInputStream(...)OgnlValueStack newVsDog dgetChild(...)getCats(...)int origSizegetCatMap(...)isMale(...)BigDecimal.ROUND_HALF_DOWNOgnlValueStack stack2setDefaultType(...)Map<> overridesMyAction actionnew MyAction(...)int count2, ...;this.count2Address address, ...;Country country, ...;String iso, ...;String displayName, ...;this.isothis.displayNameMyNumbers ONE, ...;MyNumbers TWO, ...;MyNumbers THREE, ...;new MyNumbers(...)//ok//this shuld not fail as the property is defined on a parent class//if a value is not found, then it will check for missing properties//it needs to check in all objects in the stack, not only actions, see WW-3306// register converter// expect String to be converted into a Cat// findValue should be able to access the name// children foo->foo->foo// relatives// the bar// now place the bar all over//assertEquals(new Boolean(false), vs.findValue("'Rover'.endsWith('Jack')"));//assertEquals(new Boolean(false), vs.findValue("'Rover'.endsWith(name)"));//assertEquals("RoverJack", vs.findValue("[1].name + name"));//hates will be null//this used to fail in OGNl versdion < 2.7// expected// how to test the warning was logged?// should log warning// if country is null, OGNL throws an exception/* action.setAddress(new Address()); ... */SecurityMemberAccess smaboolean accessible// Set up XWorkFooBar target, ...;new FooBar(...)FooBar.classSet<Class<?>> excludedBarInterface.classFooBarInterface.classSet<Pattern> excludedboolean actualSet<String> excludedMember valuesMyValues.classMember methodStaticTester.classClassLoader.classSystem.classSet<Pattern> patternsString setterMemberAccess.classString stringField, ...;int intField, ...;Double doubleField, ...;this.stringFieldthis.intFieldthis.doubleFieldMyValues ONE, ...;MyValues TWO, ...;MyValues THREE, ...;new MyValues(...)import FooBarConverterimport MockObjectTypeDeterminerHashMap<> propsXWorkConverter cHashSet<> sdoTestAddingToListsWithObjects(...)String spielnameObject setCatnew MockObjectTypeDeterminer(...)setMoreCats(...)IndexOutOfBoundsException egetMoreCats(...)doTestAddingToMapsWithObjects(...)getAnotherCatMap(...)setAnotherCatMap(...)doTestAddingAndModifyingCollectionWithObjects(...)Bar bar1Bar bar2String bar1TitleString bar2TitleString bar3TitleString bar4TitlesetBarCollection(...)Object aBarCollBar nextMockObjectTypeDeterminer determinerCollection<> barCollObject barsetShouldCreateIfNew(...)/* Created on 6/10/2003 *///now try to set a lower number//to test setting after a higher one//has been created//try modifying bar1 and bar2//check the logs here to make sure//the Map is being created//now test adding to a collection//now test where there is no permissionimport ListHolderListHolder listHoldernew ListHolder(...)getLongs(...)List<> myListsetStrings(...)/* Copyright (c) 2005 Opensymphony. All Rights Reserved. */new MapHolder(...)Map<> map, ...;this.mapList<String> paramsAcceptedPatternsChecker checkernew DefaultAcceptedPatternsChecker(...)IsAccepted actualDefaultExcludedPatternsChecker checkernew DefaultExcludedPatternsChecker(...)IsExcluded actualList<String> prefixesList<String> innersList<String> suffixesString innerString innerUpList<String> properParamsExcludedPatternsChecker checkerString properParamList<String> tokens/** Test loading actions from the Spring Application Context. ... */(...).appContextAction expectedSimpleAction saSpringResult springResultisInitialize(...)getStringParameter(...)TestAspect aspectStateTestSubBean chaintoAOPedActionaspectState.loggetIssueId(...)getCount2(...)/* Created on Jun 12, 2004 */// If the action is a singleton, this test will fail// And if the advice is not being applied, this will be SUCCESS.// check if AOP works// chainedAction.actionMethodName sets name then chainedAction.getCount sets count// then chaintoAction.setCount sets count2 then chainedAction.getName sets name again// then chaintoAction.actionMethodName sets issueId of the aspect object.// check if chain worksString thing, ...;int value, ...;this.thing/* Created on Nov 12, 2003 */import MethodInterceptorimport MethodInvocationproceed(...)Bar bar, ...;/* Created on Nov 11, 2003 */import ExpressionValidatorimport Advisedimport BeanNameAutoProxyCreatorimport DebugInterceptor// TODO: Document properlySpringObjectFactory objectFactory, ...;setAlwaysRespectAutowireStrategy(...)InterceptorConfig iConfigResultConfig rConfigRequiredStringValidator.classregisterPrototype(...)Foo.classisApplicationContextSet(...)boolean applicationContextSet, ...;SimpleAction simpleActiongetAutowireStrategy(...)SpringObjectFactory factoryConstructorBean beanConstructorBean.classSetterByTypeBean beanSetterByTypeBean.classSetterByNameBean beanSetterByNameBean.classgetActionBean(...)ConstructorAction.classConstructorAction actionMutablePropertyValues valuesDebugInterceptor.classaddPropertyValue(...)BeanNameAutoProxyCreator.classrefresh(...)SimpleAction action, ...;/* Created on Mar 8, 2004 */// TODO: Does this need to be a prototype?// Empty constructor/** Test various utility methods dealing with spring proxies. */Object simpleActionObject proxiedActionObject autoProxiedActionObject pointcuttedTestBeanObject pointcuttedTestSubBeanObject testAspectClass<?> simpleActionUltimateTargetClassClass<?> proxiedActionUltimateTargetClassClass<?> autoProxiedActionUltimateTargetClassClass<?> pointcuttedTestBeanUltimateTargetClassClass<?> pointcuttedTestSubBeanUltimateTargetClassClass<?> testAspectUltimateTargetClassTestBean.classTestSubBean.classTestAspect.classboolean initialize, ...;String stringParameter, ...;//  this String should be populated by springthis.initializethis.stringParameter// this method should be called by spring// intetionally emptyboolean exposeProxy, ...;this.exposeProxyimport StaticWebApplicationContextStaticWebApplicationContext contextnew StaticWebApplicationContext(...)new TestActionInvocation(...)ActionAutowiringInterceptor interceptornew ActionAutowiringInterceptor(...)loadSpringApplicationContextIntoApplication(...)XmlConfigurationProvider cStaticWebApplicationContext appContextApplicationContext loadedContextMap<Object,Object> application/* Created on 6/11/2004 */// If an exception is thrown here, things are going to go wrong in// productionimport Validation/** Implemented by SimpleAction3 and AnnotationTestBean2 to test class hierarchy traversal. ... *//** Used to test hierarchy traversal for interfaces. ... */import AnnotatedTestBean/** Extend TestBean to test class hierarchy traversal. ... */Cat cat, ...;this.cat/** Test bean. ... */Collection<> collection, ...;String email2, ...;this.collection/** Marker interface to help test hierarchy traversal. ... *//** Implemented by SimpleAction3 and TestBean2 to test class hierarchy traversal. ... */String cow, ...;String donkey, ...;String horse, ...;this.cowthis.donkeythis.horseimport ModelDrivenAction/** Extend ModelDrivenAction to test class hierarchy traversal. ... */TestBean2 model, ...;import ModelDrivenAnnotationActionAnnotationTestBean2 model, ...;new AnnotationTestBean2(...)/** SimpleAction2 ... *//** Extend SimpleAction to test class hierarchy traversal. ... */import SimpleAnnotationActionimport TestBeanList<String> list, ...;String line1, ...;String line2, ...;this.line1this.line2decodeAddress(...)Address addressgetCountry(...)getCity(...)getLine2(...)getLine1(...)String[] partsnew Address(...)setLine1(...)setLine2(...)setCity(...)setCountry(...)List<Person> users, ...;List<Address> address, ...;List<> addressesNoGenericElementAnnotation, ...;this.addressesNoGenericElementAnnotationPersonAction actionnew PersonAction(...)getUsers(...)Object personPerson.classgetFirstName(...)getLastName(...)getAddress(...)Object addressgetAddressesNoGenericElementAnnotation(...)decodePerson(...)setFirstName(...)setLastName(...)/** <code>ValidateAnnotatedMethodOnlyAction</code> ... */// do search// do different search/** Extends ModelDrivenAction to return a null model. ... */String SCIENTIFIC_NAME, ...;List<> kittens, ...;this.kittensimport Dummy2Classimport DummyClassimport MyAnnotationMyAnnotation a1findAnnotation(...)DummyClass.classMyAnnotation.classMyAnnotation nsDummy2Class.classint somethingElse, ...;this.somethingElseIterator<URL> iClassLoaderUtilTest.classClassLoaderUtil.AggregateIterator<String>AggregateIterator<String> aggrnew AggregateIterator<String>(...)Enumeration<String> en1new Enumeration<String>(...) { ... }Iterator<String> itt, ...;Enumeration<String> en2ClassPathFinder finderVector<String> foundClassPathFinder finder2Vector<String> found2ClassPathFinder finder3Vector<String> found3ClassPathFinder finder4Vector<String> found4import URLConnectionimport URLStreamHandlerimport URLStreamHandlerFactory/** FileManager Tester. ... */testLoadFile(...)DefaultFileManagerTest.classInputStream fileURL outputURLCat hates, ...;...[] childAges, ...;boolean male, ...;String deity, ...;this.childAgesthis.hatesthis.maleDog.deity/** a method which is safe to call with a null argument ... *//** Test cases for {@link DomHelper}. */String xml, ...;Date event, ...;Date meeting, ...;Foo child, ...;List<> cats, ...;List<> moreCats, ...;List<> strings, ...;Collection<> barCollection, ...;Map<> catMap, ...;Map<> anotherCatMap, ...;...[] points, ...;...[] relatives, ...;boolean useful, ...;int number, ...;long aLong, ...;Calendar calendar, ...;BarJunior barJunior, ...;this.barJuniorthis.aLongthis.catMapthis.catsthis.numberthis.anotherCatMapthis.moreCatsthis.barCollectionthis.pointsthis.relativesthis.stringsthis.usefulthis.eventthis.meetingthis.calendarFurColor BROWN, ...;FurColor BLACK, ...;FurColor GREEN, ...;new FurColor(...)doGetCollectionPropertiesTest(...)/* Created on Jan 23, 2006 ... */...[] values, ...;Map<String,Object> map, ...;/** User: patrick Date: Dec 20, 2005 Time: 11:15:29 AM */List<Long> longs, ...;List<String> strings, ...;List<Date> dates, ...;this.longsthis.dates/** <code>MyBean</code> ... *//** <code>MyBeanAction</code> ... */List<> beanList, ...;Map<> beanMap, ...;this.beanMap/** <code>MyBeanActionTest</code> ... */MyBean.classMyBeanAction actionimport CompiledPatternimport static Assert.*NamedVariablePatternMatcher matchernew NamedVariablePatternMatcher(...)CompiledPattern patternDog dog, ...;this.dogResolverUtil<ObjectFactory> resolvernew ResolverUtil<ObjectFactory>(...)Set<Class<? extends ObjectFactory>> implsgetClasses(...)findImplementations(...)ResolverUtil<> resolvernew ResolverUtil<>(...)Set<URL> implsfindNamedResource(...)/** Unit test for {@link StrutsLocalizedTextProvider}. ... */MyObject.classnew MyObject(...)Mock mockActionInvocationBar testBean2, ...;this.testBean2TestBean2 beansetBarObj(...)String foundBean2ModelDriven<> actionModelDrivenAction2.classString usDateString germanDateString text2StrutsLocalizedTextProviderTest.classString text3String text4String text5ResourceBundle rbFranceLocale.FRANCEResourceBundle rbItalyResourceBundle rbGermany// should not log// should log WARN// This tests will try to load bundles from the 3 locales but we only have files for France and Germany.// Before this fix loading the bundle for Germany failed since Italy have previously failed and thus the misses cache// contained a false entry/** Unit test of {@link TextParseUtil}. ... */ParsedValueEvaluator evaluatornew Object(...) { ... }Object sObject s2// this is bad, but it is the only way not to double evaluate passed expression// just a quick test to see if the open char works// most test are done the methods above// if this starts passing, probably an double evaluation expression vulnerability was introduced// carefully review changes as this can affect users and allows break in intrudersList<> dogs, ...;this.dogsimport UnknownHandlerManagerMockimport ConfigurationTestBaseimport SomeUnknownHandler/** Test UnknownHandlerUtil */List<UnknownHandler> unknownHandlersgetUnknownHandlers(...)UnknownHandler uh1UnknownHandler uh2SomeUnknownHandler uh1new SomeUnknownHandler(...)SomeUnknownHandler uh2setActionMethodResult(...)//should pick the first one//should pick the second one//should not pick any/** Keep these test on a separate class, they can't be in UrlUtilTest because the ... */URL jarUrlassertUrlCanBeOpened(...)WildcardHelper wildint[] patternPattern pcompileWildcardPattern(...)/** Test cases for {@link XWorkList}. ... */XWorkList xworkListArrayList<String[]> addListnew ArrayList<String[]>(...)// trim// take 2, no trim// take 3, insert/* $Id: package-info.java 655902 2008-05-13 15:15:12Z bpontarelli $ ... */new DummyContainer(...)new DummyFileManager(...)DefaultFileManagerFactoryTest.fileManagerimport DocumentBuilderimport DocumentBuilderFactoryAttributesImpl attrsnew Locator(...) { ... }getDoc(...)Element rootElement kidDocumentBuilderFactory factoryDocumentBuilder buildernewDocumentBuilder(...)LocationAttributesTest.class/* Copyright 2006,2009 The Apache Software Foundation. ... */import ByteArrayInputStreamString str, ...;Location loc1Location loc2/** Test that Location.UNKNOWN is kept identical on deserialization */ByteArrayOutputStream bosByteArrayInputStream bisgetSnippet(...)ProfilingTimerBean bean0ProfilingTimerBean bean1ProfilingTimerBean bean2ProfilingTimerBean bean3ProfilingTimerBean bean4ProfilingTimerBean bean5ProfilingTimerBean bean6ProfilingTimerBean bean7ProfilingTimerBean bean8bean0.childrenbean1.childrenbean2.childrenbean3.childrenbean4.childrenbean5.childrenbean6.childrenbean7.childrenbean8.childrenbean0.totalTime/* bean0 ... */// bean0// bean1// bean2// bean3// bean4// bean5// bean6// bean7// bean8String activateProp, ...;String minTimeProp, ...;ProfilingTimerBean beanUtilTimerStack.currentbean.startTimebean.totalTimeMockProfilingBlock<String> blocknew MockProfilingBlock<String>(...) { ... }profile(...)getProfilingTimerBean(...)getProfilingTimerBean(...).totalTimenew UtilTimerStack.ProfilingBlock<String>(...) { ... }UtilTimerStack.ProfilingBlock<String>UtilTimerStack.ACTIVATE_PROPERTYUtilTimerStack.MIN_TIMEUtilTimerStack.ProfilingBlock<T>ProfilingTimerBean bean, ...;performProfiling(...)/** A test case for ActionValidatorManager. ... */RequiredStringValidator referenceNumberRequiredStringValidatorRequiredFieldValidator orderRequiredValidatorRequiredFieldValidator.classRequiredFieldValidator customerRequiredValidatorVisitorFieldValidator customerVisitorValidatorRequiredStringValidator customerNameRequiredStringValidatorRequiredFieldValidator customerAgeRequiredValidatorRequiredFieldValidator customerAddressRequiredFieldValidatorVisitorFieldValidator customerAddressVisitorFieldValidatorRequiredStringValidator customerAddressStreetRequiredFieldValidatorRequiredStringValidator customerAddressStreetRequiredFieldValidator2RequiredStringValidator customerAddressPoboxRequiredFieldValidatorRequiredStringValidator customerAddressPoboxRequiredFieldValidator2List<Validator<>> validatorsForMockActionnew ArrayList<Validator<>>(...) { ... }List<Validator<>> validatorsForCustomerList<Validator<>> validatorsForAddressDefaultActionValidatorManager validatorManagernew DefaultActionValidatorManager(...) { ... }MockAction actionsetAppendPrefix(...)setActionValidatorManager(...)String referenceNumber, ...;Integer order, ...;Customer customer, ...;this.referenceNumberthis.orderthis.customernew Customer(...)String street, ...;String pobox, ...;this.streetthis.pobox/* MockAction.class */// reference number// order// customer/* Customer.class */// customer -> name// customer -> age// customer -> Address//customerAddressVisitorFieldValidator.setDefaultMessage("");/* Address.class */// customer -> Address -> street// customer -> Address -> poboximport AnnotationDataAware2import SimpleAnnotationAction2import SimpleAnnotationAction3import DoubleRangeFieldValidatorimport URLValidator/** AnnotationActionValidatorManagerTest ... */String alias, ...;AnnotationActionValidatorManager annotationActionValidatorManager, ...;TextProviderFactory tpf, ...;SimpleAnnotationAction.classList<> validatorListAnnotatedTestBean.classAnnotatedTestBean beanValidatorContext contextnew DummyValidatorContext(...)List<String> lValidationException exAnnotationDataAware2.classFieldValidator dataValidator1FieldValidator dataValidator2FieldValidator blingValidatorSimpleAnnotationAction3.classFieldValidator vFieldValidator v1FieldValidator vdoubleFieldValidator v2FieldValidator v3Validator<> v4Validator<> v5Validator<> v6Validator<> v7Validator<> v8FieldValidator v9FieldValidator v10FieldValidator v11FieldValidator v12FieldValidator v13FieldValidator v14FieldValidator v15FieldValidator v16FieldValidator v17List<> validatorList2SimpleAnnotationAction2.classAnnotationUser.classsetEmail(...)setEmail2(...)// 17 in the class level + 0 in the alias// TODO: add alias tests//disable configuration reload/devmode//17 in the class level + 0 in the alias//expect same number of validators// 1 in interface hierarchy, 2 from parent interface (1 default + 1 context)// 17 in the class hierarchy + 1 in the interface + 1 in interface alias// action-level validator comes first// both expression test failed see AnnotationUser-validation.xml// so we could concentrate on testing the field-level validators (AnnotationUser-validation.xml)// * make both email the same to pass the action-level validator at // AnnotationUserMarker-validation.xml// because email-field-val is short-circuit// we only get one, because AnnotationUserMarker-validation.xml action-level validatorimport ConditionalVisitorFieldValidatorimport ConversionErrorFieldValidatorimport CreditCardValidatorimport CustomValidatorimport LongRangeFieldValidatorimport ShortRangeFieldValidatorimport ValidationParameter/** Sets up all available validation annotations */import DefaultActionInvocation/** Simple test to check if validation Annotations match given validator class */AnnotationActionValidatorManager managercreateValidationManager(...)AnnotationValidationAction.classAnnotationValidationExpAction.classnew AnnotationValidationExpAction(...)getValidatorType(...)validateRegexValidator(...)validateConditionalFieldVisitorValidator(...)validateConversionFieldErrorVisitorValidator(...)validateMyValidator(...)validateDateRangeFieldValidator(...)validateDoubleRangeFieldValidator(...)validateEmailValidator(...)validateCreditCardValidator(...)validateExpressionValidator(...)validateFieldExpressionValidator(...)validateIntRangeFieldValidator(...)validateLongRangeFieldValidator(...)validateRequiredFieldValidator(...)validateRequiredStringValidator(...)validateShortRangeFieldValidator(...)validateStringLengthFieldValidator(...)validateUrlValidator(...)validateVisitorFieldValidator(...)getExpression(...)EmailValidator.EMAIL_ADDRESS_PATTERNCreditCardValidator.CREDIT_CARD_PATTERNisRepopulateField(...)new AnnotationActionValidatorManager(...)ValidatorFactory vfregisterValidator(...)MyValidator.class// ActionContext is destroyed during rebuilding configuration/** Sets up all available validation annotations with params as expressions *//** ConversionErrorFieldValidatorTest ... */String defaultFooMessage, ...;ConversionErrorFieldValidator validator, ...;DelegatingValidatorContext validatorContextnew ConversionErrorFieldValidator(...)/** DateRangeValidatorTest ... *//** Tests whether the date range validation is working. Should produce an validation error, ... */Calendar dateMockConfigurationProvider.VALIDATION_ACTION_NAMEList<String> errorMessagesCalendar.NOVEMBERDateRangeFieldValidator valnew DateRangeFieldValidator(...)Date maxDate minsetMax(...)setMin(...)import DataAware2import SimpleAction2import SimpleAction3/** DefaultActionValidatorManagerTest ... */DefaultActionValidatorManager actionValidatorManager, ...;Mock mockValidatorFileParser, ...;Mock mockValidatorFactory, ...;ValueStack stubValueStack, ...;new DefaultActionValidatorManager(...)setValidatorFileParser(...)setValidatorFactory(...)C.IS_NOT_NULLboolean passXWorkException exDataAware2.classSimpleAction3.classSimpleAction2.class/** Test to verify WW-3850. ... */// for this test we need to have a file manager with reloadingConfigs to true// no validator found, but no check on file since it is not in cache// this second call will try reload a not existing file// and causes a NPE (see WW-3850)/* // TODO: this all need to be converted to real unit tests ... *//** <code>DefaultValidatorFactoryTest</code> ... */Mock mockValidatorFileParserDefaultValidatorFactory factorynew DefaultValidatorFactory(...)import com.opensymphony.xwork2.validator.validators.*String testFileName, ...;String testFileName2, ...;String testFileName3, ...;String testFileName4, ...;String testFileName5, ...;String testFileName6, ...;String testFileNameFail, ...;ValidatorFileParser parser, ...;List<> configsValidatorConfig valCfg0ValidatorConfig valCfg1IntRangeFieldValidator.classList<> validatorConfigsgetMessageParams(...).lengthnew DefaultValidatorFileParser(...)/** Unit test for {@link DoubleRangeFieldValidator}. ... */DoubleRangeFieldValidator val, ...;MyTestProduct prodnew MyTestProduct(...)setPrice(...)setMinInclusive(...)setMaxInclusive(...)setVolume(...)DelegatingValidatorContext contextsetMaxExclusive(...)setMinExclusive(...)MockConfigurationProvider.EXPRESSION_VALIDATION_ACTIONnew ActionSupport(...) { ... }setMinInclusiveExpression(...)setMaxInclusiveExpression(...)setMinExclusiveExpression(...)setMaxExclusiveExpression(...)MyTestProduct objectDummyValidatorContext contextsetDoubleArray(...)setDoubleCollection(...)new DoubleRangeFieldValidator(...)double price, ...;Double volume, ...;...[] doubleArray, ...;Collection<Double> doubleCollection, ...;this.pricethis.volumethis.doubleArraythis.doubleCollection//Explicitly set an out-of-range double for DoubleRangeValidatorTest// should pass// should not pass// should pass as null value passed in/** Dummy validator context to use to capture error messages. ... *//** Get the field specific errors. ... *//** Add an Action level message to this Action *//** Note that this does not have the same meaning as in WW 1.x ... *//** Test case for Email Validator ... */verifyEmailValidity(...)verifyEmailValidityWithExpression(...)EmailValidator validatornew EmailValidator(...)setRegexExpression(...)verifyCaseSensitive(...)setCaseSensitiveExpression(...)verifyTrim(...)setTrimExpression(...)/** Unit test for ExpressionValidator. ... */List<> nameErrorsCollection<> errorsExpressionValidator evnew ExpressionValidator(...)setExpression(...)ValidationAware.class//make it not fail// {top} will evaluate to Hello that is not a BooleanMap<> errorsList<> errorMessages/** ModelDrivenValidationTest ... */boolean shortcircuit, ...;this.shortcircuit// passMyTestPerson testPersonnew MyTestPerson(...)RegexFieldValidator validatornew RegexFieldValidator(...)setUsername(...)setTrim(...)List<String> msgssetFriends(...)setCars(...)...[] friends, ...;List<> cars, ...;this.cars// must end with one whitespace// should contain 1 error message// when failing the validator will not add action errors/msgimport RepopulateConversionErrorFieldValidatorSupport/** Test RepopulateConversionErrorFieldValidatorSupport. ... */InternalRepopulateConversionErrorFieldValidatorSupport validator1, ...;InternalRepopulateConversionErrorFieldValidatorSupport validator2, ...;ActionSupport action, ...;Object valueFromStack1Object valueFromStack2setRepopulateField(...)Object valueFromStackMockActionInvocation invocationString[] conversionErrorValuenew InternalRepopulateConversionErrorFieldValidatorSupport(...)new DelegatingValidatorContext(...) { ... }// === inner class ============boolean doValidateGetsCalled, ...;import ValidatorSupportValidationAware validationAwareList<String> bazErrorsList<String> barErrorsMockConfigurationProvider.VALIDATION_ALIAS_NAMEList<String> fooErrorsnew ValidatorSupport(...) { ... }String messageKeyCollection<String> errorsMockConfigurationProvider.VALIDATION_SUBPROPERTY_NAMEList<String> beanCountErrors//valid values// put in an out-of-range value to see if the old validators still work// should cause a message// this should cause a messageInternalActionSupport action, ...;StringLengthFieldValidator validator, ...;setMyField(...)getMyField(...)setStringCollection(...)setMinLengthValue(...)setMinLengthExpression(...)setMaxLengthValue(...)setMaxLengthExpression(...)setTrimValue(...)new InternalActionSupport(...)new StringLengthFieldValidator(...)setMaxLength(...)setMinLength(...)String myField, ...;boolean trimValue, ...;int minLengthValue, ...;int maxLengthValue, ...;...[] strings, ...;Collection<String> stringCollection, ...;this.myFieldthis.trimValuethis.minLengthValuethis.maxLengthValuethis.stringCollectionEquidae equidaenew Equidae(...)setHorse(...)List<> errorssetCow(...)setDonkey(...)RequiredStringValidator valnew RequiredStringValidator(...)// everything should fail// trim = false should fail// cow// donkey/** Test case for URLValidator ... */ActionContext actionContext, ...;URLValidator validatornew URLValidator(...)getUrlRegex(...)setUrlRegex(...)setUrlRegexExpression(...)isValid(...)Map<String,Object> fieldErrorsnew URLValidator(...) { ... }//return "http://yahoo.com/";/** Unit test for annotated Validators. ... */XmlConfigurationProvider provider1XmlConfigurationProvider provider2/** VisitorFieldValidatorModelTest ... */VisitorValidatorModelAction action, ...;new VisitorValidatorModelAction(...)Map<String,List<String>> fieldErrorsList<String> nameMessagesString nameMessageTestBean origBeanList<String> dataMessagesString dataMessage// the required string validation inherited from the VisitorValidatorTestAction// the bean validation which is now at the top level because we set the appendPrefix to false// should also have picked up validation check for DataAware interface/** VisitorFieldValidatorTest ... */VisitorValidatorTestAction action, ...;VisitorValidatorTestAction.classTestBean[] beanArraygetTestBeanArray(...)TestBean testBeanList<String> beanCountMessagesString beanCountMessageList<> testBeanListgetTestBeanList(...)//4 errors for the array, one for context//the error from the action should be there too//4 for the list, 1 for context//add conversion error//nested visitor conversion error/** VisitorValidatorModelAction ... *//** VisitorValidatorTestAction ... */List<TestBean> testBeanList, ...;...[] testBeanArray, ...;new TestBean[]this.testBeanArraythis.testBeanListnew ArrayList<TestBean>(...)import VisitorValidatorTestActionimport AppendingValidatorContextString FIRST_NAME, ...;String SECOND_NAME, ...;String FIELD_NAME, ...;String FULL_FIELD_NAME, ...;VisitorFieldValidator.AppendingValidatorContext validatorContext, ...;ValidatorContext vc1AppendingValidatorContext vc2import DummyValidatorContextCreditCardValidator validator, ...;CreditCardAction action, ...;ValidatorContext context, ...;setAmericanExpress(...)setAmericanExpresses(...)setDinerClubs(...)setDinersClub(...)setJCB(...)setMasterCard(...)setVisa(...)new CreditCardValidator(...)new CreditCardAction(...)String americanExpress, ...;String dinersClub, ...;String JCB, ...;String masterCard, ...;String visa, ...;...[] americanExpresses, ...;List<String> dinerClubs, ...;this.americanExpressthis.dinersClubthis.JCBthis.masterCardthis.visathis.americanExpressesthis.dinerClubsValidationAction actionprepareAction(...)createDate(...)DateRangeFieldValidator validatorprepareValidator(...)Calendar.MARCHCalendar.APRILnew ValidationAction(...)setDateMinValue(...)setDateMaxValue(...)setDateRange(...)setMaxExpression(...)setMinExpression(...)IntRangeFieldValidator validatorsetInts(...)setIntMaxValue(...)setIntMinValue(...)setIntRange(...)new IntRangeFieldValidator(...)LongRangeFieldValidator validatorsetLongMaxValue(...)setLongMinValue(...)setLongRange(...)new LongRangeFieldValidator(...)RequiredFieldValidator rfvsetShorts(...)new ArrayList<Short>(...)RequiredStringValidator validatorsetStringValue(...)ShortRangeFieldValidator validatorsetShortMaxValue(...)setShortMinValue(...)setShortRange(...)new ShortRangeFieldValidator(...)Integer intRange, ...;Integer intMinValue, ...;Integer intMaxValue, ...;...[] ints, ...;Short shortRange, ...;Short shortMinValue, ...;Short shortMaxValue, ...;List<Short> shorts, ...;Long longRange, ...;Long longMinValue, ...;Long longMaxValue, ...;Date dateRange, ...;Date dateMinValue, ...;Date dateMaxValue, ...;String dateFormat, ...;String stringValue, ...;this.intRangethis.intMinValuethis.intMaxValuethis.shortRangethis.shortMinValuethis.shortMaxValuethis.longRangethis.longMinValuethis.longMaxValuethis.dateRangethis.dateMinValuethis.dateMaxValuethis.dateFormatthis.stringValuethis.shortsValueStack oldStackValidatorSupport validatorString result1/** Test class instantiation with Container */ActionMapper instancenew HashMap<String,String>(...) { ... }// You cannot use CompositeActionMapper without defined list of "struts.mapper.composite"/** ExecutionCountTestAction */int executionCount, ...;ExecutionCountTestAction.classHttpServletRequest requestMock, ...;parseIfModifiedSince(...)HttpServletRequest.class/** <code>RequestUtilsTest</code> */import MockHttpServletRequestimport MockHttpServletResponseimport MockServletContext/** Unit test for ServletActionContext. Based loosly on Jason's ActionContextTest. ... */ServletActionContext servletActionContext, ...;MockServletContext servletContext, ...;Map<> extraContextnew MockHttpServletRequest(...)new MockHttpServletResponse(...)new MockServletContext(...)SomeEnum INIT, ...;SomeEnum COMPLETED, ...;new SomeEnum(...)import StrutsTestCaseHelperimport StrutsMockServletContextimport java.util.logging.*/** Base test case for JUnit testing Struts. */StrutsMockServletContext servletContext, ...;/** Sets up the configuration settings, XWork configuration, and ... */new StrutsMockServletContext(...)/** Init Dispatcher with provided comma delimited list of xml configs to use, ie: ... */ConsoleHandler handlernew ConsoleHandler(...)Formatter formatternew Formatter(...) { ... }getLevel(...)getMillis(...)formatMessage(...)Logger loggersetFormatter(...)getHandlers(...).lengthgetHandlers(...)removeHandler(...)addHandler(...)setLevel(...)// maybe someone else already destroyed Dispatcherimport ValidatorTypeCollection<> collection2, ...;Integer fooInt, ...;...[] array, ...;...[] list, ...;List<> list2, ...;List<> list3, ...;SomeEnum status, ...;Float floatNumber, ...;Map<String,String> texts, ...;/** Define a text resource within this action that will be returned by the getText methods ... */this.texts/** Returns the test value if defined otherwise delegates to the default TextProvider *//** This is the method invoked by the {@link org.apache.struts2.util.TextProviderHelper}. ... */this.arraythis.list2this.list3this.collection2this.fooIntthis.floatNumberSomeEnum.COMPLETEDboolean _isExecuted, ...;import ServletDispatcherResultimport TokenInterceptorimport TokenSessionStoreInterceptorimport DoubleValidationAction/** TestConfigurationProvider provides a simple configuration class without the need for xml files, etc. for simple testing. */String TEST_ACTION_NAME, ...;String EXECUTION_COUNT_ACTION_NAME, ...;String TOKEN_ACTION_NAME, ...;String TOKEN_SESSION_ACTION_NAME, ...;String TEST_NAMESPACE, ...;String TEST_NAMESPACE_ACTION, ...;/** Initializes the configuration object. */HashMap<> successParamsActionConfig executionCountActionConfignew ValidationInterceptor(...)ActionConfig doubleValidationActionConfigDoubleValidationAction.classActionConfig testActionConfigTestAction.classActionConfig tokenActionConfignew TokenInterceptor(...)ActionConfig tokenSessionActionConfignew TokenSessionStoreInterceptor(...)PackageConfig defaultPackageConfigTestActionTagResult.classPackageConfig namespacePackageConfigPackageConfig testActionWithNamespacePackageConfig// empty results for token session unit test/** TestResult */List<> expectedValues, ...;List<> propertyNames, ...;String expectedValue/** Utility methods for test classes *//** normalizes a string so that strings generated on different platforms can be compared.  any group of one or more ... */readContent(...)/** Attempt to verify the contents of text against the contents of the URL specified. Performs a ... */String writerStringString bufferStringint nbytes/** compare the trimmed values of each buffer and make sure they're equivalent.  however, let's make sure to ... */MockHttpServletRequest reqMockHttpServletResponse resMock mockValueStackValueStack.classHashMap<> ctxActionComponent compgetMultipleValues(...).lengthimport AbstractTagTestimport TestConfigurationProviderboolean exceptionCaughtsetupGetServletPath(...)TestConfigurationProvider.TEST_NAMESPACETestConfigurationProvider.TEST_ACTION_NAMEimport TagSupportimport BeanTagimport ElseIfTagimport ElseTagimport I18nTagimport IfTagimport IteratorTagimport PropertyTagimport PushTagimport SetTagimport TextTagimport URLTagimport AppendIteratorTagimport MergeIteratorTagimport TextFieldTagimport UpDownSelectTag/** Test case for method findAncestor(Class) in Component and some commons ... */Property propertyActionComponent actionComponentAnchor anchorForm form2// AppendInterator/* public void testActionComponentDisposeItselfFromComponentStack() throws Exception { ... */// Action ComponentTextFieldTag tnew TextFieldTag(...)AppendIteratorTag tagnew AppendIteratorTag(...)setPageContext(...)doStartTag(...)// BeanBeanTag tagnew BeanTag(...)// ElseIfElseIfTag tagnew ElseIfTag(...)// ElseElseTag tagnew ElseTag(...)// IfIfTag tagnew IfTag(...)// IteratorIteratorTag tagnew IteratorTag(...)int endItdoAfterBody(...)TagSupport.EVAL_BODY_AGAIN// MergeIteratorMergeIteratorTag tagnew MergeIteratorTag(...)// PropertyPropertyTag tagnew PropertyTag(...)// PushPushTag tagnew PushTag(...)// SetSetTag tagnew SetTag(...)// TextTextTag tagnew TextTag(...)I18nTag tagnew I18nTag(...)// URLURLTag tagnew URLTag(...)// updownselectUpDownSelectTag tagnew UpDownSelectTag(...)// component stack// property// form// anchor// form2// textFieldimport DefaultActionMapperimport TestActionimport AbstractUITagTest/** <code>FormTest</code> */ValidationInterceptor validationInterceptor, ...;checkValidateAnnotatedMethodOnly(...)List<> vsetValidateAnnotatedMethodOnly(...)Object validatorMap<String,ActionConfig> defaultNamespacesetAllowDynamicMethodCalls(...)StringWriter outIteratorComponent icProperty propString bodynew FooAction(...)new FooAction(...) { ... }List<> items, ...;assertPropertyOutput(...)String bar, ...;FooBar fooBarTextField txtFldUIBean beannew UIBean(...) { ... }import ActionErrorTagimport ActionMessageTagimport AnchorTagimport CheckboxTagimport ComboBoxTagimport DoubleSelectTagimport FieldErrorTagimport FileTagimport FormTagimport HiddenTagimport LabelTagimport OptionTransferSelectTagimport PasswordTagimport RadioTagimport SelectTagimport SubmitTagimport TextareaTagimport TokenTag/** Test case common for all UI component in general. */// actionErrorActionMessageTag tnew ActionMessageTag(...)ActionErrorTag tagnew ActionErrorTag(...)// actionMessageActionErrorTag tActionMessageTag tag//   AnchorAnchorTag tagnew AnchorTag(...)CheckboxTag tagnew CheckboxTag(...)// comboboxComboBoxTag tagnew ComboBoxTag(...)// doubleselectDoubleSelectTag tagnew DoubleSelectTag(...)// fieldErrorFieldErrorTag tagnew FieldErrorTag(...)// fileFileTag tagnew FileTag(...)new TestConfigurationProvider(...)FormTag tagnew FormTag(...)// hiddenHiddenTag tagnew HiddenTag(...)// labelLabelTag tagnew LabelTag(...)// optiontransferselectOptionTransferSelectTag tagnew OptionTransferSelectTag(...)// passwordPasswordTag tagnew PasswordTag(...)// radioRadioTag tagnew RadioTag(...)SelectTag tagnew SelectTag(...)SubmitTag tagnew SubmitTag(...)TextareaTag tagnew TextareaTag(...)// textfieldTextFieldTag tag// tokenTokenTag tagnew TokenTag(...)/** Test case for BaseTemplateEngine */URL dummyResourceUrlFile dummyResourceFileString themePropertiesDirTemplateEngine templateEnginenew InnerBaseTemplateEngine(...)Map<> propertiesMapString themePropertiesFileName, ...;this.themePropertiesFileNameJspTemplateEngine jspTemplateEnginenew JspTemplateEngine(...)jspTemplateEngine.encoding/** Unit test for {@link SettingsTest}. */PropertiesConfigurationProvider provgetLanguage(...)Object encoding/* $Id: SettingsTest.java 651946 2008-04-27 13:41:38Z apetrelli $ ... */Settings settingsgetKeyCount(...)new TestSettings(...)String keyNameIterator<> keyNames/** TestSettings *//** Get a named setting. ... *//** List setting names */List<> testListimport StrutsUploadedFileimport static Assertions.assertThatClass<> target, ...;File tempFile, ...;UploadedFileConverter ufcnew UploadedFileConverter(...)UploadedFile uploadedFileisInstanceOf(...)assertThat(...)isEqualTo(...)UploadedFile[] uploadedFileDefaultStaticContentLoader filterDispatchernew DefaultStaticContentLoader(...)List<String> result1List<String> result2List<String> result3List<String> result4/** Test case for Dispatcher. */HttpServletRequest wrappedDispatcherListenerState statenew DispatcherListenerState(...)addDispatcherListener(...)new DispatcherListener(...) { ... }state.isDestroyedstate.isInitializedInternalConfigurationManager configurationManagernew InternalConfigurationManager(...)new MockDispatcher(...)configurationManager.destroyConfigurationInnerDestroyableObjectFactory destroyedObjectFactorynew InnerDestroyableObjectFactory(...)ConfigurationManager cmMock mockConfigurationMock mockContainerString reloadConfigsdestroyedObjectFactory.destroyedMock mockInterceptorInterceptor.classInterceptorStackConfig iscMap<String,PackageConfig> packageConfigsnew ObjectFactory(...)boolean destroyConfiguration, ...;boolean isInitialized, ...;boolean isDestroyed, ...;boolean destroyed, ...;// some i18n messages from xwork-messages.properties// some i18n messages from struts-messages.properties/** ActionMapper for testing FilterDispatcher (used in FilterDispaatcherTest) */ActionMapping _actionMapping, ...;import DataProviderString PARAM_NAME, ...;new Object[][]Request requestTestAction testActionimport Constraintimport IsAnythingimport IsEqualMock requestMock, ...;Mock sessionMock, ...;List<String> attributeNamesEnumeration<> attributeNamesEnumMockSessionMap sessionMapnew MockSessionMap(...)new Constraint[]new IsEqual(...)SessionMap<> sessionMapnew IsAnything(...)MockHttpServletRequest requestSessionMap<Object,Object> sessionMapnew SessionMap<Object,Object>(...)Object someOtherKeyObject originalValueHttpSession.class/** class that extends session map, making the values available in a local map -- useful ... *///put the value into our map after putting it in the superclass map to avoid polluting the get call.DefaultStaticContentLoader contentLoader, ...;MockHttpServletRequest req, ...;MockHttpServletResponse res, ...;StaticContentLoader contentLoaderDefaultStaticContentLoader contentLoadersetServeStaticContent(...)getContentAsString(...)getStatus(...)MockServletContext servletContextMock hostConfigMockHostConfig.classthis.contentLoadersetEncoding(...)/* $Id: ServletDispatchedTestAssertInterceptor.java 651946 2008-04-27 13:41:38Z apetrelli $ ... */Mock mockContainer, ...;ActionMapper mapper1new InnerActionMapper1(...)ActionMapper mapper2new InnerActionMapper2(...)ActionMapper mapper3new InnerActionMapper3(...)CompositeActionMapper compositeActionMappernew CompositeActionMapper(...)InnerActionMapper3.actionMappingInnerActionMapper3.uriActionMapping actionMapping, ...;import StrutsMockHttpServletRequest/** DefaultActionMapper test case. */ConfigurationManager configManager, ...;PackageConfig pkg2setupGetParameterMap(...)setupGetContextPath(...)new ConfigurationManager(...) { ... }DefaultActionMapper mappernew DefaultActionMapper(...)setupGetRequestURI(...)setupGetAttribute(...)addExpectedGetAttributeName(...)PackageConfig pkg3setAlwaysSelectFullNamespace(...)StrutsMockHttpServletRequest requestnew StrutsMockHttpServletRequest(...)DefaultActionMapper defaultActionMapperDefaultActionMapper.METHOD_PREFIXsetParameterMap(...)setExtensions(...)// =============================// === test name & namespace ===// ===========================// === test special prefix ===DefaultActionMapper.ACTION_PREFIXsetAllowActionPrefix(...)setAllowActionCrossNamespaceAccess(...)StrutsResultSupport resultaddParameterAction(...)mapper.extensionsmapper.defaultActionNamemapper.defaultMethodNameRestful2ActionMapper mapper, ...;new Restful2ActionMapper(...)setupGetMethod(...)setIdParameterName(...)setupAddParameter(...)Restful2ActionMapper.HTTP_METHOD_PARAM/** Unit test for {@link RestfulActionMapper}. */RestfulActionMapper mapper, ...;ActionMapping amMap<String,Object> paramnew RestfulActionMapper(...)import StrutsPrepareAndExecuteFilterimport MockFilterChainimport MockFilterConfig/** Integration tests for the filter */MockHttpServletResponse responseMockFilterConfig filterConfignew MockFilterConfig(...)MockFilterChain filterChainnew MockFilterChain(...) { ... }StrutsPrepareAndExecuteFilter filternew StrutsPrepareAndExecuteFilter(...)setRequestURI(...)MockFilterChain filterChain2new StrutsPrepareAndExecuteFilter(...) { ... }//simulate a FORWARDimport StrutsExecuteFilterimport StrutsPrepareFilterimport org.springframework.mock.web.*StrutsExecuteFilter filterExecute, ...;StrutsPrepareFilter filterPrepare, ...;Filter failFilter, ...;Filter stringFilter, ...;new StrutsPrepareFilter(...)new StrutsExecuteFilter(...)new Filter(...) { ... }Filter middleLinkedList<Filter> filterListnew LinkedList<Filter>(...)Filter nextremoveFirst(...)ServletException eFilter filterStrutsResultFactory builderResultConfig configMyResult.classinitDispatcherWithConfigs(...)getAccept(...)getReject(...)ResultFactory actualString reject, ...;this.reject/** Unit test for ChecboxInterceptor. */CheckboxInterceptor interceptor, ...;MockActionInvocation ai, ...;Map<String,Object> param, ...;new CheckboxInterceptor(...)setUncheckedValue(...)// should be 3 as __checkbox_ should be removed// should be 2 as __checkbox_ should be removed// should be 4 as __checkbox_ should be removed// will use false as default and not 'no'/** Test case for ClearSessionInterceptor. */Mock httpServletRequestMockClearSessionInterceptor interceptornew ClearSessionInterceptor(...)MockActionWithCookieAware actionnew MockActionWithCookieAware(...)CookieInterceptor interceptornew CookieInterceptor(...)setCookies(...)setExcludedPatternsChecker(...)setAcceptedPatternsChecker(...)getCookiesMap(...)getCookie1(...)getCookie2(...)getCookie3(...)setCookiesName(...)setCookiesValue(...)Map<String,Boolean> excludedNamenew CookieInterceptor(...) { ... }DefaultExcludedPatternsChecker excludedPatternsCheckerString sessionCookieNameString sessionCookieValueString appCookieNameString appCookieValueString reqCookieNameString reqCookieValueMap<> cookies, ...;String cookie1, ...;String cookie2, ...;String cookie3, ...;this.cookiesthis.cookie1this.cookie2this.cookie3Collections.EMPTY_MAP// by default the interceptor doesn't accept any cookiesCookieProviderInterceptor interceptornew CookieProviderInterceptor(...)CookieProvider actionnew CookieProvider(...) { ... }new HashSet<Cookie>(...)HttpServletResponse.classimport InvokeOnceMatcher/** Test case for CreateSessionInterceptor. */CreateSessionInterceptor interceptornew CreateSessionInterceptor(...)with(...)method(...)expects(...)new InvokeOnceMatcher(...)/** Unit test for DateTextFieldInterceptor. */DateTextFieldInterceptor interceptor, ...;new DateTextFieldInterceptor(...)/** Used by ExecuteAndWaitInterceptorTest. */import StrutsMockHttpSession/** Test case for ExecuteAndWaitInterceptor. */StrutsMockHttpServletRequest request, ...;HttpSession httpSession, ...;Map<> params, ...;ExecuteAndWaitInterceptor waitInterceptor, ...;ParametersInterceptor parametersInterceptor, ...;buildProxy(...)ActionProxy proxy2String result2setDelay(...)setDelaySleepInterval(...)ActionProxy proxy3String result3long beforelong afterlong before2long after2long diffnew WaitConfigurationProvider(...)new StrutsMockHttpSession(...)PackageConfig waitExecuteAndWaitDelayAction.classExecuteAndWaitInterceptor.WAITnew ExecuteAndWaitInterceptor(...)// just takes a little longer to find out job is done// interceptorsimport DefaultLocaleProviderimport JakartaMultiPartRequest/** Test case for FileUploadInterceptor. */UploadedFile EMPTY_FILE, ...;FileUploadInterceptor interceptor, ...;File tempDir, ...;TestAction action, ...;ValidationAwareSupport validationboolean notOksetAllowedTypes(...)setAllowedExtensions(...)FileUploadInterceptor interceptornew FileUploadInterceptor(...)FileUploadInterceptorTest.classsetMaximumSize(...)MyFileupAction actionnew MyFileupAction(...)setResultCode(...)MyFileupAction.classcreateMultipartRequest(...)setContent(...)String contentString[] fileContentTypesString[] fileRealFilenamesfileContentTypes.lengthfileRealFilenames.length/** tests whether with multiple files sent with the same name, the ones with forbiddenTypes (see ... */String htmlContentString plainContentString bondaryString endlineStringBuilder contentencodeTextFile(...)Locale.GERMANJakartaMultiPartRequest jaknew JakartaMultiPartRequest(...)setMaxSize(...)new TestAction(...)new UploadedFile(...) { ... }// when allowed type is empty// when file is of allowed types// when file is not of allowed types// when file is of allowed extensions// when file is not of allowed extensions//test with multiple extensions// the error message should contain at least this test// if no multipart request it will bypass and execute it// not a multipart contentype// there is no content// inspired by the unit tests for jakarta commons fileupload// set German locale// no methodsimport IArgumentMatcherI18nInterceptor interceptor, ...;ActionInvocation mai, ...;I18nInterceptor.DEFAULT_PARAMETERI18nInterceptor.DEFAULT_SESSION_ATTRIBUTELocale denmarkI18nInterceptor.DEFAULT_REQUEST_ONLY_PARAMETERLocale variantgetVariant(...)Locale.CANADA_FRENCHLocale[] localesnew Locale[]Locale.CHINAsetAttributeName(...)setParameterName(...)Locale locale1Locale.TRADITIONAL_CHINESEI18nInterceptor.DEFAULT_COOKIE_ATTRIBUTEI18nInterceptor.DEFAULT_COOKIE_PARAMETEReqCookie(...)setLocaleStorage(...)I18nInterceptor.Storage.COOKIEI18nInterceptor.StorageMap<String,Serializable> paramsnew HashMap<String,Serializable>(...)Map<String,Object> ctxnew Action(...) { ... }new I18nInterceptor(...)setLocaleProviderFactory(...)new DefaultLocaleProviderFactory(...)Cookie expected, ...;reportMatcher(...)new CookieMatcher(...)// bad locale that would get us default locale instead// should have been removed// should be stored here// should create a locale object// should not be stored here// should not create a locale object/** Test case for MessageStoreInterceptor. ... */createNiceControl(...)setResponse(...)MessageStoreInterceptor interceptornew MessageStoreInterceptor(...)HttpSession mockedSessioncreateControl(...)HttpServletRequest mockedRequestsetAllowRequestParameterSwitch(...)setOperationMode(...)once(...)Map<> sessionMapList<> actionErrorsList<> actionMessagesList<> field1ErrorsList<> field2ErrorsMessageStoreInterceptor.RETRIEVE_MODEMap<> paramMapString operationModeMessageStoreInterceptor.NONE// Mock (ActionInvocation)HttpServletResponse mockedResponseMessageStoreInterceptor msiMessageStorePreResultListener listener/** Unit test for MultiselectInterceptor. */MultiselectInterceptor interceptor, ...;new MultiselectInterceptor(...)/* $Id: MessageStoreInterceptorTest.java 651946 2008-04-27 13:41:38Z apetrelli $ ... */// should be 3 as __multiselect_ should be removed// should be 4 as __multiselect_ should be removedRolesInterceptor interceptor, ...;new RolesInterceptor(...)new MockHttpServletRequest(...) { ... }setAllowedRoles(...)setDisallowedRoles(...)setExpectedError(...)response.SC_FORBIDDENRolesInterceptor roleCheckInterceptornew RolesInterceptor(...) { ... }List<String> validRoles, ...;//has to be a user//and not a guest//allow all//expected  //expected;/** Unit test for {@link ServletConfigInterceptor}. */ServletConfigInterceptor interceptor, ...;ServletRequestAware mockServletRequestAware.classServletResponseAware mockServletResponseAware.classParameterAware mockParameterAware.classHttpParameters paramHttpParametersAware mockHttpParametersAware.classSessionAware mockSessionAware.classApplicationAware mockApplicationAware.classPrincipalAware mockPrincipalAware.classMockServletContext ctxsetUserPrincipal(...)setRemoteUser(...)ServletPrincipalProxy.classMyPrincipalAction actionnew MyPrincipalAction(...)PrincipalProxy proxyisRequestSecure(...)ServletContextAware mockServletContextAware.classnew ServletConfigInterceptor(...)PrincipalProxy proxy, ...;// less strick match is needed for this unit test to be conducted using mocks// uni test that does not use mock, but an Action so we also get code coverage for the PrincipalProxy class/** StrutsConversionErrorInterceptorTest */StrutsConversionErrorInterceptor interceptor, ...;new StrutsConversionErrorInterceptor(...)/** TokenInterceptorTest */ActionContext oldContext, ...;Map<String,Object> session, ...;TokenInterceptor.INVALID_TOKEN_CODETestConfigurationProvider.TOKEN_ACTION_NAME// must not call setToken// double post will result in a invalid.token return code/** Unit test for {@link TokenSessionStoreInterceptor}. */TestConfigurationProvider.TOKEN_SESSION_ACTION_NAME// double post will just return success and render the same view as the first execute// see TokenInterceptor where a 2nd call will return invalid.token code insteadAnnotationValidationInterceptor interceptor, ...;Mock mockActionProxy, ...;TestAction test, ...;new AnnotationValidationInterceptor(...)skipMeProtected(...)import HttpHeaderResult/** HttpHeaderResultTest */HttpHeaderResult result, ...;Mock responseMock, ...;Map<String,String> valuessetError(...)setErrorMessage(...)new HttpHeaderResult(...)import StrutsMockHttpServletResponse/** Test case for PlainTextResult. */MockActionInvocation invocation, ...;StrutsMockHttpServletResponse response, ...;StringWriter stringWriter, ...;PlainTextResult resultnew PlainTextResult(...)setExpectedContentType(...)setExpectedHeader(...)InputStream jspResourceInputStreamPlainTextResultTest.classString rreadAsString(...)setResourceAsStream(...)setCharSet(...)int sizeReadStringBuilder stringBuildernew StrutsMockHttpServletResponse(...)setWriter(...)import ServletActionRedirectResultimport IMocksControlimport static EasyMock.createControlimport static EasyMock.expectServletActionRedirectResult resultnew ServletActionRedirectResult(...)IMocksControl controlActionInvocation mockInvocationsetPrependServletContext(...)setUrlHelper(...)new DefaultUrlHelper(...)setActionMapper(...)getRedirectedUrl(...)ServletActionRedirectResult.classServletDispatcherResult viewnew ServletDispatcherResult(...)Mock dispatcherMockRequestDispatcher.classMock requestMockMock responseMockMockActionInvocation mockActionInvocation// this is a bad mock, but it worksimport static HttpServletResponse.SC_SEE_OTHERimport static EasyMock.createNiceMockimport static EasyMock.replayServletRedirectResult view, ...;ActionInvocation ai, ...;setStatusCode(...)ServletRedirectResult resultnew ServletRedirectResult(...)List<String> paramValuesValueStack mockValueStackMap<String,Object> mockContextMockActionInvocation aithis.ai/** Unit test for {@link StreamResult}. */StreamResult result, ...;MockHttpServletResponse response, ...;int contentLength, ...;setInputName(...)getInputName(...)getBufferSize(...)getContentDisposition(...)setContentCharSet(...)setAllowCaching(...)setBufferSize(...)setContentDisposition(...)MyImageAction actionnew MyImageAction(...)StreamResultTest.class// 1024 is default//check that that headers are not set by default        //check that that headers are not set by default// it's not easy to test using easymock as we use getOutputStream on HttpServletResponse.///////////////////// ${...} conditionalParse of Result, returns String,// which gets evaluated to the stack, that's how it works.// We use ${streamForImageAsString} that returns "streamForImage"// which is a property that returns an InputStream object.// This time we dun use ${...}, so streamForImage will// be evaluated to the stack, which should reaturn an// InputStream object, cause there's such a property in// the action object itself.// just use src/test/log4j2.xml as test file/** Test case for StrutsResultSupport. */InternalStrutsResultSupport resultnew InternalStrutsResultSupport(...)getInternalLocation(...)String _internalLocation, ...;// don't really need this, as encode is only valid when parse is true.import VelocityResultTestVelocityEngine velocity, ...;VelocityResult result, ...;TestResult resultnew TestResult(...)Bean beanresult.finalLocationvelocity.templateNameString expectedTemplateNamenew VelocityResult(...)new TestVelocityEngine(...)String finalLocation, ...;this.finalLocationString templateName, ...;this.templateNameString anExpressionSet<String> sList<MyObject> lnew ArrayList<MyObject>(...)Set<MyObject> snew LinkedHashSet<MyObject>(...)MyIterableObject inew MyIterableObject(...)List<String> values, ...;MyObject tmptmp.nametmp.age// null gives always falseCounter c, ...;getCurrent(...)long along bnew Counter(...)/** InvocationSessionStoreTest */String INVOCATION_KEY, ...;String TOKEN_VALUE, ...;Mock invocationMock, ...;Mock proxyMockPrefixTrie trienew PrefixTrie(...)Object fooRegexPatternMatcher matcher, ...;RegexPatternMatcherExpression expr/** See WW-3747 */new RegexPatternMatcher(...)//params//patternTagSupport.class/** Test case for Struts Type Converter. *//** Typically form Struts -> html ... */InternalStrutsTypeConverter strutsTypeConverternew InternalStrutsTypeConverter(...)strutsTypeConverter.isConvertToStringstrutsTypeConverter.objToBeConverted/** Typically form html -> Struts ... */strutsTypeConverter.isConvertFromString/** Typically from html -> Struts (in array due to the nature of html, param ... */strutsTypeConverter.fallbackConversion// === internal class for testingboolean isConvertFromString, ...;boolean isConvertToString, ...;boolean fallbackConversion, ...;Object objToBeConverted, ...;import MockRequestDispatcher/** Test case for StrutsUtil. */InternalMockHttpServletRequest request, ...;StrutsUtil strutsUtil, ...;bean(...)getDispatcher(...)getDispatcher(...).includedurlEncode(...)setContextPath(...)Object obj1Object obj2String[] selectedListList<> listMademakeSelectList(...)getIsSelected(...)toInt(...)toLong(...)// === Junit Hooknew InternalMockHttpServletRequest(...)// === internal class to assist in testingInternalMockRequestDispatcher dispatcher, ...;new InternalMockRequestDispatcher(...)String url, ...;boolean included, ...;this.urlsetIncludedUrl(...)// with include, this must have been created and should not be null// this must be true, indicating we actaully ask container to do an include// this should be in xwork-messages.properties (included by default// by LocalizedTextUtil/** TokenHelperTest */String sessionNameTokenHelper.TOKEN_NAMESPACEString defaultSessionTokenNameString token2new TreeMap<>(...)// %n rather than %nn should throw an IAE according to the Javadoc// Edge case trying to trigger ArrayIndexOutOfBoundsExceptionimport FreemarkerTemplateEngineimport JspTemplateEngineimport VelocityTemplateEngine/** TemplateEngineManagerTest */TemplateEngineManager mgr, ...;new TemplateEngineManager(...)new VelocityTemplateEngine(...)new FreemarkerTemplateEngine(...)new HashSet<>(...) { ... }setDefaultTemplateType(...)TemplateEngineManager.DEFAULT_TEMPLATE_TYPETemplateEngine defaultTemplateEngineimport static AbstractUITagTest.normalize/** Test case for FreeMarkerResult. */FreemarkerManager mgr, ...;MockHttpServletRequest request, ...;setWriteIfCompleted(...)setRealPath(...)FreeMarkerResultTest.classFreemarkerThemeTemplateLoader themeLoadernew FreemarkerThemeTemplateLoader(...)new FreemarkerManager(...)setThemeTemplateLoader(...)FreemarkerManager.CONFIG_SERVLET_CONTEXT_KEY/** Test case for FreemarkerManager */FreemarkerManager mgrStrutsMockServletContext servletContextConfiguration confgetDefaultEncoding(...)DummyFreemarkerManager managernew DummyFreemarkerManager(...)String tmpPathgetTempDirectoryPath(...)Configuration freemarkerConfig, ...;String expectedJDK17String expectedJDK18FreemarkerManager freemarkerManagersetServletContextForTemplateLoading(...)// TODO lukaszlenart: remove expectedJDK15 and if() after switching to Java 1.6//get fm config to use it in mock servlet contextimport ListEntryimport CollectionModelTestAction testAction, ...;StrutsUtil wwUtilObjectWrapper.BEANS_WRAPPERCollectionModel stringListimport BaseMatcherimport Descriptionimport Matchersimport static Mockito.mockimport static Mockito.whenFreemarkerThemeTemplateLoader loadermock(...)TemplateLoader parentTemplateLoader.classObject actualsetUIThemeExpansionToken(...)setTemplateEngine(...)thenReturn(...)when(...)isNotNull(...)Map<String,String> propsargThat(...)new IsEqual<Template>(...)String pName, ...;String pValue, ...;/** Bean Property String Name *//** Bean Property String Value */import WrapperTemplateModelimport AdapterTemplateModelimport TemplateBooleanModelimport TemplateHashModelimport TemplateModelIteratorimport TemplateNumberModelimport TemplateScalarModelimport TemplateSequenceModelObject ADAPTER_TEMPLATE_MODEL_CONTAINED_OBJECT, ...;Object WRAPPING_TEMPLATE_MODEL_CONTAINED_OBJECT, ...;TagModel tagModelnew TagModel(...) { ... }Map<> resultnew TemplateBooleanModel(...) { ... }new TemplateScalarModel(...) { ... }new TemplateNumberModel(...) { ... }new TemplateHashModel(...) { ... }new TemplateSequenceModel(...) { ... }new TemplateCollectionModel(...) { ... }new TemplateModelIterator(...) { ... }Iterator<> i, ...;new AdapterTemplateModel(...) { ... }new WrapperTemplateModel(...) { ... }InternalBean beannew InternalBean(...)getProperty1(...)getProperty2(...)getProperty3(...)getProperty4(...)getProperty5(...)getProperty6(...)getProperty7(...)getProperty8(...)getProperty9(...)getProperty10(...)getProperty11(...)boolean property1, ...;boolean property2, ...;// inverse of the expected result, so we could test that it worksString property3, ...;String property4, ...;Integer property5, ...;Float property6, ...;Map<> property7, ...;Collection<> property8, ...;Collection<> property9, ...;Object property10, ...;Object property11, ...;this.property1this.property2this.property3this.property4this.property5this.property6this.property7this.property8this.property9this.property10this.property11// Try to test out the commons Freemarker's Template Model// TemplateBooleanModel// TemplateScalarModel// TemplateNumberModel// TemplateHashModel// TemplateSequenceModel// TemplateCollectionModel// AdapterTemplateModel// WrapperTemplateModelimport MockDispatcher/** Base class to extend for unit testing UI Tags. *//** contains the buffer that our unit test will write to.  we can later verify this buffer for correctness. */StrutsMockPageContext pageContext, ...;/** Constructs the action that we're going to test against.  For most UI tests, this default action should be enough. ... */createMocks(...)JspWriter jspWriternew StrutsMockJspWriter(...)MockDispatcher dusetServletInfo(...)new StrutsMockPageContext(...)setJspWriter(...)/** create our standard mock objects */// let's not set the locale -- there is a test that checks if Dispatcher actually picks this up...// ... but generally we want to just use no locale (let it stay system default)import BeanUtilsimport AbstractUITagString FREEMARKER_ERROR_EXPECTATION, ...;/** Simple helper class for generic tag property testing mechanism. Basically it holds a property name, a property ... *//** Construct simple holder with default expectation. ... *//** Construct property holder. ... */this.expectation/** Convenience method for easily adding anonymous constructed instance to a given map, with {@link #getName()} ... *//** Initialize a map of {@link PropertyHolder} for generic tag property testing. Will be used when calling {@link ... */Map<String,PropertyHolder> resultnew HashMap<String,PropertyHolder>(...)addToMap(...)new PropertyHolder(...)/** Do a generic verification that setting certain properties on a tag causes expected output regarding this ... */List<> excludeListPropertyHolder propertyHoldergetExpectation(...)verifyGenericProperties(...)initializedGenericTagTestProperties(...)/** Attempt to verify the contents of this.writer against the contents of the resource specified.  verify() performs a ... *//** Attempt to verify the contents of this.writer against the contents of the URL specified.  verify() performs a ... */AbstractUITagTest.class//new PropertyHolder("label", "label", "label=\"label\"").addToMap(result);//new PropertyHolder("required", "someTitle").addToMap(result);/* if (appendSpace && st.hasMoreTokens()) { ... */import TestActionTagResult/** Unit test for {@link ActionTag}. */ActionTag tagnew ActionTag(...)TestConfigurationProvider.TEST_NAMESPACE_ACTIONtag.componentJspException exint stackSizetestSimple(...)ActionComponent componentTestActionTagResult resultMock mockActionInvActionInvocation oldInvocationStrutsException e// FIXME: Logging the error seems to cause the standard Maven build to failTestConfigurationProvider.class// tag clear components on doEndTag// tag clear components on doEndTag, so we need to get it here// result is never executed, hence never set into invocation// check parameters, there should be one// will just log it to ERROR but we run the code to test that it works somehowimport StrutsBodyContentAnchorTag tag, ...;String bodyTextStrutsBodyContent bodyContentnew StrutsBodyContent(...)setBodyContent(...)/** To test priority of parameter passed in to url component though ... */ParamTag param1new ParamTag(...)ParamTag param2ParamTag param3setQueryString(...)wrapWithAnchor(...)/** Use Iterable values as the value of the param tags ... */List<ValueHolder> listnew ArrayList<ValueHolder>(...)URLTagTest.ValueHoldernew ValueHolder(...)new ValueHolder[]URLTagTest.FoosetServerName(...)setServerPort(...)AnchorTag anchorParamTag paramTagAnchorTag anchorTagsetupGetContext(...)//Iterable//String[]//ValueHolder[]// request parameter map should not have any effect, as includeParams// default to GET, which get its param from request.getQueryString()// include nested param tag// will log at WARN level// should not add any request parameters// will always chop anchor if using requestURI/** Test case for AppendIteratorTag. */ParamTag iterator1ParamTagParamTag iterator2ParamTagParamTag iterator3ParamTagIterator<> appendedIterator// TestAction from bean tag, Action from execution and DefaultTextProvider/** DynAttribsTest test case. ... */Document doc, ...;URL s2UrlFile tldFileElement rootElemElement tagNodeList tagClassNodesElement tagClassElementString clazzNameNodeList dynAttribsNodeListElement dynAttribsElementString isDynAttribsboolean hasDynAttribsString failMsg// prepare to parse the TLD file using DOM// for each tag, get the class name// and dynamic-attributes value// skip if not marked as dynamic-attributes=true// load the class using reflection// instantiate classimport MockJspWriterimport MockPageContextMockPageContext pageContext, ...;MockJspWriter jspWriter, ...;TagSupport.EVAL_BODY_INCLUDETagSupport.SKIP_BODYnew MockJspWriter(...)new MockPageContext(...)ElseTag elseTag, ...;JspException eint num, ...;this.num// create the needed objects// create the mock http servlet request// NOTE: in Struts Tag library, TagUtil gets stack from request, which will be set//       when request going through the FilterDispatcher --> DispatcherUtil etc. route// create the mock page contextI18nTag tag, ...;/** Asserts that an exception is thrown when something unexpected is popped off the stack by the closing tag ... */// associate the tag with the mock page request// set the resource bundleIfTag tag, ...;setNum(...)IfTag ifTagElseTag elseTagint r1int r2ElseIfTag elseIfTag1ElseIfTag elseIfTag2ElseIfTag elseIfTag3int r3int r4int r5IfTag nestedIfTagint r6TagSupport.EVAL_PAGE// set up the stack// set up the test//tag.setPageContext(pageContext);/** Unit test of {@link IncludeTag}. */RequestDispatcher mockRequestDispatcher, ...;IncludeTag tag, ...;ServletRequest.classServletResponse.classgetRequestDispatherString(...)Include includesetupGetRequestDispatcher(...)new MockRequestDispatcher(...)new IncludeTag(...)// use always matcher as we can not determine the excact objects used in mock.include(request, response) call// adding param must be done after doStartTag()// TODO: we should test for .. in unit test - is this test correct?// use always matcher as we can not determine the exact objects used in mock.include(request, response) callimport IteratorGeneratorTag/** Test case for IteratorGeneratorTag. */IteratorGeneratorTag tagnew IteratorGeneratorTag(...)Object afterTopOfStackObject pageContextIteratornew Converter(...) { ... }// 1// 2// 3// 4// 5// 1.// 4.// 5.// 2.// 3.import MockBodyContentimport ListUtils/** Test Case for Iterator Tag */IteratorTag tag, ...;doInitBody(...)setArray(...)iterateThreeStrings(...)setMap(...)IteratorStatus statusisLast(...)isFirst(...)isOdd(...)isEven(...)validateSkipBody(...)validateCounter(...)expectedValues.lengthisEqualList(...)MockBodyContent mockBodyContentnew TestMockBodyContent(...)setupGetEnclosingWriter(...)Collection<> list, ...;// one// two// three// four// five/** Test case for MergeIteratorTag. */Iterator<> mergedIterator// if not iterator, let CCE surfaceNumberTag tagnew NumberTag(...)setFloatNumber(...)/** PropertyTag test case. */MockJspWriter jspWriterMockPageContext pageContextsetExpectedData(...)new HashMap<>(...) { ... }formatTitle(...)// setups// test// verify test//      setupsChewbacca chewie, ...;SetTag tag, ...;new Chewbacca(...)boolean furry, ...;this.furryimport SortIteratorTag/** Test case to test SortIteratorTag. */SortIteratorTag tagnew SortIteratorTag(...)Iterator<> sortedIteratornew Comparator<>(...) { ... }Integer i1Integer i2// if not an Iterator, just let the ClassCastException be thrown as error instead of failure// goodimport BodyContent/** StrutsMockBodyContent */JspWriter jspWriter, ...;String body, ...;this.jspWritergetRemaining(...)clearBuffer(...)newLine(...)import AssertionFailedError/** StrutsMockHttpServletRequest */Map<> attributes, ...;Map<> parameterMap, ...;String pathInfo, ...;String queryString, ...;String requestURI, ...;String serverName, ...;int serverPort, ...;String requestDispatherString, ...;Vector<> vthis.parameterMapthis.queryStringthis.requestDispatherString/** Get's the source string that was used in the last getRequestDispatcher method call. */this.requestURIthis.serverNamethis.serverPortAssertionFailedError ethis.pathInfo//ignore/** StrutsMockHttpServletResponse */String redirectURL, ...;this.redirectURLimport Hashtableimport UUIDimport MockHttpSession/** StrutsMockHttpSession */Hashtable<> attributes, ...;new Hashtable<>(...)ServletResponse response, ...;this.attributes/** StrutsMockServletContext */String realPath, ...;String servletInfo, ...;String contextPath, ...;Map<> initParams, ...;InputStream resourceAsStream, ...;this.resourceAsStreamthis.servletInfothis.contextPathimport SubsetIteratorTag/** Test case for SubsetIteratorTag. */SubsetIteratorTag tagnew SubsetIteratorTag(...)Iterator<> subsetIteratorIterator<> subsetIterator1Iterator<> subsetIterator2Integer[] integersnew Decider(...) { ... }int integer// List as Source// Array as Source// List as source// Array as source// array as source// Array As sourceimport BodyTagimport TestAction1/** TextTagTest */String fooValue, ...;TextTag tag, ...;TestAction actionStrutsMockBodyContent mockBodyContentnew StrutsMockBodyContent(...)int startStatusBodyTag.EVAL_BODY_BUFFEREDObject param1Object param2Object param3List<> paramsString value1Locale foreignLocalegetForeignLocale(...)String value2StringBuffer bufferTestAction1.classgetDefaultLocale(...)String value_defaultString value_int/** todo remove ActionContext set after LocalizedTextUtil is fixed to not use ThreadLocal ... */// NOTE:// simulate the condition// <s:text name="some.invalid.key">My Default Message</s:text>// nothing in stack// is in stack now/** Unit test for {@link URLTag}. */URLTag tag, ...;URLTag urlTagDefaultActionProxyFactory apFactorynew DefaultActionProxyFactory(...)ActionProxy apObject allowMethodAccessParamTag param4new MockBodyContent(...) { ... }String baseUri// Make sure we have an action invocation available// We are red// We are blue/** ActionErrorTag test case. */boolean shouldActionHaveError, ...;setHasActionErrors(...)ActionErrorTagTest.classsetJustNullElement(...)boolean yesActionErrors, ...;boolean justNullElement, ...;this.justNullElement//assertEquals("", writer.toString());/** ActionMessageTag test case. */setHasActionMessage(...)ActionMessageTagTest.classInternalActionSupport internalActionSupport/** Internal ActionSupport class for testing, can be in state with ... */boolean canHaveActionMessage, ...;this.canHaveActionMessageList<> messagescreateTag(...)verifyResource(...)setDynamicAttribute(...)/** Test case for CheckboxList. *//** Initialize a map of {@link org.apache.struts2.views.jsp.AbstractUITagTest.PropertyHolder} for generic tag ... */CheckboxListTag tagnew CheckboxListTag(...)prepareTagGeneric(...)setCollection(...)new String[][]CheckboxListTag.classCheckboxTag.class/** Test case for ComboBox component. */ArrayList<> collectionComboBoxTag.class/** Test that id attribute is evaludated against the Ognl Stack. ... */ComponentTag.class/** Note -- this test uses empty.vm, so it's basically clear */ComponentTag tagnew ComponentTag(...)/** executes a component test passing in a custom parameter. it also executes calling a custom template using an ... */tag.includeContext//        System.out.println(writer);import DateTag/** Unit test for {@link org.apache.struts2.components.Date}. */DateTag tag, ...;String formatDate componentgetFormat(...)isNice(...)Calendar futureCalendar pastnew DateTag(...)// long// component test must be done between start and end tag// always add a little slack otherwise we could calculate wrong// hmmm the Date component isn't the best to calculate the excat difference so we'll just check// that it starts with in 2 years//should return a blank/** Test case for DoubleSelectTag. */Region antwerpnew Region(...)Region gentRegion bruggeArrayList<> belgiumRegionsCountry belgiumnew Country(...)Region parisRegion bordeauxArrayList<> franceRegionsCountry franceCollection<> collectionList<> countriessetList2(...)SelectTag.classCollection<> regions, ...;this.regions//css style and classdouble longint, ...;this.longintimport ParamTag/** FieldError Tag Test Case. */setHaveFieldErrors(...)FieldErrorTagTest.classParamTag pTag1ParamTag pTag2setReturnNullForFieldErrors(...)new InternalAction(...)boolean haveFieldErrors, ...;boolean returnNullForFieldErrors, ...;this.haveFieldErrorsthis.returnNullForFieldErrorsList<> err1List<> err2List<> err3TextFieldTag.classimport Strategyimport ActionTag/** FormTagTest */FormTag.class/** This test with form tag validation enabled. Js validation script will appear ... */UpDownSelectTag tprepareMockInvocation(...)/** This test with form tag validation enabled. Js validation script will not appear ... *//** Tests the numbers are formatted correctly to not break the javascript */IntValidationAction.class/** Tests the numbers are formatted correctly to not break the javascript, using doubles *//** This test with form tag validation disabled. *//** Testing that this: <br> ... */FormTag form1FormTag form2FormTag form3FormTag formTextFieldTag text// component is removed after end tag/** Unit test for {@link HeadTag}. ... */HeadTag tagnew HeadTag(...)HeadTagTest.classTestAction testactionInputTransferSelectTag tagnew InputTransferSelectTag(...)InputTransferSelectTagTest.class//System.out.println(writer.toString());int longint, ...;/** JspTemplateTest */Mock rdMockLabelTest.classsetText(...)// put key with message in a "resource"LocaleKeyValueTest ONE, ...;LocaleKeyValueTest TWO, ...;LocaleKeyValueTest THREE, ...;new LocaleKeyValueTest(...)String s, ...;Integer i, ...;Double d, ...;Long l, ...;Float f, ...;Calendar cal, ...;HashMap<> params, ...;MockTag instance, ...;MockTag.calMockTag.dateMockTag.dMockTag.fMockTag.iMockTag.lMockTag.paramsMockTag.s/** resets all the static variables to their initial state.  this must be called before each test! */new MockTag(...)SelectTag selectTagOptGroupTag optGroupTag1new OptGroupTag(...)OptGroupTag optGroupTag2new LinkedHashMap<>(...) { ... }LocaleTestAction localeTestActionnew LocaleTestAction(...)List<> leftList<> rightOptionTransferSelectTagTest.classList<> leftValList<> rightValsetCollection2(...)setList3(...)PasswordTag.classRadioTag.classMap<String,String> myMap/** Reset Component Test. */ResetTag tagnew ResetTag(...)// no method// no action/** Tests WW-1601: Select tag template does not work properly for Object like Byte. */ByteObject hellonew ByteObject(...)new Byte(...)ByteObject fooList<> list2/** Tests WW-455: Select tag template does not work properly for Object like BigDecimal. */BigDecimalObject hellonew BigDecimalObject(...)BigDecimalObject fooBigDecimal bigDecimal, ...;this.bigDecimalByte byteValue, ...;this.byteValue/** WW-1747 - should be a valid test case for the described issue ... */new LongObject(...)IdName hellonew IdName(...)IdName worldsetFooInt(...)// expect strings to be returned, we're still dealing with HTTP here!// header stuff// empty option/** StrutsBodyContent */StringBuilder buffer, ...;/** Write a portion of an array of characters. ... *//** Unit test for {@link SubmitTag}. */StrutsBodyContent body/** TestAction1 */TextareaTag.classimport TextFieldModelTextFieldModel modelTransformControl controlonStart(...)afterBody(...)/** TokenTagTest */doTokenTest(...)TokenTag anotherTagString anotherToken/** WW-480 *///System.out.println(s);import StrutsMockBodyContent/** UI components Tooltip test case. */FormTag formTagTooltipTest.classParamTag formParamTagParamTag textFieldParamTagStrutsMockBodyContent bodyContentStrutsMockBodyContent bodyContent2// we test it on textfield component, but since the tooltip are common to// all components, it will be the same for other components as well.//same parameters as the OGNL map configuration, output must be the same// same parameters as the OGNL map configuration, output must be the same/** Test case for UpDownSelectTag */UpDownSelectTagTest.class// ===============================Map<> _myMapList<> _mySelectedMapIdsTextFieldTag tag, ...;ValidationStylesTest.class/* $Id: User.java 651946 2008-04-27 13:41:38Z apetrelli $ ... *//** Test case for ContextUtil */Mock containersetAltSyntax(...)//========================================================// ==========================================/** Test case for DefaultUrlHelper. */StubContainer stubContainer, ...;DefaultUrlHelper urlHelper, ...;String expectedUrlMock mockHttpServletRequestMock mockHttpServletResponseStringBuilder urlUrlHelper.AMPString actualUrl/** just one &, not &amp; */String expectedStringTreeMap<> paramsString urlString/** The UrlHelper should build a URL that starts with "https" followed by the server name when the scheme of the ... *//** The UrlHelper should build a URL that starts with "http" followed by the server name when the scheme of the ... *//** This test is similar to {@link #testSwitchToHttpsScheme()} with the HTTP port equal to 7001 and the HTTPS port ... */setHttpPort(...)setHttpsPort(...)/** This test is similar to {@link #testSwitchToHttpScheme()} with the HTTP port equal to 7001 and the HTTPS port ... */String expectedResultsetProp(...)Map<String,Object> queryParametersnew StubContainer(...)stubContainer.overridesContainer parent, ...;Map<String,Object> overrides, ...;removeScopeStrategy(...)setScopeStrategy(...)getResourceBase(...)/** <code>ResourceUtilTest</code> *//** Unit test for {@link XSLTResult}. */XSLTResult result, ...;TransformerException eString outnew XSLTResult(...) { ... }new URIResolver(...) { ... }new XSLTResult(...)List<String> editions, ...;this.editionsimport FieldMatchValidatorimport Payloadimport Documentedimport static ElementType.ANNOTATION_TYPEimport static ElementType.TYPE/** Validation annotation to validate that two fields are equal. ... *//** Defines several <code>@FieldMatch</code> annotations on the same element ... */import PropertyUtilsimport ConstraintValidatorimport ConstraintValidatorContextString firstFieldName, ...;String secondFieldName, ...;this.firstFieldNamefirst(...)this.secondFieldNamesecond(...)Object firstObjObject secondObj/** <p>Class consisting of various constant values being used within ... */String PROVIDER_CLASS, ...;String IGNORE_XMLCONFIGURAITION, ...;String CONVERT_MESSAGE_TO_UTF8, ...;String CONVERT_MESSAGE_FROM, ...;String FIELD_SEPERATOR, ...;String MODELDRIVEN_PREFIX, ...;String EMPTY_SPACE, ...;import ValidatorConstantsimport ConstraintViolationBeanValidationManager beanValidationManager, ...;boolean convertToUtf8, ...;String convertFromEncoding, ...;this.beanValidationManagerValidatorConstants.CONVERT_MESSAGE_TO_UTF8this.convertToUtf8ValidatorConstants.CONVERT_MESSAGE_FROMthis.convertFromEncodingValidator validatorperformBeanValidation(...)Set<ConstraintViolation<Object>> constraintViolationsaddBeanValidationErrors(...)ConstraintViolation<Object> constraintViolationisActionError(...)ValidationError validationErrorbuildBeanValidationError(...)ValidatorConstants.MODELDRIVEN_PREFIXValidatorConstants.EMPTY_SPACEgetPropertyPath(...)removeStart(...)ValidatorConstants.FIELD_SEPERATORnew ValidationError(...)/** Decide if a violation should be added to the fieldErrors or actionErrors ... */getLeafBean(...)getInvalidValue(...)/** This is copied from DefaultActionInvocation ... *//** Inner class for validation error ... */BeanValidationInterceptor.class// performing bean validation on actionClass<> providerClass, ...;ValidatorFactory validationFactory, ...;ValidatorConstants.PROVIDER_CLASSValidatorConstants.IGNORE_XMLCONFIGURAITIONConfiguration<> configurationconfigure(...)this.providerClassbyProvider(...)byDefaultProvider(...)ignoreXmlConfiguration(...)this.validationFactorybuildValidatorFactory(...)DefaultBeanValidationManager.classimport FieldActionimport FieldActionDoExecuteimport FieldMatchActionsetStreet(...)FieldAction actionFieldMatchAction actionsetPassword(...)setConfirmPassword(...)setConfirmEmail(...)String confirmEmail, ...;this.confirmEmailimport ValidPerson model, ...;import NotNullimport Sizeimport CreationalContextimport BeanManagerimport InjectionTargetimport InitialContextimport NamingException/** CdiObjectFactory allows Struts 2 managed objects, like Actions, Interceptors or Results, to be injected by a Contexts ... */String CDI_JNDIKEY_BEANMANAGER_COMP, ...;/** The key under which the BeanManager can be found according to CDI API docs */String CDI_JNDIKEY_BEANMANAGER_APP, ...;/** The key under which the BeanManager can be found according to JBoss Weld docs */String CDI_JNDIKEY_BEANMANAGER_COMP_ENV, ...;/** The key under which the BeanManager can be found in pure Servlet containers according to JBoss Weld docs. */String jndiKey, ...;this.jndiKeyBeanManager beanManager, ...;Map<Class<?>,InjectionTarget<?>> injectionTargetCache, ...;this.beanManagerfindBeanManager(...)/** Try to find the CDI BeanManager from JNDI context. First, if provided, the key given by ... */BeanManager bmContext initialContextnew InitialContext(...)NamingException e/** Lookup the given JNDI key in the given context. ... */BeanManager resultInjectionTarget<> injectionTargetgetInjectionTarget(...)CreationalContext<> ctxbuildNonContextualCreationalContext(...)produce(...)postConstruct(...)/** Get a InjectionTarget instance for a given class. If the appropriate target is not found in cache, a nw instance ... */InjectionTarget<?> resultcreateInjectionTarget(...)createAnnotatedType(...)/** Simple wrapper for CreationalContext creation. ... */createCreationalContext(...)/** Allow constructor injection */new ConcurrentHashMap<Class<?>,InjectionTarget<?>>(...)CdiObjectFactory.class// Check explicit configuration first, if given// Check CDI default// Check WELD default// Check Tomcat / Jetty default// a separate CreationalContext is required for every beanimport StartMainimport WeldContainerimport SimpleNamingContextBuilder/** CdiObjectFactoryTest. */SimpleNamingContextBuilder buildernew SimpleNamingContextBuilder(...)StartMain smnew StartMain(...)WeldContainer weldContainergo(...)activate(...)bind(...)CdiObjectFactory.CDI_JNDIKEY_BEANMANAGER_COMPgetBeanManager(...)new CdiObjectFactory(...)CdiObjectFactory cdiObjectFactoryFooConsumer fooConsumerFooConsumer.classfooConsumer.fooServiceInjectionTarget<?> injectionTargetcdiObjectFactory.injectionTargetCache/** FooConsumer. */FooService fooService, ...;getHello(...)/** FooService. *//** ActionNamesAction */Set<String> actionNames, ...;Set<String> namespaces, ...;ConfigurationHelper configHelper, ...;this.configHelpergetNamespaces(...)getActionNames(...)/** Index action to support cooperation with REST plugin ... */import ResolverUtil/** ConfigurationHelper */Set<String> namespacesMap<String,Map<String,ActionConfig>> allActionConfigsSet<String> actionNamesMap<String,ActionConfig> actionMappingsList<Properties> pomsSet<URL> urls/** ListValidatorsAction loads the validations for a given class and context */String clazz, ...;List<Validator<>> validators, ...;loadValidators(...)Class<> valueListValidatorsAction.class/** Shows the beans loaded by the internal Guice container.  Only shows beans that are recognized by Struts as official ... */Map<String,Set<Binding>> bindings, ...;new TreeMap<String,Set<Binding>>(...)addBindings(...)Set<Binding> bindingsnew TreeSet<Binding>(...)String chosenNamenew Binding(...)getInstanceClassName(...)String instNameObject instString impl, ...;String constant, ...;boolean isDefault, ...;this.implthis.aliasthis.isDefaultisDefault(...)getAlias(...)// Ignoring beans unable to be loaded/** ShowConfigAction */String detailView, ...;...[] properties, ...;this.detailViewShowConfigAction.class/* $Id: ShowConfigAction.java 1536698 2013-10-29 13:00:58Z lukaszlenart $ ... *///super might have set some :)/** Shows all constants as loaded by Struts */Map<String,String> constants, ...;getJarProperties(...)ShowJarsAction.class// this is the config browser, so it doesn't seem necessary to do more than just// send up a debug message// maybe avoiding NPE later/** ShowValidatorAction */Set<PropertyInfo> properties, ...;int selected, ...;ReflectionContextFactory reflectionContextFactory, ...;this.reflectionContextFactorythis.selectedgetSelectedValidator(...)new TreeSet<PropertyInfo>(...)BeanInfo beanInfoFromPropertyDescriptor[] pdsReflectionException enew PropertyInfo(...)PropertyInfo propertyInfopropertyInfo.namepropertyInfo.typepropertyInfo.valuePropertyInfo otherShowValidatorAction.class/** Builds all the action configurations and stores them into the XWork configuration instance ... *//** Given the name of the class, this method should build an action name. ... */import DispatcherListenerActionConfigBuilder actionConfigBuilder, ...;boolean reload, ...;boolean listeningToDispatcher, ...;this.actionConfigBuilderActionConfigBuilder.classConventionConstants.CONVENTION_ACTION_CONFIG_BUILDERthis.reload/** Not used. */this.listeningToDispatcherremoveDispatcherListener(...)/** Not used. ... *//** Does nothing. ... *//** Loads the packages using the {@link ActionConfigBuilder}. ... *///this is the only way I found to be able to get added to to ConfigurationProvider list//listening to events in Dispatcherimport PackageProviderbuildActionConfigs(...)/* $Id: ClasspathConfigurationProvider.java 655902 2008-05-13 15:15:12Z bpontarelli $ ... *//** Constants used to extend the COnvention plugin */String CONVENTION_ACTION_CONFIG_BUILDER, ...;String CONVENTION_ACTION_NAME_BUILDER, ...;String CONVENTION_RESULT_MAP_BUILDER, ...;String CONVENTION_INTERCEPTOR_MAP_BUILDER, ...;String CONVENTION_CONVENTIONS_SERVICE, ...;ResultMapBuilder resultMapBuilder, ...;String defaultParentPackageName, ...;PackageConfig parentPackage, ...;boolean redirectToSlash, ...;ConventionsService conventionsService, ...;String nameSeparator, ...;/** Constructs the unknown handler. ... */this.resultMapBuilderResultMapBuilder.classConventionConstants.CONVENTION_RESULT_MAP_BUILDERthis.conventionsServiceConventionsService.classConventionConstants.CONVENTION_CONVENTIONS_SERVICEthis.defaultParentPackageNamethis.nameSeparatorthis.parentPackagethis.redirectToSlashMap<String,ResultTypeConfig> resultsByExtensiongetResultTypesByExtension(...)determinePath(...)Resource resourcebuildActionConfig(...)resource.pathresource.extResultTypeConfig redirectResultTypeConfigString redirectNamespace/** Finds a resource using the given path parts and all of the extensions in the map. ... */String canonicalPathcanonicalize(...)string(...)new Resource(...)String fqanfindResult(...)scanResultsByExtension(...)String chainedToActionConfig chainedToConfigResultTypeConfig chainResultTypeString classLoaderPath/** Determines the result path prefix that the request URL is for, minus the action name. This includes ... */String finalPrefixdetermineResultPath(...)/** Not used */String ext, ...;this.extConventionUnknownHandler.class// Strip the namespace if it is just a slash// Try /idx/action.jsp if actionName is not empty, otherwise it will just be /.jsp// If the URL is /foo and there is an action we can redirect to, send the redirect to /foo/.// However, if that action is not in the same namespace, it is the default, so I'm not going// to return that.// Otherwise, if the URL is /foo or /foo/ look for index pages in /foo/// try to find index action in current namespace or in default one// Issue #6 - Scan for result-code as page name// Try /idx/action/index.jsp//try to find an action to chain to. If the source action is "foo" and//the result is "bar", we will try to find an action called "foo-bar"//in the same package/** Locates the result location from annotations on the action class or the package or returns the ... *//** Delegates to the other method but first looks up the Action's class using the given class name. ... *//** Returns a mapping between the result type strings and the {@link ResultTypeConfig} instances ... */String resultPath, ...;/** Constructs a new instance. ... */this.resultPathString localResultPathResultPath resultPathAnnotationResultPath.classproperty(...)ResourceBundle strutsBundleMap<String,ResultTypeConfig> resultsResultTypeConfig dispatcherdisableParse(...)ResultTypeConfig velocityResultTypeConfig freemarkernew HashMap<String,ResultTypeConfig>(...)String actionSuffix, ...;boolean lowerCase, ...;this.lowerCasethis.actionSuffixint lowerPos// Truncate Action suffix if found// Force initial letter of action to lowercase, if desiredimport ClassFinderimport ClassLoaderInterfaceimport AnnotationVisitorimport ClassReaderimport ClassVisitorimport FieldVisitorimport MethodVisitorimport Opcodesimport JarURLConnectionMap<String,List<Info>> annotated, ...;Map<String,ClassInfo> classInfos, ...;List<String> classesNotLoaded, ...;boolean extractBaseInterfaces, ...;List<String> classNamesthis.extractBaseInterfacesjar(...)file(...)test(...)readClassDef(...)List<Info> infosnew ArrayList<Info>(...)List<Package> packagesnew ArrayList<Package>(...)Package aPackageClassInfo classInfonew PackageInfo(...)new MethodInfo(...)getConstructors(...)new FieldInfo(...)Info infoAnnotationInfo annotationList<Info> annotationInfosgetAnnotationInfos(...)PackageInfo packageInfoPackage pkgList<ClassInfo> seennew ArrayList<ClassInfo>(...)MethodInfo methodInfoList<Constructor<>> constructorsnew ArrayList<Constructor<>>(...)List<Field> fieldsFieldInfo fieldInfoString dirNameEnumeration<URL> classLoaderURLsscanDir(...)replaceFirst(...)ClassReader classReadernew ClassReader(...)accept(...)new InfoBuildingVisitor(...)ClassReader.SKIP_DEBUGInfo info, ...;Opcodes.ASM5javaName(...)String interfceextractSuperInterfaces(...)String superTypegetSuperType(...)ClassInfo baseList<String> interfacesgetSuperInterfaces(...)AnnotationInfo annotationInfogetFields(...)new InfoBuildingMethodVisitor(...)new HashMap<String,List<Info>>(...)new LinkedHashMap<String,ClassInfo>(...)DefaultClassFinder.class// See if it's actually a jar// double check via proper reflection// Scrape "META-INF" off// Classes packaged in an exploded .war (e.g. in a VFS file system) should not// have WEB-INF.classes in their package name.//war files are treated as .jar files, so takeout WEB-INF/classes//try to load baseimport InterceptorRefimport InterceptorRefsInterceptorRefs interceptorRefsInterceptorRefs.classInterceptorRef interceptorRefInterceptorRef.classnew InterceptorRef[]InterceptorRef[] interceptorsinterceptorRefs(...)InterceptorRef interceptorcreateParameterMap(...)params(...)DefaultInterceptorMapBuilder.class//from @InterceptorRefs annotation//from @InterceptorRef annotation//from @Action annotationimport ClassLoaderInterfaceDelegateimport ResourceFinderSet<String> relativeResultTypes, ...;boolean flatResultLayout, ...;/** Constructs the SimpleResultMapBuilder using the given result location. ... */this.relativeResultTypesthis.flatResultLayoutString defaultResultPathString resultPrefixcreateFromResources(...)getClassHierarchy(...)createResultsFromAnnotations(...)results(...)results(...).lengthcreateFromAnnotations(...)/** Creates results from @Results and @Result annotations ... */Results resultsAnnResults.classResult resultAnnResult.classnew Result[]/** Creates any result types from the resources available in the web application. This scans the ... */Set<String> pathsgetResourcePaths(...)String classPathLocationResourceFinder findernew ResourceFinder(...)substringAfterLast(...)makeResults(...)Map<String,URL> matchesTest<URL> resourceTestgetResourceTest(...)String urlStrClassLoaderInterface classLoaderInterfaceClassLoaderInterface.CLASS_LOADER_INTERFACEnew Test<URL>(...) { ... }/** Makes all the results for the given path. ... */int indexOfDotaddResult(...)createResultConfig(...)new ResultInfo(...)/** Checks if result was already assigned, if not checks global results first and if exists, adds reference to it. ... */Map<String,ResultConfig> globalResults/** Creates the result configuration for the single result annotation. This will use all the ... */info.typeinfo.locationString defaultParamNameinfo.namedetermineType(...)DefaultResultMapBuilder.class// Get the default result location from the annotation or configuration// Add a slash// Check for resources with the action name// Add that ending slash for concatenation//results from files//get inherited @Results and @Result (class level)//method level// Build from web application using the ServletContext// Building from the classpath/* if there is a ClassLoaderInterface in the context, use it, otherwise ... */// This case is when the path doesn't contain a result code// This case is when the path contains a result code// Check for multiple results on the class// Look up by the type that was determined from the annotation or by the extension in the// ResultInfo class// Add the default parameters for the result type config (if any)// Handle the annotation// Map the location to the default param for the result or a param named location// See if we can handle relative locations or not/** Builds the interceptor configurations given the action information. ... */import ReloadingClassLoaderimport com.opensymphony.xwork2.util.finder.*import org.apache.struts2.convention.annotation.*import AllowedMethodsboolean EXTRACT_BASE_INTERFACES, ...;ActionNameBuilder actionNameBuilder, ...;InterceptorMapBuilder interceptorMapBuilder, ...;String defaultParentPackage, ...;...[] actionPackages, ...;...[] excludePackages, ...;...[] packageLocators, ...;...[] includeJars, ...;String packageLocatorsBasePackage, ...;boolean disableActionScanning, ...;boolean disablePackageLocatorsScanning, ...;boolean checkImplementsAction, ...;boolean mapAllMatches, ...;ReloadingClassLoader reloadingClassLoader, ...;Set<String> fileProtocols, ...;boolean alwaysMapExecute, ...;boolean excludeParentClassLoader, ...;boolean slashesInActionNames, ...;boolean eagerLoading, ...;ClassFinderFactory classFinderFactory, ...;/** Constructs actions based on a list of packages. ... */this.actionNameBuilderActionNameBuilder.classConventionConstants.CONVENTION_ACTION_NAME_BUILDERthis.interceptorMapBuilderInterceptorMapBuilder.classConventionConstants.CONVENTION_INTERCEPTOR_MAP_BUILDERthis.defaultParentPackagethis.slashesInActionNamesthis.excludeParentClassLoaderthis.alwaysMapExecute/** File URLs whose protocol are in these list will be processed as jars containing classes ... */this.fileProtocolsthis.disableActionScanningthis.includeJarsthis.disablePackageLocatorsScanningthis.actionPackagesthis.checkImplementsActionthis.excludePackagesthis.packageLocatorsthis.packageLocatorsBasePackagethis.mapAllMatchesthis.eagerLoadingthis.classFinderFactoryisReloadEnabled(...)new ReloadingClassLoader(...)/** Builds the action configurations by loading all classes in the packages specified by the ... */initReloadClassLoader(...)Set<Class<>> classesfindActions(...)buildConfiguration(...)this.reloadingClassLoaderTest<String> classPackageTestgetClassPackageTest(...)readUrls(...)ClassFinder finderbuildClassFinder(...)Test<ClassInfo> testgetActionClassTest(...)ClassFinder.ClassInfofindClasses(...)new DefaultClassFinder(...)List<URL> resourceUrlsArrayList<URL> classesListbuildUrlSet(...)ClassLoaderInterface parentClassLoader systemClassLoadergetSystemClassLoader(...)includeClassesUrl(...)new UrlSet.FileProtocolNormalizer(...) { ... }UrlSet.FileProtocolNormalizerexcludeUserExtensionsDir(...)excludeJavaEndorsedDirs(...)excludeJavaExtDirs(...)excludeJavaHome(...)List<URL> rawIncludedUrlsSet<URL> includeUrlsboolean[] patternUsedincludeJars.lengthString includeJarpatternUsed.length/** Note that we can't include the test for {@link #actionSuffix} here ... */String classPackageNamesubstringBeforeLast(...)checkExcludePackages(...)checkActionPackages(...)checkPackageLocators(...)/** Checks if provided class package is on the exclude list ... */excludePackages.lengthWildcardHelper wildcardHelperMap<String,String> matchMapString packageExcludeint[] packagePattern/** Checks if class package match provided list of action packages ... */String strictPackageName/** Checks if class package match provided list of package locators ... */String packageLocatorString[] splitted/** Construct a {@link Test} object that determines if a specified class name ... */new Test<String>(...) { ... }includeClassNameInActionScan(...)/** Construct a {@link Test} Object that determines if a specified class ... */new Test<ClassInfo>(...) { ... }boolean inPackageboolean nameMatchesMap<String,Builder> packageConfigsnew HashMap<String,Builder>(...)Class<?> actionClassActions actionsAnnotationActions.classAction actionAnnotationString actionPackageList<String> namespacesdetermineActionNamespace(...)cannotInstantiate(...)String defaultActionNamedetermineActionName(...)Builder defaultPackageConfigMap<String,List<Action>> mapgetActionAnnotations(...)boolean hasDefaultMethodcontainsMethod(...)List<Action> actionsAction.DEFAULT_VALUEcreateActionConfig(...)Builder pkgCfgList<Action> actionAnnotationscheckActionsAnnotation(...)Action actionAnnotation2buildIndexActions(...)AllowedMethods annotationSet<String> methods/** Interfaces, enums, annotations, and abstract classes cannot be instantiated. ... */isAnonymousClass(...)isEnum(...)isAnnotation(...)Modifier.ABSTRACT/** Determines the namespace(s) for the action based on the action class. If there is a {@link Namespace} ... */Namespace namespaceAnnotationNamespace.classNamespaces namespacesAnnotationNamespaces.classString pkgPartNamespace namespacedeleteCharAt(...)String convertedNamespace/** Converts the class name into an action name using the ActionNameBuilder. ... *//** Locates all of the {@link Actions} and {@link Action} annotations on methods within the Action ... */new HashMap<String,List<Action>>(...)Action ann/** Builds a list of actions from an @Actions annotation, and check that they are not all empty ... */Action[] actionArrayboolean valuelessSeennew ArrayList<Action>(...)/** Creates a single ActionConfig object. ... */Builder actionConfigExceptionMappings exceptionMappingsExceptionMappings.classPackageConfig existingPkgclassName(...)exceptionMappings(...)ActionConfig existingActionConfigURL classFileExceptionMapping exceptionMappingexception(...)result(...)ParentPackage parentParentPackage.classPackageConfig parentPkgBuilder pkgConfigDefaultInterceptorRef defaultInterceptorRefDefaultInterceptorRef.class/** Determine all the index handling actions and results based on this logic: ... */Map<String,Builder> byNamespaceCollection<Builder> valuesBuilder packageConfigActionConfig indexActionConfigString parentActionString parentNamespaceBuilder parentPackageBasedActionConfigBuilder.class// Validate that the parameters are okay//when the configuration is reloaded, a new classloader will be setup//setup reload class loader based on dev settings// By default, ClassFinder scans EVERY class in the specified// url set, which can produce spurious warnings for non-action// classes that can't be loaded. We pass a package filter that// only considers classes that match the action packages// specified by the user// Usually the "classes" dir.//excluding the urls found by the parent class loader is desired, but fails in JBoss (all urls are removed)//exclude parent of classloaders//if reload is enabled, we need to step up one level, otherwise the UrlSet will be empty//this happens because the parent of the reloading class loader is the web app classloader// This may fail in some sandboxes, ie GAE//try to find classes dirs inside war files// This happens in GAE since the sandbox contains no java.home directory//it is a jar file, make sure it matches at least a url regex//we really don't care about the results, just the boolean// Why do we call includeClassNameInActionScan here, when it's// already been called to in the initial call to ClassFinder?// When some action class passes our package filter in that step,// ClassFinder automatically includes parent classes of that action,// such as com.opensymphony.xwork2.ActionSupport.  We repeat the// package filter here to filter out such results.// Skip classes that can't be instantiated// Tell the ObjectFactory about this class// Determine the action package// Determine the default namespace and action name// Verify that the annotations have no errors and also determine if the default action// configuration should still be built or not.// Check if there are duplicate action names in the annotations.// Check this annotation is the default action// Build the default// Build the actions for the annotations// some actions will not have any @Action or a default method, like the rest actions// where the action mapper is the one that finds the right method at runtime//if there are @Actions or @Action at the class level, create the mappings for them// Add the new actions to the configuration// Check if there is a class or package level annotation for the namespace//single namespace//multiple annotations//don't use default if there are annotations// check subpackage and not a part of package name, eg. actions -> my.actions.transactions - WW-3803// This ensures that the match is at the end, beginning or has a dot on each side of it//build interceptors//build results//add params//add exception mappings from annotation//add exception mapping from class//add//check if an action with the same name exists on that package (from XML config probably)// there is a package already with that name, check action//watch class file// Next grab the parent annotation from the class// Finally use the default// Grab based on package-namespace and if it exists, we need to ensure the existing one has// the correct parent package. If not, we need to create a new package config//check for @DefaultInterceptorRef in the package// Step #1// First see if the namespace has an index action// Step #2// Step #3/** Determines if the class given contains the method. ... *//** Retrieves the annotation from the given method in the given class. ... *//** Return the list of parent classes in order (Object will be at index 0) ... */List<Class<?>> classes/** Builds the result configurations given the action information. ... */char[] caStringBuilder buildboolean lowerca.lengthisUpperCase(...)SEOActionNameBuilder.class// Convert to underscoresint subtractparams.lengthString DEFAULT_VALUE, ...;/** Allows actions to specify different URLs rather than the default that is based on the package ... *//** Allows action methods to specifically control the results for specific return values. These ... *//** Allows action methods to specify what interceptors must be applied to it. ... *//** Allows actions to specify different class name. ... */ElementType.PACKAGE/** Defines the default interceptor for all actions ... */PackageConfig packageConfiguration, ...;ConventionUnknownHandler handlerconventionUnknownHandler(...)createStrictMock(...)ConventionUnknownHandler.ResourcedefaultResultsByExtension(...)Configuration mockRuntimeConfiguration runtimeRuntimeConfiguration.classpackageConfiguration(...)Container mockConventionsService serviceString defaultParentPackageNameconfiguration(...)container(...)new ConventionUnknownHandler(...)Iterator<String> extensionsSet<String> keysMap<String,ResultTypeConfig> mockPackageConfig mock// Verifies method call orderimport NoAnnotationActionimport org.apache.struts2.convention.actions.result.*import ClassLevelResultPathActionimport static ReflectionTools.getAnnotationServletContext contextmockServletContext(...)createPackageConfigBuilder(...)DefaultResultMapBuilder buildernew DefaultResultMapBuilder(...)NoAnnotationAction.classnew ConventionsServiceImpl(...)Action actionAnnOverrideResultAction.classResultTypeConfig resultTypeResultConfig globalErroraddGlobalResultConfig(...)GlobalResultAction.classString resultPathGlobalResultOverrideAction.classClassLevelResultPathAction.classsetFlatResultLayout(...)ClassLevelResultAction.classInheritedResultExtends.classOverrideInheritedResultExtends.classClassLevelResultsAction.classInheritedResultsExtends.classActionLevelResultAction.classActionLevelResultsAction.classActionLevelResultsNamesAction.classResultTypeConfig redirectResultTypeConfig ftlResultTypenew IAnswer<ConventionsService>(...) { ... }DefaultResultMapBuilderTest.this.conventionsServiceDefaultResultMapBuilderTest.this// Test with a slash// Test without a slash// Setup some mock jsps// Test with a result pathimport DefaultResultPathActionimport Skipimport org.apache.struts2.convention.actions.action.*import ClassLevelAllowedMethodsActionimport PackageLevelAllowedMethodsActionimport PackageLevelAllowedMethodsChildActionimport ChainedActionimport SingleActionNameAction2import ExceptionsActionLevelActionimport ExceptionsMethodLevelActionimport ExcludeActionimport ActionLevelInterceptor2Actionimport ActionLevelInterceptor3Actionimport ActionLevelInterceptorActionimport InterceptorsActionimport ActionLevelNamespaceActionimport ClassLevelNamespaceActionimport PackageLevelNamespaceActionimport DefaultNamespaceActionimport ActionLevelNamespacesActionimport ActionAndPackageLevelNamespacesActionimport ActionParamsMethodLevelActionimport ClassLevelParentPackageActionimport PackageLevelParentPackageActionimport ClassLevelParentPackageChildActionimport PackageLevelParentPackageChildActionimport PackageLevelResultPathActionimport Indeximport TransNameActionimport Actionsimport DontFindMeActionList<InterceptorConfig> defaultInterceptorsnew ArrayList<InterceptorConfig>(...)List<InterceptorStackConfig> defaultInterceptorStacksnew ArrayList<InterceptorStackConfig>(...)InterceptorMapping interceptor1new TestInterceptor(...)InterceptorMapping interceptor2ResultTypeConfig[] defaultResultsnew ResultTypeConfig[]PackageConfig strutsDefaultmakePackageConfig(...)PackageConfig packageLevelParentPkgPackageConfig classLevelParentPkgPackageConfig rootPkgPackageConfig paramsPkgPackageConfig defaultInterceptorPkgPackageConfig exceptionPkgPackageConfig actionPkgPackageConfig idxPkgPackageConfig idx2PkgPackageConfig interceptorRefsPkgPackageConfig packageLevelPkgPackageConfig packageLevelSubPkgPackageConfig packageLevelAllowedMethodsPkgPackageConfig packageLevelAllowedMethodsSubPkgPackageConfig classLevelAllowedMethodsPkgPackageConfig differentPkgPackageConfig differentSubPkgPackageConfig pkgLevelNamespacePkgPackageConfig classLevelNamespacePkgPackageConfig actionLevelNamespacePkgPackageConfig defaultNamespacePkgPackageConfig namespaces1PkgPackageConfig namespaces2PkgPackageConfig namespaces3PkgPackageConfig namespaces4PkgPackageConfig resultPkgPackageConfig globalResultPkgPackageConfig resultPathPkgPackageConfig skipPkgPackageConfig chainPkgPackageConfig transPkgPackageConfig excludePkgResultMapBuilder resultMapBuilderActions classLevelActionsClassLevelAnnotationsAction.classActions classLevelActionsDefaultMethodClassLevelAnnotationsDefaultMethodAction.classDummyContainer mockContainernew DefaultConfiguration(...) { ... }ActionNameBuilder actionNameBuildernew SEOActionNameBuilder(...)ObjectFactory ofDefaultInterceptorMapBuilder interceptorBuildernew DefaultInterceptorMapBuilder(...)PackageBasedActionConfigBuilder buildernew PackageBasedActionConfigBuilder(...)DefaultFileManagerFactory fileManagerFactoryPackageConfig pkgConfigList<ExceptionMappingConfig> exceptionsExceptionMappingConfig exceptionObjectFactory workingFactoryConventionUnknownHandler uhActionChainResult chainResultActionChainResult chainResultToComparemakeInterceptorConfig(...)makeInterceptorStackConfig(...)checkOrder(...)ActionNameAction.classClassNameAction.classActionNamesAction.classSingleActionNameAction.classTestExtends.classClassLevelAnnotationAction.classClassLevelAnnotationDefaultMethodAction.classIndex.classActionParamsMethodLevelAction.classSingleActionNameAction2.classExceptionsMethodLevelAction.classExceptionsActionLevelAction.classInterceptorsAction.classActionLevelInterceptorAction.classActionLevelInterceptor2Action.classActionLevelInterceptor3Action.classActionLevelNamespaceAction.classClassLevelNamespaceAction.classPackageLevelNamespaceAction.classDefaultNamespaceAction.classActionLevelNamespacesAction.classActionAndPackageLevelNamespacesAction.classPackageLevelParentPackageAction.classPackageLevelParentPackageChildAction.classClassLevelParentPackageAction.classClassLevelParentPackageChildAction.classClassLevelAllowedMethodsAction.classPackageLevelAllowedMethodsAction.classPackageLevelAllowedMethodsChildAction.classPackageLevelResultPathAction.classDefaultResultPathAction.classSkip.classChainedAction.classTransNameAction.classExcludeAction.classsetActionNameBuilder(...)setInterceptorMapBuilder(...)setResultMapBuilder(...)setConventionsService(...)setFileProtocols(...)setActionPackages(...)setPackageLocators(...)setExcludePackages(...)setPackageLocatorsBase(...)verifyActionConfig(...)verifyMissingActionConfig(...)DontFindMeAction.classgetDefaultInterceptorRef(...)verifyActionConfigInterceptors(...)InterceptorConfig refInterceptorStackConfig refnew MyPackageConfig(...)InterceptorMapping interceptorDefaultFileManagerFactory fileManagerFactory, ...;T objOgnlReflectionProvider rpnew OgnlReflectionProvider(...) { ... }DefaultInterceptorFactory difnew DefaultInterceptorFactory(...)DefaultResultFactory drfnew DefaultResultFactory(...)setReflectionProvider(...)setInterceptorFactory(...)setResultFactory(...)//setup interceptors//setup interceptor stacks//setup results// Unexpected method call build(class org.apache.struts2.convention.actions.allowedmethods.PackageLevelAllowedMethodsAction, null, "package-level-allowed-methods", PackageConfig: [org.apache.struts2.convention.actions.allowedmethods#struts-default#/allowedmethods] for namespace [/allowedmethods] with parents [[PackageConfig: [struts-default] for namespace [] with parents [[]]]]):/* org.apache.struts2.convention.actions.action *//* org.apache.struts2.convention.actions.idx *//* org.apache.struts2.convention.actions.idx.idx2 *//* org.apache.struts2.convention.actions.params *//* org.apache.struts2.convention.actions.defaultinterceptor *//* org.apache.struts2.convention.actions.exception *//* org.apache.struts2.convention.actions.interceptor *//* org.apache.struts2.convention.actions.namespace *//* org.apache.struts2.convention.actions.namespace2 *//* org.apache.struts2.convention.actions.namespace3 *//* org.apache.struts2.convention.actions.namespace4 *//* org.apache.struts2.convention.actions.parentpackage *//* org.apache.struts2.convention.actions.allowedmethods *//* org.apache.struts2.convention.actions.result *//* org.apache.struts2.convention.actions.resultpath *//* org.apache.struts2.convention.actions *//* org.apache.struts2.convention.actions.skip *//* org.apache.struts2.convention.actions.chain *//* org.apache.struts2.convention.actions.transactions *//* org.apache.struts2.convention.actions.exclude */// this is only expected when excludePackages was specified with org.apache.struts2.convention.actions.exclude package//set beans on mock container//action on namespace1 (action level)//action on namespace2 (action level)//action on namespace3 (action level)//action on namespace4 (package level)/* org.apache.struts2.convention.actions.namespace action level *//* org.apache.struts2.convention.actions.namespace class level *//* org.apache.struts2.convention.actions.namespace package level *//* org.apache.struts2.convention.actions.parentpackage class level *//* org.apache.struts2.convention.actions.parentpackage.sub class level *//* org.apache.struts2.convention.actions.parentpackage package level *//* org.apache.struts2.convention.actions.parentpackage.sub package level *//* org.apache.struts2.convention.actions.allowedmethods class level *//* org.apache.struts2.convention.actions.allowedmethods.sub package level *//* org.apache.struts2.convention.actions.interceptorRefs */// Interceptors at class level//multiple interceptor at class level//test unknown handler automatic chainingSEOActionNameBuilder builderString string1, ...;this.string1/* $Id: ActionNamesAction.java 655902 2008-05-13 15:15:12Z bpontarelli $ ... */import ExceptionMappingimport ExceptionMappings/* $Id: ActionLevelResultAction.java 655902 2008-05-13 15:15:12Z bpontarelli $ ... */import Namespaces/** Extends an action that hass a @ParentPackage at the class level *//* $Id: ClassLevelParentPackageAction.java 655902 2008-05-13 15:15:12Z bpontarelli $ ... *//** Extends a class the has a @ParentPackage at the package level *//** Used to test that &lt;global-results&gt; in struts.xml are respected. ... *//** Used to test that &lt;global-results&gt; in struts.xml are are overridden when a matching result location can be ... *//* $Id: ActionNameAction.java 655902 2008-05-13 15:15:12Z bpontarelli $ ... *///should never be found by the scannerimport WebContextFactoryBuilder requestParamsHashMap<String,Object> ctxValidationAware awareValidationAwareSupport vasDWRValidator.class// don't actually execute the action/** Can render jsps from the classpath. "includes" in the jsps must not use relative paths */import UrlSetimport MemoryClassLoaderimport MemoryJavaFileObjectimport JasperExceptionimport JspCimport JspPageimport DiagnosticCollectorimport FileObjectimport ForwardingJavaFileManagerimport JavaCompilerimport JavaFileManagerimport JavaFileObjectimport SimpleJavaFileObjectimport StandardJavaFileManagerimport ToolProviderimport CodeSourceimport ProtectionDomain/** Uses jasper to extract a JSP from the classpath to a file and compile it. The classpath used for ... */MemoryClassLoader classLoader, ...;String DEFAULT_PACKAGE, ...;Pattern PACKAGE_PATTERN, ...;Pattern CLASS_PATTERN, ...;JspC jspCcompileJSP(...)String sourcegetSourceCode(...)extractClassName(...)compileJava(...)getTldAbsolutePaths(...)createServlet(...)/** Creates and inits a servlet */JSPServletConfig confignew JSPServletConfig(...)/** Compiles the given source code into java bytecode */JavaCompiler compilergetSystemJavaCompiler(...)DiagnosticCollector<JavaFileObject> diagnosticsnew DiagnosticCollector<JavaFileObject>(...)JavaFileManager jfmnew ForwardingJavaFileManager<StandardJavaFileManager>(...) { ... }getStandardFileManager(...)JavaFileObject.KindMemoryJavaFileObject fileObjectnew MemoryJavaFileObject(...)addMemoryJavaFileObject(...)SimpleJavaFileObject sourceCodeObjectnew SimpleJavaFileObject(...) { ... }JavaFileObject.Kind.SOURCEList<String> optionListSet<String> classPathString classPathStringJavaCompiler.CompilationTaskCompilationTask taskgetTask(...)getJarUrl(...)EmbeddedJSPResult.classServlet.classJspPage.classClass<> annotationsProcessorIterator<String> iteratorString entrygetDiagnostics(...)ProtectionDomain protectionDomaingetProtectionDomain(...)CodeSource codeSourcegetCodeSource(...)URL locnew JspC(...)setClassLoaderInterface(...)setCompile(...)setJspFiles(...)setPackage(...)JSPLoader.classnew MemoryClassLoader(...)//use Jasper to compile the JSP into java code//System.out.print(source);//use Java Compiler API to compile the java code into a class//the tlds that were discovered are added (their jars) to the classpath//load the class that was just built/* there is no need to call JspPage.init explicitly because Jasper's ... *///the generated bytecode is fed to the class loader//read java source code from memory//build classpath//some entries will be added multiple times, hence the set//find available jars//these should be in the list already, but I am feeling paranoid//this jar//servlet api//jsp api//ok ignore//add extra classpath entries (jars where tlds were found will be here)//compileimport HttpJspPage/** Maintains a cache of jsp locations -&gt; servlet instances for those jsps. When a jsp is requested ... */ServletCache servletCache, ...;//maps from jsp path -> pageletUrlHelper urlHelperHttpJspPage page_jspService(...)new ServletCache(...)//extract params from the url and add them to the request/** Used to init the servlets for the jsps */Enumeration<> EMPTY_ENUMERATION, ...;/** Caches servlet instances by jsp location. If a requested jsp is not in the cache, "get" ... */ConcurrentMap<String,Future<Servlet>> cache, ...;JSPLoader jspLoader, ...;Future<Servlet> futureCallable<Servlet> loadJSPCallablenew Callable<Servlet>(...) { ... }FutureTask<Servlet> futureTasknew FutureTask<Servlet>(...)CancellationException elaunderThrowable(...)new ConcurrentHashMap<String,Future<Servlet>>(...)new JSPLoader(...)/** Keeps a cache of class name -&gt; MemoryJavaFileObject. If the requested class name is in the cache ... */Map<String,MemoryJavaFileObject> cachedObjects, ...;findClass(...)new ConcurrentHashMap<String,MemoryJavaFileObject>(...)//without this, the tests will not run, because the tests are loaded by a custom classloader//so the classes referenced from the compiled code will not be found by the System Class Loader because//the target dir is not part of the classpath used when calling the jvm to execute the tests/** Captures the output of the java compiler in memory */ByteArrayOutputStream out, ...;import ELContextimport ExpressionFactoryimport MethodExpressionimport ValueExpressionimport ELSupportimport ExpressionBuilderimport MessageFactorycoerceToType(...)ExpressionBuilder buildernew ExpressionBuilder(...)createMethodExpression(...)createValueExpression(...)new ValueExpressionLiteral(...)import Externalizableimport ObjectInputimport ObjectOutputimport ELExceptionimport ELResolverimport Expressionimport FunctionMapperimport MethodInfoimport MethodNotFoundExceptionimport PropertyNotFoundExceptionimport VariableMapperimport EvaluationContextimport ReflectionUtil/** An <code>Expression</code> that refers to a method on an object. ... */Class<> expectedType, ...;String expr, ...;FunctionMapper fnMapper, ...;VariableMapper varMapper, ...;Node node, ...;...[] paramTypes, ...;this.exprthis.nodethis.fnMapperthis.varMapperthis.expectedTypethis.paramTypes/** Determines whether the specified object is equal to this ... *//** Returns the original String used to create this <code>Expression</code>, ... *//** Evaluates the expression relative to the provided context, and returns ... */EvaluationContext ctxnew EvaluationContext(...)getMethodInfo(...)createNode(...)/** Returns the hash code for this <code>Expression</code>. ... *//** Evaluates the expression relative to the provided context, invokes the ... */readUTF(...)toTypeArray(...)writeUTF(...)toTypeNameArray(...)import PropertyNotWritableExceptionimport AstLiteralExpression/** An <code>Expression</code> that can get or set a value. ... *//** Returns the type the result of the expression will be coerced to after ... */ELException eleisReadOnly(...)new PropertyNotWritableException(...)ve.value/** A helper class of Arithmetic defined by the EL Specification ... */divide(...)BigDecimal.ROUND_HALF_UPsubtract(...)multiply(...)mod(...)isStringFloat(...)BigDecimalDelegate BIGDECIMAL, ...;BigIntegerDelegate BIGINTEGER, ...;DoubleDelegate DOUBLE, ...;LongDelegate LONG, ...;Long ZERO, ...;ELArithmetic delegateNumber num0coerce(...)Number num1isNumberType(...)new Short(...)new BigDecimalDelegate(...)new BigIntegerDelegate(...)new DoubleDelegate(...)new LongDelegate(...)// could only be one of theseimport PropertyEditorimport PropertyEditorManager/** A helper class that implements the EL Specification ... */new PropertyNotFoundException(...)isBigDecimalOp(...)BigDecimal bd0coerceToNumber(...)BigDecimal bd1isDoubleOp(...)Double d0Double d1isBigIntegerOp(...)BigInteger bi0BigInteger bi1isLongOp(...)Long l0Long l1coerceToString(...)new ELException(...)coerceToBoolean(...)coerceToEnum(...)int lexCompareClass<> objTypeshortValue(...)toFloat(...)toNumber(...)byteValue(...)coerceToCharacter(...)PropertyEditor editorfindEditor(...)setAsText(...)NumberFormatException e0NumberFormatException e1// new to specELContext elContext, ...;this.elContextgetELResolver(...)isPropertyResolved(...)putContext(...)setPropertyResolved(...)import MethodExpressionImplimport MethodExpressionLiteralimport ValueExpressionImplimport AstCompositeExpressionimport AstDeferredExpressionimport AstDynamicExpressionimport AstFunctionimport AstIdentifierimport AstValueimport ELParserimport NodeVisitorimport ConcurrentCacheConcurrentCache<String,Node> cache, ...;FunctionMapper ctxFngetFunctionMapper(...)VariableMapper ctxVargetVariableMapper(...)new FunctionMapperFactory(...)new VariableMapperFactory(...)createNodeInternal(...)CompositeExpression(...)new ELParser(...)int numChildrenParseException peAstFunction funcNoderesolveFunction(...)int pcntgetOutputName(...)String variablegetImage(...)resolveVariable(...)new ValueExpressionImpl(...)new MethodExpressionImpl(...)new MethodExpressionLiteral(...)new ConcurrentCache<String,Node>(...)// validate composite expression// simply capture itFunctionMapperImpl memento, ...;FunctionMapper target, ...;this.mementonew FunctionMapperImpl(...)addFunction(...)Map<String,Function> functions, ...;this.functionsFunction fnew Function(...)new HashMap<String,Function>(...)Method m, ...;String owner, ...;...[] types, ...;String prefix, ...;String localName, ...;this.prefixthis.localNamethis.mthis.ownerthis.typesClass<> tClass<>[] p// for serialization// make sure m isn't nullVariableMapper target, ...;VariableMapper momento, ...;this.momentoValueExpression exprnew VariableMapperImpl(...)setVariable(...)Map<String,ValueExpression> vars, ...;this.varsnew HashMap<String,ValueExpression>(...)Boolean b/* Generated By:JJTree: Do not edit this line. AstAnd.java *//* Generated By:JJTree: Do not edit this line. AstBracketSuffix.java */Object obj0Boolean b0/* Generated By:JJTree: Do not edit this line. AstChoice.java */this.children.length/* Generated By:JJTree: Do not edit this line. AstCompositeExpression.java *//* Generated By:JJTree: Do not edit this line. AstDeferredExpression.java */import ELArithmetic/* Generated By:JJTree: Do not edit this line. AstDiv.java */this.image/* Generated By:JJTree: Do not edit this line. AstDotSuffix.java *//* Generated By:JJTree: Do not edit this line. AstDynamicExpression.java *//* Generated By:JJTree: Do not edit this line. AstEmpty.java *//* Generated By:JJTree: Do not edit this line. AstEqual.java *//* Generated By:JJTree: Do not edit this line. AstFalse.java */Number number, ...;ArithmeticException e0getFloatingPoint(...)/* Generated By:JJTree: Do not edit this line. AstFloatingPoint.java */FunctionMapper fnMapperClass<>[] paramTypesint numParamsIllegalAccessException iaeInvocationTargetException iteELParserTreeConstants.jjtNodeName/* Generated By:JJTree: Do not edit this line. AstFunction.java */// quickly validate again for this request/* Generated By:JJTree: Do not edit this line. AstGreaterThan.java *//* Generated By:JJTree: Do not edit this line. AstGreaterThanEqual.java */VariableMapper varMappergetELContext(...)MethodExpression menew MethodNotFoundException(...)getMethodExpression(...)ValueExpression ve/* Generated By:JJTree: Do not edit this line. AstIdentifier.java */// case A: ValueExpression exists, getValue which must// be a MethodExpression// case B: evaluate the identity against the ELResolver, again, must be// a MethodExpression to be able to invoke// finally provide helpful hintsArithmeticException e1getInteger(...)/* Generated By:JJTree: Do not edit this line. AstInteger.java *//* Generated By:JJTree: Do not edit this line. AstLessThan.java *//* Generated By:JJTree: Do not edit this line. AstLessThanEqual.java */StringBuffer bufchar c1/* Generated By:JJTree: Do not edit this line. AstLiteralExpression.java *//* Generated By:JJTree: Do not edit this line. AstMinus.java *//* Generated By:JJTree: Do not edit this line. AstMod.java *//* Generated By:JJTree: Do not edit this line. AstMult.java */Long num/* Generated By:JJTree: Do not edit this line. AstNegative.java *//* Generated By:JJTree: Do not edit this line. AstNot.java *//* Generated By:JJTree: Do not edit this line. AstNotEqual.java *//* Generated By:JJTree: Do not edit this line. AstNull.java *//* Generated By:JJTree: Do not edit this line. AstOr.java *//* Generated By:JJTree: Do not edit this line. AstPlus.java */String string, ...;this.string/* Generated By:JJTree: Do not edit this line. AstString.java *//* Generated By:JJTree: Do not edit this line. AstTrue.java */boolean COERCE_TO_ZERO, ...;Object base, ...;Object property, ...;Target tt.baset.propertyObject baseObject propertyint propCountELResolver resolvernew Target(...)Class<?> targetClassisAssignable(...)/* Generated By:JJTree: Do not edit this line. AstValue.java */// evaluate expr-a to value-a// if our base is null (we know there are more properites to evaluate)// set up our start/end// evaluate any properties before our target// if we are in this block, we have more properties to resolve,// but our base was null// coerce to the expected typeJJTELParserState jjtree, ...;/* @bgen(jjtree) *//* CompositeExpression ... */AstCompositeExpression jjtn000new AstCompositeExpression(...)boolean jjtc000openNodeScope(...)jj_ntk(...)DeferredExpression(...)DynamicExpression(...)LiteralExpression(...)jj_consume_token(...)new ParseException(...)closeNodeScope(...)Throwable jjte000clearNodeScope(...)popNode(...)new Error(...)/* LiteralExpression ... */AstLiteralExpression jjtn000new AstLiteralExpression(...)Token tsetImage(...)t.image/* DeferredExpression ... */AstDeferredExpression jjtn000new AstDeferredExpression(...)Expression(...)/* DynamicExpression ... */AstDynamicExpression jjtn000new AstDynamicExpression(...)/* Expression ... */Choice(...)/* Choice ... */Or(...)AstChoice jjtn001new AstChoice(...)boolean jjtc001jj_2_1(...)Throwable jjte001/* Or ... */And(...)AstOr jjtn001new AstOr(...)/* And ... */Equality(...)AstAnd jjtn001new AstAnd(...)/* Equality ... */Compare(...)AstEqual jjtn001new AstEqual(...)AstNotEqual jjtn002new AstNotEqual(...)boolean jjtc002Throwable jjte002/* Compare ... */Math(...)AstLessThan jjtn001new AstLessThan(...)AstGreaterThan jjtn002new AstGreaterThan(...)AstLessThanEqual jjtn003new AstLessThanEqual(...)boolean jjtc003AstGreaterThanEqual jjtn004new AstGreaterThanEqual(...)boolean jjtc004Throwable jjte003Throwable jjte004/* Math ... */Multiplication(...)AstPlus jjtn001new AstPlus(...)AstMinus jjtn002new AstMinus(...)/* Multiplication ... */Unary(...)AstMult jjtn001new AstMult(...)AstDiv jjtn002new AstDiv(...)AstMod jjtn003new AstMod(...)/* Unary ... */AstNegative jjtn001new AstNegative(...)AstNot jjtn002new AstNot(...)AstEmpty jjtn003new AstEmpty(...)Value(...)/* Value ... */AstValue jjtn001new AstValue(...)ValuePrefix(...)ValueSuffix(...)nodeArity(...)/* ValuePrefix ... */Literal(...)NonLiteral(...)/* ValueSuffix ... */DotSuffix(...)BracketSuffix(...)/* DotSuffix ... */AstDotSuffix jjtn000new AstDotSuffix(...)/* BracketSuffix ... */AstBracketSuffix jjtn000new AstBracketSuffix(...)/* NonLiteral ... */jj_2_2(...)Function(...)Identifier(...)/* Identifier ... */AstIdentifier jjtn000new AstIdentifier(...)/* Function ... */AstFunction jjtn000new AstFunction(...)Token t0Token t1jj_2_3(...)setPrefix(...)t0.imagesetLocalName(...)t1.image/* Literal ... */Boolean(...)FloatingPoint(...)Integer(...)String(...)Null(...)/* Boolean ... */AstTrue jjtn001new AstTrue(...)AstFalse jjtn002new AstFalse(...)/* FloatinPoint ... */AstFloatingPoint jjtn000new AstFloatingPoint(...)/* Integer ... */AstInteger jjtn000new AstInteger(...)/* String ... */AstString jjtn000new AstString(...)/* Null ... */AstNull jjtn000new AstNull(...)jj_3_1(...)LookaheadSuccess lsjj_save(...)jj_3_2(...)jj_3_3(...)Token xspjj_3R_30(...)jj_3R_31(...)jj_scan_token(...)jj_3R_12(...)jj_3R_32(...)jj_3R_33(...)jj_3R_68(...)jj_3R_24(...)jj_3R_25(...)jj_3R_67(...)jj_3R_66(...)jj_3R_56(...)jj_3R_57(...)jj_3R_58(...)jj_3R_26(...)jj_3R_27(...)jj_3R_28(...)jj_3R_29(...)jj_3R_60(...)jj_3R_20(...)jj_3R_21(...)jj_3R_22(...)jj_3R_23(...)jj_3R_59(...)jj_3R_49(...)jj_3R_50(...)jj_3R_18(...)jj_3R_19(...)jj_3R_46(...)jj_3R_48(...)jj_3R_47(...)jj_3R_16(...)jj_3R_17(...)jj_3R_44(...)jj_3R_45(...)jj_3R_69(...)jj_3R_70(...)jj_3R_14(...)jj_3R_15(...)jj_3R_42(...)jj_3R_43(...)jj_3R_65(...)jj_3R_64(...)jj_3R_63(...)jj_3R_11(...)jj_3R_62(...)jj_3R_41(...)jj_3R_61(...)jj_3R_51(...)jj_3R_52(...)jj_3R_53(...)jj_3R_54(...)jj_3R_55(...)jj_3R_13(...)jj_3R_34(...)jj_3R_35(...)jj_3R_36(...)jj_3R_37(...)jj_3R_38(...)jj_3R_39(...)jj_3R_40(...)ELParserTokenManager token_source, ...;/** Generated Token Manager. */SimpleCharStream jj_input_stream, ...;Token token, ...;/** Current token. */Token jj_nt, ...;/** Next token. */int jj_ntk, ...;Token jj_scanpos, ...;int jj_la, ...;int jj_gen, ...;...[] jj_la1, ...;...[] jj_la1_0, ...;...[] jj_la1_1, ...;...[] jj_2_rtns, ...;boolean jj_rescan, ...;int jj_gc, ...;/** Constructor with InputStream. ... *//** Constructor with InputStream and supplied encoding ... */new SimpleCharStream(...)new ELParserTokenManager(...)jj_2_rtns.lengthnew JJCalls(...)/** Reinitialise. ... */ReInit(...)/** Constructor with generated Token Manager. ... */Token oldToken(...).nexttoken.nextgetNextToken(...)token.kindJJCalls cc.genc.firstc.nextgenerateParseException(...)LookaheadSuccess jj_ls, ...;jj_scanpos.nextToken toktok.nextjj_add_error_token(...)jj_scanpos.kindt.next(...).kindjj_nt.kindList<> jj_expentries, ...;...[] jj_expentry, ...;int jj_kind, ...;...[] jj_lasttokens, ...;int jj_endpos, ...;int[] oldentryoldentry.lengthjj_expentry.lengthboolean[] la1tokensint[][] exptokseqnew int[][]jj_rescan_token(...)/** Enable tracing. *//** Disable tracing. */JJCalls pp.genp.argp.firstp.nextint gen, ...;Token first, ...;int arg, ...;JJCalls next, ...;new JJTELParserState(...)new JJCalls[]new LookaheadSuccess(...)jj_la1_init_0(...)jj_la1_init_1(...)/* Generated By:JJTree&JavaCC: Do not edit this line. ELParser.java *//* @bgen(jjtree) CompositeExpression *//* @bgen(jjtree) LiteralExpression *//* @bgen(jjtree) DeferredExpression *//* @bgen(jjtree) DynamicExpression *//* @bgen(jjtree) DotSuffix *//* @bgen(jjtree) BracketSuffix *//* @bgen(jjtree) Identifier *//* @bgen(jjtree) Function *//* @bgen(jjtree) FloatingPoint *//* @bgen(jjtree) Integer *//* @bgen(jjtree) String *//* @bgen(jjtree) Null *//** Token literal values and constants. ... */int EOF, ...;/** End of File. */int LITERAL_EXPRESSION, ...;/** RegularExpression Id. */int START_DYNAMIC_EXPRESSION, ...;int START_DEFERRED_EXPRESSION, ...;int INTEGER_LITERAL, ...;int FLOATING_POINT_LITERAL, ...;int EXPONENT, ...;int STRING_LITERAL, ...;int BADLY_ESCAPED_STRING_LITERAL, ...;int TRUE, ...;int FALSE, ...;int NULL, ...;int END_EXPRESSION, ...;int DOT, ...;int LPAREN, ...;int RPAREN, ...;int LBRACK, ...;int RBRACK, ...;int COLON, ...;int COMMA, ...;int GT0, ...;int GT1, ...;int LT0, ...;int LT1, ...;int GE0, ...;int GE1, ...;int LE0, ...;int LE1, ...;int EQ0, ...;int EQ1, ...;int NE0, ...;int NE1, ...;int NOT0, ...;int NOT1, ...;int AND0, ...;int AND1, ...;int OR0, ...;int OR1, ...;int EMPTY, ...;int INSTANCEOF, ...;int MULT, ...;int PLUS, ...;int MINUS, ...;int QUESTIONMARK, ...;int DIV0, ...;int DIV1, ...;int MOD0, ...;int MOD1, ...;int IDENTIFIER, ...;int FUNCTIONSUFFIX, ...;int IMPL_OBJ_START, ...;int LETTER, ...;int DIGIT, ...;int ILLEGAL_CHARACTER, ...;int DEFAULT, ...;/** Lexical state. */int IN_EXPRESSION, ...;...[] tokenImage, ...;/** Literal token values. *//* Generated By:JJTree&JavaCC: Do not edit this line. ELParserConstants.java *//** Token Manager. */PrintStream debugStream, ...;/** Debug output. */jjMoveNfa_0(...)jjStopStringLiteralDfa_0(...)jjMoveStringLiteralDfa1_0(...)jjStartNfaWithStates_0(...)readChar(...)jjStopAtPos(...)jjStartNfa_0(...)...[] jjbitVec0, ...;...[] jjbitVec2, ...;int startsAtint kindReInitRounds(...)long ljjCheckNAddStates(...)int hiByteint i1long l1int i2long l2jjCanMove_0(...)jjMoveNfa_1(...)jjStopStringLiteralDfa_1(...)jjMoveStringLiteralDfa1_1(...)jjStartNfaWithStates_1(...)jjMoveStringLiteralDfa2_1(...)jjStartNfa_1(...)...&=...jjMoveStringLiteralDfa3_1(...)jjMoveStringLiteralDfa4_1(...)jjMoveStringLiteralDfa5_1(...)jjMoveStringLiteralDfa6_1(...)jjMoveStringLiteralDfa7_1(...)jjMoveStringLiteralDfa8_1(...)jjMoveStringLiteralDfa9_1(...)...[] jjbitVec3, ...;...[] jjbitVec4, ...;...[] jjbitVec5, ...;...[] jjbitVec6, ...;...[] jjbitVec7, ...;...[] jjbitVec8, ...;jjCheckNAddTwoStates(...)jjCheckNAdd(...)jjAddStates(...)jjCanMove_1(...)...[] jjnextStates, ...;...[] jjstrLiteralImages, ...;/** Token literal values. */...[] lexStateNames, ...;/** Lexer state names. */...[] jjnewLexState, ...;/** Lex State array. */...[] jjtoToken, ...;...[] jjtoSkip, ...;SimpleCharStream input_stream, ...;...[] jjrounds, ...;...[] jjstateSet, ...;char curChar, ...;SimpleCharStream.staticFlagSwitchTo(...)/** Reinitialise parser. ... *//** Switch to specified lex state. ... */new TokenMgrError(...)TokenMgrError.INVALID_LEXICAL_STATEString curTokenImageint beginLineint beginColumnint endColumnString imGetImage(...)getBeginLine(...)getBeginColumn(...)getEndLine(...)getEndColumn(...)newToken(...)t.beginLinet.endLinet.beginColumnt.endColumnint curLexState, ...;int defaultLexState, ...;int jjnewStateCnt, ...;int jjround, ...;int jjmatchedPos, ...;int jjmatchedKind, ...;Token matchedTokenint curPosint error_lineint error_columnString error_afterboolean EOFSeenBeginToken(...)jjFillToken(...)jjMoveStringLiteralDfa0_0(...)backup(...)jjMoveStringLiteralDfa0_1(...)TokenMgrError.LEXICAL_ERROR/* Generated By:JJTree&JavaCC: Do not edit this line. ELParserTokenManager.java */int JJTCOMPOSITEEXPRESSION, ...;int JJTLITERALEXPRESSION, ...;int JJTDEFERREDEXPRESSION, ...;int JJTDYNAMICEXPRESSION, ...;int JJTVOID, ...;int JJTCHOICE, ...;int JJTOR, ...;int JJTAND, ...;int JJTEQUAL, ...;int JJTNOTEQUAL, ...;int JJTLESSTHAN, ...;int JJTGREATERTHAN, ...;int JJTLESSTHANEQUAL, ...;int JJTGREATERTHANEQUAL, ...;int JJTPLUS, ...;int JJTMINUS, ...;int JJTMULT, ...;int JJTDIV, ...;int JJTMOD, ...;int JJTNEGATIVE, ...;int JJTNOT, ...;int JJTEMPTY, ...;int JJTVALUE, ...;int JJTDOTSUFFIX, ...;int JJTBRACKETSUFFIX, ...;int JJTIDENTIFIER, ...;int JJTFUNCTION, ...;int JJTTRUE, ...;int JJTFALSE, ...;int JJTFLOATINGPOINT, ...;int JJTINTEGER, ...;int JJTSTRING, ...;int JJTNULL, ...;...[] jjtNodeName, ...;/* Generated By:JavaCC: Do not edit this line. ELParserTreeConstants.java Version 4.1 *//* JavaCC - OriginalChecksum=3f8a43fb30bdf082a70de7eb7b15fdf1 (do not edit this line) */List<> nodes, ...;List<> marks, ...;int sp, ...;int mk, ...;// number of nodes on stackboolean node_created, ...;// current mark/* Determines whether the current node was actually closed and ... *//* Call this to reinitialize the node stack.  It is called ... *//* Returns the root node of the AST.  It only makes sense to call ... *//* Pushes a node on to the stack. *//* Returns the node on the top of the stack, and remove it from the ... *//* Returns the node currently on the top of the stack. *//* Returns the number of children on the stack in the current node ... */jjtOpen(...)/* A definite node is constructed from a specified number of ... */Node cjjtSetParent(...)jjtAddChild(...)jjtClose(...)pushNode(...)/* A conditional node is constructed if its condition is true.  All ... *//* Generated By:JavaCC: Do not edit this line. JJTELParserState.java Version 4.1 *//* JavaCC - OriginalChecksum=9497b88da93266c314e4e50d08492496 (do not edit this line) *//* All AST nodes must implement this interface.  It provides basic ... *//** This method is called after the node has been made the current ... *//** This method is called after all the child nodes have been ... *//** This pair of methods are used to inform the node of its ... *//** This method tells the node to add its argument to the node's ... *//** This method returns a child node.  The children are numbered ... *//* Generated By:JJTree: Do not edit this line. Node.java *//** This exception is thrown when parse errors are encountered. ... *//** This constructor is used by the method "generateParseException" ... *//** The following constructors are for use by you for whatever ... *//** Constructor with message. ... */boolean specialConstructor, ...;/** This variable determines which constructor was used to create ... */Token currentToken, ...;/** This is the last token that has been consumed successfully.  If ... */...[] expectedTokenSequences, ...;/** Each entry in this array is an array of integers.  Each array ... *//** This is a reference to the "tokenImage" array of the generated ... *//** This method has the standard behavior when this object has been ... */StringBuilder expectedString retvalcurrentToken.nextint[] expectedTokenSequenceexpectedTokenSequence.lengthint anExpectedTokenSequencetok.kindadd_escapes(...)tok.imagecurrentToken.next.beginColumncurrentToken.next.beginLineexpectedTokenSequences.lengthString eol, ...;/** The end of line string for this machine. *//** Used to convert raw characters to their escaped version ... */StringBuilder retval/* Generated By:JavaCC: Do not edit this line. ParseException.java Version 4.1 *//* JavaCCOptions:KEEP_LINE_COL=null *//* JavaCC - OriginalChecksum=a147e4edaa2a39e08e6f250c30247549 (do not edit this line) *//** An implementation of interface CharStream, where the stream is assumed to ... */boolean staticFlag, ...;/** Whether parser is static. */int bufsize, ...;int available, ...;int tokenBegin, ...;int bufpos, ...;/** Position in buffer. */...[] bufline, ...;...[] bufcolumn, ...;boolean prevCharIsCR, ...;boolean prevCharIsLF, ...;Reader inputStream, ...;int maxNextCharInd, ...;int inBuf, ...;int tabSize, ...;char[] newbufferint[] newbuflineint[] newbufcolumnExpandBuff(...)/** Start. ... *//** Read a character. ... */FillBuff(...)UpdateLineColumn(...)/** Backup a number of characters. ... */char[] ret/** Reset buffer when finished. *//** Method to adjust line and column numbers for the start of a token. ... */int nextColDiffint columnDiff/* Generated By:JavaCC: Do not edit this line. SimpleCharStream.java Version 4.1 *//* JavaCCOptions:STATIC=false *//* JavaCC - OriginalChecksum=07e88967db3720fcfc378bbb17e7f640 (do not edit this line) */Node parent, ...;...[] children, ...;String image, ...;children.lengthNode[] c/* You can override these two methods in subclasses of SimpleNode to ... *//* Override this method if you want to customize how the node dumps out its ... */SimpleNode ndump(...)visit(...)/* Generated By:JJTree: Do not edit this line. SimpleNode.java *//** Describes the input token stream. */int kind, ...;/** An integer that describes the kind of this token.  This numbering ... */int beginLine, ...;/** The line number of the first character of this Token. */int beginColumn, ...;/** The column number of the first character of this Token. */int endLine, ...;/** The line number of the last character of this Token. */int endColumn, ...;/** The column number of the last character of this Token. *//** The string image of the token. */Token next, ...;/** A reference to the next regular (non-special) token from the input ... */Token specialToken, ...;/** This field is used to access special tokens that occur prior to this ... *//** An optional attribute value of the Token. ... *//** No-argument constructor *//** Constructs a new token for the specified Image. ... *//** Constructs a new token for the specified Image and Kind. ... */this.kind/** Returns a new Token object, by default. However, if you want, you ... *//* Generated By:JavaCC: Do not edit this line. Token.java Version 4.1 *//* JavaCCOptions:TOKEN_EXTENDS=,KEEP_LINE_COL=null *//* JavaCC - OriginalChecksum=384f0c8d72f06824f8ad2f5b33eb5e59 (do not edit this line) *//** Token Manager Error. */int LEXICAL_ERROR, ...;/** Lexical error occurred. *//* Ordinals for various reasons why an Error of this type can be thrown. */int STATIC_LEXER_ERROR, ...;/** An attempt was made to create a second instance of a static token manager. */int INVALID_LEXICAL_STATE, ...;/** Tried to change to an invalid lexical state. */int LOOP_DETECTED, ...;/** Detected (and bailed out of) an infinite loop in the token manager. */int errorCode, ...;/** Indicates the reason why the exception is thrown. It will have ... *//** Replaces unprintable characters by their escaped (or unicode escaped) ... *//** Note: You can customize the lexical error message by modifying this method. ... */addEscapes(...)/** You can also modify the body of this method to customize your error messages. ... *//** No arg constructor. *//* Constructors of various flavors follow. *//** Constructor with message and reason. ... *//** Full Constructor. ... */LexicalError(...)/* Generated By:JavaCC: Do not edit this line. TokenMgrError.java Version 4.1 *//* JavaCCOptions: *//* JavaCC - OriginalChecksum=8048f4b229a762baa426e8e8436dbe9e (do not edit this line) */import WeakHashMapMap<K,V> eden, ...;Map<K,V> longterm, ...;this.edennew ConcurrentHashMap<K,V>(...)this.longtermnew WeakHashMap<K,V>(...)V vgetArray(...)/** Utilities for Managing Serialization and Reflection ... */...[] EMPTY_STRING, ...;...[] PRIMITIVE_NAMES, ...;...[] PRIMITIVES, ...;forNamePrimitive(...)String ncint pbinarySearch(...)/** Converts an array of Class names to Class types ... */Class<>[] cs.length/** Converts an array of Class types to Class names ... */String[] s/** Returns a method based on the criteria ... */paramString(...)NoSuchMethodException nsmetypes.lengthPropertyDescriptor pPropertyDescriptor[] descdesc.lengthIntrospectionException ie/** Some constants and other global data that are used by the compiler and the runtime. ... */String JSP_SERVLET_BASE, ...;/** The base class of the generated servlets. */String SERVICE_METHOD_NAME, ...;/** _jspService is the name of the method that is called by ... */String SERVLET_CONTENT_TYPE, ...;/** Default servlet content type. */...[] STANDARD_IMPORTS, ...;/** These classes/packages are automatically imported by the ... */String SERVLET_CLASSPATH, ...;/** ServletContext attribute for classpath. This is tomcat specific. ... */String JSP_FILE, ...;/** Request attribute for <code>&lt;jsp-file&gt;</code> element of a ... */int DEFAULT_BUFFER_SIZE, ...;/** Default size of the JSP buffer. */int DEFAULT_TAG_BUFFER_SIZE, ...;/** Default size for the tag buffers. */int MAX_POOL_SIZE, ...;/** Default tag handler pool size. */String PRECOMPILE, ...;/** The query parameter that causes the JSP engine to just ... */String JSP_PACKAGE_NAME, ...;/** The default package name for compiled jsp pages. */String TAG_FILE_PACKAGE_NAME, ...;/** The default package name for tag handlers generated from tag files */String INC_SERVLET_PATH, ...;/** Servlet context and request attributes that the JSP engine ... */String TMP_DIR, ...;String ALT_DD_ATTR, ...;// Must be kept in sync with org/apache/catalina/Globals.javaString TAGLIB_DTD_PUBLIC_ID_11, ...;/** Public Id and the Resource path (of the cached copy) ... */String TAGLIB_DTD_RESOURCE_PATH_11, ...;String TAGLIB_DTD_PUBLIC_ID_12, ...;String TAGLIB_DTD_RESOURCE_PATH_12, ...;String WEBAPP_DTD_PUBLIC_ID_22, ...;String WEBAPP_DTD_RESOURCE_PATH_22, ...;String WEBAPP_DTD_PUBLIC_ID_23, ...;String WEBAPP_DTD_RESOURCE_PATH_23, ...;...[] CACHED_DTD_PUBLIC_IDS, ...;/** List of the Public IDs that we cache, and their ... */...[] CACHED_DTD_RESOURCE_PATHS, ...;String NS_PLUGIN_URL, ...;/** Default URLs to download the pluging for Netscape and IE. */String IE_PLUGIN_URL, ...;String TEMP_VARIABLE_NAME_PREFIX, ...;/** Prefix to use for generated temporary variable names */char ESC, ...;/** A replacement char for "\$". ... */String ESCStr, ...;boolean IS_SECURITY_ENABLED, ...;/** Has security been turned on? */String SESSION_PARAMETER_NAME, ...;/** The name of the path parameter used to pass the session identifier ... */import FileNotFoundExceptionimport TldLocationsCacheimport JspConfigimport TagPluginManagerimport Localizerimport ParserUtils/** A class to hold all init parameters specific to the JSP engine. ... */// Loggerboolean development, ...;/** Is Jasper being used in development mode? */boolean fork, ...;/** Should Ant fork its java compiles of JSP pages. */boolean keepGenerated, ...;/** Do you want to keep the generated Java files around? */boolean trimSpaces, ...;/** Should white spaces between directives or actions be trimmed? */boolean isPoolingEnabled, ...;/** Determines whether tag handler pooling is enabled. */boolean mappedFile, ...;/** Do you want support for "mapped" files? This will generate ... */boolean classDebugInfo, ...;/** Do we want to include debugging information in the class file? */int checkInterval, ...;/** Background compile thread check interval in seconds. */boolean isSmapSuppressed, ...;/** Is the generation of SMAP info for JSR45 debuggin suppressed? */boolean isSmapDumped, ...;/** Should SMAP info for JSR45 debugging be dumped to a file? */boolean genStringAsCharArray, ...;/** Are Text strings to be generated as char arrays? */boolean errorOnUseBeanInvalidClassAttribute, ...;File scratchDir, ...;/** I want to see my generated servlets. Which directory are they ... */String ieClassId, ...;/** Need to have this as is for versions 4 and 5 of IE. Can be set from ... *//** What classpath should I use while compiling generated servlets? */String compiler, ...;/** Compiler to use. */String compilerTargetVM, ...;/** Compiler target VM. */String compilerSourceVM, ...;/** The compiler source VM. */String compilerClassName, ...;/** The compiler class name. */TldLocationsCache tldLocationsCache, ...;/** Cache for the TLD locations */JspConfig jspConfig, ...;/** Jsp config information */TagPluginManager tagPluginManager, ...;/** TagPluginManager */String javaEncoding, ...;/** Java platform encoding to generate the JSP ... */int modificationTestInterval, ...;/** Modification test interval. */boolean xpoweredBy, ...;/** Is generation of X-Powered-By response header enabled/disabled? */boolean displaySourceFragment, ...;/** Should we include a source fragment in exception messages, which could be displayed ... *//** Are we keeping generated code around? *//** Are we supporting HTML mapped servlets? *//** Should class files be compiled with debug information? *//** Background JSP compile thread check intervall */this.genStringAsCharArray/** Class ID for use in the plugin tag when the browser is IE. *//** What is my scratch dir? *//** What classpath should I use while compiling the servlets ... *//** Java compiler class to use. *//** Create an EmbeddedServletOptions object using data available from ... */String validatingString keepgenString trimspString poolingEnabledParamString mapFileString debugInfoString checkIntervalString modificationTestIntervalString developmentString suppressSmapString dumpSmapString genCharArrayString errBeanClassString ieClassIdString dirString compilerTargetVMString compilerSourceVMString javaEncodingString compilerClassNameString forkString xpoweredByString displaySourceFragmentparseFloat(...)String kString vParserUtils.validatingthis.keepGeneratedthis.isPoolingEnabledthis.mappedFilethis.classDebugInfothis.checkIntervalNumberFormatException exthis.modificationTestIntervalthis.developmentthis.ieClassIdConstants.TMP_DIRthis.scratchDircanWrite(...)this.compilerthis.compilerTargetVMthis.compilerSourceVMthis.javaEncodingthis.compilerClassNamethis.forkthis.xpoweredBythis.displaySourceFragmentnew TldLocationsCache(...)new JspConfig(...)new TagPluginManager(...)EmbeddedServletOptions.class// JVM version numbers// quick hack/* scratchdir */// First try the Servlet 2.2 javax.servlet.context.tempdir property// Not running in a Servlet 2.2 container.// Try to get the JDK 1.2 java.io.tmpdir property// Setup the global Tag Libraries location cache for this// web-application.// Setup the jsp config info for this web app.// Create a Tag plugin instance/** Base class for all exceptions generated by the JSP engine. Makes it ... *//** Creates a JasperException with the embedded exception and the reason for ... *//** Creates a JasperException with the embedded exception ... */import FileOutputStreamimport FileReaderimport FileWriterimport Compilerimport JspRuntimeContextimport JspCServletContext/** Shell for the jspc compiler.  Handles all options associated with the ... */String DEFAULT_IE_CLASS_ID, ...;String SWITCH_VERBOSE, ...;String SWITCH_HELP, ...;String SWITCH_OUTPUT_DIR, ...;String SWITCH_PACKAGE_NAME, ...;String SWITCH_CACHE, ...;String SWITCH_CLASS_NAME, ...;String SWITCH_FULL_STOP, ...;String SWITCH_COMPILE, ...;String SWITCH_SOURCE, ...;String SWITCH_TARGET, ...;String SWITCH_URI_BASE, ...;String SWITCH_URI_ROOT, ...;String SWITCH_FILE_WEBAPP, ...;String SWITCH_WEBAPP_INC, ...;String SWITCH_WEBAPP_XML, ...;String SWITCH_MAPPED, ...;String SWITCH_XPOWERED_BY, ...;String SWITCH_TRIM_SPACES, ...;String SWITCH_CLASSPATH, ...;String SWITCH_DIE, ...;String SWITCH_POOLING, ...;String SWITCH_ENCODING, ...;String SWITCH_SMAP, ...;String SWITCH_DUMP_SMAP, ...;String SHOW_SUCCESS, ...;String LIST_ERRORS, ...;int INC_WEBXML, ...;int ALL_WEBXML, ...;int DEFAULT_DIE_LEVEL, ...;int NO_DIE_LEVEL, ...;...[] insertBefore, ...;int die, ...;String classPath, ...;URLClassLoader loader, ...;boolean poolingEnabled, ...;String targetPackage, ...;String targetClassName, ...;String uriBase, ...;String uriRoot, ...;int dieLevel, ...;boolean helpNeeded, ...;boolean compile, ...;boolean smapSuppressed, ...;boolean smapDumped, ...;boolean caching, ...;Map<> cache, ...;boolean failOnError, ...;/** Throw an exception if there's a compilation error, or swallow it. ... */List<> extensions, ...;/** The file extensions to be handled as JSP files. ... */List<> pages, ...;/** The pages. *//** Needs better documentation, this data member does. ... *//** The java file encoding.  Default ... */String webxmlFile, ...;// Generation of web.xml fragmentsint webxmlLevel, ...;boolean addWebXmlMappings, ...;Writer mapout, ...;CharArrayWriter servletout, ...;CharArrayWriter mappingout, ...;JspCServletContext context, ...;/** The servlet context. */JspRuntimeContext rctxt, ...;/** The runtime context. ... */boolean verbose, ...;boolean listErrors, ...;boolean showSuccess, ...;int argPos, ...;boolean fullstop, ...;String sourceCode, ...;arg.lengthJspC jspcsetArgs(...)jspc.helpNeededJasperException jeexit(...)String toknextArg(...)setTrimSpaces(...)setClassPath(...)setJavaEncoding(...)setCompilerSourceVM(...)setCompilerTargetVM(...)new JasperException(...)nextFile(...)getAbsolutePathsOfLocations(...)this.trimSpacesthis.poolingEnabledConstants.MAX_POOL_SIZE// Off-line compiler, no need for security manager/* @see Options#isCaching() */this.caching/* @see Options#getCache() */this.smapSuppressedthis.smapDumped/** Determines whether text strings are to be generated as char arrays, ... *//** Indicates whether text strings are to be generated as char arrays. ... *//** Sets the class-id value to be sent to Internet Explorer when using ... *//** Gets the class-id value that is sent to Internet Explorer when using ... *//* @see Options#getCompilerTargetVM *//* @see Options#getCompilerSourceVM() *//** Returns the encoding to use for ... *//** Sets the encoding to use for ... *//** Returns the list of file extensions ... *//** Adds the given file extension to the ... *//** Parses comma-separated list of JSP files to be processed.  If the argument ... */StringTokenizer tok/** Sets the compile flag. ... *//** Sets the verbosity level.  The actual number doesn't ... */getServletClassName(...)getServletPackageName(...)String thisServletName/** Include the generated web.xml inside the webapp's web.xml. ... */File webappBaseFile webXmlFile webXml2String insertStartMarkerString insertEndMarkernew FileReader(...)BufferedReader fragmentReaderFileOutputStream fosinsertBefore.lengthString line2ClassLoader originalClassLoaderString jspUriJspCompilationContext clctxtnew JspCompilationContext(...)Compiler clccreateCompiler(...)String tempsetServletClassName(...)setServletPackageName(...)initClassLoader(...)setClassLoader(...)isOutDated(...)generateWebMapping(...)this.sourceCodeThrowable rootCausegetRootCause(...)getFailOnError(...)/** Locate all jsp files in the webapp. Used if no explicit ... */Stack<String> dirsgetExtensions(...)addExtension(...)File f2isJspPage(...)/** Executes the compilation. ... */initServletContext(...)initWebXml(...)String nextjspprocessFile(...)completeWebXml(...)// ==================== protected utility methods ====================File fmapingsnew JspCServletContext(...)new JspRuntimeContext(...)/** Initializes the classloader as/if needed for the given ... */ClassLoader jspcLoaderArrayList<> urlsURL[] urlsAnew URL[]getClassPath(...)File libFilenew URLClassLoader(...)/** Find the WEB-INF dir by looking up in the directory tree. ... */String tUriBaseFile gString fParentFile frootJspC.class// Start treating the rest as JSP Pages// Add all extra arguments to the list of files// isn't this why we are running jspc?// compile with debug info// we don't compile, so this is meanlingless// Insert the <servlet> and <servlet-mapping> declarations// Skip anything previously generated by JSPC// set up a scratch/output dir if none is provided/* Override the defaults */// If compile is set, generate both .java and .class, if// .jsp file is newer than .class file;// Otherwise only generate .java, if .jsp file is newer than// the .java file// Generate mapping// Bugzilla 35114.// Make sure default extensions are always included// noting to do if it fails since we are done with it// Turn the classPath into URLs// Failing a toCanonicalPath on a file that// exists() should be a JVM regression test,// therefore we have permission to freak uot//TODO: add .tld files to the URLCLassLoader// If there is no acceptible candidate, uriRoot will// remain null to indicate to the CompilerContext to// use the current working/user dir.// since this is an optional default and a null value// for uriRoot has a non-error meaning, we can just// pass straight throughimport JspUtilimport ServletWriterimport JasperLoaderimport JspServletWrapperimport TagInfo/** A place holder for various things that are used through out the JSP ... */Map<String,URL> tagFileJarUrls, ...;boolean isPackagedTagFile, ...;String jspUri, ...;boolean isErrPage, ...;String basePackageName, ...;String derivedPackageName, ...;String servletJavaFileName, ...;String javaPath, ...;String classFileName, ...;ServletWriter writer, ...;Options options, ...;JspServletWrapper jsw, ...;Compiler jspCompiler, ...;String baseURI, ...;String outputDir, ...;int removed, ...;URLClassLoader jspLoader, ...;URL baseUrl, ...;Class<> servletClass, ...;boolean isTagFile, ...;boolean protoTypeMode, ...;TagInfo tagInfo, ...;URL tagFileJarUrl, ...;// jspURI _must_ be relative to the contextthis.jspUricanonicalURI(...)this.isErrPagethis.optionsthis.jswthis.baseURIthis.rctxtthis.tagFileJarUrlsthis.basePackageNameConstants.JSP_PACKAGE_NAMEthis.isTagFilethis.tagInfothis.tagFileJarUrl/** ---------- Class path and loader ---------- *//* ==================== Methods to override ==================== */this.classPathgetParentClassLoader(...)this.loadernew JasperLoader(...)getPermissionCollection(...)/** ---------- Input/Output  ---------- */createOutputDir(...)new CustomCompiler(...)Compiler compiler/** Get the full value of a URI relative to this compilations context ... *//** ---------- Access resources in the webapp ---------- */File.separator/** Gets a resource as a stream, relative to the meanings of this ... *//* ==================== Common implementation ==================== */getTagClassName(...)int iSepmakeJavaIdentifier(...)isTagFile(...)String dPackageNamegetDerivedPackageName(...)makeJavaPackage(...)getOutputDir(...)String tagName/** Gets the 'location' of the TLD associated with the given taglib 'uri'. ... */String[] locationgetTldLocationsCache(...)getOptions(...)getKeepGenerated(...)// ==================== Removal ==================== removeWrapper(...)// ==================== Compile and reload ====================removeGeneratedFiles(...)setReload(...)setCompilationException(...)JasperException ex// ==================== Manipulating the class ====================getJspLoader(...)ClassNotFoundException cexObject outputDirLock, ...;// ==================== protected methods ==================== makeOutputDir(...)File outDirFileFile basegetScratchDir(...)StringBuffer resultisPathSeparator(...)int separatorPosJspCompilationContext.class// hack fix for resolveRelativeURI// strip the basde slash since it will be combined with the// uriBase to generate a file// sometimes we get uri's massaged from File(String), so check for// a root directory deperator char// Cache compilation exception// Append servlet or tag handler path to scratch dir/* multiple path separators. ... *//* a single dot at the end of the path - we are done. *//* self directory in path ... *//* two dots in a path: go back one hierarchy. ... */// only if we have exactly _two_ dots./** The cache for the location of the TLD's ... *//** The web-application wide cache for the returned TreeNode ... *//** Repository of {page, request, session, application}-scoped beans ... */HashMap<String,String> beanTypes, ...;ClassLoader loader, ...;ErrorDispatcher errDispatcher, ...;this.errDispatcherNode.UseBeanjspError(...)/** Collect info about the page and nodes, and make them availabe through ... *//** A visitor for collecting information on the page and the body of ... */Node.Visitorboolean scriptingElementSeen, ...;boolean usebeanSeen, ...;boolean includeActionSeen, ...;boolean paramActionSeen, ...;boolean setPropertySeen, ...;boolean hasScriptingVars, ...;Node.ParamActionNode.IncludeActiongetPage(...)visitBody(...)Node.ForwardActionNode.SetPropertyNode.PlugIngetHeight(...)getWidth(...)Node.CustomTagcheckSeen(...)getChildInfo(...)/** Check all child nodes for various elements and update the given ... */Node.ChildInfoboolean scriptingElementSeenSaveboolean usebeanSeenSaveboolean includeActionSeenSaveboolean paramActionSeenSaveboolean setPropertySeenSaveboolean hasScriptingVarsSaveCustomTag ctJspAttribute[] attrsgetJspAttributes(...)Node.JspAttributeattrs.lengthgetVariableInfos(...).lengthgetVariableInfos(...)getTagVariableInfos(...).lengthgetTagVariableInfos(...)setScriptless(...)setHasUseBean(...)setHasIncludeAction(...)setHasParamAction(...)setHasSetProperty(...)setHasScriptingVars(...)Node.JspElementgetNameAttribute(...)Node.JspBodyNode.NamedAttributeNode.DeclarationNode.ExpressionNode.ScriptletNode.NodesCollectVisitor collectVisitornew CollectVisitor(...)updatePageInfo(...)getPageInfo(...)// Check to see what kinds of element we see as child elements// save values collected so far// Scan attribute list for expressions// Record if the tag element and its body contains any scriptlet.// Propagate value of scriptingElementSeen up.import JspCompilationContextimport Options/** Main JSP compiler class. This class uses Ant for compiling. ... */JspCompilationContext ctxt, ...;PageInfo pageInfo, ...;TagFileProcessor tfp, ...;Node.Nodes pageNodes, ...;// ------------------------------------------------------------ Constructorthis.ctxt// --------------------------------------------------------- Public Methodsthis.pageNodes/** Compile the jsp file into equivalent servlet in .java file ... */String[] smapStrlong t3long t4JspConfig jspConfiggetJspConfig(...)JspConfig.JspPropertyJspProperty jspPropertyfindJspProperty(...)getJspFile(...)String javaFileNamegetServletJavaFileName(...)ServletWriter writernew PageInfo(...)new BeanRepository(...)isELIgnored(...)setELIgnored(...)isScriptingInvalid(...)setScriptingInvalid(...)getIncludePrelude(...)setIncludePrelude(...)getIncludeCoda(...)setIncludeCoda(...)isDeferedSyntaxAllowedAsLiteral(...)setDeferredSyntaxAllowedAsLiteral(...)isTrimDirectiveWhitespaces(...)setTrimDirectiveWhitespaces(...)checkOutputDir(...)ParserController parserCtlnew ParserController(...)Nodes directivesparseDirectives(...)ByteArrayOutputStream byteArrayOutputStreamTagPluginManager tagPluginManagergetTagPluginManager(...)validateDirectives(...)isPrototypeMode(...)setupContextWriter(...)generate(...)validateExDirectives(...)collect(...)new TagFileProcessor(...)loadTagFiles(...)concatenate(...)setSourceCode(...)Exception e1Exception e2isSmapSuppressed(...)generateSmap(...)removeProtoTypeFiles(...)getClassFileName(...)getJavaEncoding(...)OutputStreamWriter oswUnsupportedEncodingException exnew ServletWriter(...)/** Compile the servlet from .java file to .class file ... *//** Compile the jsp file from the current engine context ... *//** Compile the jsp file from the current engine context. As an side- effect, ... */new ErrorDispatcher(...)String[] smapgenerateJava(...)String targetFileNamegenerateClass(...)File targetFilesetServletClassLastModifiedTime(...)getDevelopment(...)/** This is a protected method intended to be overridden by subclasses of ... *//** Determine if a compilation is necessary by checking the time stamp of the ... */String jsplong jspRealLastModifiedlong targetLastModifiedList<> dependsgetDependants(...)getModificationTestInterval(...)getLastModificationTest(...)setLastModificationTest(...)URL jspUrlURLConnection ucincrementRemoved(...)getJarEntry(...)Object dependString includeURL includeUrlURLConnection iuclong includeLastModified/** Remove generated files */String classFileNameFile classFileFile javaFileCompiler.class// Setup page info area/* If the current uri is matched by a pattern specified in a ... *//* The setting of isELIgnored changes the behaviour of the parser ... */// Parse the file// Pass 1 - the directives// Pass 2 - the whole translation unit// generate prototype .java file for the tag file// Validate and process attributes - don't re-validate the// directives we validated in pass 1// Collect page info// Compile (if necessary) and load the tag files referenced in// this compilation unit.// Determine which custom tag needs to declare which scripting vars// Optimizations by Tag Plugins// Optimization: concatenate contiguous template texts.// Generate static function mapper codes.// generate servlet .java file// The writer is only used during the compile, dereference// it in the JspCompilationContext when done to allow it// to be GC'd and save memory.// Remove the generated .java file// JSR45 Support// If any proto type .java and .class files was generated,// the prototype .java may have been replaced by the current// compilation (if the tag file is self referencing), but the// .class file need to be removed, to make sure that javac would// generate .class again from the new .java file just generated.// Setup the ServletWriter// Fix for bugzilla 41606// Set JspServletWrapper.servletClassLastModifiedTime after successful compile// Make sure these object which are only used during the// generation and compilation of the JSP page get// dereferenced so that they can be GC'd and reduce the// memory footprint.// Only get rid of the pageNodes if in production.// In development mode, they are used for detailed// error messages.// http://issues.apache.org/bugzilla/show_bug.cgi?id=37062// determine if source dependent files (e.g. includes using include// directives) have been changed.// Remove as much as possible, ignore possible exceptions/** Default implementation of ErrorHandler interface. ... *//* Processes the given JSP parse error. ... *//* Processes the given javac compilation errors. ... */Object[] argsdetails.lengthgetJspBeginLineNumber(...)getJspFileName(...)getJspExtract(...)getJavaLineNumber(...)/** Processes the given javac error report and exception. ... */int indent, ...;getQName(...)printIndent(...)printString(...)Nodes pageNode.PageDirectiveprintAttributes(...)Node.TaglibDirectiveNode.IncludeDirectivedumpBody(...)Node.CommentNode.GetPropertyNode.ParamsActionNode.ELExpressionNode.UninterpretedTagString tagNode.TemplateTextnew DumpVisitor(...)JasperException e//		indent++;//		indent--;import FunctionInfo/** This class generates functions mappers for the EL expressions in the page. ... */int currFunc, ...;StringBuffer ds, ...;StringBuffer ss, ...;// Contains codes to initialize the functions mappers./** Creates the functions mappers for all EL expressions in the JSP page. ... */// Contains declarations of the functions mappers.ELFunctionMapper mapnew ELFunctionMapper(...)String dsmap.dsmap.ssnew ELFunctionVisitor(...)Node rootnew Declaration(...)/** A visitor for the page.  The places where EL is allowed are scanned ... */HashMap<String,String> gMap, ...;/** Use a global name map to facilitate reuse of function maps. ... */doMap(...)getEL(...)/** Creates function mappers, if needed, from ELNodes */ELNode.NodesFvisitor fvnew Fvisitor(...)ArrayList<> functionsfv.funcsString decNamematchMap(...)String funcMethod// Only care about functions in ELNode'sELNode.VisitorArrayList<Function> funcs, ...;ELNode.FunctionHashMap<String,String> keyMap, ...;new ArrayList<Function>(...)setMapName(...)getMapName(...)FunctionInfo funcInfogetFunctionInfo(...)getFunctionClass(...)int iArrayString baseTypeint aCountint jj/** Find the name of the function mapper for an EL.  Reuse a ... */String mapNameString temName/* @return An unique name for a function mapper. */// Append the declarations to the root node// First locate all unique functions in this EL// Reuse a previous map if possible// Generate declaration for the map statically// Special case if there is only one function in the map// Setup arguments for either getMapForFunction or mapFunction// Count the number of array dimension// Put the current name in the global function map// If not all in the previous match, then no match./** This class defines internal representation for an EL Expression ... *//** Represents an EL expression: anything in ${ and }. *//** Child classes */ELNode.Nodes expr, ...;char type, ...;/** Represents text outside of EL expression. *//** Represents anything in EL expression, other than functions, including ... *//** Represents a function ... */FunctionInfo functionInfo, ...;...[] parameters, ...;this.functionInfo/** An ordered list of ELNode. */String mapName, ...;/* Name used for creating a map for the functions in this ... */List<ELNode> list, ...;// The function map associated this ELnew ArrayList<ELNode>(...)/** Visit the nodes in the list with the supplied visitor ... */Iterator<ELNode> iterELNode nthis.mapName/* A visitor class for traversing ELNodes *//** This class implements a parser for EL expressions. ... */Token curToken, ...;// current tokenELNode.Nodes ELexpr, ...;// Current index of the expression// The EL expressionboolean escapeBS, ...;...[] reservedWords, ...;// is '\' an escape char in text outside EL?new Nodes(...)/** Parse an EL expression ... */ELParser parserhasNextChar(...)skipUntilEL(...)Nodes elexprparseEL(...)parser.exprELNode.Textnew Root(...)ELNode.Rootparser.type/** Parse an EL expression string '${...}' ... */toChar(...)new ELText(...)ELNode.ELTextparseFunction(...)/** Parse for a function FunctionInvokation ::= (identifier ':')? identifier ... */String s1String s2int markisELReserved(...)Token t2setIndex(...)/** Test if an id is a reserved word in EL */reservedWords.length/** Skip until an EL expression ('${' || '#{') is reached, allowing escape ... */char prevnextChar(...)/* @return true if there is something left in EL expression buffer other ... */skipSpaces(...)/* @return The next token in the EL expression buffer. */isJavaIdentifierStart(...)isJavaIdentifierPart(...)peekChar(...)new Id(...)parseQuotedChars(...)new Char(...)/* Parse a string in single or double quotes, allowing for escape sequences ... */new QuotedString(...)/* A collection of low level parse methods dealing with character in the EL ... *//* Represents a token in EL expression string *//* Represents an ID token in EL *//* Represents a character token in EL */char ch, ...;this.ch/* Represents a quoted (single or double) string token in EL */// Output whatever is in buffer// Function prefix// Function name// else error!// For now...ErrorHandler errHandler, ...;// Custom error handlerboolean jspcMode, ...;// Indicates whether the compilation was initiated by JspServlet or JspCnew DefaultErrorHandler(...)this.jspcModedispatch(...)parseJavacMessage(...)javacError(...)/* Dispatches the given JSP parse error to the configured error handler. ... */// Private utility methods//*********************************************************************boolean hasLocationException nestedExMalformedURLException me/* Parses the given Java compilation error message, which may contain one ... */ArrayList<JavacErrorDetail> errorsnew ArrayList<JavacErrorDetail>(...)StringBuffer errMsgBufint lineNumJavacErrorDetail javacErrorJavacErrorDetail[] errDetailsint beginColonint endColonString lineNumStrcreateJavacError(...)new JavacErrorDetail[]ErrorVisitor errVisitornew ErrorVisitor(...)Node errNodegetJspSourceNode(...)new JavacErrorDetail(...)getBeginJavaLine(...)/* Visitor responsible for mapping a line number in the generated servlet ... */int lineNum, ...;// Java source line number to be mappedNode found, ...;/* JSP node whose Java source code range in the generated servlet ... */this.lineNumgetEndJavaLine(...)/** Gets the JSP node to which the source line number in the generated ... */// XXX check web.xml for custom error handler// Localize// give a hint about what's wrong// Get error location// Get the full URL of the resource that caused the error// Fallback to using context-relative path// Get the context-relative resource path, so as to not// disclose any local filesystem details// Get nested exception/* Parse compilation errors. Each compilation error consists of a file ... *//* Error line number is delimited by set of colons. ... */// add previous error to error vector// Ignore messages preceding first error// Add last error to error vector// Attempt to map javac error line number to line in JSP page// If this is a scriplet node then there is a one to one mapping// between JSP lines and Java lines/* javac error line number cannot be mapped to JSP page ... *//** Processes the given JSP parse error. ... *//** Processes the given javac compilation errors. ... */import TagAttributeInfoimport TagVariableInfoimport VariableInfoimport Constantsimport NamedAttributeimport JspRuntimeLibraryimport JSPRuntime/** Generate Java source from Nodes ... */...[] OBJECT_CLASS, ...;String VAR_EXPRESSIONFACTORY, ...;String VAR_ANNOTATIONPROCESSOR, ...;ServletWriter out, ...;ArrayList<> methodsBuffered, ...;FragmentHelperClass fragmentHelperClass, ...;ErrorDispatcher err, ...;BeanRepository beanInfo, ...;boolean breakAtLF, ...;String jspIdPrefix, ...;int jspId, ...;Vector<String> tagHandlerPoolNames, ...;GenBuffer charArrayBuffer, ...;StringBuffer b/** Single quote and escape a character */this.jspIdPrefixthis.jspId/** Generates declarations. This includes "info" of the page directive, and ... */boolean getServletInfoGenerated, ...;/* Generates getServletInfo() method that returns the value of the ... */String infogetAttributeValue(...)printil(...)pushIndent(...)printin(...)quote(...)popIndent(...)setBeginJavaLine(...)getJavaLine(...)printMultiLn(...)setEndJavaLine(...)// Custom Tags may contain declarations from tag plugins.useTagPlugin(...)getAtSTag(...)getAtETag(...)new DeclarationVisitor(...)/** Compiles list of tag handler pool names. */Vector<> names, ...;/* Constructor ... *//* Gets the name of the tag handler pool for the given custom tag ... */implementsSimpleTag(...)createTagHandlerPoolName(...)getNamedAttributeNodes(...)hasEmptyBody(...)setTagHandlerPoolName(...)/* Creates the name of the tag handler pool whose tag handlers may ... */String poolNameString[] attrNamesattrNames.lengthreverseOrder(...)new TagHandlerPoolVisitor(...)Vector<> vars, ...;getCustomNestingLevel(...)TagVariableInfo[] tagVarInfosVariableInfo[] varInfosvarInfos.lengthString varNamegetVarName(...)String tmpVarNametagVarInfos.lengthgetNameGiven(...)getAttributeString(...)getTagData(...)getNameFromAttribute(...)new ScriptingVarVisitor(...)/** Generates the _jspInit() method for instantiating the tag handler pools. ... *//** Generates the _jspDestroy() method which is responsible for calling the ... *//** Generate preamble package name (shared by servlet and tag handler ... *//** Generate preamble imports (shared by servlet and tag handler preamble ... */getImports(...)/** Generation of static initializers in preamble. For example, dependant ... */List<> dependants/** Declare tag handler pools (tags of the same type and with the same ... *//** Declare general-purpose methods (shared by servlet and tag handler ... */generateInit(...)generateDestroy(...)/** Generates the beginning of the static portion of the servlet. */String servletPackageNameString servletClassNameString serviceMethodNameConstants.SERVICE_METHOD_NAMEgenPreamblePackage(...)genPreambleImports(...)getExtends(...)isThreadSafe(...)generateDeclarations(...)genPreambleStaticInitializers(...)genPreambleClassVariableDeclarations(...)genPreambleMethods(...)isSession(...)isErrorPage(...)declareTemporaryScriptingVars(...)isXpoweredBy(...)getErrorPage(...)isAutoFlush(...)/** Generates an XML Prolog, which includes an XML declaration and an XML ... */String omitXmlDeclgetOmitXmlDecl(...)String doctypeNamegetDoctypeName(...)isXmlSyntax(...)hasJspRoot(...)String cTypeString charSetString doctypePublicgetDoctypePublic(...)String doctypeSystemgetDoctypeSystem(...)/* Generates the constructor. (shared by servlet and tag handler preamble ... *//** A visitor that generates codes for the elements in the page. */Hashtable<> handlerInfos, ...;/* Hashtable containing introspection information on tag handlers: ... */Hashtable<> tagVarNumbers, ...;String parent, ...;boolean isSimpleTagParent, ...;String pushBodyCountVar, ...;// Is parent a SimpleTag?String simpleTagHandlerVar, ...;boolean isSimpleTagHandler, ...;boolean isFragment, ...;int methodNesting, ...;int charArrayCount, ...;HashMap<> textMap, ...;/** Constructor. */this.methodsBufferedthis.fragmentHelperClass/** Returns an attribute value, optionally URL encoded. If the value is a ... */isNamedAttribute(...)isELInterpreterInput(...)attributeValueWithEL(...)getTemporaryVariableName(...)getNamedAttributeNode(...)/* When interpreting the EL attribute value, literals outside the EL ... */Class<?> typeStringBuffer outputboolean elinterpreterCall(...)/** Prints the attribute value specified in the param action, in the form ... */String sepgetTextAttribute(...)attributeValue(...)new ParamVisitor(...)String flushJspAttribute pageboolean isFlushString pageParamNode jspBodyfindJspBody(...)generateNamedAttributeValue(...)prepareParams(...)JSPRuntime.classprintParams(...)/** Scans through all child nodes of the given parent for <param> ... */Nodes subelementsNodes paramSubElementsNode m/** Finds the <jsp:body> subelement of the given parent node. If not ... */JspBody resultcheckVariable(...)Class<> beangetBeanType(...)Method methJspAttribute valueString valueVarNameString scopeString klassJspAttribute beanNameboolean generateNewString canonicalNameString scopenameString lockgetErrorOnUseBeanInvalidClassAttribute(...)String binaryNameString codeJspAttribute heightJspAttribute widthString hspaceString vspaceString alignString iepluginurlString nspluginurlString codebaseString archiveString jreversionString widthStrString heightStrJspBody jspBodyString s0makeAttr(...)getIeClassId(...)String s3/** A visitor to handle <jsp:param> in a plugin */boolean ie, ...;this.ieConstants.IE_PLUGIN_URLConstants.NS_PLUGIN_URLTagHandlerInfo handlerInfogetTagHandlerInfo(...)String baseVarcreateTagVarName(...)String tagEvalVarString tagHandlerVarString tagPushBodyCountVarServletWriter outSaveChildInfo cigenerateTagPlugin(...)isScriptless(...)hasScriptingVars(...)String tagMethodGenBuffer genBuffernew GenBuffer(...)generateLocalVariables(...)generateCustomDoTag(...)String tmpParentboolean isSimpleTagParentSaveString tmpPushBodyCountVarboolean tmpIsSimpleTagHandlergenerateCustomStart(...)implementsTryCatchFinally(...)generateCustomEnd(...)String SINGLE_QUOTE, ...;String DOUBLE_QUOTE, ...;Attributes attrsgetNonTaglibXmlnsAttributes(...)int attrsLenJspAttribute[] jspAttrsHashtable<> mapString elemNameboolean hasBodyString attrStrString attrNameNode subelemint textSizeint initLengthJspUtil.CHUNKSIZEint srcLineint lineIncaddSmap(...)genStringAsCharArray(...)ServletWriter caOutString charArrayNamegenerateJspFragment(...)Node.InvokeActionString varReaderAttrString varAttrtoGetterMethod(...)String scopeNamegetScopeConstant(...)Node.DoBodyActionNode.AttributeGeneratorCustomTag tagevaluateAttribute(...)Hashtable<> handlerInfosByShortNamenew TagHandlerInfo(...)getTagHandlerClass(...)Class<> tagHandlerClassString tagHandlerClassNamedeclareScriptingVars(...)VariableInfo.AT_BEGINsaveScriptingVars(...)implementsJspIdConsumer(...)getTagHandlerPoolName(...)generateSetters(...)createJspId(...)implementsBodyTag(...)syncScriptingVars(...)VariableInfo.NESTEDimplementsIterationTag(...)restoreScriptingVars(...)VariableInfo.AT_ENDString tmpTagHandlerVarVector<> vecgetScriptingVars(...)Object elemVariableInfo varInfogetDeclare(...)TagVariableInfo tagVarInfo/* This method is called as part of the custom tag's start element. ... */getScope(...)/* This method is called as part of the custom tag's end element. ... *//* Synchronizes the scripting variables of the given custom tag for the ... *//* Creates a tag variable name by concatenating the given prefix and ... */Integer iString attrValueString localNamecheckIfAttributeIsJspFragment(...)generateNamedAttributeJspFragment(...)isDynamic(...)getSetterMethod(...)convertString(...)getPropertyEditorClass(...)TagAttributeInfo taigetTagAttributeInfo(...)String elContextString markgetJspContextVar(...)isDeferredInput(...)getTypeName(...)ValueExpression.classboolean evaluategetExpressionFactoryVar(...)toJavaSourceTypeFromTld(...)getExpectedTypeName(...)canBeRequestTime(...)isDeferredMethodInput(...)MethodExpression.classString[] pgetParameterTypeNames(...)p.length/** Generate code to create a map for the alias variables ... */TagVariableInfo[] tagVarsString aliasMapVarboolean aliasSeentagVars.lengthString nameFromString aliasedNamegenerateAliasMap(...)Mark m/* @param c The target class to which to coerce the given string @param ... */String quotedcoerceToPrimitiveBoolean(...)coerceToPrimitiveByte(...)coerceToByte(...)coerceToChar(...)coerceToPrimitiveDouble(...)coerceToDouble(...)coerceToPrimitiveFloat(...)coerceToFloat(...)coerceToInt(...)coerceToInteger(...)coerceToPrimitiveShort(...)coerceToShort(...)coerceToPrimitiveLong(...)coerceToLong(...)/* Converts the scope string representation, whose possible values are ... *//** Generates anonymous JspFragment inner class which is passed as an ... */FragmentHelperClass.FragmentFragment fragmentopenFragment(...)boolean tmpIsFragmentString pushBodyCountVarSavegetGenBuffer(...)closeFragment(...)/** Generate the code required to obtain the runtime value of the given ... */Nodes bodyboolean templateTextOptimizationNode bodyElement/** Similar to generateNamedAttributeValue, but create a JspFragment ... */hasUseBean(...)hasParamAction(...)hasIncludeAction(...)/** Common part of postamble, shared by both servlets and tag files. */GenBuffer methodBufferadjustJavaLines(...)isUsed(...)generatePostamble(...)/** Generates the ending part of the static portion of the servlet. */genCommonPostamble(...)getErrorDispatcher(...)getCompilationContext(...)new FragmentHelperClass(...)isPoolingEnabled(...)getBeanRepository(...)getMappedFile(...)/** The main entry for Generator. ... */Generator gennew Generator(...)gen.isPoolingEnabledcompileTagHandlerPoolList(...)gen.ctxtJasperTagInfo tagInfogetTagInfo(...)generateTagHandlerPreamble(...)generateXmlProlog(...)generatePreamble(...)gen.fragmentHelperClassnew GenerateVisitor(...)gen.methodsBufferedgenerateTagHandlerPostamble(...)/* Generates tag handler preamble. */hasDynamicAttributes(...)generateSetJspContext(...)generateTagHandlerAttributes(...)generateSetDynamicAttribute(...)generatePageScopedVariables(...)TagAttributeInfo[] attrInfosattrInfos.lengthisDeferredMethod(...)isDeferredValue(...)/** Generates declarations for tag handler attributes, and defines the getter ... */isFragment(...)toJavaSourceType(...)toSetterMethodName(...)/* Generate setter for JspContext so we can create a wrapper and store both ... */boolean nestedSeenboolean atBeginSeenboolean atEndSeen/* Generates implementation of ... *//* Creates a page-scoped variable for each declared tag attribute. Also, if ... */boolean variableMapperVargetDynamicAttributesMapName(...)/* Generates the getter method for the given attribute name. */char[] attrChars/* Generates the setter method name for the given attribute name. *//** Class storing the result of introspecting a custom tag handler. */Hashtable<> methodMaps, ...;Hashtable<> propertyEditorMaps, ...;Class<> tagHandlerClass, ...;this.tagHandlerClassthis.methodMapsthis.propertyEditorMapsBeanInfo tagClassInfoPropertyDescriptor[] pdpd.length/** XXX *//** A class for generating codes to a buffer. Included here are some support ... *//* For a CustomTag, the codes that are generated at the beginning of the ... */Node.Nodes body, ...;CharArrayWriter charWriter, ...;setGeneratedInBuffer(...)/** Adjust the Java Lines. This is necessary because the Java lines ... */adjustJavaLine(...)new Node.Visitor(...) { ... }Nodes bisGeneratedInBuffer(...)/** Keeps track of the generated Fragment Helper Class */GenBuffer genBuffer, ...;this.genBufferboolean used, ...;// True if the helper class should be generated.ArrayList<> fragments, ...;GenBuffer classBuffer, ...;// Buffer for entire helper classthis.usedServletWriter outthis.classBufferFragment resultnew Fragment(...)setInnerClassName(...)// alias// Static data for getDependants()// Method used to get compile time file dependencies// First the package name:// Generate imports// Generate class declaration// Class body begins here// Static initializations here// Class variable declarations// Constructor// generateConstructor(className);// Methods here// Now the service method// Local variable declarations/* An XML declaration is generated under the following conditions: - ... *//* Output a DOCTYPE declaration if the doctype-root-element appears. If ... */// Start of an EL expression// Composite expression - must coerce to String// Skip an escaped $ or }// End of an EL expression// Nothing to see here - move to next character// The separator is '&' after the second use// default to false;// If the page for jsp:include was specified via// jsp:attribute, first generate code to evaluate// that body.// If any of the params have their values specified by// jsp:attribute, prepare those values first.// So that javac won't complain about// codes after "return"// If the page for jsp:forward was specified via// XXX Not sure if we can eliminate dead codes after this.// Bean is defined using useBean, introspect at compile time// The object could be a custom action with an associated// VariableInfo entry for this name.// Get the class name and then introspect at runtime.// default to same as property// We've got to resolve the very call to the interpreter// at runtime since we don't know what type to expect// in the general case; we thus can't hard-wire the call// into the generated code. (XXX We could, however,// optimize the case where the bean is exposed with// <jsp:useBean>, much as the code here does for// getProperty.)// The following holds true for the arguments passed to// JspRuntimeLibrary.handleSetPropertyExpression():// - 'pageContext' is a VariableResolver.// - 'this' (either the generated Servlet or the generated tag// handler for Tag files) is a FunctionMapper.// If the value for setProperty was specified via// If "class" is specified, try an instantiation at compile time// Canonical name for klass// Obtain the canonical type name// Check that there is a 0 arg constructor// At compile time, we have determined that the bean class// exists, with a public zero constructor, new() can be// used for bean instantiation.// Cannot instantiate the specified class, either a// compilation error or a runtime error will be raised,// depending on a compiler flag.// Doing our best here to get a canonical name// from the binary name, should work 99.99% of time.// if type is unspecified, use "class" as type of bean// Default to page// Declare bean// Lock while getting or creating bean// Locate bean from context// Create bean/* Check if bean is alredy there *//* If both class name and beanName is not specified, the bean ... *//* Instantiate the bean if it is not in the specified scope. */// If the value for beanName was specified via// Implies klass is not null/* Note: Beans.instantiate throws ClassNotFoundException if ... */// close of try// Generate codes to instantiate the bean class/* Set attribute for bean in the specified scope */// Only visit the body when bean is instantiated// End of lock block// XXX - Fixed a bug here - value used to be output// inline, which is only okay if value is not an EL// expression. Also, key/value pairs for the// embed tag were not being generated correctly.// Double check that this is now the correct behavior.// We want something of the form// out.println( "<param name=\"blah\"// value=\"" + ... + "\">" );// out.print( " blah=\"" + ... + "\"" );// Look for a params node and prepare its param subelements:// XXX - Fixed a bug here - width and height can be set// dynamically. Double-check if this generation is correct.// IE style plugin// <object ...>// First compose the runtime output string// Then print the output string to the java file// <param > for java_code// <param > for java_codebase// <param > for java_archive// <param > for type/* generate a <param> for each <jsp:param> in the plugin body *//* Netscape style plugin part */// s1 and s2 are the same as before./* Generate a 'attr = "value"' for each <jsp:param> in plugin body *//* Fallback */// Don't visit body of this tag - we already did earlier.// Use plugin to generate more efficient code if there is one.// Create variable names// If the tag contains no scripting element, generate its codes// to a method.// The tag handler and its body code can reside in a separate// method if it is scriptless and does not have any scripting// variable defined.// Generate a call to this method// Set up new buffer for the method/* For fragments, their bodies will be generated in fragment ... */// Generate code for method declaration// Initilaize local variables used in this method./* Classic tag handler: Generate code for start element, body, ... */// visit body// Generate end of method// restore previous writer/* Write begin tag */// Visit tag body/* Write end tag */// Compute attribute value string for XML-style and named// attributes// Write begin tag, using XML-style 'name' attribute as the// element name// Write remaining attributes// Does the <jsp:element> have nested tags other than// <jsp:attribute>// Smap should not include the body// Write end tag// Special case small text strings// Generate Strings as char arrays, for performance// relative to starting srouce line// Generate an out.write() when see a '\n' in template// add a Smap for this line// Not sure we need this// Copy virtual page scope of tag file to page scope of invoking// page// Invoke fragment, unless fragment is null// Store varReader in appropriate scope// Restore EL context// Invoke body// Declare AT_BEGIN scripting variables// includes setting the context// JspIdConsumer (after context has been set)// Synchronize AT_BEGIN scripting variables// Declare NESTED scripting variables// Assume EVAL_BODY_BUFFERED// Synchronize AT_BEGIN and NESTED scripting variables// Synchronize NESTED scripting variables// Map the Java lines that handles start of custom tags to the// JSP line for this tag// EVAL_BODY// TryCatchFinally// try// Declare and synchronize AT_END scripting variables (must do this// outside the try/catch/finally block)// Resource injection// Set the body/* Encapsulate body of custom tag invocation in JspFragment and ... *//* Body of tag is the body of the <jsp:body> element. The visit ... */// Declare and synchronize AT_END scripting variables// If the scripting variable has been declared, skip codes// for saving and restoring it.// XXX - no need to generate temporary variable here// XXX assert(c.length > 0)// results buffer// generate elContext reference// reset buffer// create our mark// depending on type// optimize// should the expression be evaluated before passing to// the setter?// JSP.2.3.2// JSP.2.3.3// JSP.2.3.5// run attrValue through the expression interpreter// Set context// Generate alias map// Set parent// The setParent() method need not be called if the value being// passed is null, since SimpleTag instances are not reused// need to handle deferred values and methods// XXX - A possible optimization here would be to check to see// if the only child of the parent node is TemplateText. If so,// we know there won't be any parameters, etc, so we can// generate a low-overhead JspFragment that just echoes its// body. The implementation of this fragment can come from// the org.apache.struts2.jasper.runtime package as a support class.// Use a fixed name for push body count, to simplify code gen// XXX - Need to change pageContext to jspContext if// we're not in a place where pageContext is defined (e.g.// in a fragment or in a tag file.// If the only body element for this named attribute node is// template text, we need not generate an extra call to// pushBody and popBody. Maybe we can further optimize// here by getting rid of the temporary variable, but in// reality it looks like javac does this for us.// XXX - Another possible optimization would be for// lone EL expressions (no need to pushBody here either).// Empty body must be treated as ""// Cannot access err since this method is static, but at// least flag an error.// err.getString(// "jsp.error.internal.unexpected_node_type" ) );// Append any methods that were generated in the buffer.// Append the helper class// Append char array declarations// Close the class definition// Close the service method// Generated methods, helper classes, etc./* Temporary hack. If a JSP page uses the "extends" attribute of the ... */// Generate package declaration/* Class body begins here */// Declare writer used for storing result of fragment/body invocation// if 'varReader' or 'var' attribute is specified// Tag-handler specific declarations// Now the doTag() method/* According to the spec, 'pageContext' must not be made available as an ... */// Declare implicit objects.// set current JspContext on ELContext// Have to catch Throwable because a classic tag handler// helper method is declared to throw Throwable.// handle restoring VariableMapper// restore nested JspContext on ELContext// Close the doTag method// Declare attributes// Define attribute getter and setter methods// getter method// setter method// Tag files should also set jspContext attributes// Determine if there are any aliases// switch/* According to the spec, only dynamic attributes with no uri are to be ... */// "normal" attributes// handle assigning deferred vars to VariableMapper, storing// previous values under '_el_ve[i]' for later re-assignment// we need to scope the modified VariableMapper for consistency and performance// Expose the Map containing dynamic attributes as a page-scoped var/* FIXME: should probably be checking for things like ... */// Don't adjust lines for the nested tags that// are also generated in buffers, because the// adjustments will be done elsewhere.// Note: cannot be static, as we need to reference things like// _jspx_meth_*// XXX - Returns boolean because if a tag is invoked from// within this fragment, the Generator sometimes might// generate code like "return true". This is ignored for now,// meaning only the fragment is skipped. The JSR-152// expert group is currently discussing what to do in this case.// See comment in closeFragment()// Note: Throwable required because methods like _jspx_meth_*// throw Throwable.// XXX - See comment in openFragment()// Generate all fragment methods:// Generate postamble:// catch// finally// invoke method// helper classimport TagFileInfoimport TagLibraryInfoimport TreeNode/** Class responsible for generating an implicit tag library containing tag ... */String WEB_INF_TAGS, ...;String TAG_FILE_SUFFIX, ...;String TAGX_FILE_SUFFIX, ...;String TAGS_SHORTNAME, ...;String TLIB_VERSION, ...;String JSP_VERSION, ...;String IMPLICIT_TLD, ...;Hashtable<> tagFileMap, ...;// Maps tag names to tag file pathsParserController pc, ...;PageInfo pi, ...;Vector<> vec, ...;Set<> dirListthis.pcthis.pithis.tagFileMapthis.vecnew FunctionInfo[]ParserUtils punew ParserUtils(...)TreeNode tldparseXMLDocument(...)findChildren(...)addDependant(...)this.jspversionTreeNode elementString tnamethis.tlibversiondouble version/** Checks to see if the given tag name maps to a tag file path, ... */TagFileInfo tagFilegetTagFile(...)TagInfo tagInfoparseTagFileDirectives(...)getTagFileJarUrl(...)getJspCompilationContext(...)new TagFileInfo(...)addElement(...)this.tagFilesnew TagFileInfo[]copyInto(...)getTaglibs(...)new TagLibraryInfo[]// Implicit tag libraries have no functions:// Determine the value of the <short-name> subelement of the// "imaginary" <taglib> element// Populate mapping of tag names to tag file paths/* Use the filename of the tag file, without the .tag or ... */// Add implicit TLD to dependency list// Process each child element of our <taglib> element// JSP 1.1// JSP 1.2// All other elements are invalidimport javax.servlet.jsp.tagext.*/** TagInfo extension used by tag handlers that are implemented via tag files. ... */String dynamicAttrsMapName, ...;this.dynamicAttrsMapName/** Class providing details about a javac compilation error. ... */String javaFileName, ...;int javaLineNum, ...;String jspFileName, ...;int jspBeginLineNum, ...;StringBuffer errMsg, ...;String jspExtract, ...;this.javaFileNamethis.javaLineNumthis.errMsgthis.jspBeginLineNumthis.jspFileNameString[] jspLinesString[] javaLinesStringBuffer fragmentjspLines.lengthString javaLine/** Gets the name of the Java source file in which the compilation error ... *//** Gets the compilation error line number. ... *//** Gets the name of the JSP file from which the Java source file was ... *//** Gets the start line number (in the JSP file) of the JSP element ... *//** Gets the compilation error message. ... *//** Gets the extract of the JSP that corresponds to this message. ... */this.jspExtract/** Reads a text file from an input stream into a String[]. Used to read in ... */List<> lines// Read both files in, so we can inspect them// If the line contains the opening of a multi-line scriptlet// block, then the JSP line number we got back is probably// faulty.  Scan forward to match the java line...// Update jsp line number// copy out a fragment of JSP to display to the user// Can't read files - ignore/** Handles the jsp-config element in WEB_INF/web.xml.  This is used ... */String WEB_XML, ...;Vector<> jspProperties, ...;ServletContext ctxt, ...;String defaultIsXml, ...;String defaultIsELIgnored, ...;// unspecifiedString defaultIsScriptingInvalid, ...;String defaultDeferedSyntaxAllowedAsLiteral, ...;String defaultTrimDirectiveWhitespaces, ...;JspProperty defaultJspProperty, ...;URL uriInputSource ipTreeNode webAppTreeNode jspConfigfindChild(...)Iterator<> jspPropertyListgetVersion(...)Vector<> urlPatternsString pageEncodingString scriptingInvalidString elIgnoredString isXmlVector<> includePreludeVector<> includeCodaString deferredSyntaxAllowedAsLiteralString trimDirectiveWhitespacesString urlPatternJspProperty propertynew JspProperty(...)JspPropertyGroup propertyGroupnew JspPropertyGroup(...)boolean isStarprocessWebDotXml(...)/** Select the property group that has more restrictive url-pattern. ... */String prevPathString currPath/** Find a property that best matches the supplied resource. ... */String uriPathString uriExtensionVector<> includePreludesVector<> includeCodasJspPropertyGroup isXmlMatchJspPropertyGroup elIgnoredMatchJspPropertyGroup scriptingInvalidMatchJspPropertyGroup pageEncodingMatchJspPropertyGroup deferedSyntaxAllowedAsLiteralMatchJspPropertyGroup trimDirectiveWhitespacesMatchString isELIgnoredString isScriptingInvalidString isDeferedSyntaxAllowedAsLiteralString isTrimDirectiveWhitespacesJspPropertyGroup jpgJspProperty jpgetJspProperty(...)isXml(...)selectProperty(...)getPageEncoding(...)/** To find out if an uri matches an url pattern in jsp config.  If so, ... */Object jspPropertyJspProperty jspProperty, ...;this.jspPropertyString isXml, ...;String elIgnored, ...;String scriptingInvalid, ...;String pageEncoding, ...;Vector<> includePrelude, ...;Vector<> includeCoda, ...;String deferedSyntaxAllowedAsLiteral, ...;String trimDirectiveWhitespaces, ...;this.isXmlthis.elIgnoredthis.scriptingInvalidthis.pageEncodingthis.includePreludethis.includeCodathis.deferedSyntaxAllowedAsLiteralthis.trimDirectiveWhitespacesJspConfig.class// no web.xml// Add one JspPropertyGroup for each URL Pattern.  This makes// the matching logic easier.// Exact match// pattern must be "*", or of the form "*.jsp"// The url patterns are reconstructed as the follwoing:// path != null, extension == null:  / or /foo/bar.ext// path == null, extension != null:  *.ext// path != null, extension == "*":   /foo/*// Both specifies a *.ext, keep the first one// JSP Configuration settings do not apply to tag files	    // (arrays will be the same length)// exact match pattern: /a/foo.jsp// not matched;// Matching patterns *.ext or /p/*// not matched// We have a match// Add include-preludes and include-codas// If there is a previous match for the same property, remember// the one that is more restrictive.// There is an exact match// Matches *, *.ext, /p/*, or /p/*.extimport XMLReaderimport LexicalHandler/** Class implementing a parser for a JSP document, that is, a JSP page in XML ... */String LEXICAL_HANDLER_PROPERTY, ...;String JSP_URI, ...;EnableDTDValidationException ENABLE_DTD_VALIDATION_EXCEPTION, ...;ParserController parserController, ...;StringBuffer charBuffer, ...;Node current, ...;// Node representing the XML element currently being parsedNode scriptlessBodyNode, ...;/* Outermost (in the nesting hierarchy) node whose body is declared to be ... */Mark startMark, ...;//through the characters.//as set by the previous element, and updating it as we advance//we get an accurate starting location by starting with startMark//this is the best we can do.  But when we parse character data,//data, so for Nodes that are not created from character data,//XMl parser eats white space that is not part of character//immediately _following_ the current element.  The underlying//return the line and column numbers for the character//that locator.getLineNumber() and locator.getColumnNumber()//Mark representing the start of the current element.  Noteboolean inDTD, ...;// Flag indicating whether we are inside DTD declarationsboolean isValidating, ...;boolean directivesOnly, ...;boolean isTop, ...;int tagDependentNesting, ...;// Nesting level of Tag dependent bodiesboolean tagDependentPending, ...;// is first encountered// Flag set to delay incrmenting tagDependentNesting until jsp:body/* Constructor */this.parserControllerthis.pageInfogetCompiler(...)this.errthis.directivesOnlythis.isTop/* Parses a JSP document by responding to SAX events. ... */JspDocumentParser jspDocParsernew JspDocumentParser(...)Nodes pageNodesNode.RootRoot dummyRootSAXParser saxParsergetSAXParser(...)InputStream inStreamsetPageEncoding(...)setJspConfigPageEncoding(...)setIsEncodingSpecifiedInProlog(...)setIsBomPresent(...)jspDocParser.currentaddInclude(...)jspDocParser.pageInfojspDocParser.isTopjspDocParser.ctxtjspDocParser.errEnableDTDValidationException ejspDocParser.isValidatingException anySAXParseException enew Mark(...)/* Processes the given list of included files. ... */Node includeDirnew IncludeDirective(...)processIncludeDirective(...)/* Receives notification of the start of an element. ... */AttributesImpl taglibAttrsAttributesImpl nonTaglibAttrsAttributesImpl nonTaglibXmlnsAttrsString currentPrefixprocessChars(...)checkPrefixes(...)new SAXParseException(...)boolean isTaglibString attrQNameString attrUrihasTaglib(...)parseStandardAction(...)new UninterpretedTag(...)parseCustomAction(...)String bodyTypegetBodyType(...)TagInfo.BODY_CONTENT_SCRIPTLESSTagInfo.BODY_CONTENT_TAG_DEPENDENT/* Receives notification of character data inside an element. ... */boolean isAllSpaceNode.JspTextnew TemplateText(...)CharArrayWriter ttextint lastChint elTypeint chboolean singleQboolean doubleQnew ELExpression(...)/* Receives notification of the end of an element. */boolean isTrimNodes subElemsNode subElemltrim(...)rtrim(...)isAllSpace(...)Node.ScriptingElementcheckScriptingBody(...)isTagDependent(...)/* Receives the document locator. ... *//* See org.xml.sax.ext.LexicalHandler. */new Comment(...)fatalError(...)/* Receives notification of a non-recoverable error. *//* Receives notification of a recoverable error. *//* Receives notification of the start of a Namespace mapping. */TagLibraryInfo taglibInfogetTaglibInfo(...)getTaglib(...)addTaglib(...)pushPrefixMapping(...)/* Receives notification of the end of a Namespace mapping. */popPrefixMapping(...)new JspRoot(...)Node.JspRootsetHasJspRoot(...)String importsnew PageDirective(...)addImport(...)new Scriptlet(...)new Expression(...)new UseBean(...)new SetProperty(...)new GetProperty(...)new IncludeAction(...)new ForwardAction(...)new ParamAction(...)new ParamsAction(...)new PlugIn(...)new JspText(...)new JspBody(...)new NamedAttribute(...)new JspOutput(...)Node.JspOutputnew TagDirective(...)Node.TagDirectivenew AttributeDirective(...)Node.AttributeDirectivenew VariableDirective(...)Node.VariableDirectivenew InvokeAction(...)new DoBodyAction(...)new JspElement(...)new FallBackAction(...)Node.FallBackAction/* Checks if the XML element with the given tag name is a custom action, ... */TagLibraryInfo tagLibInfoTagFileInfo tagFileInfoCustomTag retnew SAXException(...)String handlerClassNamenew CustomTag(...)/* Creates the tag library associated with the given uri namespace, and ... */TagLibraryInfo resultString tagdirnew ImplicitTagLibraryInfo(...)boolean isPlainUrigetTldLocation(...)isCaching(...)getCache(...)new TagLibraryInfoImpl(...)/* Ensures that the given body only contains nodes that are instances of ... */String elemType/* Parses the given file included via an include directive. ... */FileNotFoundException fnfe/* Checks an element's given URI, qname, and attributes to see if any ... */checkPrefix(...)/* Checks the given URI and qname to see if they hijack the 'jsp' prefix, ... */addPrefix(...)setIsJspPrefixHijacked(...)/* Gets SAXParser. ... */XMLReader xmlReadergetXMLReader(...)setFeature(...)setErrorHandler(...)/* Exception indicating that a DOCTYPE declaration is present, but ... */getBodyContent(...)getTagFileInfo(...)new EnableDTDValidationException(...)// Create dummy root and initialize it with given page encodings// Parse the input// Create Node.Nodes from dummy root// Create a dummy Include directive node// jsp:text must not have any subelements/* Notice that due to a bug in the underlying SAX parser, the ... */// TaglibInfo for this uri already established in// startPrefixMapping// custom action/* JSP.6.1.1: All textual nodes that have only white space are to be ... *///We subtract two from the column number to//account for the '[$,#]{' that we've already parsed// following "${" || "#{" to first unquoted "}"// Not start of EL anymore// Ignore any whitespace (including spaces, carriage returns,// line feeds, and tabs, that appear at the beginning and at// the end of the body of the <jsp:attribute> action, if the// action's 'trim' attribute is set to TRUE (default).// In addition, any textual nodes in the <jsp:attribute> that// have only white space are dropped from the document, with// the exception of leading and trailing white-space-only// textual nodes in a <jsp:attribute> whose 'trim' attribute// is set to FALSE, which must be kept verbatim.// Flush char buffer and remove white spaces// ignore comments in the DTD// There can only be one 'import' attribute per page directive// We're nested inside a node whose body is// declared to be scriptless// There can only be one 'import' attribute per tag directive// Check if this is a user-defined (custom) tag// uri (of the form "urn:jsptagdir:path") references tag file dir// uri references TLD file// uri is of the form "urn:jsptld:path"/* If the uri value is a plain uri, a translation error must ... */// Preserve xmlns attributes//factory.setFeature(//    "http://xml.org/sax/features/validation",//    validating);// Configure the parser/** JspReader is an input buffer for the JSP parser. It should allow ... *//** Logger. */Mark current, ...;/** The current spot in the file. */String master, ...;/** What is this? */List<> sourceFiles, ...;/** The list of source files. */int currFileId, ...;/** The current file ID (-1 indicates an error or no file). *//** Seems redundant. */JspCompilationContext context, ...;/** The compilation context. *//** The Jasper error dispatcher. */boolean singleFile, ...;/** Set to true when using the JspReader on a single file where we read up ... *//** Constructor: same as above constructor but with initialized reader ... */pushFile(...)/** Returns the file at the given position in the list. ... *//** Checks if the current file has more input. ... */current.cursorcurrent.stream.lengthcurrent.streampopFile(...)hasMoreInput(...)current.linecurrent.col/** Back up the current cursor by one char, assumes current.cursor > 0, ... */Mark oldstartCharArrayWriter cawMark mark/** search the stream for a match to a string ... *//** Looks ahead to see if there are optional spaces followed by ... */isSpace(...)/** Skip until the given string is matched in the stream. ... */Mark retint limlenMark restart/** Skip until the given string is matched in the stream, but ignoring ... */int prev/** Skip until the given end tag is matched in the stream. ... */skipUntil(...)/** Parse a space delimited token. ... */StringBuffer stringBufferchar endQuoteisDelimiter(...)/** Gets the URL for the given path name. ... *//** Parse utils - Is current character a token delimiter ? ... *//** Register a new source file. ... *//** Unregister the source file. ... *//** Push a file (and its associated Stream) on the file stack.  THe ... */String longNameint fileidregisterSourceFile(...)char[] bufpushStream(...)/** Pop a file from the file stack.  The field "current" is retored ... */String fNameMark previouspopStream(...)unregisterSourceFile(...)current.baseDirJspReader.class// Doesn't matter// Double \ is not an escape char anymore// Note: If this logic changes, also update Node.TemplateText.rtrim()// Consume the open quote: // Check end of quote, skip closing quote:// Read value until delimiter is found:// Take care of the quoting here.// Look for a single-char work delimiter:// Look for an end-of-comment or end-of-tag:                // Register the file// Bugzilla 37407: http://issues.apache.org/bugzilla/show_bug.cgi?id=37407// Pop state being constructed:// Is stack created ? (will happen if the Jsp file we're looking at is// missing.// Restore parser state:// Note that although the current file is undefined here, "current"// is not set to null just for convience, for it maybe used to// set the current (undefined) position.import JspFactoryImplimport SecurityClassLoadimport FilePermissionimport PermissionCollectionimport Policyimport Certificateint jspReloadCount, ...;/* Counts how many times the webapp's JSPs have been reloaded. */// ----------------------------------------------------------- ConstructorsString appBaseinitClassPath(...)Constants.IS_SECURITY_ENABLEDinitSecurity(...)getCheckInterval(...)/** This web applications ServletContext */URLClassLoader parentClassLoader, ...;PermissionCollection permissionCollection, ...;CodeSource codeSource, ...;long lastCheck, ...;Map<String,JspServletWrapper> jsps, ...;/** Maps JSP pages to their JspServletWrapper's *//** Add a new JspServletWrapper. ... */// ------------------------------------------------------ Public Methods/** Get an already existing JspServletWrapper. ... *//** Remove a  JspServletWrapper. ... *//** Returns the number of JSPs for which JspServletWrappers exist, i.e., ... *//** Get the SecurityManager Policy CodeSource for this web ... *//** Get the parent URLClassLoader. ... *//** Get the SecurityManager PermissionCollection for this ... *//** Process a "destroy" event for this web application context. *//** Increments the JSP reload counter. *//** Resets the JSP reload counter. ... */this.jspReloadCount/** Gets the current value of the JSP reload counter. ... *//** Method used by background thread to check the JSP dependencies ... */Object[] wrappersObject wrapperJspServletWrapper jswJspCompilationContext ctxtgetJspEngineContext(...)FileNotFoundException ex/** Method used to initialize classpath for compiles. */// -------------------------------------------------------- Private MethodsURL[] urlsStringBuffer cpathString cpConstants.SERVLET_CLASSPATH/** Method used to initialize SecurityManager data. */Policy policygetPolicy(...)String docBaseString codeBaseFile contextDirgetCanonicalFile(...)String workDirnew CodeSource(...)getPermissions(...)new FilePermission(...)new RuntimePermission(...)String jarUrlString jndiUrlJspRuntimeContext.classnew ConcurrentHashMap<String,JspServletWrapper>(...)JspFactoryImpl factorynew JspFactoryImpl(...)securityClassLoad(...)String basePackagesetDefaultFactory(...)/** Preload classes required at runtime by a JSP servlet so that ... */// Get the parent class loader// If this web application context is running from a// directory, start the background compilation thread// Checking was disabled// JspServletWrapper also synchronizes on this when// it detects it has to do a reload// Tomcat 4 can use URL's other than file URL's,// a protocol other than file: will generate a// bad file system path, so only add file:// protocol URL's to the classpath.// Setup the PermissionCollection for this web app context// based on the permissions configured for the root of the// web app context directory, then add a file read permission// for that directory.// Get the permissions for the web app context// Create a file read permission for web app context directory// Create a file read permission for web app tempdir (work)// directory// Allow the JSP to access org.apache.struts2.jasper.runtime.HttpJspBaseimport ExpressionFactoryImplimport ExpressionEvaluatorImplimport ExpressionEvaluator/** This class has all the utility method(s). ... */String META_INF_TAGS, ...;String OPEN_EXPR, ...;// Delimiters for request-time expressions (JSP and XML syntax)String CLOSE_EXPR, ...;String OPEN_EXPR_XML, ...;String CLOSE_EXPR_XML, ...;int tempSequenceNumber, ...;ExpressionEvaluator expressionEvaluator, ...;//tc6//= new ExpressionEvaluatorImpl();//private static ExpressionEvaluatorImpl expressionEvaluator...[] javaKeywords, ...;int CHUNKSIZE, ...;chars.length/** Checks if the token is a runtime expression. ... */String openExprString closeExprString returnString/** Takes a potential expression and converts it into XML form ... */Constants.ESC/** Checks to see if the given scope is valid. ... *//** Checks if all mandatory attributes are present and if all attributes ... */Mark startboolean validint tempLengthNodes tagBodyString missingAttributeint attrLeftLengthString attributeString qNameint numSubElementsValidAttribute validAttributeint attrPosvalidAttribute.mandatoryvalidAttribute.nameString escStringString shellSpCharschar nextChar/** Escape the 5 entities defined by XML. ... *//** Replaces any occurrences of the character <tt>replace</tt> with the ... */int beginint lastboolean mandatory, ...;boolean rtexprvalue, ...;// not used nowthis.mandatorythis.rtexprvalue/** Convert a String value to 'boolean'. ... *//** <p> The <tt>Class</tt> object is determined by passing the given string ... */int i0int dims/** Produces a String representing a call to the EL interpreter. ... */String jspCtxtString targetTypeString primitiveConverterMethodStringBuilder call/** Validates the syntax of all ${} expressions within the given string. ... *//** Resets the temporary variable name. ... */Constants.TEMP_VARIABLE_NAME_PREFIXString jarEntryNameZipEntry jarEntry/** Gets the fully-qualified class name of the tag handler corresponding to ... */getTagHandlerClassName(...)getClassNameBase(...)StringBuffer base/** Converts the given path to a Java package or fully-qualified class name ... */String[] classNameComponentsStringBuffer legalClassNamesclassNameComponents.length/** Splits a string into it's components. ... */Vector<> compsString comp/** Converts the given identifier to a legal Java identifier ... */StringBuffer modifiedIdentifiermangleChar(...)isJavaKeyword(...)/** Mangle the specified character to create a legal Java class name. ... */char[] resultforDigit(...)javaKeywords.length/** Converts the given Xml name to a legal Java identifier.  This is ... *//** Handles taking input from TLDs ... *//** Class.getName() return arrays in the form "[[[&lt;et&gt;", where et, ... */StringBuilder resultType/** Compute the canonical name from a Class instance.  Note that a ... */setCharAt(...)new ExpressionEvaluatorImpl(...)new ExpressionFactoryImpl(...)// Prescan to convert %\> to %>// Escape all backslashes not inside a Java string literal/* CharArrayWriter caw = new CharArrayWriter(); ... */// AttributesImpl.removeAttribute is broken, so we do this...// Add names of attributes specified using jsp:attribute// Check if this value appear in the attribute of the node// Nothing can come before jsp:attribute, and only// jsp:body can come after it./* First check to see if all the mandatory attributes are present. ... */// If mandatory attribute is missing then the exception is thrown// Check to see if there are any more attributes for the specified tag.// Now check to see if the rest of the attributes are valid too.// XXX *could* move EL-syntax validation here... (sb)// This is an array.  Count the dimensions// Array of more than i dimension/* Determine which context object to use. *//* Determine whether to use the expected type's textual name ... *//* Build up the base call to the interpreter. */// XXX - We use a proprietary call to the interpreter for now// as the current standard machinery is inefficient and requires// lots of wrappers and adapters.  This should all clear up once// the EL interpreter moves out of JSTL and into its own project.// In the future, this should be replaced by code that calls// ExpressionEvaluator.parseExpression() and then cache the resulting// expression objects.  The interpreterCall would simply select// one of the pre-cached expressions and evaluate it.// Note that PageContextImpl implements VariableResolver and// the generated Servlet/SimpleTag implements FunctionMapper, so// that machinery is already in place (mroth)./* Add the primitive converter method if we need to. */// Detect format error at translation time// this trick avoids escaping issues//It's tempting to remove the ".tag" suffix here, but we can't.//If we remove it, the fully-qualified class name of this tag//could conflict with the package name of other tags.//For instance, the tag file//    /WEB-INF/tags/foo.tag//would have fully-qualified class name//    org.apache.jsp.tag.web.foo//which would conflict with the package name of the tag file//    /WEB-INF/tags/foo/bar.tag/** Class responsible for converting error codes to corresponding localized ... *//* Returns the localized error message corresponding to the given error ... */MessageFormat formatter/** Mark represents a point in the JSP input. ... */int cursor, ...;// position within current streamString baseDir, ...;// directory of file for current stream...[] stream, ...;// current streamint fileId, ...;// fileid of current stream// name of the current fileStack<> includeStack, ...;/* stack of stream and stream state of streams that have included ... */// encoding of current fileJspReader reader, ...;// reader that owns this mark (so we can look up fileid's)this.readerthis.streamthis.cursorthis.colthis.fileIdthis.includeStackother.readerother.streamother.fileIdother.fileNameother.cursorother.lineother.colother.baseDirother.encodingother.includeStack/** Sets this mark's state to a new stream. ... */new IncludeState(...)/** Restores this mark's state to a previously stored stream. ... */IncludeState statestate.cursorstate.linestate.colstate.fileIdstate.fileNamestate.baseDirstate.stream// -------------------- Locator interface --------------------/** Gets the URL of the resource with which this Mark is associated ... */m.readerm.fileIdm.cursorm.linem.colboolean greater/** Keep track of parser before parsing an included file. ... */// clone includeStack without cloning contents// store current state in stack// set new variables// make sure we have something to pop// get previous state in stackimport IterationTagimport JspIdConsumerimport SimpleTagimport TagDataimport TryCatchFinallyimport TagPluginContext/** An internal data representation of a JSP page or a JSP docuement (XML). Also ... */...[] ZERO_VARIABLE_INFO, ...;Attributes attrs, ...;Attributes taglibAttrs, ...;// xmlns attributes that represent tag libraries (only in XML syntax)Attributes nonTaglibXmlnsAttrs, ...;/* xmlns attributes that do not represent tag libraries (only in XML syntax) */Nodes body, ...;int beginJavaLine, ...;int endJavaLine, ...;Nodes namedAttributeNodes, ...;String qName, ...;// cached for performanceString innerClassName, ...;/* The name of the inner class to which the codes for this node and its body ... */boolean isDummy, ...;/** Zero-arg Constructor. */this.isDummythis.startMarkaddToParent(...)this.qName/** Constructor for Nodes parsed from standard syntax. ... */this.attrs/** Constructor for Nodes parsed from XML syntax. ... */this.nonTaglibXmlnsAttrsthis.taglibAttrs/* Constructor. ... *//* Gets this Node's attributes. ... *//* Gets this Node's xmlns attributes that represent tag libraries (only ... *//* Gets this Node's xmlns attributes that do not represent tag libraries ... *//** Get the attribute that is non request time expression, either from the ... */String attrNamedAttribute namedAttribute/** Searches all subnodes of this node for jsp:attribute standard actions ... */NamedAttribute resultNodes nodesint numChildNodesNamedAttribute na/** Searches all subnodes of this node for jsp:attribute standard actions, ... */Nodes result/** Selects and invokes a method in the visitor class based on the node type. ... *//* Adds this Node to the body of the given parent. */// *********************************************************************Nodes parentBodysetBody(...)/** Represents the root of a Jsp page or Jsp document *//** ************************************************************************* ... */Root parentRoot, ...;boolean isXmlSyntax, ...;String pageEnc, ...;// Source encoding of the page containing this RootString jspConfigPageEnc, ...;// Page encoding specified in JSP config elementboolean isDefaultPageEncoding, ...;/* Flag indicating if the default page encoding is being used (only ... */boolean isEncodingSpecifiedInProlog, ...;/* Indicates whether an encoding has been explicitly specified in the ... */boolean isBomPresent, ...;/* Sequence number for temporary variables. *//* Constructor. */Node rthis.isXmlSyntax/* Sets the encoding specified in the JSP config element whose URL ... *//* Gets the encoding specified in the JSP config element whose URL ... *//** Generates a new temporary variable name. */nextTemporaryVariableName(...)/** Represents the root of a Jsp document (XML syntax) *//** Represents a page directive */Vector<> imports, ...;/** Parses the comma-separated list of class or package names in the ... *//** Represents an include directive *//** Represents a custom taglib directive *//** Represents a tag directive *//** Represents an attribute directive *//** Represents a variable directive *//** Represents a <jsp:invoke> tag file action *//** Represents a <jsp:doBody> tag file action *//** Represents a Jsp comment Comments are kept for completeness. *//** Represents an expression, declaration, or scriptlet *//** When this node was created from a JSP page in JSP syntax, its text ... */String ret/** For the same reason as above, the source line information in the ... *//** Represents a declaration *//** Represents an expression. Expressions in attributes are embedded in the ... *//** Represents a scriptlet *//** Represents an EL expression. Expressions in attributes are embedded in ... */ELNode.Nodes el, ...;this.el/** Represents a param action */JspAttribute value, ...;/** Represents a params action *//** Represents a fallback action *//** Represents an include action */JspAttribute page, ...;/** Represents a forward action *//** Represents a getProperty action *//** Represents a setProperty action *//** Represents a useBean action */JspAttribute beanName, ...;this.beanName/** Represents a plugin action */JspAttribute width, ...;JspAttribute height, ...;this.heightthis.width/** Represents an uninterpreted tag, from a Jsp document */...[] jspAttrs, ...;this.jspAttrs/** Represents a <jsp:element>. */JspAttribute nameAttr, ...;/* Sets the XML-style 'name' attribute */this.nameAttr/* Gets the XML-style 'name' attribute *//** Represents a <jsp:output>. *//** Collected information about child elements. Used by nodes like CustomTag, ... */boolean scriptless, ...;boolean hasUseBean, ...;// contain no scripting elements.// true if the tag and its bodyboolean hasIncludeAction, ...;boolean hasParamAction, ...;boolean hasSetProperty, ...;/** Represents a custom tag */TagData tagData, ...;String tagHandlerPoolName, ...;TagFileInfo tagFileInfo, ...;...[] varInfos, ...;int customNestingLevel, ...;ChildInfo childInfo, ...;boolean implementsIterationTag, ...;boolean implementsBodyTag, ...;boolean implementsTryCatchFinally, ...;boolean implementsJspIdConsumer, ...;boolean implementsSimpleTag, ...;boolean implementsDynamicAttributes, ...;Vector<> atBeginScriptingVars, ...;Vector<> atEndScriptingVars, ...;Vector<> nestedScriptingVars, ...;Node.CustomTag customTagParent, ...;Integer numCount, ...;boolean useTagPlugin, ...;TagPluginContext tagPluginContext, ...;Nodes atSTag, ...;/** The following two fields are used for holding the Java scriptlets ... */Nodes atETag, ...;/* Constructor for custom action implemented by tag handler. */this.customNestingLevelmakeCustomNestingLevel(...)this.childInfonew ChildInfo(...)this.implementsIterationTagIterationTag.classthis.implementsBodyTagBodyTag.classthis.implementsTryCatchFinallyTryCatchFinally.classthis.implementsSimpleTagSimpleTag.classthis.implementsDynamicAttributesDynamicAttributes.classthis.implementsJspIdConsumerJspIdConsumer.class/* Constructor for custom action implemented by tag file. */this.tagFileInfoTagInfo infoTagAttributeInfo[] taitai.lengththis.tagDatathis.varInfosgetVariableInfo(...)/* @return true if this custom action is supported by a tag file, false ... */this.customTagParentthis.numCountthis.atBeginScriptingVarsthis.atEndScriptingVarsthis.nestedScriptingVars/* Gets the scripting variables for the given scope that need to be ... *//* Gets this custom tag's custom nesting level, which is given as the ... *//** Checks to see if the attribute of the given name is of type ... */TagAttributeInfo[] attributesattributes.lengththis.tagPluginContext/* Computes this custom tag's custom nesting level, which corresponds to ... */Node p(...).qNamep.parent/** Returns true if this custom action has an empty body, and false ... */boolean hasEmptyBody/** Used as a placeholder for the evaluation code of a custom action ... */CustomTag tag, ...;// name of the attribute// The tag this attribute belongs to/** Represents the body of a &lt;jsp:text&gt; element *//** Represents a Named Attribute (&lt;jsp:attribute&gt;) */String temporaryVariableName, ...;// A unique temporary variable name suitable for code generation// True if this node is to be trimmed, or false otherwise/* Get the attribute value from this named attribute (<jsp:attribute>). ... */String attrValue, ...;AttributeVisitor attributeVisitornew AttributeVisitor(...)getAttrValue(...)/** Represents a JspBody node (&lt;jsp:body&gt;) *//** Represents a template text string */ArrayList<> extraSmap, ...;/** Trim all whitespace from the left of the template text *//** Trim all whitespace from the right of the template text *//** Returns true if this template text contains whitespace only. *//** Add a source to Java line mapping ... *//** Represents attributes that can be request time expressions. ... */boolean expression, ...;boolean dynamic, ...;TagAttributeInfo tai, ...;boolean namedAttribute, ...;// If true, this JspAttribute represents a <jsp:attribute>NamedAttribute namedAttributeNode, ...;// The node in the parse tree for the NamedAttributethis.namedAttributeNodethis.dynamicthis.namedAttributethis.tai/** Allow node to validate itself ... *//** Use this constructor if the JspAttribute represents a named ... */String mgetMethodSignature(...)int rti/** Only makes sense if namedAttribute is false. ... *//** Only makes sense if namedAttribute is true. ... *//** An ordered list of Node, used to represent the body of an element, or a ... */Node.Root root, ...;boolean generatedInBuffer, ...;// null if this is not a page/** Appends a node to the list ... *//** Removes the given node from the list. ... */ArrayIndexOutOfBoundsException e/** A visitor class for visiting the node. This class also provides the ... *//** This method provides a place to put actions that are common to all ... *//** Visit the body of a node, using the current visitor */doVisit(...)new VariableInfo[]// Look for the attribute in NamedAttribute children// qualified name// Figure out and set the parent root// No comma found// Nulls cause NPEs further down the line// (if null or true, leave default of true)// Mandatary attribute "name" will be checked in Validator// According to JSP 2.0, if the body of the <jsp:attribute>// action is empty, it is equivalent of specifying "" as the value// of the attribute.// determine exact typeimport ListIteratorimport PageData/** An implementation of <tt>javax.servlet.jsp.tagext.PageData</tt> which ... */String CDATA_START_SECTION, ...;String CDATA_END_SECTION, ...;StringBuffer buf, ...;// string buffer used to build XML viewFirstPassVisitor firstPassnew FirstPassVisitor(...)SecondPassVisitor secondPassnew SecondPassVisitor(...)getJspIdPrefix(...)/** Returns the input stream of the XML view. ... *//* First-pass Visitor for JspRoot nodes (representing jsp:root elements) ... */AttributesImpl rootAttrs, ...;// Prefix for the 'id' attributethis.rootAttrsisJspPrefixHijacked(...)containsPrefix(...)setAttributes(...)addAttributes(...)getTaglibAttributes(...)/* Converts taglib directive into "xmlns:..." attribute of jsp:root ... *//* Second-pass Visitor responsible for producing XML view and assigning ... */Compiler compiler, ...;boolean resetDefaultNS, ...;// Current value of jsp:id attributethis.buf/* Visits root node. */appendXmlProlog(...)appendTag(...)boolean resetDefaultNSSave/* Visits jsp:root element of JSP page in XML syntax. ... */appendPageDirective(...)appendTagDirective(...)appendText(...)/* Appends the given tag, including its body, to the XML view. *//* Appends the given tag, including its body, to the XML view, ... *//* Appends the page directive with the given attributes to the XML ... */boolean appendgetExprInXml(...)boolean firstListIterator<> iterlistIterator(...)/* Appends a page directive with 'pageEncoding' and 'contentType' ... *//* Appends the tag directive with the given attributes to the XML ... *//* Appends a tag directive containing a single 'pageEncoding' ... */appendCDATA(...)/* Appends the given text as a CDATA section to the XML view, unless ... */escapeCDATA(...)/* Escapes any occurrences of "]]>" (by replacing them with "]]&gt;") ... */CharArrayWriter result/* Appends the attributes of the given Node to the XML view. */boolean defaultNSSeen...|=.../* Appends XML prolog with encoding declaration. */// First pass// Second pass// Turn StringBuffer into InputStream// should never happen/* Top-level page. ... *//* 'jsp' prefix has been hijacked, that is, bound to a ... *//* According to javadocs of org.xml.sax.helpers.AttributesImpl, ... */// Bugzilla 35252: http://issues.apache.org/bugzilla/show_bug.cgi?id=35252// top-level page// expand in place// Comments are ignored in XML view/* If the template text came from a JSP page written in JSP syntax, ... */// append jsp:id// append remaining attributes/* Page directive's 'import' attribute is considered ... */// Concatenate names of imported classes/packages// match found/* Append "xmlns" attributes that represent tag libraries *//* Append "xmlns" attributes that do not represent tag libraries *//* Append all other attributes *//** A repository for various info about the translation unit under compilation. ... */Vector<> dependants, ...;BeanRepository beanRepository, ...;HashMap<> taglibsMap, ...;HashMap<> jspPrefixMapper, ...;HashMap<> xmlPrefixMapper, ...;HashMap<> nonCustomTagPrefixMap, ...;String jspFile, ...;String defaultLanguage, ...;String language, ...;String defaultExtends, ...;String xtends, ...;String session, ...;boolean isSession, ...;String bufferValue, ...;int buffer, ...;String autoFlush, ...;// XXX confirmboolean isAutoFlush, ...;String isThreadSafeValue, ...;boolean isThreadSafe, ...;String isErrorPageValue, ...;boolean isErrorPage, ...;String errorPage, ...;String info, ...;boolean scriptingInvalid, ...;String isELIgnoredValue, ...;boolean isELIgnored, ...;String deferredSyntaxAllowedAsLiteralValue, ...;// JSP 2.1boolean deferredSyntaxAllowedAsLiteral, ...;ExpressionFactory expressionFactory, ...;String trimDirectiveWhitespacesValue, ...;boolean trimDirectiveWhitespaces, ...;String omitXmlDecl, ...;String doctypeName, ...;String doctypePublic, ...;String doctypeSystem, ...;boolean isJspPrefixHijacked, ...;HashSet<> prefixes, ...;// Set of all element and attribute prefixes used in this translation unitboolean hasJspRoot, ...;Vector<> pluginDcls, ...;// Id's for tagplugin declarationsthis.jspFilethis.beanRepositorythis.taglibsMapthis.jspPrefixMapperthis.xmlPrefixMapperthis.nonCustomTagPrefixMapthis.importsthis.dependantsthis.pluginDclsthis.prefixesConstants.STANDARD_IMPORTS.lengthConstants.STANDARD_IMPORTS/** Check if the plugin ID has been previously declared.  Make a not ... */this.doctypeNamethis.doctypeSystemthis.doctypePublic/* Tag library and XML namespace management methods *//* Adds the given prefix to the set of prefixes of this translation unit. ... *//* Checks to see if this translation unit contains the given prefix. ... *//* Maps the given URI to the given tag library. ... *//* Gets the tag library corresponding to the given URI. ... *//* Gets the collection of tag libraries that are associated with a URI ... *//* Checks to see if the given URI is mapped to a tag library. ... *//* Maps the given prefix to the given URI. ... *//* Pushes the given URI onto the stack of URIs to which the given prefix ... */LinkedList<> stacknew LinkedList<>(...)addFirst(...)/* Removes the URI at the top of the stack of URIs to which the given ... *//* Returns the URI to which the given prefix maps. ... */getFirst(...)/* language *//* Page/Tag directive attributes *//* extends *//** Gets the value of the 'extends' page directive attribute. ... *//* contentType *//* buffer */Integer k/* session *//* autoFlush *//* isThreadSafe *//* info *//* errorPage *//* isErrorPage *//* isELIgnored *//* deferredSyntaxAllowedAsLiteral *//* trimDirectiveWhitespaces */this.deferredSyntaxAllowedAsLiteralConstants.JSP_SERVLET_BASE// Enter standard imports// XXX throw new Exception("XXX");/* If page superclass is top level class (i.e. not in a package) ... *//** This class implements a parser for a JSP page (non-xml view). JSP page ... */String currentFile, ...;Mark start, ...;int scriptlessCount, ...;URL jarFileUrl, ...;String JAVAX_BODY_CONTENT_PARAM, ...;// These are not accessible from outside the parser.// Virtual body content types, to make parsing a little easier.String JAVAX_BODY_CONTENT_PLUGIN, ...;String JAVAX_BODY_CONTENT_TEMPLATE_TEXT, ...;boolean STRICT_QUOTE_ESCAPING, ...;this.currentFilethis.scriptlessCountthis.jarFileUrl/** The main entry for Parser ... */Parser parsernew Parser(...)Root rootPageInfo pageInfosetIsDefaultPageEncoding(...)parseElements(...)/** Attributes ::= (S Attribute)* S? */parseAttribute(...)/** Parse Attributes for a reader, provided for external use */Parser tmpParserparseAttributes(...)/** Attribute ::= Name S? Eq S? ( '"<%=' RTAttributeValueDouble | '"' ... */parseName(...)char quoteString watchStringparseAttributeValue(...)/** Name ::= (Letter | '_' | ':') (Letter | Digit | '.' | '_' | '-' | ':')* */isLetter(...)/** AttributeValueDouble ::= (QuotedChar - '"')* ('"' | <TRANSLATION_ERROR>) ... */Mark stopskipUntilIgnoreEsc(...)parseQuoted(...)/** QuotedChar ::= '&apos;' | '&quot;' | '\\' | '\"' | "\'" | '\>' | '\$' | ... */CharArrayWriter cw/* Invokes parserController to parse the included page *//* Parses a page directive with the following syntax: PageDirective ::= ( S ... */PageDirective n/* Parses an include directive with the following syntax: IncludeDirective ... */Node includeNode/** Add a list of files. This is used for implementing include-prelude and ... *//* Parses a taglib directive with the following syntax: Directive ::= ( S ... */Mark prevMarkgetNonCustomTagPrefix(...)String uriPrevTagLibraryInfoImpl implTagFileInfo infogetTagFiles(...)setTagFileJarUrl(...)addPrefixMapping(...)String urnTagdirnew TaglibDirective(...)/* Parses a directive with the following syntax: Directive ::= S? ( 'page' ... */String directiveparsePageDirective(...)parseIncludeDirective(...)parseTaglibDirective(...)parseTagDirective(...)parseAttributeDirective(...)parseVariableDirective(...)/* Parses a directive with the following syntax: ... */String eTagmatchesETag(...)/* Parses a tag directive with the following syntax: PageDirective ::= ( S ... */TagDirective n/* Parses a attribute directive with the following syntax: ... */AttributeDirective n/* Parses a variable directive with the following syntax: PageDirective ::= ( ... */VariableDirective n/* JSPCommentBody ::= (Char* - (Char* '--%>')) '--%>' *//* DeclarationBody ::= (Char* - (char* '%>')) '%>' */parseScriptText(...)/* XMLDeclarationBody ::= ( S? '/>' ) | ( S? '>' (Char* - (char* '<')) ... */matchesETagWithoutLessThan(...)/* ExpressionBody ::= (Char* - (char* '%>')) '%>' *//* XMLExpressionBody ::= ( S? '/>' ) | ( S? '>' (Char* - (char* '<')) ... *//* ELExpressionBody (following "${" to first unquoted "}") // XXX add formal ... */Mark lastboolean singleQuotedboolean doubleQuotedint currentChar/* ScriptletBody ::= (Char* - (char* '%>')) '%>' *//* XMLScriptletBody ::= ( S? '/>' ) | ( S? '>' (Char* - (char* '<')) ... *//** Param ::= '<jsp:param' S Attributes S? EmptyBody S? */Node paramActionNodeparseEmptyBody(...)/* For Include: StdActionContent ::= Attributes ParamBody ... */parseOptionalBody(...)/* For Forward: StdActionContent ::= Attributes ParamBody */Node forwardNodeNode invokeNodeNode doBodyNodeNode elementNodeTagInfo.BODY_CONTENT_JSP/* For GetProperty: StdActionContent ::= Attributes EmptyBody */Node getPropertyNodeTagInfo.BODY_CONTENT_EMPTY/* For SetProperty: StdActionContent ::= Attributes EmptyBody */Node setPropertyNode/* EmptyBody ::= '/>' | ( '>' ETag ) | ( '>' S? '<jsp:attribute' ... */matchesOptionalSpacesFollowedBy(...)parseNamedAttributes(...)/* For UseBean: StdActionContent ::= Attributes OptionalBody */Node useBeanNode/* Parses OptionalBody, but also reused to parse bodies for plugin and param ... */parseJspAttributeAndBody(...)parseBody(...)/** Attempts to parse 'JspAttributeAndBody' production. Returns true if it ... */parseJspBody(...)/* Params ::= `>' S? ( ( `<jsp:body>' ( ( S? Param+ S? `</jsp:body>' ) | ... */Node jspParamsNode/* Fallback ::= '/>' | ( `>' S? `<jsp:body>' ( ( S? ( Char* - ( Char* `</jsp:body>' ) ) `</jsp:body>' ... */Node fallBackNode/* For Plugin: StdActionContent ::= Attributes PluginBody ... */Node pluginNode/* PluginTags ::= ( '<jsp:params' Params S? )? ( '<jsp:fallback' Fallback? ... */parseJspParams(...)parseFallBack(...)/* StandardAction ::= 'include' StdActionContent | 'forward' ... */parseInclude(...)parseForward(...)parseInvoke(...)parseDoBody(...)parseGetProperty(...)parseSetProperty(...)parseUseBean(...)parsePlugin(...)parseElement(...)/* # '<' CustomAction CustomActionBody ... */parseToken(...)String shortTagNameString bcNode tagNodeputNonCustomTagPrefix(...)/* Parse for a template text string until '<' or "${" or "#{" is encountered, ... */pushChar(...)char next/* XMLTemplateText ::= ( S? '/>' ) | ( S? '>' ( ( Char* - ( Char* ( '<' | ... */parseELExpression(...)/* AllBody ::= ( '<%--' JSPCommentBody ) | ( '<%@' DirectiveBody ) | ( '<jsp:directive.' ... */parseElementsScriptless(...)parseComment(...)parseDirective(...)parseXMLDirective(...)parseDeclaration(...)parseXMLDeclaration(...)parseXMLExpression(...)parseScriptlet(...)parseXMLScriptlet(...)parseXMLTemplateText(...)parseCustomTag(...)checkUnbalancedEndTag(...)parseTemplateText(...)/* ScriptlessBody ::= ( '<%--' JSPCommentBody ) | ( '<%@' DirectiveBody ) | ( '<jsp:directive.' ... *//* TemplateTextBody ::= ( '<%--' JSPCommentBody ) | ( '<%@' DirectiveBody ) | ( '<jsp:directive.' ... *//* Flag as error if an unbalanced end tag appears by itself. *//** TagDependentBody := */Mark bodyStartMark bodyEndskipUntilETag(...)/* Parses jsp:body action. */Node bodyNode/* Parse the body as JSP content. @param tag The name of the tag whose end ... */parseTagDependentBody(...)parsePluginTags(...)parseParam(...)parseElementsTemplateText(...)/* Parses named attributes. */NamedAttribute namedAttributeNodegetAttributeBodyType(...)Node lastNode/** Determine the body type of <jsp:attribute> from the enclosing node */TagAttributeInfo[] tldAttrstldAttrs.lengthsetSingleFile(...)// For the Top level page, add inlcude-prelude and include-coda// Get the qualified name// Determine prefix and local name components// quote// putback delimiter '<%=' and '%>', since they are needed if the// attribute does not allow RTexpression.// \ " and ' are always unescaped regardless of if they are// inside or outside of an EL expression. JSP.1.6 takes// precedence over JSP.1.3.10 (confirmed with EG).// Unescaped quote character/* A page directive may contain multiple 'import' attributes, each of ... */// Included file expanded here// Current compilation context needs location of cached// tag files// No need to get the tagLibInfo objects. This alos suppresses// parsing of any tag files used in this tag file.// XXX could move this logic to JspReader// XXX somewhat wasteful// skip character following '\' within quotes// Done// Parse the one or more named attribute nodes// Body not allowed// EmptyBody// Must be ( '>' # Body ETag )// May be an EmptyBody, depending on whether// There's a "<jsp:body" before the ETag// First, parse <jsp:attribute> elements:// ActionBody// If we have <jsp:attribute> but something other than// <jsp:body> or the end tag, translation error.// Parse 'CustomAction' production (tag prefix and custom action name)// skip '<'// Check if this is a user-defined tag.// Remember the prefix for later error checking// Must be a classic tag, load it here.// tag files will be loaded later, in TagFileProcessor// Parse 'CustomActionBody' production:// At this point we are committed - if anything fails, we produce// a translation error.// Parse 'Attributes' production:// Parse 'CustomActionEnd' production:// Now we parse one of 'CustomActionTagDependent',// 'CustomActionJSPContent', or 'CustomActionScriptlessContent'.// depending on body-content in TLD.// Looking for a body, it still can be empty; but if there is a// a tag body, its syntax would be dependent on the type of// body content declared in the TLD.// Output the first character// Looking for \% or \$ or \#// Check for <![CDATA[// Create a template text node// Mark and parse the EL expression and create its node:// vc: ScriptlessBody// We must follow the ScriptlessBody production if one of// our parents is ScriptlessBody.// Keep track of how many scriptless nodes we've encountered// so we know whether our child nodes are forced scriptless// Check for unbalanced standard actions// Check for unbalanced custom actions// (note the == since we won't recognize JAVAX_*// from outside this module).// Check for nested jsp:body or jsp:attributeimport XMLEncodingDetector/** Controller for the parsing of a JSP page. ... */String CHARSET, ...;boolean isXml, ...;/* Indicates the syntax (XML or standard) of the file being processed */Stack<> baseDirStack, ...;/* A stack to keep track of the 'current base directory' ... */int skip, ...;String sourceEnc, ...;boolean directiveOnly, ...;/** Parses a JSP page or tag file. This is invoked by the compiler. ... */doParse(...)/** Parses the directives of a JSP page or tag file. This is invoked by the ... *//** Processes an include directive with the given path. ... *//** Extracts tag file directive information from the tag file with the ... *//** Extracts tag file directive information from the given tag file. ... */boolean isTagFileSaveboolean directiveOnlySave/** Parses the JSP page or tag file with the given path name. ... */Nodes parsedPageString absFileNameresolveFileName(...)String jspConfigPageEncgetJspConfigPageEncoding(...)determineSyntaxAndEncoding(...)InputStreamReader inStreamReaderJspReader jspReadernew JspReader(...)/* Checks to see if the given URI is matched by a URL pattern specified in ... *//** Determines the syntax (standard or XML) and page encoding properties ... */boolean isExternalboolean revertMark startMarkObject[] retgetPageEncodingForJspSyntax(...)/* Determines page source encoding for page or tag file in JSP syntax, ... */String saveEncodingboolean isDirectivegetPageEncodingFromDirective(...)/* Scans the given attributes for the attribute with the given name, ... *//* Resolve the name of the file and update baseDirStack() to keep track of ... */String baseDir/* Checks to see if the given page contains, as its first element, a <root> ... */String rootString xmlnsDeclregionMatches(...)setUseCaches(...)connect(...)// If we're parsing a packaged tag file or a resource included by it// (using an include directive), ctxt.getTagFileJar() returns the // JAR file from which to read the tag file or included resource,// respectively.// For files that are statically included, isTagfile and directiveOnly// remain unchanged.// Figure out what type of JSP document and encoding type we are// dealing with// Included resource, add to dependent list/* Make sure the encoding explicitly specified in the XML ... */// Dispatch to the appropriate parser// JSP document (XML syntax)// InputStream for jspx page is created and properly closed in// JspDocumentParser.// Standard syntax/* 'true' if the syntax (XML or standard) of the file is given ... *//* Indicates whether we need to revert from temporary usage of ... */// If <is-xml> is specified in a <jsp-property-group>, it is used.// JSP (standard) syntax. Use encoding specified in jsp-config// if provided.// We don't know the encoding, so use BOM to determine it// XML syntax or unknown, (auto)detect encoding .../* We don't know if we're dealing with XML or standard syntax. ... */// (This implies 'isExternal' is TRUE.)// We know we're dealing with a JSP document (via JSP config or// ".jspx" suffix), so we're done./* At this point, 'isExternal' or 'isXml' is FALSE. ... *//* At this point, we know we're dealing with JSP syntax. ... */// Default to "ISO-8859-1" per JSP spec/* Determine page encoding from directive of the form <%@ page %>, ... */// If this is a comment, skip until its end// error will be caught in Parser// compare for "tag ", so we don't match "taglib"// attrName = contentType// <prefix>:root must be the first element// call substring to get rid of leading '<'// Determine namespace associated with <root> element's prefix/** Class responsible for determining the scripting variables that every ... */Integer MAX_SCOPE, ...;/* Assigns an identifier (of type integer) to every custom tag, in order ... */Node.CustomTag parent, ...;CustomTag tmpParentsetCustomTagParent(...)setNumCount(...)/* For every custom tag, determines the scripting variables it needs to ... */Hashtable<> scriptVars, ...;setScriptingVars(...)Integer ownRangeCustomTag parentgetCustomTagParent(...)getNumCount(...)Integer currentRangenew CustomTagCounter(...)new ScriptingVariableVisitor(...)// NESTED/** This is what is used to generate servlets. ... */int TAB_WIDTH, ...;String SPACES, ...;// Current indent level:int virtual_indent, ...;// The sink writer:int javaLine, ...;// servlet line numbers start from 1// -------------------- Access informations --------------------// -------------------- Formatting --------------------/** Print a standard comment for echo outputed chunk. ... *//** Prints the given string followed by '\n' ... *//** Prints a '\n' *//** Prints the current indention *//** Prints the current indention, followed by the given string ... *//** Prints the current indention, and then the string, and a '\n'. ... *//** Prints the given int. ... */// look for hidden newlines inside strings/** Represents a source map (SMAP), which serves to associate lines ... */String outputFileName, ...;// Private state/* The SMAP syntax is reasonably straightforward.  The purpose of this ... */// OverviewString defaultStratum, ...;List<> strata, ...;List<> embedded, ...;boolean doEmbedded, ...;// Methods for adding mapping data/** Adds the given SmapStratum object, representing a Stratum with ... */this.defaultStratumgetStratumName(...)/** Adds the given string as an embedded SMAP with the given stratum name. ... *//** Instructs the SmapGenerator whether to actually print any embedded ... */// Methods for serializing the logical SMAPStringBuffer outint nStrataint nEmbeddedSmapStratum s// For testing (and as an example of use)...SmapGenerator gnew SmapGenerator(...)new SmapStratum(...)SmapGenerator embeddedsetOutputFileName(...)addFile(...)addLineData(...)addStratum(...)// check state and initialize buffer// start the SMAP// include embedded SMAPs// print our StratumSections, FileSections, and LineSections// end the SMAP/** Represents the line and file mappings associated with a JSR-045 ... *//** Represents a single LineSection in an SMAP, associated with ... */// Class for storing LineInfo dataint inputStartLine, ...;int outputStartLine, ...;int lineFileID, ...;int inputLineCount, ...;int outputLineIncrement, ...;boolean lineFileIDSet, ...;this.inputStartLinethis.outputStartLinethis.lineFileIDthis.lineFileIDSetthis.inputLineCountthis.outputLineIncrementString stratumName, ...;List<> fileNameList, ...;List<> filePathList, ...;List<> lineData, ...;int lastFileID, ...;/** Constructs a new SmapStratum object for the given stratum name ... */this.stratumName/** Adds record of a new file, by filename. ... */// Methods to add mapping information/** Adds record of a new file, by filename and path.  The path ... */int pathIndex/** Combines consecutive LineInfos wherever possible */LineInfo liLineInfo liNextliNext.lineFileIDSetliNext.inputStartLineli.inputStartLineliNext.inputLineCountli.inputLineCountliNext.outputStartLineli.outputStartLineli.outputLineIncrementsetOutputLineIncrement(...)liNext.outputLineIncrementsetInputLineCount(...)/** Adds complete information about a simple line mapping.  Specify ... */int fileIndexnew LineInfo(...)setInputStartLine(...)setOutputStartLine(...)setLineFileID(...)// Methods to retrieve informationint boundString filePath//Incorporate each LineInfo into the previous LineInfo's//outputLineIncrement, if possible//inputLineCount, if possible// check the input - what are you doing here??// still//Jasper incorrectly SMAPs certain Nodes, giving them an //outputStartLine of 0.  This can cause a fatal error in//optimizeLineSection, making it impossible for Jasper to//compile the JSP.  Until we can fix the underlying//SMAPping problem, we simply ignore the flawed SMAP entries.// build the LineInfo// save it// print StratumSection// print FileSection// Source paths must be relative, not absolute, so we// remove the leading "/", if one exists.// print LineSection/** Contains static utilities for generating SMAP data based on the ... */String SMAP_ENCODING, ...;// Constants/** Generates an appropriate SMAP representing the current compilation ... */// Public entry pointsPreScanVisitor psVisitornew PreScanVisitor(...)getMap(...)int innerClassCountString[] smapInfounqualify(...)evaluateNodes(...)optimizeLineSection(...)isSmapDumped(...)File outSmapPrintWriter soString innerClassString innerClassFileNamesmap.lengthFile outServletinstall(...)/** Returns an unqualified version of the given file path. */// Private utilities/** Returns a file path corresponding to a potential SMAP input ... */// Installation logic (from Robert Field, JSR-045 spec lead)String nameSDE, ...;...[] orig, ...;...[] sdeAttr, ...;...[] gen, ...;int origPos, ...;int genPos, ...;int sdeIndex, ...;new SDEInstaller(...)File tmpFilerenameTo(...)FileOutputStream outStreamnew FileNotFoundException(...)this.sdeAttrreadWhole(...)orig.lengthsdeAttr.lengthaddSDE(...)FileInputStream inStreamint constantPoolCountPosint constantPoolCountreadU2(...)int interfaceCountint attrCountPosint attrCountwriteU2(...)copyConstantPool(...)writeUtf8ForSDE(...)randomAccessWriteU2(...)copyMembers(...)copyAttrs(...)writeAttrForSDE(...)boolean sdeFoundint nameIndexreadU4(...)writeU4(...)writeU1(...)int savePosreadU1(...)int sdeIndexint tagbyte[] utf8readBytes(...)writeBytes(...)SDEInstaller.classnew SmapGenVisitor(...)SmapStratum smap, ...;HashMap<> innerClassMap, ...;this.smapthis.breakAtLFthis.innerClassMapSmapStratum smapSavegetInnerClassName(...)doSmapText(...)doSmap(...)int iInputStartLineint iOutputStartLineint iOutputLineIncrementArrayList<> extraSmapgetExtraSmap(...)String unqualifiedNameint lineCountint skippedLinesboolean slashStarSeenboolean beginningHashMap<> map, ...;SmapUtil.class// Scan the nodes for presence of Jasper generated inner classes// set up our SMAP generator/** Disable reading of input SMAP because: ... */// now, assemble info about our own stratum (JSP) using JspLineMap// Map out Node.Nodes// get the bytes// do it// write result// magic min/maj version// copy old constant pool return index of SDE symbol, if found// if "SourceDebugExtension" symbol not there add it// increment the countantPoolCount// access, this, super// fields// methods// copy the class attributes, return true if SDE attr found (not copied)// we will be adding SDE and it isn't already counted// access, name, descriptor// don't write old SDE// copy const pool index zero not in class file// Class// Field// Method// InterfaceMethod// Integer// Float// NameAndType// Long// Double// Utf8// Utf8 tag//Add the file information//Add a LineInfo that corresponds to the beginning of this node// Output additional mappings in the text// Count lines inside text, but skipping comment lines at the// beginning of the text.// End of /* */ comment// Some executable code after commentString DIRECTIVE_ACTION, ...;String ROOT_ACTION, ...;String JSP_ROOT_ACTION, ...;String PAGE_DIRECTIVE_ACTION, ...;String JSP_PAGE_DIRECTIVE_ACTION, ...;String INCLUDE_DIRECTIVE_ACTION, ...;String JSP_INCLUDE_DIRECTIVE_ACTION, ...;String DECLARATION_ACTION, ...;String JSP_DECLARATION_ACTION, ...;String SCRIPTLET_ACTION, ...;String JSP_SCRIPTLET_ACTION, ...;String EXPRESSION_ACTION, ...;String JSP_EXPRESSION_ACTION, ...;String USE_BEAN_ACTION, ...;String JSP_USE_BEAN_ACTION, ...;String SET_PROPERTY_ACTION, ...;String JSP_SET_PROPERTY_ACTION, ...;String GET_PROPERTY_ACTION, ...;String JSP_GET_PROPERTY_ACTION, ...;String INCLUDE_ACTION, ...;String JSP_INCLUDE_ACTION, ...;String FORWARD_ACTION, ...;String JSP_FORWARD_ACTION, ...;String PARAM_ACTION, ...;String JSP_PARAM_ACTION, ...;String PARAMS_ACTION, ...;String JSP_PARAMS_ACTION, ...;String PLUGIN_ACTION, ...;String JSP_PLUGIN_ACTION, ...;String FALLBACK_ACTION, ...;String JSP_FALLBACK_ACTION, ...;String TEXT_ACTION, ...;String JSP_TEXT_ACTION, ...;String JSP_TEXT_ACTION_END, ...;String ATTRIBUTE_ACTION, ...;String JSP_ATTRIBUTE_ACTION, ...;String BODY_ACTION, ...;String JSP_BODY_ACTION, ...;String ELEMENT_ACTION, ...;String JSP_ELEMENT_ACTION, ...;String OUTPUT_ACTION, ...;String JSP_OUTPUT_ACTION, ...;String TAGLIB_DIRECTIVE_ACTION, ...;String JSP_TAGLIB_DIRECTIVE_ACTION, ...;String INVOKE_ACTION, ...;/* Tag Files */String JSP_INVOKE_ACTION, ...;String DOBODY_ACTION, ...;String JSP_DOBODY_ACTION, ...;String TAG_DIRECTIVE_ACTION, ...;/* Tag File Directives */String JSP_TAG_DIRECTIVE_ACTION, ...;String ATTRIBUTE_DIRECTIVE_ACTION, ...;String JSP_ATTRIBUTE_DIRECTIVE_ACTION, ...;String VARIABLE_DIRECTIVE_ACTION, ...;String JSP_VARIABLE_DIRECTIVE_ACTION, ...;String URN_JSPTAGDIR, ...;/* Directive attributes */String URN_JSPTLD, ...;import TagExtraInfoimport JspSourceDependent/** 1. Processes and extracts the directive info in a tag file. 2. Compiles and ... */Vector<> tempVector, ...;/** A visitor the tag file */...[] tagDirectiveAttrs, ...;JspUtil.ValidAttribute...[] attributeDirectiveAttrs, ...;...[] variableDirectiveAttrs, ...;TagLibraryInfo tagLibInfo, ...;TagExtraInfo tei, ...;String bodycontent, ...;String smallIcon, ...;String largeIcon, ...;String example, ...;Vector<> attributeVector, ...;Vector<> variableVector, ...;String ATTR_NAME, ...;String VAR_NAME_GIVEN, ...;String VAR_NAME_FROM, ...;String VAR_ALIAS, ...;String TAG_DYNAMIC, ...;HashMap<> nameTable, ...;HashMap<> nameFromTable, ...;this.tagLibInfocheckAttributes(...)checkConflict(...)checkUniqueName(...)boolean deferredValueboolean deferredValueSpecifiedString deferredValueStringString deferredValueTypeboolean deferredMethodboolean deferredMethodSpecifiedString deferredMethodStringString deferredMethodSignatureboolean requiredboolean rtexprvalueString rtexprvalueStringboolean fragmentTagAttributeInfo tagAttributeInfonew TagAttributeInfo(...)getRequiredVersion(...)String nameGivenString nameFromAttributeString declareStrboolean declareint scopenew TagVariableInfo(...)/* Returns the vector of attributes corresponding to attribute ... *//* Returns the vector of variables corresponding to variable directives. *//* Returns the value of the dynamic-attributes tag directive attribute. */String tagClassNamegetReliableURN(...)TagVariableInfo[] tagVariableInfosnew TagVariableInfo[]TagAttributeInfo[] tagAttributeInfonew TagAttributeInfo[]new JasperTagInfo(...)TagAttributeInfo attr, ...;this.attr/** Reports a translation error if names specified in attributes of ... */HashMap<> tableNameEntry nameEntrynew NameEntry(...)/** Perform miscellean checks after the nodes are visited. */NameEntry nameFromEntryNode nameFromNodeTagAttributeInfo tagAttrisRequired(...)new ValidAttribute[]new ValidAttribute(...)/** Parses the tag file, and collects information on the directives included ... */ErrorDispatcher errTagFileDirectiveVisitor tagFileVisitornew TagFileDirectiveVisitor(...)postCheck(...)/** Compiles and loads a tagfile. */URL tagFileJarUrlString tagFileJarPathJspRuntimeContext rctxtgetRuntimeContext(...)JspServletWrapper wrappergetWrapper(...)getTagLibrary(...)Class<> tagClazzint tripCountincTripCount(...)new JspServletWrapper(...)addWrapper(...)setTagInfo(...)JspServletWrapper tempWrapperloadTagFilePrototype(...)loadTagFile(...)decTripCount(...)Object tagIns/* Visitor which scans the page and looks for tag handlers that are tag ... */String tagFilePathsetTagHandlerClass(...)/** Implements a phase of the translation that compiles (if necessary) the ... */new TagFileLoaderVisitor(...)/** Removed the java and class files for the tag prototype generated from the ... */Compiler cremoveGeneratedClassFiles(...)// JSP 2// JSP 21// JSP 2.1 Table JSP.8-3// handle deferredValue and deferredValueType// handle deferredMethod and deferredMethodSignature// type is fixed to "JspFragment" and a translation error// must occur if specified.// rtexprvalue is fixed to "true" and a translation error// Already the default/* An alias has been specified. We use 'nameGiven' to hold the ... */// name-given specified// XXX Get it from tag file name// Check that var.name-from-attributes has valid values.// Ignore - tagFileJarUrl will be null// Use same classloader and classpath for compiling tag files// Make sure that JspCompilationContext gets the latest TagInfo// for the tag file. TagInfo instance was created the last// time the tag file was scanned for directives, and the tag// file may have been modified since then.// When tripCount is greater than zero, a circular// dependency exists. The circularily dependant tag// file is compiled in prototype mode, to avoid infinite// recursion.// Add the dependants for this tag file to its parent's// dependant list. The only reliable dependency information// can only be obtained from the tag instance.// ignore errors// For tags in JARs, add the TLD and the tag as a dependency// Add TLD// Add Tagimport TagLibraryValidatorimport ValidationMessage/** Implementation of the TagLibraryInfo class from the JSP spec. ... */PrintWriter outtags.lengthtagFiles.lengthfunctions.length// the following is a workaround until these problems are resolved.// handle relative paths when dealing when home and getDocBase are set// resolveRelativeUri and/or getResourceAsStream don't seem to properly// XXX FIXMEString realgenerateTLDLocation(...)parseTLD(...)URL jarFileUrl/* @param ctxt The JSP compilation context @param uri The TLD's uri @param ... */Vector<> tagVectorVector<> tagFileVectorHashtable<> functionTablethis.shortnamethis.urnthis.tagLibraryValidatorcreateValidator(...)createTagInfo(...)createTagFileInfo(...)createFunctionInfo(...)String funcNamethis.tagsnew TagInfo[]/* @param uri The uri of the TLD @param ctxt The compilation context ... */int uriTypeuriType(...)TldLocationsCache.ABS_URITldLocationsCache.NOROOT_REL_URIresolveRelativeUri(...)String teiClassNameString bodycontentString displayNameString smallIconString largeIconboolean dynamicAttributesVector<> attributeVectorVector<> variableVectorTagExtraInfo teiTagInfo taginfonew TagInfo(...)TreeNode iconcreateVariable(...)createAttribute(...)Class<> teiClass/* Parses the tag file directives of the given TagFile and turns them into a ... */TreeNode childString expectedTypeString methodSignatureboolean reqTimeboolean isFragmentString validatorClassMap<> initParamsTagLibraryValidator tlvString[] initParamcreateInitParam(...)Class<> tlvClasssetInitParameters(...)String signaturenew FunctionInfo(...)/** The instance (if any) for the TagLibraryValidator class. ... */// Until javax.servlet.jsp.tagext.TagLibraryInfo is fixed/** Translation-time validation of the XML document associated with the JSP ... */getTagLibraryValidator(...)getPrefixString(...)TagLibraryValidator tagLibraryValidator, ...;TagLibraryInfoImpl.class// see if file exists on the filesystem first// if file not found on filesystem, get the resource through// the context// The URI points to the TLD itself or to a JAR file in which the// TLD is stored// Location points to TLD file// Add TLD to dependency list// Tag library is packaged in JAR file// Create an iterator over the child elements of our <taglib> element// Check to see if the <taglib> root element contains a 'version'// attribute, which was added in JSP 2.0 to replace the <jsp-version>// subelement// JSP2.0// Ignored elements// Recognized but ignored/* Default body content for JSP 1.2 tag handlers (<body-content> has ... */// Ignored// Ignore <example> element: Bugzilla 33538// Ignore <tag-extension> element: Bugzilla 33538// Ignore these elements: Bugzilla 38015// Tag file packaged in JAR// See https://issues.apache.org/bugzilla/show_bug.cgi?id=46471// This needs to be removed once all the broken code that depends on// it has been removed/* According to JSP.C-3 ("TLD Schema Element Structure - tag"), ... */// According to JSP spec, for static values (those determined at// translation time) the type is fixed at java.lang.String.import TagPlugin/** Manages tag plugin optimizations. ... */String TAG_PLUGINS_XML, ...;String TAG_PLUGINS_ROOT_ELEM, ...;HashMap<> tagPlugins, ...;invokePlugin(...)TreeNode rootIterator<> pluginListTreeNode pluginNodeTreeNode tagClassNodeString tagClassTreeNode pluginClassNodeString pluginClassStrTagPlugin tagPluginClass<> pluginClass/** Invoke tag plugin for the given custom tag, if a plugin exists for ... */TagPluginContext tagPluginContextnew TagPluginContextImpl(...)setTagPluginContext(...)doTag(...)Node.CustomTag node, ...;Node.Nodes curNodes, ...;HashMap<> pluginAttributes, ...;setAtETag(...)setAtSTag(...)setUseTagPlugin(...)Node parentgetTagPluginContext(...)JspAttribute attrgetNodeAttribute(...)isPluginDeclared(...)new AttributeGenerator(...)// Error// Since we'll generate the body anyway, this is really a nop, // except for the fact that it lets us put the Java sources the// plugins produce in the correct order (w.r.t the body)./** A visitor to concatenate contiguous template texts. */int textNodeCount, ...;Node.TemplateText firstTextNode, ...;StringBuffer textBuffer, ...;String emptyText, ...;collectText(...)/* The following directis are ignored in text concatenation *//* Don't concatenate text across body boundaries */getTrimSpaces(...)/** This method breaks concatenation mode.  As a side effect it copies ... */TextCatVisitor vnew TextCatVisitor(...)// Append text to text buffer// Copy the text in buffer into the first template text node.// Cleanup, in case the page ends with a template textint ABS_URI, ...;/** The types of URI one may specify for a tag library */int ROOT_REL_URI, ...;int NOROOT_REL_URI, ...;String FILE_PROTOCOL, ...;String JAR_FILE_SUFFIX, ...;HashSet<String> noTldJars, ...;// Names of JARs that are known not to contain any TLDsHashtable<> mappings, ...;/** The mapping of the 'global' tag library URI to the location (resource ... */boolean redeployMode, ...;this.redeployMode/** Sets the list of JARs that are known not to contain any TLDs. ... */scanJars(...)processTldsInFileSystem(...)/* Populates taglib map described in web.xml. */String altDDNameConstants.ALT_DD_ATTRTreeNode webtldIterator<> taglibsTreeNode taglibString tagUriString tagLocString tagLoc2/** Scans the given JarURLConnection for TLD files located in META-INF ... */Enumeration<> entriesInputStream streamgetUriFromTld(...)/* Searches the filesystem under /WEB-INF for any TLD files, and adds ... *//* Returns the value of the uri element of the given TLD, or null if the ... */TreeNode uri/* Scans all JARs accessible to the webapp's classloader and its ... */ClassLoader webappLoaderURLConnection connneedScanJar(...)scanJar(...)/* Determines if the JAR file with the given <tt>jarPath</tt> needs to be ... */String jarNameTldLocationsCache.class// Constructor and Initilizations/* Initializes the set of JARs that are known not to contain any TLDs */// Bootstrap JARs// Main JARs// i18n JARs// Misc JARs not included with Tomcat// JARs from J2SE runtime// Acquire input stream to web application deployment descriptor// Parse the web application deployment descriptor// altDDName is the absolute path of the DD// Allow taglib to be an element of the root or jsp-config (JSP2.0)// Parse the next <taglib> element// Save this location if appropriate// Add implicit map entry only if its uri is not already// present in the map// if not in redeploy mode, close the jar in case of an error// if in redeploy mode, always close the jar// Parse the tag library descriptor at the specified resource path// JARs under WEB-INF/lib must be scanned unconditionally according// to the spec.import ELContextImplimport JspFragment/** Performs validation on the page elements. Attributes are checked for ... *//** A visitor to validate and extract page directive info */...[] pageDirectiveAttrs, ...;boolean pageEncodingSeen, ...;boolean pageEncodingSeenSavesetLanguage(...)setExtends(...)getBufferValue(...)setBufferValue(...)getAutoFlush(...)setAutoFlush(...)getIsThreadSafe(...)setIsThreadSafe(...)getIsELIgnored(...)setIsELIgnored(...)getIsErrorPage(...)setIsErrorPage(...)setErrorPage(...)getInfo(...)setInfo(...)comparePageEncodings(...)getDeferredSyntaxAllowedAsLiteral(...)getTrimDirectiveWhitespaces(...)addImports(...)compareTagEncodings(...)/* Compares page encodings specified in various places, and throws ... */String configEncString pageDirEncisBomPresent(...)isEncodingSpecifiedInProlog(...)String pageEnc/** A visitor for validating nodes other than page directives */...[] jspRootAttrs, ...;...[] includeDirectiveAttrs, ...;...[] taglibDirectiveAttrs, ...;...[] includeActionAttrs, ...;...[] paramActionAttrs, ...;...[] forwardActionAttrs, ...;...[] getPropertyAttrs, ...;...[] setPropertyAttrs, ...;...[] useBeanAttrs, ...;...[] plugInAttrs, ...;...[] attributeAttrs, ...;...[] invokeAttrs, ...;...[] doBodyAttrs, ...;...[] jspOutputAttrs, ...;String versionthrowErrorIfExpression(...)getJspAttribute(...)setPage(...)boolean valueSpecifiedBeanRepository beanInfoJspAttribute jattrcheckScope(...)setBeanName(...)addBean(...)setWidth(...)setHeight(...)StringBuffer exprNodes elisDeferredSyntaxAllowedAsLiteral(...)prepareExpression(...)setEL(...)int attrSizenew JspAttribute[]setJspAttributes(...)String customActionUriint attrsSizeNodes naNodesint jspAttrsSizeHashtable<String,Object> tagDataAttrsnew Hashtable<String,Object>(...)TagData tagDatanew TagData(...)getTagExtraInfo(...)implementsDynamicAttributes(...)checkXmlAttributes(...)checkNamedAttributes(...)getVariableInfo(...).lengthsetTagData(...)int xmlAttrLenNodes namedAttrsint jspAttrSizeint jspAttrIndexsetNameAttribute(...)new JspAttribute(...)String omitXmlDeclOldString doctypeNameOldString doctypePublicOldString doctypeSystemOldsetOmitXmlDecl(...)setDoctypeName(...)setDoctypeSystem(...)setDoctypePublic(...)String varReader/* Make sure the given custom action does not have any invalid ... */boolean checkDeferredboolean runtimeExpressionboolean elExpressionboolean deferredboolean deferredValueIsLiteralboolean expressionIterator<ELNode> nodesELNode nodeClass<> expectedClasstoClass(...)checkType(...)Class<> expectedTypeString typeStrJspFragment.classELContextImpl ctxnew ELContextImpl(...)validateFunctions(...)setFunctionMapper(...)validateEL(...)getExpressionFactory(...)ELException eTagData.REQUEST_TIME_VALUE/* Make sure the given custom action does not have any invalid named ... */String attrPrefixNamedAttributeVisitor navnew NamedAttributeVisitor(...)hasDynamicContent(...)/** Preprocess attributes that can be expressions. Expression delimiters ... */JspAttribute resultcontainsEL(...)/* Return an empty StringBuffer [not thread-safe] *//* Checks to see if the given attribute value represents a runtime or EL ... *//* Throws exception if the value of the attribute with the given name in ... */boolean hasDynamicContent, ...;/** Validate functions in EL expressions */Node n, ...;this.nString functionTagLibraryInfo taglibfindUri(...)getFunction(...)setUri(...)setFunctionInfo(...)processSignature(...)new FVVisitor(...)ExpressionFactory efsetMethodName(...)/** Get the method name from the signature. */getFunctionSignature(...)/** Get the parameters types from the function signature. ... */ArrayList<String> paramsboolean lastArgString argValidateFunctionMapper fmappernew ValidateFunctionMapper(...)HashMap<String,Method> fnmap, ...;this.fnmapnew HashMap<String,Method>(...)ValidateFunctionMapper fmapper, ...;this.fmapperString[] paramTypesparamTypes.lengthClass<>[] paramsmapFunction(...)new MapperELVisitor(...)/** A visitor for validating TagExtraInfo classes of all tags */// End of ValidateVisitorValidationMessage[] errorserrors.lengthStringBuffer errMsgnew DirectiveVisitor(...)boolean isXmlString defaultTypeString charsetisDefaultPageEncoding(...)new ValidateVisitor(...)validateXmlView(...)new PageDataImpl(...)new TagExtraInfoVisitor(...)/** Validate XML view against the TagLibraryValidator classes of all imported ... */// Private (utility) methodsErrorDispatcher errDispTagLibraryInfoImpl tligetShortName(...)// Since pageDirectiveSeen flag only applies to the Current page// save it here and restore it after the file is included.// JSP.2.10.1// 'pageEncoding' can occur at most once per file// Check for bad combinations// Attributes for imports for this node have been processed by// the parsers, just add them to pageInfo.// Note: Most of the validation is done in TagFileProcessor// when it created a TagInfo object from the// tag file in which the directive appeared.// This method does additional processing to collect page info// Do nothing, since this attribute directive has already been// validated by TagFileProcessor when it created a TagInfo object// from the tag file in which the directive appeared// Do nothing, since this variable directive has already been/* Compare the 'pageEncoding' attribute of the page directive with ... */// Either 'uri' or 'tagdir' attribute must be specified// make sure the value of the 'name' attribute is not a// request-time expression// Make sure we've got at least one nested jsp:param// exit if we are ignoring EL all together// JSP.2.2 - '#{' not allowed in template text// build expression// validate/prepare expression// store it/* The bodyconet of a SimpleTag cannot be JSP. *//* If the tag handler declares in the TLD that it supports dynamic ... *//* Make sure all required attributes are present, either as ... */// JSP.C1: It is a (translation time) error for an action that// has one or more variable subelements to have a TagExtraInfo// class that returns a non-null object.// XML-style 'name' attribute, which is mandatory, must not be// included in JspAttribute array// Process XML-style attributes// Process named attributes// The String litteral must be castable to what is declared as type// for the attribute// Check casting// No deferred expressions allowed for this attribute// Only deferred expressions are allowed for this attribute// El expression// Runtime expression// Attribute does not accept any expressions.// Make sure its value does not contain any./* See above comment about namespace matches. For named ... */// XXX Is it an error to see "%=foo%" in non-Xml page?// (We won't see "<%=foo%> in xml page because '<' is not a// valid attribute value in xml).// The attribute can contain expressions but is not a// scriptlet expression; thus, we want to run it through// the expression interpreter// validate expression syntax if string contains// expression(s)// Value is null. Check for any NamedAttribute subnodes// that might contain the value for this attribute.// Otherwise, the attribute wasn't found so we return null.// prefix not specified and a default ns found// Skip TLD function uniqueness check. Done by Schema ?// test it out// Signature is of the form// <return-type> S <method-name S? '('// < <arg-type> ( ',' <arg-type> )* )? ')'// Determine the default output content type/* Validate all other nodes. This validation step includes checking a ... *//* Invoke TagLibraryValidator classes of all imported tags (second ... *//* Invoke TagExtraInfo method isValid() for all imported tags (third ... *//** This interface is to be implemented by the plugin author, to supply ... *//** Generate codes for a custom tag. ... *//** This interface allows the plugin author to make inqueries about the ... *//** Generate an import statement ... *//** Generate a declaration in the of the generated class.  This can be ... *//** Generate Java source codes ... *//** Generate codesto evaluate value of a attribute in the custom tag ... *//** Generate codes for the body of the custom tag *//** Abandon optimization for this tag handler, and instruct ... *//** Get the PluginContext for the parent of this custom tag.  NOTE: ... *//** Associate the attribute with a value in the current tagplugin context. ... *//** Implementation of ELContext ... */FunctionMapper NullFunctionMapper, ...;ELResolver resolver, ...;FunctionMapper functionMapper, ...;VariableMapper variableMapper, ...;// immutableELResolverImpl.DefaultResolverthis.resolverthis.functionMapperthis.variableMappernew FunctionMapper(...) { ... }/** Simple ELContextWrapper for runtime evaluation of EL w/ dynamic FunctionMappers ... */ELContext target, ...;import ArrayELResolverimport BeanELResolverimport CompositeELResolverimport ListELResolverimport MapELResolverimport ResourceBundleELResolverimport VariableResolverELResolver DefaultResolver, ...;VariableResolver variableResolver, ...;this.variableResolvergetFeatureDescriptors(...)getCommonPropertyType(...)new CompositeELResolver(...)new MapELResolver(...)new ResourceBundleELResolver(...)new ListELResolver(...)new ArrayELResolver(...)new BeanELResolver(...)import ELParseExceptionExpressionFactory factory, ...;new ExpressionImpl(...)new ELParseException(...)ValueExpression ve, ...;this.veELContext ctxnew ELResolverImpl(...)String mark, ...;MethodExpression target, ...;this.markMethodNotFoundException enew JspMethodNotFoundException(...)PropertyNotFoundException enew JspPropertyNotFoundException(...)new JspELException(...)getExpressionString(...)isLiteralText(...)/** Wrapper for providing context to ValueExpressions ... */ValueExpression target, ...;getExpectedType(...)PropertyNotWritableException enew JspPropertyNotWritableException(...)ELContext ctx, ...;import AnnotationProcessor/** Verify the annotation and Process it. ... *//** Call postConstruct method on the specified instance. Note: In Jasper, this ... *//** Call preDestroy method on the specified instance. ... */preDestroy(...)import CharArrayReader/** Write text to a character-output stream, buffering characters so as ... */String LINE_SEPARATOR, ...;boolean LIMIT_BUFFER, ...;...[] cb, ...;int nextChar, ...;// Enclosed writer to which any output is writtenConstants.DEFAULT_TAG_BUFFER_SIZE/** Write a single character. */ensureOpen(...)reAllocBuff(...)cbuf.length/** Write an array of characters.  This method cannot be inherited from the ... */buf.length/** Write a portion of a String. ... *//** Write a string.  This method cannot be inherited from the Writer class ... *//** Write a line separator.  The line separator string is defined by the ... *//** Print a boolean value.  The string produced by <code>{@link ... *//** Print a character.  The character is translated into one or more bytes ... *//** Print an integer.  The string produced by <code>{@link ... *//** Print a long integer.  The string produced by <code>{@link ... *//** Print a floating-point number.  The string produced by <code>{@link ... *//** Print a double-precision floating-point number.  The string produced by ... *//** Print an array of characters.  The characters are converted into bytes ... *//** Print a string.  If the argument is <code>null</code> then the string ... *//** Print an object.  The string produced by the <code>{@link ... *//** Terminate the current line by writing the line separator string.  The ... *//** Print a boolean value and then terminate the line.  This method behaves ... *//** Print a character and then terminate the line.  This method behaves as ... *//** Print an integer and then terminate the line.  This method behaves as ... *//** Print a long integer and then terminate the line.  This method behaves ... *//** Print a floating-point number and then terminate the line.  This method ... *//** Print a double-precision floating-point number and then terminate the ... *//** Print an array of characters and then terminate the line.  This method ... *//** Print a String and then terminate the line.  This method behaves as ... *//** Print an Object and then terminate the line.  This method behaves as ... *//** Clear the contents of the buffer. If the buffer has been already ... */cb.length/** Clears the current contents of the buffer. Unlike clear(), this ... *//** Close the stream, flushing it first.  Once a stream has been closed, ... *//** This method returns the size of the buffer used by the JspWriter. ... *//** Return the value of this BodyJspWriter as a Reader. ... */new CharArrayReader(...)/** Return the value of the BodyJspWriter as a String. ... *//** Write the contents of this BodyJspWriter into a Writer. ... */clearBody(...)/* Reallocates buffer since the spec requires it to be unbounded. */// According to the spec, the JspWriter returned by // JspContext.pushBody(java.io.Writer writer) must behave as// though it were unbuffered. This means that its getBufferSize()// must always return 0.// Flush not called as the writer passed could be a BodyContent and// it doesn't allow to flush./** This is the super class of all JSP-generated servlets. ... */jspInit(...)_jspInit(...)jspDestroy(...)_jspDestroy(...)/** Entry point into service. */import ELContextEventimport ELContextListenerimport JspApplicationContextimport JspContextimport ImplicitObjectELResolverimport ScopedAttributeELResolver/** Implementation of JspApplicationContext ... */List<ELContextListener> contextListeners, ...;List<ELResolver> resolvers, ...;boolean instantiated, ...;this.contextListenersJspApplicationContextImpl implnew JspApplicationContextImpl(...)ELResolver rcreateELResolver(...)ELContextEvent eventnew ELContextEvent(...)JspContext.classcontextCreated(...)this.instantiatedCompositeELResolver rnew ImplicitObjectELResolver(...)Iterator<> itrthis.resolversnew ScopedAttributeELResolver(...)new ArrayList<ELContextListener>(...)new ArrayList<ELResolver>(...)JspApplicationContextImpl.class// create ELContext for JspContext// alert all ELContextListenersimport Enumerator/** Implementation of a JSP Context Wrapper. ... */PageContext invokingJspCtxt, ...;// Invoking JSP contextHashMap<String,Object> pageAttributes, ...;ArrayList<> nestedVars, ...;// ArrayList of NESTED scripting variablesArrayList<> atBeginVars, ...;// ArrayList of AT_BEGIN scripting variablesArrayList<> atEndVars, ...;// ArrayList of AT_END scripting variablesMap<> aliases, ...;HashMap<String,Object> originalNestedVars, ...;this.invokingJspCtxtthis.nestedVarsthis.atBeginVarsthis.atEndVarsthis.pageAttributesthis.aliasesthis.originalNestedVarssyncBeginTagFile(...)getAttributesScope(...)new Enumerator(...)getAttributeNamesInScope(...)release(...)getServletConfig(...)pushBody(...)popBody(...)getExpressionEvaluator(...)handlePageException(...)/** VariableResolver interface *//** Synchronize variables at begin of tag file */saveNestedVariables(...)/** Synchronize variables before fragment invokation */copyTagToPageScope(...)/** Synchronize variables at end of tag file */restoreNestedVariables(...)/** Copies the variables of the given scope from the virtual page scope of ... */findAlias(...)/** Saves the values of any NESTED variables that are present in the invoking ... *//** Restores the values of any NESTED variables in the invoking JSP context. *//** Checks to see if the given variable name is used as an alias, and if so, ... *///private ELContextImpl elContext;// Should never be called since handleException() called with a// Throwable in the generated servlet.// instead decorate!!!/* if (this.elContext != null) { ... */import AccessControllerimport PrivilegedActionimport JspEngineInfo/** Implementation of JspFactory. ... */String SPEC_VERSION, ...;boolean USE_POOL, ...;int POOL_SIZE, ...;ThreadLocal<PageContextPool> localPool, ...;JspFactoryImpl jasperFactoryImpl, ...;PrivilegedGetPageContext dpnew PrivilegedGetPageContext(...)doPrivileged(...)internalGetPageContext(...)PrivilegedReleasePageContext dpnew PrivilegedReleasePageContext(...)internalReleasePageContext(...)new JspEngineInfo(...) { ... }PageContextPool poolnew PageContextPool(...)new PageContextImpl(...)initialize(...)JspFactoryImpl factory, ...;Servlet servlet, ...;ServletRequest request, ...;String errorPageURL, ...;boolean needsSession, ...;boolean autoflush, ...;this.servletthis.errorPageURLthis.needsSessionthis.autoflushPageContext pageContext, ...;this.pageContext...[] pool, ...;int current, ...;this.poolnew PageContext[]PageContext itemJspFactoryImpl.classnew ThreadLocal<PageContextPool>(...)//this call is coming from a page is that is getting handled by jasper, so use the jasper factory instead/* FIXME: need to do something reasonable here!! */import JspTag/** Helper class from which all Jsp Fragment helper classes extend. ... */int discriminator, ...;JspContext jspContext, ...;PageContext _jspx_page_context, ...;JspTag parentTag, ...;this.discriminatorthis.jspContextthis._jspx_page_contextthis.parentTagimport PrivilegedActionExceptionimport PrivilegedExceptionActionString SERVLET_EXCEPTION, ...;String JSP_EXCEPTION, ...;String prop, ...;String param, ...;boolean ignoreMethodNF, ...;this.paramthis.ignoreMethodNFinternalIntrospecthelper(...)/** This method is called at the beginning of the generated servlet code ... */Throwable errorboolean isNullOrEmpty// __begin convertMethodgetValueFromBeanInfoPropertyEditor(...)getValueFromPropertyEditorManager(...)// __begin introspectMethod// __end convertMethodintrospecthelper(...)// __begin introspecthelperMethod// __end introspectMethodPrivilegedIntrospectHelper dpnew PrivilegedIntrospectHelper(...)PrivilegedActionException peClass<> propertyEditorClassObject tmpvalcreateTypedArray(...)Object oval// __begin toStringMethod//-------------------------------------------------------------------// functions to convert builtin Java data types to string.// __end introspecthelperMethod/** Create a typed array. ... */// __end toStringMethodObject[] tmpvalInteger[] tmpvalByte[] tmpvalnew Byte[]Boolean[] tmpvalShort[] tmpvalnew Short[]Long[] tmpvalDouble[] tmpvalFloat[] tmpvalCharacter[] tmpvalint[] tmpvalbyte[] tmpvalparseByte(...)boolean[] tmpvalshort[] tmpvalnew short[]parseShort(...)long[] tmpvaldouble[] tmpvalfloat[] tmpvalchar[] tmpval/** Escape special shell characters. ... *//** Decode an URL formatted string. ... */byte[] holdbufferchar holdcharint bufcountchar cur// __begin lookupReadMethodMethod/** Use proprietaryEvaluate ... */// handles <jsp:setProperty> with EL expression for 'value' attribute// __end lookupReadMethodMethodproprietaryEvaluate(...)// PropertyEditor SupportPropertyEditor pePropertyEditor propEditor/** Convert a possibly relative resource path into a context-relative ... */// ************************************************************************// General Purpose Runtime MethodsString pathInfo/** Perform a RequestDispatcher.include() operation, with optional flushing ... */new ServletResponseWrapperInclude(...)/** URL encodes a string, based on the supplied character encoding. ... */ByteArrayOutputStream bufOutputStreamWriter writerisSafeChar(...)byte[] baba.length/* The only place that sets JSP_EXCEPTION is ... *///XXX Please check.// speedily leave if we're not needed//allocate the buffer - use byte[] to avoid calls to new.// REVISIT -- remedy for Deprecated warning.//return new String(holdbuffer,0,0,bufcount);// just in case introspection silently fails.// FIXME - It is tempting to use request.getRequestDispatcher() to// resolve a relative path directly, but Catalina currently does not// take into account whether the caller is inside a RequestDispatcher// include or not.  Whether Catalina *should* take that into account// is a spec issue currently under review.  In the mean time,// replicate Jasper's previous behavior// The default request encoding// Use the default encoding?// convert to external encoding before hex conversion// Converting each byte in the buffer/** Interface for tracking the source files dependencies, for the purpose ... */// with Eclipse JDT 3.1 in Java 5 mode// FIXME: Type used is Object due to very weird behavior import SecurityUtilWriter out, ...;boolean flushed, ...;Constants.DEFAULT_BUFFER_SIZE/** Create a buffered character-output stream that uses a default-sized ... *//** Create a new buffered character-output stream that uses an output ... */this.autoFlush/** Package-level access *//** Flush the output buffer to the underlying character stream, without ... */initOut(...)isPackageProtectionEnabled(...)new PrivilegedAction<>(...) { ... }/** Discard the output buffer. */getLocalizeMessage(...)/** Flush the stream. ... *//** Close the stream. ... *//** check to make sure that the stream has not been closed ... *//** Write a single character. ... */bufferOverflow(...)/** Our own little min method, to avoid loading java.lang.Math if we've run ... */int tString lineSeparator, ...;/* Methods that do not terminate lines *//* Methods that do terminate lines */// clear() is illegal after any unbuffered output (JSP.5.5)// multiple calls to close is OK// Simple fix for Bugzilla 35410// Calling the other write function so as to init the buffer anywaysimport FunctionMapperImplimport VariableResolverImpl/** Implementation of the PageContext class from the JSP spec. Also doubles as a ... */JspFactory jspf, ...;...[] outs, ...;// per-servlet stateJspApplicationContextImpl applicationContext, ...;HashMap<String,Object> attributes, ...;// page-scope attributes// per-request stateELContextImpl elContext, ...;boolean isIncluded, ...;JspWriter out, ...;// initial output streamJspWriterImpl baseOut, ...;this.outsnew BodyContentImpl[]this.depth_initialize(...)this.applicationContextthis.baseOutnew JspWriterImpl(...)IllegalStateException isedoGetAttribute(...)doSetAttribute(...)doRemoveAttribute(...)doGetAttributeScope(...)doFindAttribute(...)doGetAttributeNamesInScope(...)/** Returns the exception associated with this page context, if any. <br> ... */getThrowable(...)String baseURInew PrivilegedExceptionAction<>(...) { ... }doInclude(...)PrivilegedActionException enew VariableResolverImpl(...)doForward(...)getAbsolutePathRelativeToContext(...)String includeUriConstants.INC_SERVLET_PATHinitCause(...)outs.lengthBodyContentImpl[] newOutsnew BodyContentImpl(...)/** Provides programmatic access to the ExpressionEvaluator. The JSP ... */doHandlePageException(...)Object newExceptiongetServletName(...)/** Proprietary method to evaluate EL expressions. XXX - This method should ... */Object retValueExpressionFactory exprFactorygetJspApplicationContext(...)PrivilegedActionException exException realExXmlEscape(...)createELContext(...)// initialize state// initialize application context// Setup session (if required)// initialize the initial out ...// register names/values as per spec// push it into the including jspWriter// Old code:// out.flush();// Do not flush the buffer even if we're not included (i.e.// we are the main page. The servlet will flush it and close// the stream.// Session has been invalidated.// Ignore and fall through to application scope.// Ignore and fall throw to application scope.// Only wrap if needed// JSP.4.5 If the buffer was flushed, throw IllegalStateException// Make sure that the response object is not the wrapper for include// Update the value of the "out" attribute in the page scope// attribute namespace of this PageContext/* Set request attributes. Do not set the ... */// The error page could be inside an include.// t==null means the attribute was not set.// now clear the error code - to prevent double handling.// Otherwise throw the exception wrapped inside a ServletException.// Set the exception as the root cause in the ServletException// to get a stack trace for the real problem// &apos;// &quot;import Tag/** Thread-local based pool of tag handlers that can be reused. ... */int maxSize, ...;Vector<> perThreadDataVector, ...;// For cleanupThreadLocal<> perThread, ...;...[] handlers, ...;/** Constructs a tag handler pool with the default capacity. */String maxSizeSgetOption(...)new ThreadLocal<>(...) { ... }PerThreadData ptdnew PerThreadData(...)ptd.handlersnew Tag[]ptd.current/** Gets the next available tag handler from this tag handler pool, ... *//** Adds the given tag handler to this tag handler pool, unless this tag ... */ptd.handlers.length/** Calls the release() method of all tag handlers in this tag handler pool. *//** Maps EL functions to their Java method counterparts. Keeps the actual Method ... */HashMap<> fnmap, ...;/** Maps "prefix:name" to java.lang.Method objects. */Method theMethod, ...;/** If there is only one function in the map, this is the Method for it. *//** Constructor has protected access. *//** Generated Servlet and Tag Handler implementations call this method to ... */ProtectedFunctionMapper funcMappernew ProtectedFunctionMapper(...)funcMapper.fnmap/** Stores a mapping from the given EL function prefix and name to the given ... *//** Creates an instance for this class, and stores the Method for the given ... */funcMapper.theMethod/** Resolves the specified local name and prefix into a Java.lang.Method. ... *//** ServletResponseWrapper used by the JSP 'include' action. ... */PrintWriter printWriter, ...;/** PrintWriter which appends to the JspWriter of the including page. */this.printWriter/** Returns a wrapper around the JspWriter of the including page. *//** Clears the output buffer of the JspWriter associated with the including ... *//** Pool of tag handlers that can be reused. ... */String OPTION_TAGPOOL, ...;String OPTION_MAXSIZE, ...;// index of next available tag handlerAnnotationProcessor annotationProcessor, ...;TagHandlerPool resultString tpClassNamenew TagHandlerPool(...)this.handlersAnnotationProcessor.class/** Constructs a tag handler pool with the given capacity. ... */Tag handlerTag instancehandlers.length/** Calls the release() method of all available tag handlers in this tag ... */TagHandlerPool.class// Nothing - jasper generated servlets call the other constructor,// this should be used in future + init .// Out of sync block - there is no need for other threads to// wait for us to construct a tag for this thread.// There is no need for other threads to wait for us to release/** Static class used to preload java classes when using the ... */SecurityClassLoad.class/** Util class for Security related operations. ... */boolean packageDefinitionEnabled, ...;/** Filter the specified message string for characters that are sensitive ... */char[] contentcontent.length/** Class loader for loading servlet class files (corresponding to JSP files) ... */SecurityManager securityManager, ...;this.permissionCollectionthis.codeSourcethis.securityManager/** Load the class with the specified name.  This method searches for ... *//** Load the class with the specified name, searching using the following ... */checkPackageAccess(...)String error/** Delegate to parent ... *//** Get the Permissions for a CodeSource. ... */// (0) Check our previously loaded class cache// (.5) Permission to access this class when using a SecurityManager// Do not call the security manager since by default, we grant that package.// Class is not in org.apache.jsp, therefore, have our// parent load it/** Simple <code>ServletContext</code> implementation without ... */Hashtable<> myAttributes, ...;/** Servlet context attributes. */PrintWriter myLogWriter, ...;/** The log writer we will write log messages to. *//** The base URL (document root) for this context. *//** Create a new instance of this ServletContext implementation. ... */Set<> thePathsFile theBaseDirString[] theFilestheFiles.lengthFile testFile/** Log the specified message. ... *//** Log the specified message and exception. ... *//** Remove the specified context attribute. ... *//** Set or replace the specified context attribute. ... */import EmbeddedServletOptionsimport PeriodicEventListener/** The JSP engine (a.k.a Jasper). ... *//* Initializes this JspServlet. */String engineOptionsNameClass<> engineOptionsClassClass<>[] ctorSigServletConfig.classConstructor<> ctornew EmbeddedServletOptions(...)getJspCount(...)setJspReloadCount(...)/** Gets the number of JSPs that have been reloaded. ... */getJspReloadCount(...)/** <p>Look for a <em>precompilation request</em> as described in ... */Constants.PRECOMPILEint ampersandString jspFileConstants.JSP_FILEboolean precompilepreCompile(...)serviceJspFile(...)checkCompile(...)boolean isErrorPageString includeRequestUrifilter(...)service(...)JspServlet.class// Initialize the JSP Runtime Context// Check for a custom Options implementation// Instantiate the indicated Options implementation// Need to localize this.// Use the default Options implementation// ?jsp_precompile// ?jsp_precompile&foo=bar...// part of some other name or value// ?jsp_precompile=true// Spec says if jsp_precompile=false, the request should not// be delivered to the JSP page; the easiest way to implement// this is to set the flag to true, and precompile the page anyway.// This still conforms to the spec, since it says the// precompilation request can be ignored.// ?jsp_precompile=false// JSP is specified via <jsp-file> in <servlet> declaration/* Check to see if the requested JSP has been the target of a ... *//* Requested JSP has been target of ... *//* Requested JSP has not been the target of a ... */// Check if the requested JSP page exists, to avoid// creating unnecessary directories and files.// This file was included. Throw an exception as// a response.sendError() will be ignored// Strictly, filtering this is an application// responsibility but just in case...import SingleThreadModelimport UnavailableExceptionimport ErrorDispatcherimport JavacErrorDetailServlet theServlet, ...;long available, ...;boolean firstTime, ...;int tripCount, ...;JasperException compileException, ...;long servletClassLastModifiedTime, ...;long lastModificationTest, ...;/* JspServletWrapper for JSP pages. *//* JspServletWrapper for tag files. */this.tripCountAnnotationProcessor annotationProcessorincrementJspReloadCount(...)/** Sets the compilation exception for this JspServletWrapper. ... */this.compileException/** Sets the last-modified time of the servlet class file associated with ... */this.servletClassLastModifiedTime/** Compile (if needed) and load a tag file */isRemoved(...)/** Compile and load a prototype for the Tag file.  This is needed ... */setPrototypeMode(...)/** Get a list of files that the current page has source dependency on. */getServlet(...)HttpServletResponse.SC_SERVICE_UNAVAILABLEServletException exhandleJspException(...)IllegalStateException exUnavailableException exint unavailableSecondsgetUnavailableSeconds(...)this.lastModificationTest/** <p>Attempts to construct a JasperException that contains helpful information ... */Throwable realExceptionStackTraceElement[] framesStackTraceElement jspFrameframes.lengthint javaLineNumberJavacErrorDetail detailgetPageNodes(...)int jspLineNumbergetDisplaySourceFragment(...)Exception jeJspServletWrapper.class// not used// Synchronizing on jsw enables simultaneous loading// of different pages, but not the same page.// This is to maintain the original protocol.// Wait period has expired. Reset./* (1) Compile */// The following sets reload to true, if necessary// Throw cached compilation exception/* (2) (Re)load servlet class file */// If a page is to be precompiled only, return./* (3) Service request */// sync on the wrapper so that the freshness// of the page is determined right before servicing// a response.sendError() will be ignored by the// servlet engine.// Arbitrary default// Log any exception, since it can't be passed along// First identify the stack frame in the trace that represents the JSP// If we couldn't find a frame in the stack trace corresponding// to the generated servlet class, we can't really add anything// If the line number is less than one we couldn't find out// where in the JSP things went wrong// If anything goes wrong, just revert to the original behaviourimport JspTagException/** Util contains some often used consts, static methods and embedded class ... */String VALID_SCHEME_CHAR, ...;String DEFAULT_ENCODING, ...;int HIGHEST_SPECIAL, ...;...[] specialCharactersRepresentation, ...;/** Converts the given string description of a scope to the corresponding ... */int colonPos/** Strips a servlet session ID from <tt>url</tt>.  The session ID ... */StringBuffer uint sessionStartConstants.SESSION_PARAMETER_NAMEint sessionEndchar[] arrayBufferStringBuffer escapedBufferchar[] escaped/** Utility methods ... */isAbsoluteUrl(...)new JspTagException(...)/** Wraps responses to allow us to retrieve results as Strings. ... */StringWriter sw, ...;ByteArrayOutputStream bos, ...;ServletOutputStream sos, ...;boolean isWriterUsed, ...;boolean isStreamUsed, ...;String charEncoding, ...;/** Has no effect. ... */this.charEncodingnew ServletOutputStream(...) { ... }new char[][]// positioned after the attribute name// positioned at the '='// positioned after the '='// attribute value is a quoted string// create StringBuffer to hold escaped xml string// add unescaped portion// add escaped xml// no xml escaping was necessary// add rest of unescaped portion// don't touch absolute URLs// normalize relative URLs against a context root// Don't produce string starting with '//', many// browsers interpret this as host name, not as// path on same host.// target didn't write anythingboolean hasVarisAttributeSpecified(...)String exceptionNameString caughtNamegenerateJavaSource(...)generateBody(...)String strVargetConstantAttribute(...)//flag for the existence of the var attribute//temp name for exception and caught//main part to generate code//do catch//if the var specified, the exception object should //be set to the attribute "var" defines in page scope //whenever there's exception caught, //the flag caught should be set true;//do finally//if var specified, the attribute it defines //in page scope should be removedimport org.apache.struts2.jasper.compiler.tagplugin.*// Not much to do here, much of the work will be done in the// containing tags, <c:when> and <c:otherwise>.// See comments in When.java for the reason "}" is generated here.boolean hasVar, ...;String indexboolean hasVarStatusboolean hasItemsdontUseTagPlugin(...)doCollection(...)generateAttribute(...)/** Generate codes for Collections ... */String itemsVString indexVString beginVString endVString stepVString iterVgenerateImport(...)generateIterators(...)String tV/** Generate iterators for data types supported in items */generateDeclaration(...)// We must have a begin and end attributes// If var is specified and the body contains an EL, then sycn// the var attribute/* && ctxt.hasEL() */// Object[]// boolean[]// short[]// int[]// long[]// float[]// double[]// Collection// Enumeration// Map// whileboolean hasBeginboolean hasEndboolean hasStepString itemsNameString delimsNameString stNameString beginNameString endNameString stepNameString tokensCountName//init the flags//define all the temp variables' names//get the value of the "items" attribute //get the value of the "delim" attribute//new a StringTokenizer Object according to the "items" and the "delim"//if "begin" specified, move the token to the "begin" place//and record the begin index. default begin place is 0.//when "end" is specified, if the "end" is more than the last index,//record the end place as the last index, otherwise, record it as "end";//default end place is the last index //get the step value from "step" if specified.//default step value is 1.//the loop//if var specified, put the current token into the attribute "var" defines.String condVimport Utilboolean hasContextboolean hasScopeboolean hasVarReaderboolean hasCharEncodingString urlNameString contextNameString iauNameString urlObjNameString ucNameString inputStreamNameString tempReaderNameString tempReaderName2String charSetNameString charEncodingNameString varReaderNameString servletContextNameString servletPathNameString requestDispatcherNameString irwNameString brNameString sbNameString tempStringNameString strScopeint iScope//flags//variables' names// is absolute url//URL object//URLConnection//ImportResponseWrapper name//BufferedReader name//StringBuffer name//is absolute url//get the url value//validate the url//initialize the is_absolute_url//validate the context//define charset//if the charEncoding attribute is specified//initialize the charEncoding//assign appropriate value tp the charset//reshape the url string//if the varReader attribute specified//get the String value of varReader//if the url is absolute url//get the content of the target//define the Reader//initialize the Reader object//validate the response//set attribute in the page context scope//if the url is relative//if the url is relative, http request is needed//get the servlet context of the context defined in the context attribute//get the request dispatcher//initialize a ImportResponseWrapper to include the resource//validate the response status//push in the page context//execute the body action//close the reader//if the varReader is not specified //ctxt.generateJavaSource("        throw new JspTagException(ex.toString());");//if the url is relative, http request is needed.// See When.java for the reason whey "}" is need at the beginng and// not at the end.boolean hasDefaultboolean hasEscapeXmlString strValNameString strDefNameString strEscapeXmlName//these two data member are to indicate //whether the corresponding attribute is specified//strValName, strEscapeXmlName & strDefName are two variables' name //standing for value, escapeXml and default attribute//according to the tag file, the value attribute is mandatory.//initiate the strDefName with null.//if the default has been specified, then assign the value to it;//initiate the strEscapeXmlName with true;//if the escapeXml is specified, assign the value to it;//main part. String nameNameString valueNameTagPluginContext parentgetParentContext(...)//don't support the body content//define names of all the temp variables//if the param tag has no parents, throw a exception//get the url string before adding this param//get the value of "name"//if the "name" is null then do nothing.//else add such string "name=value" to the url.//and the url should be encoded//if the current param is the first one, add a "?" ahead of it//else add a "&" ahead of itString baseUrlNameString responseName//flag for the existence of the "context"//names of the temp variables//get context//get the url//get the raw url according to "url" and "context"//get the response object//if the url is relative, encode it//do redirect//scope flag//the value of the "var"//remove attribute from certain scope.//default scope is "page".boolean hasValueboolean hasTargetString targetNameString successFlagName//the flags to indicate whether the attributes have been specified//the scope name//the id of the scope//initialize the flags//the temp variables name//initialize the "result" which will be assigned to the var or target.property//initialize the strScope//get the iScope according to the strScope//if the attribute var has been specified then assign the result to the var;//else assign the result to the target.property//generate the temp variable name//initialize the property//initialize the target//the target is ok//if the target is a map, then put the result into the map with the key property//get all the property of the target//the success flag is to imply whether the assign is successful//find the right property//get the "set" method;//invoke the method through the reflection//catch the el exception and throw it as a JspException//init flags//define name of the temp variables//get the scope//get the value//get the context//get the raw url//if "var" is specified, the url string store in the attribute var defines//if var is not specified, just print out the url stringTagPluginContext parentContextgetPluginAttribute(...)setPluginAttribute(...)// Get the parent context to determine if this is the first <c:when>// See comment below for the reason we generate the extra "}" here.// We don't generate the closing "}" for the "if" here because there// may be whitespaces in between <c:when>'s.  Instead we delay// generating it until the next <c:when> or <c:otherwise> or// <c:choose>/** Adapter class that wraps an <code>Enumeration</code> around a Java2 ... *//** Return an Enumeration over the values of the specified Collection. ... *//** Return an Enumeration over the values returned by the ... */this.iterator/** Return an Enumeration over the values of the specified Map. ... *//** The <code>Iterator</code> over which the <code>Enumeration</code> ... *//** Tests if this enumeration contains more elements. ... *//** Returns the next element of this enumeration if this enumeration ... *//** A simple ASCII byte reader. This is an optimized reader for reading ... *//** Default byte buffer size (2048). */InputStream fInputStream, ...;/** Input stream. */// Data...[] fBuffer, ...;/** Byte buffer. *//** Constructs an ASCII reader from the specified input stream ... */// Constructors/** Read a single character.  This method will block until a character is ... */// Reader methodsint b0/** Read characters into a portion of an array.  This method will block ... */// read():intfBuffer.length/** Skip characters.  This method will block until some characters are ... */// read(char[],int,int)skip(...)/** Tell whether this stream is ready to be read. ... */// skip(long):long/** Tell whether this stream supports the mark() operation. */// ready()markSupported(...)/** Mark the present position in the stream.  Subsequent calls to reset() ... */// markSupported()/** Reset the stream.  If the stream has been marked, then attempt to ... */// mark(int)/** Close the stream.  Once a stream has been closed, further read(), ... */// reset()// Convert to unsigned// close()// class ASCIIReaderHashtable<> fIANA2JavaMap, ...;/** fIANA2JavaMap */Hashtable<> fJava2IANAMap, ...;/** fJava2IANAMap */// <clinit>()/** Adds an IANA to Java encoding name mapping. ... */// Public static methods// putIANA2JavaMapping(String,String)// getIANA2JavaMapping(String):String/** Adds a Java to IANA encoding name mapping. ... */// removeIANA2JavaMapping(String):String// putJava2IANAMapping(String,String)// getJava2IANAMapping(String):String// Static initialization// add IANA to Java encoding mappings.// is this an error???// Add support for Cp1252 and its friends// added since this encoding only differs w.r.t. presentation // support for 1047, as proposed to be added to the // IANA registry in // http://lists.w3.org/Archives/Public/ietf-charset/2002JulSep/0049.html// Adding new aliases as proposed in// http://lists.w3.org/Archives/Public/ietf-charset/2002JulSep/0058.html// REVISIT://   j:CNS11643 -> EUC-TW?//   ISO-2022-CN? ISO-2022-CN-EXT?// add Java to IANA encoding mappings//fJava2IANAMap.put("8859_1",    "US-ASCII"); // ?// proposed addition (see above for details):// removeJava2IANAMapping// class EncodingMapimport ParserConfigurationExceptionimport EntityResolverimport ErrorHandler/** XML parsing utilities for processing web application deployment ... */ErrorHandler errorHandler, ...;/** An error handler for use when parsing XML documents. */EntityResolver entityResolver, ...;/** An entity resolver for use when parsing XML documents. */boolean validating, ...;// Turn off for JSP 2.0 until switch over to using xschema./** Parse the specified XML document, and return a <code>TreeNode</code> ... */Document documentsetEntityResolver(...)ParserConfigurationException exSAXParseException exSAXException sx/** Create and return a TreeNode that corresponds to the specified Node, ... */// ------------------------------------------------------ Protected MethodsTreeNode treeNodenew TreeNode(...)NamedNodeMap attributesNode attributeTreeNode treeChildnew MyErrorHandler(...)new MyEntityResolver(...)// ------------------------------------------------------------ Private ClassesLog logMyEntityResolver.classConstants.CACHED_DTD_PUBLIC_IDS.lengthConstants.CACHED_DTD_PUBLIC_IDSString cachedDtdPublicIdConstants.CACHED_DTD_RESOURCE_PATHSInputSource isrcMyErrorHandler.class// Perform an XML parse of this document, via JAXP// Convert the resulting document to a graph of TreeNodes// Construct a new TreeNode for this node// Convert all attributes of this node// Create and attach all children of this node// Return the completed TreeNode graph// We ignore warningsint TABLE_SIZE, ...;/** Default table size. */...[] fBuckets, ...;/** Buckets. */int fTableSize, ...;// actual table size/** Constructs a symbol table with a default number of buckets. *//** Constructs a symbol table with a specified number of buckets. ... */new Entry[]/** Adds the specified symbol to the symbol table and returns a ... */// Public methodsint bucketentry.nextentry.characters.lengthentry.charactersentry.symbol// addSymbol(String):String// addSymbol(char[],int,int):String// hash(String):int// hash(char[],int,int):int// containsSymbol(String):boolean/** This class is a symbol table entry. Each entry acts as a node ... */// Classes// containsSymbol(char[],int,int):booleanString symbol, ...;/** Symbol. *//** Symbol characters. This information is duplicated here for ... */Entry next, ...;/** The next entry. *//** Constructs a new entry from the specified symbol and next entry ... */this.symbolcharacters.lengththis.next/** Constructs a new entry from the specified symbol information and ... */// search for identical symbol// create new entry// add new entry// class Entry// class SymbolTable/** Construct a new node with no parent. ... *//** Construct a new node with the specified parent. ... */HashMap<> attributes, ...;/** The attributes of this node, keyed by attribute name, ... *//** The body text associated with this node (if any). */ArrayList<> children, ...;/** The children of this node, instantiated only if required. *//** The name of this node. */TreeNode parent, ...;/** The parent node of this node. *//** Add an attribute to this node, replacing any existing attribute ... *//** Add a new child node to this node. ... */Iterator<> itemsTreeNode itemArrayList<> results/** Remove any existing value for the specified attribute name. ... *//** Remove a child node from this node, if it is one. ... *//** Set the body text associated with this node (if any). ... *//** Append to the specified StringBuffer a character representation of ... */int indent2Iterator<> namesfindAttributes(...)Iterator<> children// Reconstruct an opening node// Reconstruct the body text of this node (if any)// Reconstruct child nodes with extra indentation// Reconstruct a closing node marker/** Reader for UCS-2 and UCS-4 encodings. ... *//** Default byte buffer size (8192, larger than that of ASCIIReader ... */short UCS2LE, ...;short UCS2BE, ...;short UCS4LE, ...;short UCS4BE, ...;short fEncoding, ...;// what kind of data we're dealing with// <init>(InputStream, short)// <init>(InputStream,int,short)int b1int b2int b3int byteLengthint numCharsint numToReadint charWidthlong bytesSkipped... | ...UCSReader.class// UCS-2// try and make count be a multiple of the number of bytes we're looking for// BigEndian// this looks ugly, but it avoids an if at any rate...// end of input; something likely went wrong!A  Pad buffer with nulls.// now count is a multiple of the right number of bytes// charWidth will represent the number of bits to move// n leftward to get num of bytes to skip, and then move the result rightward// to get num of chars effectively skipped.// The trick with &'ing, as with elsewhere in this dcode, is// intended to avoid an expensive use of / that might not be optimized// away.// class UCSReaderimport UTFDataFormatExceptionboolean DEBUG_READ, ...;/** Debug read. */// debuggingint fOffset, ...;/** Offset into buffer. */int fSurrogate, ...;/** Surrogate character. *//** Constructs a UTF-8 reader from the specified input stream, ... */expectedByte(...)invalidByte(...)int uuuuuint wwwwint hsint lsinvalidSurrogate(...)toHexString(...)int outint totalint inint zzzzint yyyyyyint xxxxxxlong remainingchar[] chlong skippedch.length/** Throws an exception for expected byte. */// Private methodsnew UTFDataFormatException(...)/** Throws an exception for invalid byte. */// expectedByte(int,int,int)/** Throws an exception for invalid surrogate bits. */// invalidByte(int,int,int,int)UTF8Reader.class// decode character// NOTE: We use the index into the buffer if there are remaining//       bytes from the last block read. -Ac// get first byte// UTF-8:   [0xxx xxxx]// Unicode: [0000 0000] [0xxx xxxx]// UTF-8:   [110y yyyy] [10xx xxxx]// Unicode: [0000 0yyy] [yyxx xxxx]// UTF-8:   [1110 zzzz] [10yy yyyy] [10xx xxxx]// Unicode: [zzzz yyyy] [yyxx xxxx]// UTF-8:   [1111 0uuu] [10uu zzzz] [10yy yyyy] [10xx xxxx]*// Unicode: [1101 10ww] [wwzz zzyy] (high surrogate)//          [1101 11yy] [yyxx xxxx] (low surrogate)//          * uuuuu = wwww + 1// error// use surrogate// return character// handle surrogate// read bytes// adjust length to read// perform read operation// skip read; last character was in error// NOTE: Having an offset value other than zero means that there was//       an error in the last character read. In this case, we have//       skipped the read so we don't consume any bytes past the //       error. By signalling the error on the next block read we//       allow the method to return the most valid characters that//       it can on the previous block read. -Ac// convert bytes to characters// decode bytes into surrogate characters// set characters// return number of characters converted// invalidSurrogate(int)// class UTF8Reader...[] CHARS, ...;/** Character flags. */int MASK_VALID, ...;/** Valid character mask. */int MASK_SPACE, ...;/** Space character mask. */int MASK_NAME_START, ...;/** Name start character mask. */int MASK_NAME, ...;/** Name character mask. */int MASK_PUBID, ...;/** Pubid character mask. */int MASK_CONTENT, ...;int MASK_NCNAME_START, ...;/** NCName start character mask. */int MASK_NCNAME, ...;/** NCName character mask. */// isValid(int):boolean// isInvalid(int):boolean// isContent(int):boolean// isMarkup(int):boolean// isSpace(int):boolean// isNameStart(int):boolean// isName(int):boolean// isNCNameStart(int):boolean// isNCName(int):boolean/** Check to see if a string is a valid Name according to [5] ... *//* [5] Name ::= (Letter | '_' | ':') (NameChar)* */// isPubid(int):booleanisNameStart(...)isName(...)/** Check to see if a string is a valid NCName according to [4] ... *//* from the namespace rec ... */// isValidName(String):booleanisNCNameStart(...)isNCName(...)/** Check to see if a string is a valid Nmtoken according to [7] ... *//* [7] Nmtoken ::= (NameChar)+ */// isValidNCName(String):boolean// encodings// isValidIANAEncoding(String):booleanfill(...)// Initializing the Character Flag Array// Code generated by: XMLCharGenerator.// Fill 3 of value (byte) 49// Fill 6 of value (byte) 49// Fill 2 of value (byte) -71// Fill 10 of value (byte) -71// Fill 2 of value (byte) 49// Fill 26 of value (byte) -3// Fill 2 of value (byte) 33// Fill 60 of value (byte) 33// Fill 8 of value (byte) 33// Fill 23 of value (byte) -19// Fill 31 of value (byte) -19// Fill 58 of value (byte) -19// Fill 11 of value (byte) -19// Fill 8 of value (byte) -19// Fill 53 of value (byte) -19// Fill 68 of value (byte) -19// Fill 9 of value (byte) 33// Fill 36 of value (byte) -19// Fill 3 of value (byte) 33// Fill 2 of value (byte) -19// Fill 4 of value (byte) 33// Fill 30 of value (byte) -19// Fill 56 of value (byte) 33// Fill 89 of value (byte) -19// Fill 18 of value (byte) 33// Fill 7 of value (byte) -19// Fill 14 of value (byte) 33// Fill 2 of value (byte) -87// Fill 46 of value (byte) 33// Fill 70 of value (byte) -87// Fill 26 of value (byte) 33// Fill 36 of value (byte) 33// Fill 3 of value (byte) -19// Fill 20 of value (byte) -19// Fill 44 of value (byte) -19// Fill 18 of value (byte) -19// Fill 13 of value (byte) 33// Fill 12 of value (byte) -19// Fill 66 of value (byte) -19// Fill 4 of value (byte) -87// Fill 28 of value (byte) -19// Fill 55 of value (byte) 33// Fill 38 of value (byte) -19// Fill 7 of value (byte) 33// Fill 10 of value (byte) 33// Fill 17 of value (byte) -87// Fill 23 of value (byte) -87// Fill 3 of value (byte) -87// Fill 11 of value (byte) 33// Fill 27 of value (byte) -19// Fill 5 of value (byte) 33// Fill 26 of value (byte) -19// Fill 10 of value (byte) -19// Fill 8 of value (byte) -87// Fill 10 of value (byte) -87// Fill 6 of value (byte) 33// Fill 71 of value (byte) -19// Fill 5 of value (byte) -19// Fill 15 of value (byte) -19// Fill 4 of value (byte) -19// Fill 15 of value (byte) -87// Fill 519 of value (byte) 33// Fill 16 of value (byte) -87// Fill 17 of value (byte) 33// Fill 22 of value (byte) -19// Fill 7 of value (byte) -87// Fill 16 of value (byte) 33// Fill 6 of value (byte) -19// Fill 5 of value (byte) -87// Fill 12 of value (byte) -87// Fill 12 of value (byte) 33// Fill 6 of value (byte) -87// Fill 15 of value (byte) 33// Fill 9 of value (byte) -87// Fill 16 of value (byte) -19// Fill 145 of value (byte) 33// Fill 46 of value (byte) -19// Fill 39 of value (byte) 33// Fill 62 of value (byte) 33// Fill 33 of value (byte) -19// Fill 20 of value (byte) -87// Fill 21 of value (byte) -87// Fill 230 of value (byte) 33// Fill 39 of value (byte) -19// Fill 41 of value (byte) 33// Fill 40 of value (byte) 33// Fill 3078 of value (byte) 33// Fill 156 of value (byte) -19// Fill 90 of value (byte) -19// Fill 13 of value (byte) -19// Fill 211 of value (byte) 33// Fill 13 of value (byte) -87// Fill 68 of value (byte) 33// Fill 81 of value (byte) 33// Fill 3714 of value (byte) 33// Fill 25 of value (byte) 33// Fill 9 of value (byte) -19// Fill 84 of value (byte) -19// Fill 40 of value (byte) -19// Fill 7379 of value (byte) 33// Fill 20902 of value (byte) -19// Fill 3162 of value (byte) 33// Fill 11172 of value (byte) -19// Fill 92 of value (byte) 33// Fill 8190 of value (byte) 33// class XMLCharInputStream stream, ...;boolean isEncodingSetInProlog, ...;Boolean isBigEndian, ...;Reader reader, ...;// org.apache.xerces.impl.XMLEntityManager fieldsint DEFAULT_XMLDECL_BUFFER_SIZE, ...;boolean fAllowJavaEncodings, ...;SymbolTable fSymbolTable, ...;XMLEncodingDetector fCurrentEntity, ...;int fBufferSize, ...;int lineNumber, ...;// org.apache.xerces.impl.XMLEntityManager.ScannedEntity fieldsint columnNumber, ...;boolean literal, ...;...[] ch, ...;int position, ...;boolean mayReadChunks, ...;XMLString fString, ...;// org.apache.xerces.impl.XMLScanner fieldsXMLStringBuffer fStringBuffer, ...;XMLStringBuffer fStringBuffer2, ...;String fVersionSymbol, ...;String fEncodingSymbol, ...;String fStandaloneSymbol, ...;int fMarkupDepth, ...;// org.apache.xerces.impl.XMLDocumentFragmentScannerImpl fields...[] fStrings, ...;new SymbolTable(...)XMLEncodingDetector detectornew XMLEncodingDetector(...)createInitialReader(...)scanXMLDecl(...)this.isEncodingSetInPrologthis.isBomPresentthis.skip// stub method// org.apache.xerces.impl.XMLEntityManager.startEntity()// Adapted from:new RewindableInputStream(...)byte[] b4Object[] encodingDescgetEncodingName(...)encodingDesc.lengthcreateReader(...)/** Creates a reader capable of reading the given input stream in ... */// org.apache.xerces.impl.XMLEntityManager.createReaderString ENCODINGboolean validIANAisValidIANAEncoding(...)boolean validJavaisValidJavaEncoding(...)getIANA2JavaMapping(...)new UTF8Reader(...)new ASCIIReader(...)boolean isBEnew UCSReader(...)UCSReader.UCS4BEUCSReader.UCS4LEUCSReader.UCS2BEUCSReader.UCS2LE/** Returns the IANA encoding name that is auto-detected from ... */// org.apache.xerces.impl.XMLEntityManager.getEncodingName// createReader(InputStream,String, Boolean): Reader// org.apache.xerces.impl.XMLEntityManager.EntityScanner.isExternal// org.apache.xerces.impl.XMLEntityManager.EntityScanner.peekCharfCurrentEntity.chfCurrentEntity.positionfCurrentEntity.countisExternal(...)// org.apache.xerces.impl.XMLEntityManager.EntityScanner.scanChar// peekChar():intboolean externalfCurrentEntity.lineNumberfCurrentEntity.columnNumber// org.apache.xerces.impl.XMLEntityManager.EntityScanner.scanNameString symboladdSymbol(...)// org.apache.xerces.impl.XMLEntityManager.EntityScanner.scanLiteralint newlinesfCurrentEntity.literalisContent(...)/** Scans a range of character data up to the specified delimiter, ... */boolean doneint delimLenchar charAt0int delimOffsetisInvalid(...)/** Skips a character appearing immediately on the input. ... */// org.apache.xerces.impl.XMLEntityManager.EntityScanner.skipCharint cc/** Skips space characters appearing immediately on the input. ... */// org.apache.xerces.impl.XMLEntityManager.EntityScanner.skipSpacesboolean entityChanged/** Skips the specified string appearing immediately on the input. ... *//** Loads a chunk of text. ... */// org.apache.xerces.impl.XMLEntityManager.EntityScanner.loadfCurrentEntity.mayReadChunksfCurrentEntity.ch.lengthfCurrentEntity.readerendEntity(...)new EOFException(...)// org.apache.xerces.impl.XMLEntityManager.RewindableInputStream...[] fData, ...;int fStartOffset, ...;int fEndOffset, ...;int fLength, ...;int fMark, ...;fData.lengthbyte[] newDataint bytesLeftint returnedValavailable(...)// org.apache.xerces.impl.XMLDocumentScannerImpl.dispatch// end of RewindableInputStream classskipString(...)String targetfStringBuffer.chfStringBuffer.offsetfStringBuffer.lengthscanChar(...)scanPIData(...)scanXMLDeclOrTextDecl(...)/** Scans an XML or text declaration. ... */// org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanXMLDeclOrTextDeclString encodingPseudoAttr/* Scans an XML or text declaration. ... */// org.apache.xerces.impl.XMLScanner.scanXMLDeclOrTextDeclString standaloneint STATE_VERSIONint STATE_ENCODINGint STATE_STANDALONEint STATE_DONEboolean dataFoundForTargetboolean sawSpacescanPseudoAttribute(...)reportFatalError(...)skipChar(...)/** Scans a pseudo attribute. ... */// org.apache.xerces.impl.XMLScanner.scanPseudoAttributescanName(...)int quotescanLiteral(...)isHighSurrogate(...)scanSurrogates(...)/* <p> ... */// org.apache.xerces.impl.XMLScanner.scanPIDatachar c0char c2scanData(...)/* Scans surrogates and append them to the specified buffer. ... */// org.apache.xerces.impl.XMLScanner.scanSurrogatesint highint lowsupplemental(...)isLowSurrogate(...)/* Convenience function used in all XML scanners. ... */// org.apache.xerces.impl.XMLScanner.reportFatalErrornew XMLString(...)new XMLStringBuffer(...)// wrap this stream in RewindableInputStream// perform auto-detect of encoding if necessary// read first four bytes and determine encoding// Special case UTF-8 files with BOM created by Microsoft// tools. It's more efficient to consume the BOM than make// the reader perform extra checks. -Ac// ignore first three bytes...// normalize encoding name// try to use an optimized reader// sould never happen with this encoding...// check for valid name// NOTE: AndyH suggested that, on failure, we use ISO Latin 1//       because every byte is a valid ISO Latin 1 character.//       It may not translate correctly but if we failed on//       the encoding anyway, then we're expecting the content//       of the document to be bad. This will just prevent an//       invalid UTF-8 sequence to be detected. This is only//       important when continue-after-fatal-error is turned//       on. -Ac// try to use a Java reader// see comment above.// UTF-16, with BOM// UTF-16, big-endian// UTF-16, little-endian// default to UTF-8 if we don't have enough bytes to make a// good determination of the encoding// UTF-8 with a BOM// other encodings// UCS-4, big endian (1234)// UCS-4, little endian (4321)// UCS-4, unusual octet order (2143)// REVISIT: What should this be?// UCS-4, unusual octect order (3412)// UTF-16, big-endian, no BOM// (or could turn out to be UCS-2...// UTF-16, little-endian, no BOM// EBCDIC// a la xerces1, return CP037 instead of EBCDIC here// default encoding// load more characters, if needed// peek at character// return peeked character// scan character// return character that was scanned// scan name// bad luck we have to resize our buffer// return name// normalize newlines/** * NEWLINE NORMALIZATION ** *//** * NEWLINE NORMALIZATION *** ... */// scan literal value// return next character// NOTE: We don't want to accidentally signal the//       end of the literal if we're expanding an//       entity appearing in the literal. -Ac// something must be wrong with the input: e.g., file ends an// unterminated comment// iterate over buffer looking for delimiter// looks like we just hit the delimiter// return true if string was skipped// skip character// handle newlines// character was not skipped// skip spaces// the load change the position to be 1,// need to restore it when entity not changed// REVISIT: Does this need to be updated to fix the//          #x0D ^#x0A newline normalization problem? -Ac// no spaces were found// skip string// REVISIT: Can a string to be skipped cross an//          entity boundary? -Ac// read characters// reset count and position// end of this entity// handle the trailing edges// better get some more for the voracious reader.../* In a manner of speaking, when this class isn't permitting more ... */// NOTE: special case where document starts with a PI//       whose name starts with "xml" (e.g. "xmlfoo")// standard XML declaration// scan decl// pseudo-attribute values// set encoding on reader// scan pseudo-attributes// REVISIT: XML REC says we should throw an error// in such cases.// some may object the throwing of fatalError.// TODO: check encoding name; set encoding on//       entity scanner// REVISIT: should we remove this error reporting?// If there is no data in the xml or text decl then we fail to report// error for version or encoding info above.// end// fill in return array// return// check target// spaces// we found the end, there is no data// if there is data there should be some space// data// convert surrogates to supplemental character// supplemental character must be a valid XML character// fill in the buffer/** The character array. */int offset, ...;/** The offset into the character array. */int length, ...;/** The length of characters from the offset. *//** Constructs an XMLString structure preset with the specified ... */// <init>()/** Constructs an XMLString structure with copies of the values in ... */// <init>(char[],int,int)/** Initializes the contents of the XMLString structure with the ... */// <init>(XMLString)this.offsetthis.length/** Initializes the contents of the XMLString structure with copies ... */// setValues(char[],int,int)s.chs.offset/** Resets all of the values to their defaults. */// setValues(XMLString)// clear()// equals(char[],int,int):boolean// Object methods// equals(String):boolean// is this faster than call s.toCharArray first and compare the // two arrays directly, which will possibly involve creating a// new char array object.// toString():String// class XMLStringint DEFAULT_SIZE, ...;/** Default buffer size (32). *//** Constructs a string buffer from a char. ... */// <init>(int)/** Constructs a string buffer from a String. ... */// <init>(char)/** Constructs a string buffer from the specified character array. ... */// <init>(String)/** Constructs a string buffer from the specified XMLString. ... *//** Clears the string buffer. *//** append ... */this.ch.lengthint newLengthchar[] newch// append(char)// append(String)// append(char[],int,int)// append(XMLString)// class XMLStringBufferimport HttpsParametersimport BrokenBarrierExceptionimport CyclicBarrierMockServletContext context, ...;EmbeddedJSPResult result, ...;CountingClassLoaderInterface classLoaderInterfacenew CountingClassLoaderInterface(...)Integer counter0classLoaderInterface.countersInteger counter1/* public void testKeyInContext() throws Exception { ... *///ok i give up..i don't know why this doesn't work from mavenServletCache cacheServlet servlet1Servlet servlet2DummyServletCache cachenew DummyServletCache(...)int numThreadsCyclicBarrier startBarriernew CyclicBarrier(...)CyclicBarrier endBarrierList<ServletGetRunnable> runnablesnew ArrayList<ServletGetRunnable>(...)Object servletServletGetRunnable runnablenew ServletGetRunnable(...)await(...)XWorkConverter converternew DummyConverter(...)DefaultFileManager fileManagernew OgnlTextParser(...)FileManagerFactory fileManagerFactorynew DummyFileManagerFactory(...)new EmbeddedJSPResult(...)//converter has a protected default constructor...mehObject object, ...;CyclicBarrier startBarrier, ...;CyclicBarrier endBarrier, ...;this.servletCachethis.startBarrierthis.endBarrierthis.actionContextObject object2Map<String,Integer> counters, ...;new HashMap<String,Integer>(...)//the jsp is inside jsps.jar//make sure that files are not read multiple times//start a bunch of thread at the same time using CyclicBarrier and hit the cache//then wait for all the threads to end and check that they all got a reference to the same object//and the cache size should be 1//create the threads//mock value stack//mock converter//mock container//wait to start all threads at once..or try at leastimport VisibleForTestingimport GxpContextimport MarkupClosure/** Struts2 to GXP adapter. Can be used to write a GXP or create a ... */Map<> defaultValues, ...;List<Param> params, ...;Class<> gxpClass, ...;Method writeMethod, ...;Method getGxpClosureMethod, ...;boolean hasBodyParam, ...;lookupMethodByName(...)this.gxpClassthis.writeMethodthis.getGxpClosureMethodlookupParams(...)/** Writes GXP. Pulls GXP parameters from Struts2's value stack. ... */getGxpInstance(...)createDebugString(...)List<Object> argListgetArgListFromValueStack(...)Iterator<Object> igetGxpClosure(...)getOverrides(...)Param.BODY_PARAM_NAME/** Iterates over GXP parameters, pulls value from value stack for each ... */this.defaultValues/** Combines parameter names and types into <code>Param</code> objects. ... */List<Param> paramsnew ArrayList<Param>(...)List<String> parameterNameslookupParameterNames(...)List<Class<?>> parameterTypeslookupParameterTypes(...)Iterator<Class<?>> parameterTypeIteratorClass<> paramTypeisBody(...)isOptional(...)getDefaultValue(...)methods.lengthprintExceptionTraceToBuffer(...)String typesMatchdoesArgumentTypeMatchParamType(...)Class<? extends Object> argClass// add default values to the bottom of the stack. if no action provides// a getter for a param, the default value will be used.// push override parameters onto the stack.// If there are more parameter names than parameter types it means that we are// using instantiable GXPs and there are 1 or more constructor parameters.// Constructor params will always be first in the list, so just drop an appropriate// number of elements from the beginning of the list.// skip the first two, gxp_out and gxp_context. they are for internal use.// TODO(jpelly): Handle all primitive unwrapping (ie, Boolean --> boolean).boolean useInstances, ...;String gxpName, ...;this.gxpNamethis.useInstances/** Provides resources necessary to execute a GXP. *//** Uses reasonable defaults to provide resources. */// set content type if it hasn't already been set.// If no character encoding was set in the content type, default to UTF-8.import Functionimport MapMakerimport HtmlClosure/** Struts 2 to GXP adapter. Can be used to write a GXP or create ... */Map<Class<>,Gxp> classToGxp, ...;Map<String,Gxp> pathToGxp, ...;/** Looks up Gxp instance for GXP with given path. ... *//** Looks up Gxp instance for the given GXP class. ... */makeComputingMap(...)softValues(...)new Function<Class<>,Gxp>(...) { ... }weakKeys(...)new MapMaker(...)new Gxp(...)new Function<String,Gxp>(...) { ... }getGxpClassForPath(...)// Couldn't find or load the GXP class.  Return null.// It would be simpler if classToGxp.create() could return null,// but the contract of ReferenceCache doesn't allow it to./** Struts 2 to GXP adapter that uses instances of GXP Interfaces, as created by ... */Class<> gxpInterface, ...;Class<> gxpInstance, ...;getNestedClass(...)this.gxpInterfacethis.gxpInstanceClass<> nestedMap<Class<>,GxpInstance> classToGxpInstance, ...;Map<String,GxpInstance> pathToGxpInstance, ...;/** Looks up {@code GxpInstance} instance for the given GXP class. ... */GxpInstance.classnew Function<Class<>,GxpInstance>(...) { ... }new GxpInstance(...)new Function<String,GxpInstance>(...) { ... }/** Tells Struts 2 which parameter name to use if it's not already specified. */boolean outputXml, ...;/** Whether or not this GXP should output XML. ... */this.outputXmlGxp gxpgetUseInstances(...)getGxpName(...)new HtmlClosure(...) { ... }/** Tells the GXP to write itself to the output stream. ... */GxpResourceProvider providergetProvider(...)new GxpContext(...)new HtmlOrXmlProvider(...)String HTML_CONTENT_TYPE, ...;/** Default content-type to use for responses. */String XML_CONTENT_TYPE, ...;// TODO(lwerner): OGNL or Struts 2 seems to be swallowing this exception// rather than logging or rethrowing it, so you never see this message// TODO(dpb): Is this true now that this work is not done in a setter?String BODY_PARAM_NAME, ...;boolean optional, ...;Object defaultValue, ...;Method defaultGetterthis.optionalNoSuchMethodException ignoredHtmlClosure.class// if you specify a default parameter value in a GXP, a getDefaultXxx()// method will be present.import JRExceptionimport JasperCompileManager/** Ported to Struts: */compileReportToFile(...)JRException e/** <code>JasperReportConstants</code> */String FORMAT_PDF, ...;/** PDF format constant */String FORMAT_XML, ...;/** XML format constant */String FORMAT_HTML, ...;/** HTML format constant */String FORMAT_XLS, ...;/** XLS format constant */String FORMAT_CSV, ...;/** CSV format constant */String FORMAT_RTF, ...;/** RTF format constant */import net.sf.jasperreports.engine.*import net.sf.jasperreports.engine.export.*import JRLoaderimport ConnectionString dataSource, ...;String documentName, ...;String delimiter, ...;String imageServletUrl, ...;String timeZone, ...;boolean wrapField, ...;String connection, ...;/** Connection which can be passed to the report ... */String reportParameters, ...;/** Names a report parameters map stack value, allowing ... */String exportParameters, ...;/** Names an exporter parameters map stack value, ... *//** Default ctor. *//** Default ctor with location. ... */this.imageServletUrlthis.dataSourcethis.documentNamethis.delimiter/** set time zone id ... */this.timeZonethis.wrapFieldthis.reportParametersthis.exportParametersthis.connectionValueStackDataSource stackDataSourceConnection connString systemIdnew ValueStackShadowMap(...)File directoryMap<> reportParamsByteArrayOutputStream outputJasperPrint jasperPrintinitializeProperties(...)OutputStream outputStreamnew ValueStackDataSource(...)JRParameter.REPORT_LOCALEJRParameter.REPORT_TIME_ZONEJasperReport jasperReportloadObject(...)fillReport(...)JRExporter<> exporterMap<> exportParamsStringBuffer tmpnew JRPdfExporter(...)new JRCsvExporter(...)Map<> imagesMapnew JRHtmlExporter(...)JRHtmlExporterParameter.IMAGES_MAPJRHtmlExporterParameter.IMAGES_URIJRExporterParameter.JASPER_PRINTnew JRXlsExporter(...)new JRXmlExporter(...)new JRRtfExporter(...)exportReportToBytes(...)writeReport(...)/** Writes report bytes to response output stream. ... *//** Sets up result properties, parsing etc. ... *//** Run a Jasper report to CSV format and put the results in a byte array ... */JRExporterParameter.OUTPUT_STREAMJRCsvExporterParameter.FIELD_DELIMITERexportReport(...)JasperReportsResult.class// Will throw a runtime exception if no "datasource" property. TODO Best place for that is...?// Handle IE special case: it sends a "contype" request first.// TODO Set content type to config settings?// Construct the data source for the report.// set the the HTTP Header to work around IE SSL weirdness// Determine the directory that the report file is in and set the reportDirectory parameter// For WW 2.1.7://  ServletContext servletContext = ((ServletConfig) invocation.getInvocationContext().get(ServletActionContext.SERVLET_CONFIG)).getServletContext();// put timezone in jasper report parameter// put the report time zone// Add any report parameters from action to param map.// Fill the report and produce a print object// Export the print object to the desired output format// IMAGES_MAPS seems to be only supported as "backward compatible" from JasperReports 1.1.0// Needed to support chart images:// Will throw ServletException on IOException.import JRFieldimport JRRewindableDataSource/** Ported to Struts. *//** Logger for this class */ValueStack valueStack, ...;boolean firstTimeThrough, ...;/** Create a value stack data source on the given iterable property ... */Object dataSourceValuethis.valueStack/** Get the value of a given field ... */getValueClass(...)/** Move to the first item. ... *//** Is there any more data ... */ValueStackDataSource.class//TODO: move the code to return a ValueStackDataSource to a seperate//      method when and if the JRDataSource interface is updated to support//      this.// wrap value with ValueStackDataSource if not already wrapped/** valueStack reference */Set<> entries, ...;/** entries reference *//** Constructs an instance of ValueStackShadowMap. ... *//** Implementation of containsKey(), overriding HashMap implementation. ... */boolean hasKey/** Implementation of get(), overriding HashMap implementation. ... *//** Map of tag attributes, used for rendering the tags *//** Add a key/value pair to the attributes only if the value is not null. Value ... */addIfExists(...)/** Add a key/value pair to the attributes only if the value is not null. ... *//** Add a key/value pair to the attributes only if the value is not null and is a boolean with a ... *//** Add a key/value pair to the attributes, if the value is null, it will be set as an empty string. ... */addDefaultToEmpty(...)/** Default implementation of TagHandlerFactory */TagHandler thsetNext(...)DefaultTagHandlerFactory.class/** Default implementation of the theme */Map<String,List<TagHandlerFactory>> handlerFactories, ...;this.handlerFactories/** Set (replace if exists) the tag handler factories for specific tag ... *//** Insert a new tag handler into a sequence of tag handlers for a specific tag ... */List<TagHandlerFactory> tagHandlerFactoriesnew ArrayList<TagHandlerFactory>(...)List<TagHandler> handlersnew ArrayList<TagHandler>(...)List<TagHandlerFactory> factoriesTagHandler prevTagGenerator genDefaultTheme.class//TODO: Could use public FactoryList here//TODO, need to account for TagHandlers vs. TagSerializers here// TagSerializer ser = (TagSerializer) handlers.get(handlers.size() - 1);import BaseTemplateEngineimport SimpleTheme/** Template engine that renders tags using java implementations */// The struts template engine manager// The struts default template type. If struts ever changes this will need updating.Themes themes, ...;Theme themerenderTag(...)HashMap<String,Theme> themes, ...;new HashMap<String,Theme>(...)/** Allows for providing custom theme classes (implementations of the org.apache.struts2.views.java.Theme) interface ... */StringTokenizer customThemesString themeClassClassCastException cceClassNotFoundException cnf/** Allows for providing an alternative default struts theme. Will default to "ftl" otherwise. ... */new Themes(...) { ... }new SimpleTheme(...)JavaTemplateEngine.class// Theme not supported, so do what struts would have done if we were not here.// May be the default template has changed?// Retry render// Give up and throw a new StrutsException(e);// Render our template// Make sure we don't set ourself as default for race condition/** Write a tag openening, with its attributes ... *//** Writes a tag close ... *//** Writes to the inner text of a tag. By default the body is html encoded ... *//** Writes to the inner text of a tag ... *//** Implementations of this class build the html representation of the tag *//** Write tags as XHTML */import TagGenerator/** Base class for ActionError and ActionMessage */Object errorsObjgetListExpression(...)Iterator<> ittboolean escapetoBooleanDefaultIfNull(...)new Attributes(...)getDefaultClass(...)/* Expression used to get list from stack *//* default class for UL element *///li for each error//span for errorimport TagHandlerTagHandler nextTagHandler, ...;TemplateRenderingContext context, ...;boolean altSyntax, ...;this.nextTagHandlerthis.altSyntaxprocessParams(...)//all rendering must happend at the end of the tag, so we can support nested paramsObject disabledaddIfTrue(...)//hidden inputObject listObjString listKeyString listValueint cntAttributes aObject itemKeyString itemKeyStrObject itemValueString itemValueStrisChecked(...)/** It's set to true if the nameValue (the value associated with the name ... */Boolean checked// Get parameters// This will interate through all lists// key// Checkbox button section// Label section// Hidden input section// NameValue are the values that is provided by the name property// in the action/** Adds attributes from common-attributes.ftl */import DateWordAttributes attrCharacter antCCharacter cString cssClass// Get format// Verify if it's correct/** Adds dynamic attributes */processDynamicAttributes(...)Map<String,String> dynamicAttributes//does nothingList<String> fieldErrorFieldNamesstartUL(...)String fieldErrorFieldNameList<String> fieldErrorsString fieldErrorwriteError(...)endUL(...)Entry<String,List<String>> errorEntry//iterate over field error namesString baseBoolean showPassword// Radio button sectionboolean isButtonString label/** Adds attributes from scripting-event.ftl */String headerKeyString headerValueObject emptyOptionList<ListUIBean> listUIBeansOptGroup.INTERNAL_LIST_UI_BEAN_LIST_PARAMETER_KEYboolean selectedwriteOption(...)writeOptionGroup(...)Object optGroupBeanObject tmpKeyString tmpKeyStrObject tmpValueString tmpValueStr//options//header//emptyoption//key//value//opt groupimport DefaultTagHandlerFactoryimport DefaultThemeimport TagHandlerFactoryimport XHTMLTagSerializersetHandlerFactories(...)new HashMap<String,List<TagHandlerFactory>>(...) { ... }new FactoryList(...)TextFieldHandler.classScriptingEventsHandler.classCommonAttributesHandler.classDynamicAttributesHandler.classDateTextFieldHandler.classSelectHandler.classFormHandler.classFormHandler.CloseHandler.classFormHandler.CloseHandlerAnchorHandler.classAnchorHandler.CloseHandler.classAnchorHandler.CloseHandlerCheckboxHandler.classFileHandler.classPasswordHandler.classLabelHandler.classResetHandler.classSubmitHandler.classSubmitHandler.CloseHandler.classSubmitHandler.CloseHandlerTextAreaHandler.classRadioHandler.classCheckboxListHandler.classActionErrorHandler.classTokenHandler.classActionMessageHandler.classHeadHandler.classHiddenHandler.classFieldErrorHandler.classEmptyHandler.classnew DefaultTagHandlerFactory(...)XHTMLTagSerializer.class//button bodyObject type//first input//second inputgetUIBean(...)applyScriptingAttrs(...)assertScriptingAttrs(...)applyCommonAttrs(...)assertCommonAttrs(...)applyDynamicAttrs(...)assertDynamicAttrs(...)Map<String,String> scriptingAttrs, ...;Map<String,String> commonAttrs, ...;Map<String,Object> dynamicAttrs, ...;SimpleTheme theme, ...;Map<> stackContext, ...;new ConverterEx(...)Template.classsetUpStack(...)Component.COMPONENT_STACKString substr//XWorkConverter doesnt have a public onstructor (the one with parameters will require mor config)//TODO setup a config with stack and all..for realActionError tag, ...;List<String> errors, ...;s(...)this.errorsexpectFind(...)//errors are needed to setup stackimport ServletUrlRendererAnchor tag, ...;new ServletUrlRenderer(...)Checkbox tag, ...;DateTextField tag, ...;FieldError tag, ...;Map<String,List<String>> errors, ...;List<String> fieldNames, ...;this.fieldNamesnew LinkedHashMap<String,List<String>>(...) { ... }File tag, ...;Form tag, ...;UrlRenderer rendererHead tag, ...;Hidden tag, ...;Label tag, ...;Password tag, ...;boolean showPassword, ...;//dont call base setupReset tag, ...;Bean bean1, ...;Select tag, ...;setIntField(...)setStringField(...)Submit tag, ...;TextArea tag, ...;TextField tag, ...;Token tag, ...;//token id is randomimport ChartUtilitiesimport JFreeChartString DEFAULT_TYPE, ...;JFreeChart chart, ...;boolean chartSet, ...;// the JFreeChart to renderString height, ...;// supported are jpg, jpeg or png, defaults to png// CONSTRUCTORS ----------------------------// defaults to 'chart'this.chart// ACCESSORS ----------------------------this.chartSet/** Executes the result. Writes the given chart as a PNG or JPG to the servlet output stream. ... */// Required by com.opensymphony.xwork2.Result// OTHER METHODS -----------------------OutputStream osJFreeChart.classwriteChartAsPNG(...)getIntValueFromString(...)writeChartAsJPEG(...)ChartResult.class// if our chart hasn't been set (by the testcase), we'll look it up in the value stack// we need to have a chart object - if not, blow up// make sure we have some value for the width and height// get a reference to the servlet output stream to write our chart image to// check the type to see what kind of output we have to produceimport StrutsTestCaseimport ChartFactoryimport DefaultPieDatasetimport WriteListenerJFreeChart mockChart, ...;MockServletOutputStream os, ...;ActionProxy mockActionProxy, ...;HttpServletResponse responseMock, ...;ChartResult resultnew ChartResult(...)setChart(...)isWritten(...)DefaultPieDataset datanew DefaultPieDataset(...)createPieChart(...)new MockServletOutputStream(...)boolean written, ...;// very simple check that outputStream was written to.// expect exception if chart not set./** Specialized form of {@link ServletActionRedirectResult} which takes care of ... */sendJsonInsteadOfRedirect(...)printJson(...)/** If browser has called action in a JS/AJAX context we cannot send a ... */isJsonEnabled(...)isValidateOnly(...)HttpServletResponse.SC_OKJSONValidationInterceptor.VALIDATE_JSON_PARAMJSONValidationInterceptor.VALIDATE_ONLY_PARAMimport WildcardUtil/** <p>Isolate the process of cleaning JSON data from the Interceptor class ... */boolean allow, ...;this.allowMap<String,Filter> includesExcludesMap, ...;cleanList(...)cleanMap(...)cleanValue(...)clean(...)allow(...)Map<String,Filter> includesExcludesMapFilter ff.patternf.allowMap<String,Boolean> existingExprMap<String,Map<String,String>> includePatternDatagetIncludePatternData(...)String splitPatternJSONUtil.WILDCARD_PATTERNJSONUtil.SPLIT_PATTERNString joinStringJSONUtil.JOIN_STRINGString arrayBeginJSONUtil.ARRAY_BEGIN_STRINGString arrayEndJSONUtil.ARRAY_END_STRINGnew TreeMap<String,Filter>(...)String piecenew Filter(...)/** Allow external caching of the compiled result. ... */JSONCleaner.class// Compile a pattern for each level of the object hierarchy// so cleanMap() won't short-circuit too early./** Wrap exceptions throwed by the JSON serializer */import SMDMethodimport RPCErrorimport RPCErrorCodeimport RPCResponse/** Populates an action from a JSON string */boolean enableSMD, ...;boolean enableGZIP, ...;boolean wrapWithComments, ...;boolean prefix, ...;boolean ignoreHierarchy, ...;String root, ...;List<Pattern> excludeProperties, ...;List<Pattern> includeProperties, ...;boolean ignoreSMDMethodInterfaces, ...;JSONPopulator populator, ...;JSONCleaner dataCleaner, ...;boolean excludeNullProperties, ...;String callbackParameter, ...;String jsonContentType, ...;String jsonRpcContentType, ...;String requestContentTypereadContentType(...)String requestContentTypeEncodingreadContentTypeEncoding(...)String mapKeyMap<> jsonpopulateObject(...)new JSONException(...)String jsongetIncludeProperties(...)boolean writeGzipisGzipInRequest(...)this.enableSMDMap<> smdRPCResponse rpcResponsenew RPCResponse(...)new RPCError(...)RPCErrorCode.EXCEPTIONgetDebug(...)RPCErrorCode.INVALID_PROCEDURE_CALLRPCErrorCode.SMD_DISABLEDaddCallbackIfApplicable(...)writeJSONToResponse(...)new SerializationParams(...)this.wrapWithCommentsString contentTypeEncodingRPCResponse responseObject idList<> parametersint parameterCountRPCErrorCode.METHOD_NOT_FOUNDRPCErrorCode.MISSING_METHODClass<>[] parameterTypesType[] genericTypesList<> invocationParametersRPCErrorCode.PARAMETERS_MISMATCHObject parameterMethod[] smdMethodslistSMDMethods(...)checkSMDMethodSignature(...)/** Look for a method in clazz carrying the SMDMethod annotation with ... */SMDMethod smdMethodAnntotationSMDMethod.classboolean paramsMatchString callbackName/** Ignore annotations on methods in interfaces You may need to set to this ... */this.ignoreSMDMethodInterfaces/** Wrap generated JSON with comments. Only used if SMD is enabled. ... */this.ignoreHierarchy/** Sets the root object to be deserialized, defaults to the Action ... *//** Sets the JSONPopulator to be used ... */this.populator/** Sets the JSONCleaner to be used ... */this.dataCleanerthis.debug/** Turns debugging on or off ... */setDebug(...)/** Sets a comma-delimited list of regular expressions to match properties ... */Set<String> excludePatternsasSet(...)/** Sets a comma-delimited list of wildcard expressions to match ... */processIncludePatterns(...)JSONUtil.REGEXP_PATTERN/** Setting this property to "true" will compress the output. ... */this.enableGZIP/** Add headers to response to prevent the browser from caching the response ... */this.excludeNullPropertiesthis.callbackParameterthis.jsonContentTypethis.jsonRpcContentTypenew JSONPopulator(...)JSONInterceptor.class// load JSON object// JSON array (this.root cannot be null in this case)// create a map with a list inside// clean up the values// model overrides action// populate fields// model makes no sense when using RPC// validate id// could be a numeric value// the map is going to have: 'params', 'method' and 'id' (for the// client to identify the response)// parameters// method// validate size// size mismatch// convert parametersimport JSON/** Isolate the process of populating JSON objects from the Interceptor class ... */JSON jsonJSON.classconvertPrimitive(...)isJSONPrimitive(...)convertToCollection(...)convertToMap(...)convertToArray(...)Locale.classClass<> arrayTypeObject newArrayObject listValueObject newObjectClass<> itemClassType itemTypeCollection<> newCollectionParameterizedType ptypeInstantiationException exMap<> newMap/** Converts numbers to the desired class, if possible ... */DateFormat formatterString sValuechar charValueString[] componentscomponents.lengthJSONUtil.RFC3339_FORMATJSONPopulator.class// iterate over class fields// use only public setters// if it is a java primitive then get a default value, otherwise// leave it as null// nested bean// create an object for each element// primitive array// array of other class// fallback if clazz represents an interface or abstract class// array of beans// String, Object// primitive map// map of beansimport CharacterIteratorimport StringCharacterIteratorObject OBJECT_END, ...;Object ARRAY_END, ...;Object COLON, ...;Object COMMA, ...;Map<Character,Character> escapes, ...;CharacterIterator it, ...;char c, ...;Object token, ...;StringBuilder buf, ...;this.cthis.itnew StringCharacterIterator(...)skipWhiteSpace(...)object(...)number(...)buildInvalidInputException(...)Map<> retList<> retObject readboolean toDoubleaddDigits(...)CharacterIterator.DONEunicode(...)new HashMap<Character,Character>(...)// should be a colonimport SMDGeneratorboolean ignoreInterfaces, ...;boolean enumAsBean, ...;boolean cacheBeanInfo, ...;String defaultDateFormat, ...;String wrapPrefix, ...;String wrapSuffix, ...;/** Gets a list of regular expressions of properties to exclude from the JSON ... *//** Sets a comma-delimited list of wildcard expressions to match properties ... */readRootObject(...)writeToResponse(...)createJSONString(...)enableGzip(...)IOException exceptionbuildSMDObject(...)findRootObject(...)isWrapWithComments(...)new SMDGenerator(...)/** Retrieve the encoding ... *//** Sets the root object to be serialized, defaults to the Action ... */this.ignoreInterfacesthis.enumAsBeanthis.errorCodethis.wrapPrefixthis.wrapSuffix/** If defined will be used instead of {@link #defaultEncoding}, you can define it with result ... */this.defaultDateFormatJSONWriter.ENUM_AS_BEAN_DEFAULTJSONResult.class// only permit caching bean information when struts devMode = falseimport GZIPOutputStream/** Wrapper for JSONWriter with some utility methods. */String RFC3339_FORMAT, ...;boolean CACHE_BEAN_INFO_DEFAULT, ...;/** Serializes an object into JSON. ... */JSONWriter writernew JSONWriter(...)setCacheBeanInfo(...)/** Serializes an object into JSON, excluding any properties matching any of ... */setIgnoreHierarchy(...)setEnumAsBean(...)setDateFormatter(...)/** Serializes an object into JSON to the given writer. ... *//** Serializes an object into JSON to the given writer, excluding any ... *//** Deserializes a object from JSON ... */JSONReader readernew JSONReader(...)BufferedReader bufferReadergetSerializedJSON(...)getWrapPrefix(...)isPrefix(...)getWrapSuffix(...)getErrorCode(...)isNoCache(...)isGzip(...)GZIPOutputStream outnew GZIPOutputStream(...)finish(...)getBytes(...).length/** List visible methods carrying the ... */new LinkedList<Method>(...)Method[] methodResultnew Method[]SMDMethod smdMethodAnnotationvisitInterfaces(...)new JSONUtil.ClassVisitor(...) { ... }JSONUtil.ClassVisitor/** Realizes the visit(Class) method called by vistInterfaces for all ... *//** Called when a new interface/class is encountered ... *//** Visit all the interfaces realized by the specified object, its ... */List<Class<>> classesVisitednew LinkedList<Class<>>(...)visitUniqueInterfaces(...)/* Recursive method to visit all the interfaces of a class (and its ... */boolean okayToContinueinterfaces.lengthClass<> superClassString REGEXP_PATTERN, ...;String WILDCARD_PATTERN, ...;String SPLIT_PATTERN, ...;/* package */String JOIN_STRING, ...;String ARRAY_BEGIN_STRING, ...;String ARRAY_END_STRING, ...;Map<String,String> dataMap<String,Map<String,String>> defaultIncludePatternData, ...;List<Pattern> resultsMap<String,String> existingPatternsprocessPattern(...)String[] patternPiecesString patternExprString patternPieceprocessPatternPiece(...)isIndexedProperty(...)/* Add a pattern that does not have the indexed property matching (ie. list\[\d+\] becomes list). */JSONUtil.class// read content// status or error code// content type// recurse the entire superclass/interface hierarchy and add in// order encountered// Compile a pattern for each *unique* "level" of the object// hierarchy specified in the regex.// Check for duplicate patterns so that there is no overlap./** Serializes validation and action errors into JSON. This interceptor does not ... */String VALIDATE_ONLY_PARAM, ...;String VALIDATE_JSON_PARAM, ...;String NO_ENCODING_SET_PARAM, ...;int validationFailedStatus, ...;String validateOnlyParam, ...;String validateJsonParam, ...;String noEncodingSetParam, ...;generateJSON(...)setupEncoding(...)isSetEncoding(...)buildResponse(...)buildArray(...)Entry<String,List<String>> fieldErrorString fieldErrorKeyescapeJson(...)/** HTTP status that will be set in the response if validation fails ... */this.validationFailedStatus/** Overrides 'struts.validateOnly' param name ... */this.validateOnlyParam/** Overrides 'struts.enableJSONValidation' param name ... */this.validateJsonParam/** Overrides 'struts.JSONValidation.no.encoding' param name ... */this.noEncodingSetParamHttpServletResponse.SC_BAD_REQUESTJSONValidationInterceptor.class// generate json//there were no errors//should we use FreeMarker here?//action errors//field errors//if it is model driven, remove "model." see WW-2721//remove trailing comma, IE creates an empty object, duh/* response should be something like: ... */import JSONFieldBridgeimport JSONParameterimport FieldBridgeimport ParameterizedBridgeboolean ENUM_AS_BEAN_DEFAULT, ...;/** By default, enums are serialised as name=value pairs */ConcurrentMap<Class<?>,BeanInfo> BEAN_INFO_CACHE_IGNORE_HIERARCHY, ...;ConcurrentMap<Class<?>,BeanInfo> BEAN_INFO_CACHE, ...;Stack<Object> stack, ...;Object root, ...;boolean buildExpr, ...;String exprStack, ...;Collection<Pattern> excludeProperties, ...;Collection<Pattern> includeProperties, ...;DateFormat formatter, ...;this.exprStackthis.buildExprthis.includeProperties/** Detect cyclic references ... *//** Serialize object into json ... */bool(...)date(...)processCustom(...)/** Serialize custom object into json ... *//** Instrospect bean and serialize its properties ... */boolean hasDatagetBeanInfoIgnoreHierarchy(...)Method accessorMethod baseAccessorfindBaseAccessor(...)boolean propertyPrintedJSONAnnotationFinder jsonFindernew JSONAnnotationFinder(...)shouldSerialize(...)shouldExcludeProperty(...)expandExpr(...)setExprStack(...)JSONFieldBridge.classgetBridgedValue(...)JSONFieldBridge fieldBridgeAnnimpl(...)FieldBridge instanceparams(...).lengthParameterizedBridge.classJSONParameter paramsetParameterValues(...)objectToString(...)/** Instrospect an Enum and serialize it as a name/value pair or as a bean ... *//* Add name/value pair to buffer *//* Add map to buffer */boolean warnedNonString/* Add date to buffer */this.formatter/* Add array to buffer *//* Add boolean to buffer *//** escape characters ... */CharacterIterator itisISOControl(...)/* Add object to buffer *//* Add char to buffer *//** Represent as unicode ... */...<<=.../** If true, an Enum is serialized as a bean with a special property ... */this.cacheBeanInfoboolean serialize, ...;Method accessor, ...;this.accessornew Stack<Object>(...)JSONWriter.classnew ConcurrentHashMap<Class<?>,BeanInfo>(...)// cyclic reference// ignore "class" and others// special-case handling for an Enumeration - include the name() as// a property *///in hibernate4.3.7,because javassist3.18.1's class name generate rule is '_$$_jvst'+...// one report per mapString serializedJSON, ...;boolean smd, ...;boolean gzip, ...;this.serializedJSONthis.smdthis.gzip/* Annotation used to customize serialization */import StringBridge/** User: maurizio.cucchiara ... */ElementType.PARAMETER/* Used to serialize RPC Errors */int code, ...;String stack, ...;this.codecode(...)StringWriter sPrintWriter wRPCError.classRPCErrorCode MISSING_METHOD, ...;RPCErrorCode MISSING_ID, ...;RPCErrorCode INVALID_PROCEDURE_CALL, ...;RPCErrorCode METHOD_NOT_FOUND, ...;RPCErrorCode PARAMETERS_MISMATCH, ...;RPCErrorCode EXCEPTION, ...;RPCErrorCode SMD_DISABLED, ...;new RPCErrorCode(...)/** Class that will be serialized as a response to an RPC call */Object result, ...;RPCError error, ...;String debug, ...;/* Holds SMD declarations for a class */String DEFAULT_VERSION, ...;String DEFAULT_SERVICE_TYPE, ...;String version, ...;String objectName, ...;String serviceType, ...;String serviceUrl, ...;Set<SMDMethod> methods, ...;this.methodsthis.versionthis.objectNamethis.serviceTypethis.serviceUrlnew TreeSet<SMDMethod>(...)import JSONUtilimport SMDimport SMDMethodParameterObject rootObject, ...;// rootObject is based on OGNL expression (action by default)this.rootObjectSMD smdnew SMD(...)SMD smdAnnotationSMD.classsetServiceUrl(...)setObjectName(...)objectName(...)setServiceType(...)serviceType(...)setVersion(...)version(...)processAnnotatedMethod(...)shouldProcessMethod(...)readMethodName(...)SMDMethod smdMethodnew SMDMethod(...)addSMDMethod(...)processMethodsParameters(...)int parametersCountAnnotation[][] parameterAnnotationsprocessParameter(...)SMDMethodParameter smdMethodParameterAnnotationgetSMDMethodParameterAnnotation(...)buildParamName(...)addSMDMethodParameter(...)new SMDMethodParameter(...)/** Find an SMDethodParameter annotation on this array */SMDGenerator.class// customize SMD// get public methods// SMDMethod annotation is required// find params for this method// are you ever going to pick shorter names? nopeSet<SMDMethodParameter> parameters, ...;SMDMethod otherother.parametersSMDMethod toComparetoCompare.nametoCompare.parametersnew TreeSet<SMDMethodParameter>(...)(...).name/** An enumeration for JSON serialization testing */AnEnum ValueA, ...;AnEnum ValueB, ...;AnEnum ValueC, ...;new AnEnum(...)/** A more complicated Enum with additional properties. */AnEnumBean One, ...;AnEnumBean Two, ...;AnEnumBean Three, ...;String propA, ...;String propB, ...;this.propAthis.propBnew AnEnumBean(...)List<Bean> beans, ...;AnotherBean yetAnotherBean, ...;this.beansnew ArrayList<Bean>(...)this.yetAnotherBeannew AnotherBean(...)boolean booleanField, ...;char charField, ...;long longField, ...;float floatField, ...;double doubleField, ...;Object objectField, ...;byte byteField, ...;AnEnum enumField, ...;AnEnumBean enumBean, ...;BigInteger bigInteger, ...;this.byteFieldthis.booleanFieldthis.charFieldthis.floatFieldthis.longFieldthis.objectFieldthis.enumFieldthis.enumBeanthis.bigIntegerJSONActionRedirectResult resultnew JSONActionRedirectResult(...)JSONCleaner cleanergetCleaner(...)Map<> datanew JSONCleaner(...) { ... }/** Test serialization of an Enum in the two supported modes: - Enum as a ... *//** Asserts that a bean can be serialized to JSON and restored as a map */Bean bean1JSONWriter jsonWritersetBooleanField(...)setCharField(...)setDoubleField(...)setFloatField(...)setLongField(...)setEnumField(...)AnEnum.ValueAsetEnumBean(...)AnEnumBean.Two/** Asserts that a bean can be serialized to JSON and restored as a map <br> ... */Map<> enumBean1Map<> enumBean2getPropA(...)getPropB(...)// note: this is a// note:// this// is a// get// the// special// propAMockActionInvocationEx invocation, ...;JSONInterceptorTest.classtryBadJSON(...)JSONInterceptor interceptornew JSONInterceptor(...)SMDActionTest1 actionnew SMDActionTest1(...)setRequestContent(...)setEnableSMD(...)JSONException eSMDActionTest2 actionnew SMDActionTest2(...)isInvoked(...)isDoSomethingInvoked(...)String normalizedActualString normalizedExpectedJSONResultTest.classgetStringParam(...)getIntParam(...)isBooleanParam(...)getCharParam(...)getLongParam(...)getFloatParam(...)getDoubleParam(...)getShortParam(...)getByteParam(...)getBeanParam(...)getListParam(...)getMapParam(...)List<> insideListisBooleanField(...)getStringField(...)getIntField(...)getCharField(...)getDoubleField(...)getByteField(...)Map<> beanBean bean2String[] strArrayint[] intArraygetIntArray(...)Bean[] beanArraygetBeanArray(...)getCollection(...)getCollection2(...)strArray.lengthintArray.lengthgetDate(...)getDate2(...)getFoo2(...)TestAction4 actionnew TestAction4(...)TestAction5 actionnew TestAction5(...)List<Bean> beansgetBeans(...)getYetAnotherBean(...)getAnotherBean(...)new MockActionInvocationEx(...)boolean invoked, ...;this.invoked// request// JSON is not well formed, throw exception// I can't get JUnit to ignore the exception// @Test(expected = JSONException.class)// SMD was not enabled so invocation must happen// method was aliased, but was invoked with the regular name// so method must not be invoked// method was aliased, but was invoked with the aliased name// so method must be invoked// SMD was enabled so invocation must happen// can't be invoked// asert values were passed properly// interceptor// serialize and compare// inside a map any primitive is either: String, Long, Boolean or Double// test desrialize=falseJSONPopulator populatorOtherBean beannew OtherBean(...)Map<> jsonMapgetLongField(...)StringReader stringReaderObject jsongetBigDecimal(...)getBigInteger(...)WrapperClassBean beannew WrapperClassBean(...)getBooleanField(...)isPrimitiveBooleanField1(...)isPrimitiveBooleanField2(...)isPrimitiveBooleanField3(...)getNullIntField(...)getListField(...)getListMapField(...)getMapListField(...)getArrayMapField(...).lengthgetArrayMapField(...)import static Assert.assertNotNull/** User: mcucchiara ... */JSONReader reader, ...;/** JSONResultTest */JSONUtil.CACHE_BEAN_INFO_DEFAULTPattern allJSONResult resultnew JSONResult(...)String smdsetExcludeNullProperties(...)TestAction2 actionnew TestAction2(...)setWrapPrefix(...)setWrapSuffix(...)SingleDateBean dateBeannew SingleDateBean(...)setDefaultDateFormat(...)List<> collection2setBigDecimal(...)setBigInteger(...)AnEnumBean.OneAnEnum.ValueBsetObjectField(...)setDate2(...)TestAction3 actionnew TestAction3(...)AnEnum.ValueCAnEnumBean.ThreesetWrapWithComments(...)executeTest2Action(...)setCallbackParameter(...)setNoCache(...)HttpServletResponse.SC_CONTINUE/** Repeats test2 but with the Enum serialized as a bean *//** Ensures that properties of given root object are read as shallow ... */setIncludeProperties(...)new LinkedHashSet<>(...)TestAction a1TestAction a2setSet(...)JSONResult json/* + * $Id$ ... */// test scape characters// beans// circular reference// keep order in map// should be ignored, marked 'transient'// date// set root// thnListBean beannew ListBean(...)List<Pattern> includeProperties// This additional 'listOfLists' pattern should be omitted, but not with current version of JSONUtilimport AnnotationValidationInterceptorJSONValidationInterceptor interceptor, ...;AnnotationValidationInterceptor validationInterceptor, ...;JSONValidationInterceptor interceptornew JSONValidationInterceptor(...)setValidateJsonParam(...)setValidateOnlyParam(...)this.validationInterceptor//json//execution//http status//just validateBeanWithMap bean1new BeanWithMap(...)AnnotatedBean bean1new AnnotatedBean(...)setUrl(...)BeanWithList bean1new BeanWithList(...)setErrors(...)URL url, ...;List<List<String>> listOfLists, ...;new ArrayList<List<String>>(...)int primitiveInt, ...;Integer intField, ...;Boolean booleanField, ...;Character charField, ...;Long longField, ...;Float floatField, ...;Byte byteField, ...;this.primitiveIntboolean addWasCalled, ...;List<> listParam, ...;Map<> mapParam, ...;Bean beanParam, ...;String stringParam, ...;int intParam, ...;boolean booleanParam, ...;char charParam, ...;long longParam, ...;float floatParam, ...;double doubleParam, ...;short shortParam, ...;Object objectParam, ...;byte byteParam, ...;this.stringParamthis.intParamthis.booleanParamthis.charParamthis.longParamthis.floatParamthis.doubleParamthis.byteParamthis.shortParamthis.beanParamthis.mapParamthis.listParamthis.addWasCalledthis.objectParamboolean doSomethingInvoked, ...;/** Tests that the SMDMethod annotation can be found in interfaces when ... */String a, ...;String z, ...;this.athis.zString b, ...;String c, ...;String y, ...;this.bthis.yString d, ...;String e, ...;String x, ...;this.dthis.ethis.x/** Asserts that the SMDMethod annotation is only detected on the classes ... */Method[] smdMethodsAClassA.classMethod[] smdMethodsBClassB.classMethod[] smdMethodsCClassC.classsmdMethodsA.lengthsmdMethodsB.lengthsmdMethodsC.length/** Asserts that the SMDMethod annotation is also detected on the interfaces ... *//** This is the important case: detects the SMDMethod annotation on a proxy */InvocationHandler handlernew InvocationHandler(...) { ... }// dummy implementationInterfaceA proxyInterfaceA.classInterfaceB.classInterfaceC.class// proxy is proxy to an impl of ClassA// first, without the recursion// now with the recursionimport JspConfigDescriptorServletRegistration.DynamicFilterRegistration.DynamicList<> collection, ...;List<> collection2, ...;Set<> set, ...;...[] beanArray, ...;...[] intArray, ...;String nogetter, ...;Date date2, ...;Bean bean, ...;String foo2, ...;this.setthis.nogetterthis.intArraythis.beanArraythis.date2this.foo2AnotherBean anotherBean, ...;this.anotherBeanimport IOUtilsPattern WHITESPACE_BLOCK, ...;/** A regex pattern for recognizing blocks of whitespace characters. *//** normalizes a string so that strings generated on different platforms can ... *//** Attempt to verify the contents of text against the contents of the URL ... *//* FIXME: appendSpace has been always ignored, uncommenting the following line will cause dozen of test fails ... *//** compare the trimmed values of each buffer and make sure they're ... */int nullIntField, ...;boolean primitiveBooleanField1, ...;boolean primitiveBooleanField2, ...;boolean primitiveBooleanField3, ...;List<SimpleValue> listField, ...;List<Map<String,Long>> listMapField, ...;Map<String,List<Long>> mapListField, ...;...[] arrayMapField, ...;this.listFieldthis.listMapFieldthis.mapListFieldthis.arrayMapFieldthis.primitiveBooleanField1this.primitiveBooleanField2this.primitiveBooleanField3this.nullIntFieldimport DefaultResourceLoaderimport Resourceimport UrlResourcenew UrlResource(...)ConventionPluginResourceLoader.classimport XWorkJUnit4TestCaseMap<String,String> dispatcherInitParams, ...;DefaultResourceLoader resourceLoader, ...;/** gets an object from the stack after an action is executed *//** gets an object from the stack after an action is executed ... */findValueAfterExecute(...)T action/** Executes an action and returns it's output (not the result returned from ... */getActionMapping(...)/** Creates an action proxy for a request, and sets parameters of the ActionInvocation to the passed ... *//** Finds an ActionMapping for a given request *//** Finds an ActionMapping for a given url *//** Injects dependencies on an Object using Struts internal IoC container */Enumeration<> attributeNamesMockHttpServletRequest nextRequestinitServletMockObjects(...)setupBeforeInitDispatcher(...)initDispatcherParams(...)getConfigPath(...)/** Override this method to return a comma separated list of paths to a configuration ... */new DefaultResourceLoader(...)// set the action context to the one used by the proxy// this is normally done in onSetUp(), but we are using Struts internal// objects (proxy and action invocation)// so we have to hack around so it worksgetActionProxy(...)new ConventionPluginResourceLoader(...)ApplicationContext applicationContext, ...;import GenericXmlContextLoader/** Base class for Spring JUnit actions */String DEFAULT_CONTEXT_LOCATION, ...;GenericXmlContextLoader xmlContextLoadernew GenericXmlContextLoader(...)loadContext(...)getContextLocations(...)// only load beans from spring onceimport ConsoleHandlerimport Formatterimport LogRecordinitActionContext(...)/** A helper method which allows instantiate an action if this action extends ... */initSession(...)applyAdditionalParams(...)new MockHttpSession(...)/** Can be overwritten in subclass to provide additional context's params and settings used during action invocation ... */setupAfterInitDispatcher(...)StrutsTestCase.class// empty be default// empty by default/** Example action, which is called by the convention plugin test case */MySessionBean mySessionBean, ...;/* $Id:$ ... */// do Something/** User: maurizio cucchiara ... */import RunWithimport ContextConfigurationimport SpringJUnit4ClassRunnerJUnitTestAction action//set parameters before calling getActionProxyimport PortletContextObject portletContextStrutsStatics.STRUTS_PORTLET_CONTEXTimport ViewActionimport StrutsJUnit4TestCaseimport static Assert.assertTrue/** Uses the convention plugin to execute actions */ViewAction action// Output is filled out only for FreeMarker and Velocity templates// If you wanna use JSP check response.getForwardedUrl()// struts-plugin.xml will load configuration from the Convention and Spring plugin// struts-convention-configuration.xml overrides some settings from plugin to allow work in limited environment/** An action which reads a value from the session. ... *//** An action which sets a value into the session */String SESSION_VALUE, ...;import JUnitTestAction/** Calls SessionSet which sets a value into the session and afterwards calls SessionGet, which ... */String output2finishExecution(...)import InvalidSyntaxExceptionString CURRENT_BUNDLE_NAME, ...;/** ClassLoaderInterface instance that delegates to the singleton of DefaultBundleAccessor */loadResource(...)Collection<URL> collloadResources(...)new Hashtable<Object,URL>(...)loadResourceAsStream(...)import ClassTemplateLoaderimport FileTemplateLoaderimport MultiTemplateLoaderimport WebappTemplateLoaderimport FreeMarkerBundleResourceLoaderimport StrutsClassTemplateLoader/** This class extends FreemarkerManager in core to add a template loader ... */new FreeMarkerBundleResourceLoader(...)BundleFreemarkerManager.class/** Package loader implementation that loads resources from a bundle */BundleConfigurationProvider provnew BundleConfigurationProvider(...)List<PackageConfig> listremoveAll(...)Bundle bundle, ...;Enumeration<URL> enew EnumeratorIterator<URL>(...)Enumeration<E> e, ...;BundlePackageLoader.class/** Helper class that find resources and loads classes from the list of bundles */DefaultBundleAccessor self, ...;Map<String,String> packageToBundle, ...;Map<Bundle,Set<String>> packagesByBundle, ...;getServiceReferences(...)InvalidSyntaxException e/** Add as Bundle -&gt; Package mapping ... */Set<String> pkgsthis.packageToBundlegetCurrentBundle(...)getActiveBundles(...)List<URL> resourcestranslateBundleURLToJarURL(...)Entry<String,Bundle> entryMap<>.Entry<String,Bundle>loadResourceFromAllBundles(...)this.osgiHostnew HashMap<Bundle,Set<String>>(...)DefaultBundleAccessor.class//cannot happen we are passing null as the paramObjectFactory delegateObjectFactory, ...;BundleAccessor bundleResourceLoader, ...;OsgiConfigurationProvider osgiConfigurationProvider, ...;this.bundleResourceLoaderthis.osgiConfigurationProviderimport VelocityBundleResourceLoaderimport BundleEventimport BundleListener/** Struts package provider that starts the OSGi container and deelgates package loading */FileManagerFactory fileManagerFactory, ...;boolean bundlesChanged, ...;getBundleContext(...)setBundleContext(...)setOsgiHost(...)new BundleClassLoaderInterface(...)Set<String> bundleNamesshouldProcessBundle(...)loadConfigFromBundle(...)addBundleListener(...)/** Loads XML config as well as Convention config from a bundle ... */PackageLoader loadernew BundlePackageLoader(...)Set<String> packagesBeforeLoadingPackageProvider conventionPackageProviderSet<String> packagesAfterLoadingBundleAccessor.CURRENT_BUNDLE_NAMEaddPackageFromBundle(...)/** Checks for "Struts2-Enabled" header in the bundle ... */String strutsEnabledVelocityBundleResourceLoader.classsetVelocityProperties(...)this.fileManagerFactory/** Listens to bundle event to load/unload config ... */BundleEvent.STARTEDBundleEvent.STOPPEDonBundleStopped(...)/** This method is called when a bundle is stopped, so the config that is related to it is removed ... */Set<String> packagesremovePackageConfig(...)OsgiConfigurationProvider.class//this class loader interface can be used by other plugins to lookup resources//from the bundles. A temporary class loader interface is set during other configuration//loading as well//init action context//iterate over the bundles and load packages from them//load XML and Convention config//the Convention plugin will use BundleClassLoaderInterface from the ActionContext to find resources//and load classes//XML config//Convention//get the existing packages before reloading the provider (se we can figure out what are the new packages)//add the new packages to the map of bundle -> package//if there is a runtime config, it meas that this method was called froma bundle start event//instead of the initial load, in that case, reload the config// Cast to String is required on JDK7import FelixOsgiHostimport GlassfishOSGiHostString GLASSFISH, ...;new GlassfishOSGiHost(...)new FelixOsgiHost(...)/** A bundle is a jar, and a bundle URL will be useless to clients, this method translates ... *//** Calls getBean() on the passed object using refelection. Used on Spring context ... */Method getBeanMethod/** Calls containsBean on the passed object using refelection. Used on Spring context ... */OsgiUtil.class/** Implementations of this interface can load packages from a Bundle *//** This Object factory uses the ActionContext(s) published by Spring OSGi ... */String SPRING_SERVICE_NAME, ...;SpringOsgiObjectFactory.classServiceReference[] refsgetAllServiceReferences(...)Object context/** ServletContextListener that starts Osgi host */String OSGI_HOST, ...;String PLATFORM_KEY, ...;String platformcreateOsgiHost(...)StrutsOsgiListener.classimport AutoProcessorimport ServiceTrackerimport Manifest/** A base OsgiHost implementation */Pattern versionPattern, ...;/** This bundle map will not change, but the status of the bundles can change over time. ... *//** Gets a param from the ServletContext, returning the default value if the param is not set ... */List<String> bundleJarsLevel1Map<String,String> runLevelsgetRunLevelDirs(...)ServiceTracker.classAutoProcessor.AUTO_START_PROPgetBundlesInDir(...)String runLevelMap<String,String> dirsFile bundlesDirString[] runLevelDirsrunLevelDirs.lengthList<String> bundleJarsFile[] bundlesbundles.lengthFile bundleString systemPackagesConstants.FRAMEWORK_SYSTEMPACKAGESString jreVersion/* Find subpackages of the packages defined in the property file and export them */String[] rootPackagesList<String> exportedPackagesString rootPackageMap<URL,Set<String>> subpackagesMapfindPackagesMap(...)Entry<URL,Set<String>> entryMap<>.Entry<URL,Set<String>>String subpackageManifest manifestgetManifest(...)getMainAttributes(...)getVersionFromString(...)List<String> partsfindProperties(...)BaseOsgiHost.class//starts system bundles in level 1//get a list of directories under /bundles with numeric names (the runlevel)//there are no run level dirs, search for bundles in that dir//the name is not a number//add all the dirs to the list//add all the bundles to the list//Felix has a way to load the config file and substitution expressions//but the method does not have a way to specify the file (other than in an env variable)//${jre-${java.specification.version}}//build a list of subpackages//get version if not set//make a string with the exported packages and add it to the system properties//try to get the version from the file name//defaultimport Feliximport FelixConstantsimport Main/** Apache felix implementation of an OsgiHost ... */Felix felix, ...;Properties configPropsProperties strutsConfigPropsString storageDirString cleanBundleCachegetServletContextParam(...)copySystemProperties(...)replaceSystemPackages(...)addExportedPackages(...)addAutoStartBundles(...)Constants.FRAMEWORK_STORAGEFelixConstants.FRAMEWORK_STORAGE_CLEANFelixConstants.FRAMEWORK_STORAGE_CLEAN_ONFIRSTINITFelixConstants.SERVICE_URLHANDLERS_PROPFelixConstants.LOG_LEVEL_PROPFelixConstants.BUNDLE_CLASSPATHFelixConstants.FRAMEWORK_BEGINNING_STARTLEVELnew Felix(...)addSpringOSGiSupport(...)startFelix(...)Map<String,Bundle> bundlesnew HashMap<String,Bundle>(...)FelixOsgiHost.class//load properties from felix embedded file// Copy framework properties from the system properties.//struts, xwork and felix exported packages//find bundles and adde em to autostart property// Bundle cache//other properties//add the bundle context to the ServletContext// see the javadoc for org.springframework.osgi.web.context.support.OsgiBundleXmlWebApplicationContext for more details// OsgiBundleXmlWebApplicationContext expects the the BundleContext to be set in the ServletContext under the attribute// OsgiBundleXmlWebApplicationContext.BUNDLE_CONTEXT_ATTRIBUTEimport BundleReference/** A glassfish implementation of an OsgiHost */String BUNDLES_DIR, ...;/** Location inside the WAR where initial bundles are located. */BundleContext bctx, ...;installManagedBundles(...)BundleReference refinstallBundles(...)ArrayList<Bundle> installednew ArrayList<Bundle>(...)findBundles(...)installBundle(...)BundleException eArrayList<URL> list/** This bundle map will not change, but the status of the bundles can change ... */GlassfishOSGiHost.class// add the bundle context to the ServletContext// Obtaining BundleContext from ServletContext class which is loaded// by bundle class loader// installing managed bundles// see the javadoc for// org.springframework.osgi.web.context.support.OsgiBundleXmlWebApplicationContext// for more details// OsgiBundleXmlWebApplicationContext expects the the BundleContext to// be set in the ServletContext under the attributeimport BundleActivator/** Implementations of this class start an OSGi container. They must also add the BundleContext to ... */String OSGI_BUNDLE_CONTEXT, ...;String OSGI_HEADER_STRUTS_ENABLED, ...;/** Actions implementing this interface will receive an instance of the BundleContext, ... *//** If a class implements BundleContextAware, this interceptor will call the setBundleContext(BundleContext) ... */Type[] typesgetGenericInterfaces(...)Type typeParameterizedType parameterizedTypeServiceAware<>.classClass<> serviceClassList<> servicesrefs.lengthObject servicesetServices(...)OsgiHost.OSGI_BUNDLE_CONTEXTOsgiInterceptor.class//inject BundleContext//inject service implementations//get the services//wow, that's a lot of nested ifs/** Classes implementing this interface, will be injected a list of services ... *//** Finds FreeMarker templates in bundles */import DefaultStaticContentLoader/** Loads static resources from bundles *//** Finds Velocity templates in bundles */FelixOsgiHost felixHost, ...;BundleContext bundleContextBundleContext.classBundleContextAware bundleContextAwareBundleContextAware.classOsgiInterceptor osgiInterceptornew OsgiInterceptor(...)SomeAction someActionnew SomeAction(...)ServiceReference objectRefServiceReference.classObject someObjectList<Object> objectsgetServices(...)new ServiceReference[]//service refsList<Object> services, ...;this.services/* Defines a list of profiles to be activated by OVal when calling a method in an action */import Configurerimport AnnotationsConfigurerimport JPAAnnotationsConfigurerimport XMLConfigurerMap<String,List<Configurer>> validatorCache, ...;Map<String,Configurer> validatorFileCache, ...;boolean validateJPAAnnotations, ...;this.reloadConfigsthis.validateJPAAnnotationsList<Configurer> configurersbuildXMLConfigurers(...)addAditionalConfigurers(...)AnnotationsConfigurer annotationsConfigurernew AnnotationsConfigurer(...)new JPAAnnotationsConfigurer(...)new ArrayList<Configurer>(...)addIfNotNull(...)XMLConfigurer configurernew XMLConfigurer(...)fromXML(...)new HashMap<String,List<Configurer>>(...)new HashMap<String,Configurer>(...)DefaultOValValidationManager.class//add an annotation configurerimport FieldContextimport MethodReturnValueContextimport OValContextimport Profiles/* This interceptor provides validation using the OVal validation framework */OValValidationManager validationManager, ...;this.validationManager/** Enable OVal support for JPA *//** Determines if {@link com.opensymphony.xwork2.Validateable}'s <code>validate()</code> should be called, ... *//** Determines if {@link com.opensymphony.xwork2.Validateable}'s <code>validate()</code> should always ... */performOValValidation(...)performProgrammaticValidation(...)getConfigurers(...)new Validator(...)List<ConstraintViolation> violationsProfiles profilesProfiles.classString[] profileNamesprofileNames.lengthdisableAllProfiles(...)String profileNameenableProfile(...)addValidationErrors(...)new ConstraintViolation[]ConstraintViolation violationgetMessageVariables(...)buildValidationError(...)getCauses(...)/** Get field name and message, used to add the validation error to fieldErrors */OValContext contextgetCheckName(...)/** Decide if a violation should be added to the fieldErrors or actionErrors */OValValidationInterceptor.class//OVal vallidatio (no XML yet)//Validatable.valiedate() and validateX()// If any exception occurred while doing reflection, we want// rethrow if something is wrong while doing validateXXX / validateDoXXX//read validation from xmls//if the method is annotated with a @Profiles annotation, use those profiles//perform validation//translate message// push context variable into stack, to allow use ${max}, ${min} etc in error messages//push the validator into the stack// build field name// don't add "model." prefix to fields of model in model driven action// add violations of member object fields//the default OVal message shows the field name as ActionClass.fieldName//the result will have the full method name, like "getName()", replace it by "name" (obnly if it is a field)import DefaultOValValidationManager//just to expose the cacheString middleName, ...;this.middleNameimport AssertValidassertValue(...)ActionProxy baseActionProxy2DummyDefaultOValValidationManager managerOValValidationManager.classOValValidationManager managerSimpleFieldsXML.classList<Configurer> configurers2SimpleField actionSimpleMethod actionSimpleFieldOGNLExpression actionFieldsWithProfiles actionSimpleFieldI18n actionSimpleFieldI18nDefaultKey actionisValidateCalled(...)isValidateExecuteCalled(...)MemberObject actiongetPerson(...)//load again and check it is the same instance// 5: as there will be field errors for 'model' and 'address' themselves// 5: as there will be field errors for 'person' and 'person.address' themselvesimport Lengthimport NotEmptyboolean validateCalled, ...;boolean validateExecuteCalled, ...;this.validateCalledthis.validateExecuteCalledimport Basicimport IsInvariant//some method annotated, whose name is not a fieldimport MinLengthimport Columnimport ServletMultipartRequest/** Multipart form data request adapter for Jason Pell's multipart utils package. */ServletMultipartRequest multi, ...;int intMaxSizenew ServletMultipartRequest(...)getFileSystemName(...)getURLParameter(...)getURLParameters(...)/** Sets the encoding for the uploaded params.  This needs to be set if you are using character sets other than ... */String inputValueUploadedFile currentFilePellMultiPartRequest.class//this needs to be synchronised, as we should not change the encoding at the same time as//calling the constructor.  See javadoc for MultipartRequest.setEncoding().// TODO - not sure about this - is this the filename of the actual file or// TODO - the uploaded filename as provided by the browser?// TODO - Not sure what version of Pell this class uses as it doesn't seem to be the latest//NB: This should never be called at the same time as the constructor for//ServletMultiPartRequest, as it can cause problems.//See javadoc for MultipartRequest.setEncoding()import PlexusContainer/** Creates a plexus container for the application, session, and request */String CHILD_CONTAINER_NAME, ...;boolean loaded, ...;ServletContext ctx, ...;PlexusContainer childPlexusContainer parentPlexusLifecycleListener.KEYhasChildContainer(...)getChildContainer(...)createChildContainer(...)setPlexusContainer(...)dispose(...)PlexusObjectFactory.classimport DefaultPlexusContainer/** Manages the Plexus lifecycle for the servlet and session contexts */PlexusContainer pcnew DefaultPlexusContainer(...)String PLEXUS_COMPONENT_TYPE, ...;PlexusContainer base, ...;isLoaded(...)Map<> thisInterceptorClassParamsValidator<>.classgetPlexusContainer(...)Exception e3Exception e4Exception e5/** Looks up an object ... */// uh oh! looks like the lifecycle listener wasn't installed. Let's inform the user/** Stores and retrieves the plexus container in the thread */ThreadLocal<PlexusContainer> ptl, ...;new ThreadLocal<PlexusContainer>(...)import PlexusConfigurationResourceException/** Utility methods for dealing with Plexus *//** Configures the container with the configuration file ... */setConfigurationResource(...)import PortletConstantsimport PortletPhaseimport MockPortletContextimport MockPortletRequestimport MockPortletResponseimport MockPortletSessionimport MockStateAwareResponseimport PortletMode/** Base class used to test action in portlet environment */MockPortletSession portletSession, ...;MockPortletRequest portletRequest, ...;MockPortletResponse portletResponse, ...;MockContext portletContext, ...;initPortletContext(...)new MockContext(...)setMajorVersion(...)getMajorVersion(...)new MockPortletRequest(...)new MockStateAwareResponse(...)new MockPortletSession(...)createSession(...)PortletConstants.REQUESTPortletConstants.RESPONSEPortletConstants.MODE_NAMESPACE_MAPnew HashMap<PortletMode,String>(...)PortletConstants.PHASEPortletPhase.EVENT_PHASE/** Override to define version of your portlet environment ... *//** Override to create your own session ... */getAttributeMap(...)getPortletSession(...)StrutsPortletTestCase.class/** Simple workaround to define Portlet version */int majorVersion, ...;this.majorVersionimport PortletActionContextimport PortletUrlHelperimport PortletUrlHelperJSR286/** Implementation of the {@link UrlRenderer} interface that renders URLs for portlet environments. ... */ServletUrlRenderer servletRenderer, ...;/** The servlet renderer used when not executing in a portlet context. */PortletUrlHelper portletUrlHelper, ...;this.servletRendererisJSR268Supported(...)this.portletUrlHelpernew PortletUrlHelperJSR286(...)new PortletUrlHelper(...)getPortletContext(...)isPortletModeChange(...)getPortletMode(...)String modePortletMode portletModenew PortletMode(...)String modeNamespacegetModeNamespaceMap(...)getModeActionMap(...)getPortletUrlType(...)getWindowState(...)onlyActionSpecified(...)onlyValueSpecified(...)buildResourceUrl(...)createDefaultUrl(...)PortletMode newPortletModeformComponent.methodformComponent.portletModeformComponent.windowState/* $Id: PortletUrlRenderer.java 612406 2008-01-16 10:05:06Z nilsga $ ... *//** Portlet specific {@link java.util.Map} implementation representing the ... */PortletContext context, ...;Set<Entry<String,Object>> entries, ...;/** Creates a new map object given the {@link PortletContext}. ... *//** Removes all entries from the Map and removes all attributes from the ... *//** Creates a Set of all portlet context attributes as well as context init ... */new HashSet<Entry<String,Object>>(...)new Entry<String,Object>(...) { ... }/** Returns the portlet context attribute or init parameter based on the ... *//** Sets a portlet context attribute given a attribute name and value. ... *//** Removes the specified portlet context attribute. ... *//* $Id: PortletApplicationMap.java 557544 2007-07-19 10:03:06Z nilsga $ ... */// Add portlet context attributes// Add portlet context init paramsimport DispatcherServletString DEFAULT_ACTION_NAME, ...;/** Default action name to use when no default action has been configured in the portlet ... */String ACTION_PARAM, ...;/** Action name parameter name */String MODE_PARAM, ...;/** Key for parameter holding the last executed portlet mode. */String PHASE, ...;/** Key used for looking up and storing the portlet phase *//** Key used for looking up and storing the ... */String EVENT_ACTION, ...;/** Key used for looking up and storing the action that was invoked in the action or event phase. */String PORTLET_CONFIG, ...;String ERROR_ACTION, ...;/** Name of the action used as error handler */String PORTLET_NAMESPACE, ...;/** Key for the portlet namespace stored in the ... */String MODE_NAMESPACE_MAP, ...;/** Key for the mode-to-namespace map stored in the ... */String DEFAULT_ACTION_MAP, ...;/** Key for the mode-to-default-action map stored in the ... */String DEFAULT_ACTION_FOR_MODE, ...;/** Key for the default action name for the portlet, stored in the ... */String ACTION_RESET, ...;/** Key for request attribute indicating if the action has been reset. */String RENDER_DIRECT_LOCATION, ...;/** Key for session attribute indicating the location of the render direct action. */String RENDER_DIRECT_NAMESPACE, ...;/** Namespace use for executing the renderDirect action. Necessary to get the namespaces on s:urls correct. */String DISPATCH_TO, ...;/** Key for the dispatch instruction for the {@link DispatcherServlet} */String STACK_FROM_EVENT_PHASE, ...;/** Session key where the value stack from the event phase is stored. */String DEFAULT_DISPATCHER_SERVLET_NAME, ...;/** Default name of dispatcher servlet in web.xml *//** Key for the action mapping in the context *//** Defines phases of portlet processing per the portlet specification. */PortletPhase RENDER_PHASE, ...;/** Constant used for the render phase ( ... */PortletPhase ACTION_PHASE, ...;/** Constant used for the action phase ( ... */PortletPhase EVENT_PHASE, ...;/** Constant used for the event phase */PortletPhase SERVE_RESOURCE_PHASE, ...;/** Constant used for the serve resource phase that was added with the 2.0 portlet specification. */new PortletPhase(...)import PortletRequestPortletRequest request, ...;/** Removes all attributes from the request as well as clears entries in this ... *//** Returns a Set of attributes from the portlet request. ... */Enumeration<String> enumeration/** Returns the request attribute associated with the given key or ... *//* $Id: PortletRequestMap.java 582626 2007-10-07 13:26:12Z mrdon $ ... */import PortletSession/** A simple implementation of the {@link java.util.Map} interface to handle a collection of portlet session ... */PortletSession session, ...;/** Creates a new session map given a portlet request. ... *//** Returns the session attribute associated with the given key or ... *//* $Id: PortletSessionMap.java 582626 2007-10-07 13:26:12Z mrdon $ ... */import ActionRequestimport ActionResponseimport PortletConfigimport PortletResponseimport RenderRequestimport RenderResponseimport ResourceResponseimport static PortletConstants.DEFAULT_ACTION_FOR_MODEimport static PortletConstants.MODE_NAMESPACE_MAPimport static PortletConstants.PHASEimport static PortletConstants.PORTLET_CONFIGimport static PortletConstants.PORTLET_NAMESPACEimport static PortletConstants.REQUESTimport static PortletConstants.RESPONSE/** PortletActionContext. ActionContext thread local for the portlet environment. ... *//** Get the PortletConfig of the portlet that is executing. ... *//** Get the RenderRequest. Can only be invoked in the render phase. ... */isRender(...)getPhase(...)/** Get the RenderResponse. Can only be invoked in the render phase. ... *//** Get the ActionRequest. Can only be invoked in the event phase. ... */isAction(...)/** Get the ResourceResponse. Can only be invoked in the resource phase. ... */isResource(...)/** Get the action namespace of the portlet. Used to organize actions for multiple portlets in ... *//** Get the current PortletRequest. ... *//** Get the current PortletResponse ... *//** Get the phase that the portlet is executing in. ... *//** Check to see if the current request is a portlet request. ... *//** Get the default action mapping for the current mode. ... *//** Get the namespace to mode mappings. ... *//** Get the mode to default action mappings. ... */PortletConstants.DEFAULT_ACTION_MAP/** Get the portlet context. ... *//** Whether JSR286 features are supported. ... */PortletContext ctx/* $Id: PortletActionContext.java 564279 2007-08-09 17:00:49Z nilsga $ ... */// fallback to old behaviour, check WW-3763/** Get the location of the view. ... *//** Always return success. ... */PortletConstants.RENDER_DIRECT_LOCATION/* $Id: DirectRenderFromEventAction.java 564120 2007-08-09 07:14:51Z nilsga $ ... */String dispatchToPortletConstants.DISPATCH_TOHttpServletRequest wrapperwrapRequestIfNecessary(...)/* $Id: DispatcherServlet.java 590812 2007-10-31 20:32:54Z apetrelli $ ... */import PortletApplicationMapimport PortletRequestMapimport PortletSessionMapimport PortletServletContextimport PortletServletRequestimport PortletServletResponseimport GenericPortletimport PortletExceptionimport WindowStateimport static PortletConstants.ACTION_PARAMimport static PortletConstants.ACTION_RESETimport static PortletConstants.DEFAULT_ACTION_NAMEimport static PortletConstants.MODE_PARAMString portletNamespace, ...;ActionProxyFactory factory, ...;Map<PortletMode,String> modeMap, ...;Map<PortletMode,ActionMapping> actionMap, ...;Dispatcher dispatcherUtils, ...;/** Initialize the portlet with the init parameters from <tt>portlet.xml</tt> ... */getPortletName(...)new PortletServletContext(...)parseModeConfig(...)PortletMode.VIEWPortletMode.EDITPortletMode.HELP/** Parse the mode to namespace mappings configured in portlet.xml ... */String defaultActionStringBuilder fullPath/** Service an action from the <tt>event</tt> phase. ... */resetActionContext(...)getRequestMap(...)getSessionMap(...)getApplicationMap(...)PortletPhase.ACTION_PHASE/** Service an action from the <tt>render</tt> phase. ... */WindowState.MINIMIZEDPortletPhase.RENDER_PHASE/** Reset the action context. *//** Merges all application and portlet attributes into a single ... */String defaultLocale/** Loads the action and executes it. This method first creates the action ... */HttpServletRequest servletRequestnew PortletServletRequest(...)HttpServletResponse servletResponsecreatePortletServletResponse(...)getPortletConfig(...)PortletConstants.RENDER_DIRECT_NAMESPACEPortletConstants.ACTION_MAPPINGnew PortletException(...)/** Returns a Map of all application attributes. Copies all attributes from ... */new PortletApplicationMap(...)/** Gets the namespace of the action from the request. The namespace is the ... */String actionPathgetDefaultActionPath(...)resetAction(...)/** Get the namespace part of the action path. ... *//** Get the action name part of the action path. ... *//** Returns a Map of all request parameters. This implementation just calls ... *//** Returns a Map of all request attributes. The default implementation is to ... */new PortletRequestMap(...)/** Returns a Map of all session attributes. The default implementation is to ... */new PortletSessionMap(...)/** Convenience method to ease testing. ... *//** Check to see if the action parameter is valid for the current portlet mode. If the portlet ... */boolean resetString[] modeParammodeParam.lengthString originatingModeString currentMode/** Method to create a PortletServletResponse matching the used Portlet API, to be overridden for JSR286 Dispatcher. ... */new PortletServletResponse(...)new HashMap<PortletMode,ActionMapping>(...)Jsr168Dispatcher.class/* $Id: Jsr168Dispatcher.java 759140 2009-03-27 13:51:52Z nilsga $ ... */// For testability// Check to see if an event set the render to be included directly// TODO Must put http request/response objects into map for use with// ServletActionContext// The dummy servlet objects. Eases reuse of existing interceptors that uses the servlet objects.// End dummy servlet objects// Multipart request. Request parameters are encoded in the multipart data,// so we need to manually add them to the parameter map.// Use the usual action mapper, but it is expecting an action extension// on the uri, so we add the default one, which should be ok as the// portlet is a portlet first, a servlet secondimport PortletServletResponseJSR286import EventRequestimport EventResponseimport ResourceRequestPortletPhase.SERVE_RESOURCE_PHASEnew PortletServletResponseJSR286(...)Jsr286Dispatcher.class// We'll use the event name as the "action"import PrincipalAwarePortletRequest requestsetPortletRequest(...)PortletResponse responsesetPortletResponse(...)new PortletPrincipalProxy(...)PortletContext portletContextsetPortletContext(...)setPortletPreferences(...)new ServletPortletPreferences(...)getPreferences(...)PortletAwareInterceptor.class/* $Id: PortletAwareInterceptor.java 590812 2007-10-31 20:32:54Z apetrelli $ ... */// Check if running in a servlet environment/* $Id: PortletContextAware.java 590812 2007-10-31 20:32:54Z apetrelli $ ... */import PortletPreferences/** All Actions that want to have access to the portlet preferences should ... *//* $Id: PortletPreferencesAware.java 557544 2007-07-19 10:03:06Z nilsga $ ... *//** PrincipalProxy implementation for using PortletRequest Principal related methods. *//* $Id: PortletPrincipalProxy.java 559107 2007-07-24 17:03:11Z jholmes $ ... *//* $Id: PortletRequestAware.java 590812 2007-10-31 20:32:54Z apetrelli $ ... *//* $Id: PortletResponseAware.java 590812 2007-10-31 20:32:54Z apetrelli $ ... */import DirectRenderFromEventActionimport static PortletConstants.*PortletPhase phaserestoreStack(...)saveStack(...)ActionResponse actionResponsesetRenderParameter(...)RenderRequest requestisProperPrg(...)CompoundRoot oldRootValueStack currentStackPortletStateInterceptor.class/* $Id: PortletStateInterceptor.java 601698 2007-12-06 10:59:38Z nilsga $ ... */import ReadOnlyExceptionimport ValidatorException/** Simple portlet preferences implementation that uses a map in the Session ... */String PREFERENCES_KEY, ...;String[] val/* $Id: ServletPortletPreferences.java 557544 2007-07-19 10:03:06Z nilsga $ ... *//** Portlet modification of the {@link ServletActionRedirectResult}. ... */List<String> prohibitedResultParam, ...;String portletNamespacePortletConstants.PORTLET_NAMESPACEMap<PortletMode,String> namespaceMapgetNamespaceMap(...)/* $Id: PortletActionRedirectResult.java 590812 2007-10-31 20:32:54Z apetrelli $ ... */import PortletRequestDispatcher/** Result type that includes a JSP to render. */boolean useDispatcherServlet, ...;String dispatcherServletName, ...;PortletMode portletMode, ...;PortletResultHelper resultHelper, ...;determineResultHelper(...)this.resultHelpernew PortletResultHelperJSR286(...)new PortletResultHelperJSR168(...)/** Execute the result. Obtains the ... */executeMimeResult(...)isEvent(...)executeActionResult(...)executeRegularServletResult(...)/** Executes the regular servlet result. ... *//** Executes the action result. ... */Map<String,Object> sessionMapconvertQueryParamsToRenderParams(...)PortletConstants.ACTION_PARAMPortletConstants.MODE_PARAM/** Converts the query params to render params. ... *//** Executes the render result. ... */PortletRequest reqPortletResponse resPortletRequestDispatcher dispatchergetNamedDispatcher(...)/** Sets the content type. ... *//** Sets the title. ... */this.useDispatcherServletthis.dispatcherServletNamePortletConstants.DEFAULT_DISPATCHER_SERVLET_NAMEPortletResult.class/* $Id: PortletResult.java 582626 2007-10-07 13:26:12Z mrdon $ ... */// View is rendered with a view action...luckily...// View is rendered outside an action...uh oh...import javax.portlet.*/** PortletResultHelper abstracts Portlet API result functions specific to the used API spec version. ... *//** Set a render parameter, abstracted from the used Portlet API version ... *//** Set a portlet mode, abstracted from the used Portlet API version ... *//** Call a dispatcher's include method, abstracted from the used Portlet API version. ... *//** PortletResultHelperJSR168 implements PortletResultHelper for Portlet 1.0 API (JSR168). ... *//** Set a render parameter, abstracted from the used Portlet API version. This implementation assumes that the given ... *//** Set a portlet mode, abstracted from the used Portlet API version. This implementation assumes that the given ... *//** Call a dispatcher's include method, abstracted from the used Portlet API version. This implementation assumes ... */RenderRequest reqRenderResponse res/** PortletResultHelperJSR286 implements PortletResultHelper for Portlet 2.0 API (JSR286). ... */MimeResponse resexecuteRenderResult(...)/** Executes the result ... */ActionResponse resgetActionResponse(...)/** Creates a Velocity context from the action, loads a Velocity template and ... *//** Retrieve the content type for this template. <br>People can override ... *//** Retrieve the encoding for this template. <br>People can override this ... *//** Given a value stack, a Velocity engine, and an action invocation, this ... */PortletVelocityResult.class/* $Id: PortletVelocityResult.java 582626 2007-10-07 13:26:12Z mrdon $ ... */// always flush the writer (we used to only flush it if this was a// jspWriter, but someone asked// to do it all the time (WW-829). Since Velocity support is being// deprecated, we'll oblige :)import HttpSessionContext/** Wrapper object exposing a {@link PortletSession} as a {@link HttpSession} instance. ... */PortletSession portletSession, ...;this.portletSessiongetCreationTime(...)getLastAccessedTime(...)getMaxInactiveInterval(...)Enumeration<> attrNamesisNew(...)setMaxInactiveInterval(...)/** Get the wrapped portlet session. ... *//* $Id: PortletHttpSession.java 590812 2007-10-31 20:32:54Z apetrelli $ ... *//** Wrapper object exposing a {@link PortletConfig} as a {@link ServletConfig} instance. ... */PortletConfig portletConfig, ...;this.portletConfig/** Get the {@link PortletContext} as a {@link PortletServletContext} instance. ... *//** Will return the portlet name. ... *//** Get the wrapped {@link PortletConfig} instance. ... *//* $Id: PortletServletConfig.java 590812 2007-10-31 20:32:54Z apetrelli $ ... *//** Wrapper object exposing a {@link PortletContext} as a {@link ServletContext} instance. ... */PortletContext portletContext, ...;this.portletContextgetMimeType(...)getMinorVersion(...)/** Returns a {@link PortletServletRequestDispatcher} wrapping the {@link PortletRequestDispatcher} ... */new PortletServletRequestDispatcher(...)getPortletContextName(...)/** Get the wrapped {@link PortletContext} instance. ... *//* $Id: PortletServletContext.java 590812 2007-10-31 20:32:54Z apetrelli $ ... */import ServletInputStream/** Wrapper object exposing a {@link InputStream} from a portlet as a {@link ServletInputStream} instance. ... */InputStream portletInputStream, ...;this.portletInputStream/** Get the wrapped {@link InputStream} instance. ... *//* $Id: PortletServletInputStream.java 590812 2007-10-31 20:32:54Z apetrelli $ ... *//** Wrapper object exposing a {@link OutputStream} from a portlet as a {@link ServletOutputStream} instance. ... */OutputStream portletOutputStream, ...;this.portletOutputStream/** Get the wrapped {@link OutputStream} instance. ... *//* $Id: PortletServletOutputStream.java 590812 2007-10-31 20:32:54Z apetrelli $ ... *//** Wrapper object exposing a {@link PortletRequest} as a ... */PortletRequest portletRequest, ...;Map<String,String[]> extraParams, ...;this.portletRequestthis.extraParamsgetAuthType(...)/** Not allowed in a portlet. ... *//** Gets a property from the {@link PortletRequest}. Note that a ... *//** Gets the property names from the {@link PortletRequest}. Note that a ... */getPropertyNames(...)/** Gets the values for the specified property from the ... */getRequestedSessionId(...)/** A {@link PortletRequest} has no servlet path. But for compatibility with ... *//** Get the {@link PortletSession} as a {@link PortletHttpSession} instance. ... */new PortletHttpSession(...)isRequestedSessionIdValid(...)/** Gets an attribute value on the {@link PortletRequest}. If the attribute ... *//** Can only be invoked in the event phase. ... *//** Can only be invoked in the event phase. When invoked in the event phase, ... */new PortletServletInputStream(...)getPortletInputStream(...)getLocalAddr(...)getLocalPort(...)getLocales(...)getRemoteAddr(...)getRemoteHost(...)getRemotePort(...)/** Get the {@link PortletRequestDispatcher} as a ... *//** Get the wrapped {@link PortletRequest} instance. ... *//* $Id: PortletServletRequest.java 590812 2007-10-31 20:32:54Z apetrelli $ ... */// Check if the parameter is overriden in the extra paramsPortletRequestDispatcher portletRequestDispatcher, ...;this.portletRequestDispatchergetPortletRequest(...)PortletResponse respgetPortletResponse(...)PortletException e/* $Id: PortletServletRequestDispatcher.java 590812 2007-10-31 20:32:54Z apetrelli $ ... */PortletResponse portletResponse, ...;this.portletResponseaddProperty(...)new PortletServletOutputStream(...)getPortletOutputStream(...)resetBuffer(...)/* $Id: PortletServletResponse.java 590812 2007-10-31 20:32:54Z apetrelli $ ... */import MimeResponse/** PortletServletResponseJSR286. ... */PortletServletResponseJSR286.classimport PortletSecurityExceptionimport PortletURL/** Helper class for creating Portlet URLs. Portlet URLs are fundamentally different from regular ... */String ENCODING, ...;String PORTLETMODE_NAME_EDIT, ...;String PORTLETMODE_NAME_VIEW, ...;String PORTLETMODE_NAME_HELP, ...;String URLTYPE_NAME_ACTION, ...;String URLTYPE_NAME_RESOURCE, ...;/** Create a portlet URL with for the specified action and namespace. ... */StringBuilder resultingActionint paramStartIndexMap<String,String[]> portletParamsensureParamsAreStringArrays(...)Object urlcreateUrl(...)prependNamespace(...)String queryStrString paramValPortletURL portletUrlRenderResponse responsegetRenderResponse(...)PortletURL urlcreateActionURL(...)createRenderURL(...)setSecure(...)PortletSecurityException e/** Prepend the namespace configuration for the specified namespace and PortletMode. ... */getPortletNamespace(...)PortletMode mode/** Encode an url to a non Struts action resource, like stylesheet, image or ... */encodeUrl(...)RenderResponse resp/** Will ensure that all entries in <code>params</code> are String arrays, ... */new LinkedHashMap<String,String[]>(...)/** Convert the given String to a WindowState object. ... */WindowState stateWindowState.MAXIMIZEDWindowState.NORMAL/** Convert the given String to a PortletMode object. ... */PortletUrlHelper.class/* $Id: PortletUrlHelper.java 582626 2007-10-07 13:26:12Z mrdon $ ... */// TEMP BUG-WORKAROUND FOR DOUBLE ESCAPING OF AMPERSAND// Relative URLs are not allowed in a portletimport BaseURL/** PortletUrlJSR286Helper. ... */MimeResponse respMimeResponse responseBaseURL urlcreateResourceURL(...)PortletUrlHelperJSR286.classimport ResourceUtil/* Struts results are constructed for each result execeution ... *//** allow parameterization of the contentType the default being text/html ... */executeResourceResult(...)ResourceResponse responsegetResourceResponse(...)/** This method is called from {@link #doExecute(String, ActionInvocation)} ... *//** the default implementation of postTemplateProcess applies the contentType ... *//** Called before the execution is passed to template.process(). This is a ... *//* $Id: PortletFreemarkerResult.java 564599 2007-08-10 14:05:17Z nilsga $ ... */import MockMimeResponsePortletContext portletCtxnew MockPortletContext(...)new MockMimeResponse(...)PortletUrlRenderer renderernew PortletUrlRenderer(...)UrlProvider componentgetUrlProvider(...)UrlProvider provider// creates new empty ActionContextimport MockObjectTestCaseMock mockPortletContext, ...;PortletContext.classPortletApplicationMap mapwill(...)returnValue(...)stubs(...)Enumeration<> namesnew Enumeration<>(...) { ... }List<> keys, ...;Iterator<> it, ...;Enumeration<> initParamNamesSet<String> keySetSet<String> expectedKeysSet<Entry<String,Object>> entrySetArrayList<String> dummy/* $Id: PortletApplicationMapTest.java 557544 2007-07-19 10:03:06Z nilsga $ ... */// test iterator/** PortletRequestMapTest. Insert description. */PortletRequestMap mapMockPortletRequest requestSet<> entriescheckEntry(...)/* $Id: PortletRequestMapTest.java 580134 2007-09-27 19:44:01Z nilsga $ ... *//** PortletSessionMapTest. Insert description. */PortletSessionMap mapPortletSession sessionObject val1Object val2MockPortletRequest req/* $Id: PortletSessionMapTest.java 580134 2007-09-27 19:44:01Z nilsga $ ... */// Assert that the values has been propagated to the session// Assert that the values from the session is in the map// Assert that there are no elements in the portlet session// Assert that the element that was removed was returned and the key is no longer in the// portlet sessionimport static PortletActionContext.getActionRequestimport static PortletActionContext.getActionResponseimport static PortletActionContext.getDefaultActionForModeimport static PortletActionContext.getPhaseimport static PortletActionContext.getPortletConfigimport static PortletActionContext.getPortletNamespaceimport static PortletActionContext.getRenderRequestimport static PortletActionContext.getRenderResponseimport static PortletActionContext.getRequestimport static PortletActionContext.getResponseMock mockRenderRequest, ...;Mock mockRenderResponse, ...;Mock mockPortletConfig, ...;Mock mockActionRequest, ...;Mock mockActionResponse, ...;RenderRequest renderRequest, ...;RenderResponse renderResponse, ...;ActionRequest actionRequest, ...;ActionResponse actionResponse, ...;RenderRequest.classRenderResponse.classActionRequest.classActionResponse.classPortletConfig.classgetRenderRequest(...)getActionRequest(...)getDefaultActionForMode(...)/* $Id: PortletActionContextTest.java 557544 2007-07-19 10:03:06Z nilsga $ ... */import MockPortletConfig/** Jsr168DispatcherTest. Insert description. */String MULTIPART_REQUEST, ...;Jsr168Dispatcher dispatcher, ...;Mock mockConfig, ...;Mock mockCtx, ...;Mock mockRequest, ...;Mock mockSession, ...;Mock mockActionFactory, ...;Mock mockAction, ...;new Jsr168Dispatcher(...)setupStub(...)new ListResourceBundle(...) { ... }MockPortletContext portletContextMockPortletConfig portletConfignew MockPortletConfig(...)Map<PortletMode,ActionMapping> actionMapaddInitParameter(...)Mock mockResponseMap<String,String[]> requestParamsMap<String,String> initParamsinitPortletConfig(...)initRequest(...)setupActionFactory(...)processAction(...)/** Initialize the mock request (and as a result, the mock session) ... */PortletSession.classsetupParamStub(...)Map<String,String> newMap/** Set up stubs for the mock. ... *//* $Id: Jsr168DispatcherTest.java 602665 2007-12-09 12:11:25Z mrdon $ ... *///mockSession.expects(once()).method("setAttribute").with(new Constraint[]{eq(PortletActionConstants.LAST_MODE), eq(PortletMode.VIEW)});/** Test portlet actions for porlet 2.0 specification. */Jsr286Dispatcher dispatcher, ...;new Jsr286Dispatcher(...)PortletAwareInterceptor interceptor, ...;new PortletAwareInterceptor(...)PortletRequest.classPortletRequestAware actionPortletRequestAware.class/* $Id: PortletAwareInterceptorTest.java 590812 2007-10-31 20:32:54Z apetrelli $ ... */import DefaultActionSupportimport static PortletConstants.EVENT_ACTIONimport static PortletConstants.STACK_FROM_EVENT_PHASEPortletStateInterceptor interceptor, ...;new PortletStateInterceptor(...)RenderRequest renderRequestValueStack eventPhaseStackValueStack resultingStacknew DefaultActionSupport(...)new DirectRenderFromEventAction(...)/* $Id: PortletStateInterceptorTest.java 590812 2007-10-31 20:32:54Z apetrelli $ ... */import TestRunnerimport static ActionContext.PARAMETERSimport static ActionContext.SESSIONimport static PortletConstants.RENDER_DIRECT_LOCATION/** PortletResultTest. Insert description. */Mock mockProxy, ...;Mock mockRequestMock mockRdPortletRequestDispatcher.classPortletRequestDispatcher rdConstraint[] paramssame(...)ActionContext ctxMapPortletResult resultnew PortletResult(...)atLeastOnce(...)PortletResultTest.class/* $Id: PortletResultTest.java 564926 2007-08-11 14:31:18Z nilsga $ ... */import PortletModeExceptionimport WindowStateExceptionMockUrl url, ...;Map<String,String> modeNamespaceMapnew MockUrl(...)WindowState windowState, ...;Map<String,String[]> parameters, ...;/* $Id: PortletUrlHelperTest.java 564967 2007-08-11 20:20:33Z nilsga $ ... */import static StrutsStatics.STRUTS_PORTLET_CONTEXTMock mockHttpReq, ...;Mock mockHttpRes, ...;Mock mockPortletReq, ...;Mock mockPortletRes, ...;Mock mockPageCtx, ...;Mock mockPortletUrl, ...;MockJspWriter mockJspWriter, ...;PortletUrlTagTest.classMap<> modeMapMap<> contextMapPageContext.classPortletURL.classnew ParamMapConstraint(...)ParamTag paramTag2Map<> myExpectedMap, ...;Map<> myActualMap, ...;boolean allSameString[] expectedString[] actualdescribeTo(...)Iterator<String> it/* $Id: PortletUrlTagTest.java 609901 2008-01-08 08:18:23Z nilsga $ ... */import TilesContainerimport TilesExceptionimport TilesAccessimport Requestimport RenderPortletRequest/** Dedicated Tile result to be used in Portlet environment ... */String TILES_ACTION_NAME, ...;TilesContainer containergetCurrentContainer(...)Request currentRequestnew RenderPortletRequest(...)TilesAccess.CURRENT_CONTAINER_ATTRIBUTE_NAMETilesAccess.CONTAINER_ATTRIBUTEimport ContentTypeHandler/** Manages content type handlers */String STRUTS_REST_HANDLER_OVERRIDE_PREFIX, ...;/** Gets the handler for the request by looking at the request content type and extension ... *//** Gets the handler for the response by looking at the extension of the request ... *//** Handles the result using handlers to generate content type-specific content ... *//** Finds the extension in the url ... *//** Uses the content handler to apply the request body to the action */ContentTypeHandlerManager selector, ...;this.selectorContentTypeHandler handlergetHandlerForRequest(...)toObject(...)/** Manages {@link ContentTypeHandler} instances and uses them to ... */Map<String,ContentTypeHandler> handlersByExtension, ...;/** ContentTypeHandlers keyed by the extension */Map<String,ContentTypeHandler> handlersByContentType, ...;/** ContentTypeHandlers keyed by the content-type */String defaultExtension, ...;this.defaultExtensionContentTypeHandler.classString overrideNamethis.handlersByExtensionString typeOnlythis.handlersByContentTypefindExtension(...)getExtensionIfPresent(...)String acceptHeaderString[] typesfindHandler(...)readResultCode(...)Integer statusCodereadStatusCode(...)getHandlerForResponse(...)String extCodefromObject(...)/** Gets the extension in the url ... */int dotPosint slashPosnew HashMap<String,ContentTypeHandler>(...)// Check for overriding handlers for the current extension// overriding handler has already been registered//dont store character encoding// strip off encoding and search again (e.g., application/json;charset=ISO-8859-1)import static HttpServletResponse.*/** Default implementation of rest info that uses fluent-style construction */Object etag, ...;Object locationId, ...;boolean disableCaching, ...;boolean noETag, ...;Date lastModified, ...;this.etagthis.noETagthis.locationIdthis.disableCachinggetRequestURL(...)int lastDotboolean etagNotChangedboolean lastModifiedNotChangedString reqETagString headerIfModifiedSincecompareIfModifiedSince(...)Date requestLastModified/** Type-safe rest-related information to apply to a response *//** Applies the configured information to the response ... */import HtmlHandler/** Extends the usual {@link ActionInvocation} to add support for processing the object returned ... */ContentTypeHandlerManager handlerSelector, ...;boolean logger, ...;String defaultErrorResultName, ...;boolean restrictToGet, ...;HttpHeaders httpHeaders, ...;boolean isFirstInterceptor, ...;boolean hasErrors, ...;this.defaultErrorResultName/** If set to true (by default) blocks returning content from any other methods than GET, ... */this.restrictToGetthis.handlerSelectorboolean executeResultlong middleTimeprocessResult(...)logger(...)selectTarget(...)disableCatching(...)/** Execute the current result. If it is an error and no result is selected load ... */updateStatusFromResult(...)handleResult(...)/** Get the status code from HttpHeaderResult and it is saved in the HttpHeaders object. */int status/** Find the most appropriate result: ... */boolean isHttpHeaderResultshouldRestrictToGET(...)// or backward compatible restrictToGET flag is set to true// don't return any content for PUT, DELETE, and POST where there are no errorslong endTimelong processResultlong totalRestActionInvocation.class// Normal invoke without execute the result// Execute the result when the last interceptor has finished// Error processing the result// Log execution + result time// Select the target// Get the httpHeaders// Apply headers// Don't return content on a not modified// Get handler by representation// get the result// execute the result to apply headers and status in every representations// Specific representation (json, xml...)// Normal struts execution (html o other struts result)// Find result by resultCode// Get default error result// Select target (content to return)// Exception// Error messages// Model// No cacheString POST, ...;String PUT, ...;String DELETE, ...;String OPTIONS, ...;String indexMethodName, ...;String getMethodName, ...;String postMethodName, ...;String editMethodName, ...;String newMethodName, ...;String deleteMethodName, ...;String putMethodName, ...;String optionsMethodName, ...;String postContinueMethodName, ...;String putContinueMethodName, ...;this.indexMethodNamethis.getMethodNamethis.postMethodNamethis.editMethodNamethis.newMethodNamethis.deleteMethodNamethis.putMethodNamethis.optionsMethodNamethis.postContinueMethodNamethis.putContinueMethodNamehandleDynamicMethodInvocation(...)int scPosint prevSlashPosisOptions(...)isExpectContinue(...)/** Parses the name and namespace from the uri.  Uses the configured package ... */String expectRestActionMapper.class// cut off any ;jsessionid= type appendix but allow the rails-like ;edit// fun trickery to parse 'actionName/id/methodName' in the case of 'animals/dog/edit'//WW-4589 do not overwrite explicit method name// Handle uris with no id, possibly ending in '/'// Index e.g. foo// Creating a new entry on POST e.g. foo// Handle uris with an id at the end// Viewing the form to edit an item e.g. foo/1;edit// cut off the id parameter, even if a method is specified// WW-4585// add any ; appendix to name, it will be handled later in getMapping method/** Factory that creates the {@link RestActionInvocation} */String STRUTS_REST_NAMESPACE, ...;new RestActionInvocation(...)/** Extends {@link ActionSupport} to provides a default implementation of the index method that can be invoked for ... */String DIVIDER, ...;/** Default execution. ... *//** Inspect the implemented methods to know the allowed http methods. ... */String methodsMethod[] methsDefaultHttpHeaders httpHeaderswithStatus(...)/** By default, return continue. ... */import static HttpServletResponse.SC_BAD_REQUESTContentTypeHandlerManager manager, ...;int validationFailureStatusCode, ...;this.validationFailureStatusCodethis.manager/** Intercept {@link ActionInvocation} and processes the errors using the {@link org.apache.struts2.rest.handler.ContentTypeHandler} ... */HttpHeaders inforenderResult(...)RestWorkflowInterceptor.class/** Handles transferring content to and from objects for a specific content type *//** Populates an object using data from the input stream ... *//** Writes content to the stream ... *//** Gets the content type for this handler ... *//** Gets the extension this handler supports ... *//** Handles the default content type for requests that originate from a browser's HTML form ... */String CONTENT_TYPE, ...;/** No transformation is required as the framework handles this data ... *//** Handles HTML content, usually just a simple passthrough to the framework */import ObjectMapperimport ObjectReaderimport SerializationFeature/** Handles JSON content using jackson-lib */ObjectMapper mapper, ...;ObjectReader orreaderForUpdating(...)SerializationFeature.WRITE_NULL_MAP_VALUESreadValue(...)new ObjectMapper(...)/* $Id: JsonLibHandler.java 1097172 2011-04-27 16:36:54Z jogep $ ... */import JSONArrayimport JSONObjectimport JsonConfig/** Handles JSON content using json-lib */JSONArray jsonArraynew JsonConfig(...)JSONObject jsonObjecttoBean(...)import XStream/** Handles XML content */XStream xstreamcreateXStream(...)toXML(...)new XStream(...)import FormUrlEncodedHandlerimport static HttpServletResponse.SC_NOT_MODIFIEDimport static HttpServletResponse.SC_OKDefaultContentTypeHandlerManager mgr, ...;MockHttpServletResponse mockResponse, ...;MockHttpServletRequest mockRequest, ...;new DefaultContentTypeHandlerManager(...)String objnew ContentTypeHandler(...) { ... }mgr.handlersByExtensionsetDefaultExtension(...)Mock mockHandlerXmlMock mockHandlerJsonMock mockHandlerXmlOverrideDefaultContentTypeHandlerManager mgrMap<String,ContentTypeHandler> handlersContentTypeHandlerManager.STRUTS_REST_HANDLER_OVERRIDE_PREFIX/** Assert that the request content-type and differ from the response content type */Mock mockHandlerFormFormUrlEncodedHandler.CONTENT_TYPEDefaultContentTypeHandlerManager handlerManagerContentTypeHandler handler, ...;DefaultContentTypeHandlerManager.STRUTS_REST_HANDLER_OVERRIDE_PREFIXSet<String> handlersDefaultHttpHeaders headerswithETag(...)getGMTDateFormat(...)String allowRestActionInvocation restActionInvocation, ...;new RestActionInvocationTester(...)/** Test the correct action results: null, String, HttpHeaders, Result ... */restActionInvocation.httpHeadersHttpServletResponse.SC_ACCEPTEDConfigurationException c/** Test the target selection: exception, error messages, model and null ... */RestActionSupport actionRestAction restActionList<String> modelrestActionInvocation.targetrestAction.modelsetRestrictToGet(...)/** Test the not modified status code. ... *//** Test the default error result. ... */setDefaultErrorResultName(...)/** Test the global execution ... */MockInterceptor mockInterceptornew RestAction(...)setMimeTypeHandlerSelector(...)List<String> model, ...;// ko// ok, object not allowed// Model with get and no content in post, put, delete// disable content restriction to GET only// ok, no result// Default index method return 'success'// Define result 'success'RestActionMapper mapper, ...;String allowDynamicMethodInvocation, ...;new RestActionMapper(...)setServletPath(...)tryUri(...)setRemoteAddr(...)// allow DMIimport AnyConstraintMatcherRestWorkflowInterceptor wfnew RestWorkflowInterceptor(...)Mock mockActionProxyMock mockContentTypeHandlerManagerContentTypeHandlerManager.classsetValidationFailureStatusCode(...)new AnyConstraintMatcher(...) { ... }setContentTypeHandlerManager(...)/* $Id: RestWorkflowInterceptor.java 666756 2008-06-11 18:11:00Z hermanns $ ... */boolean important, ...;this.importantContact contactcontact.agecontact.importantcontact.namenew Contact(...)JacksonLibHandler handlernew JacksonLibHandler(...)String dataContact targetStringReader readerList<Contact> sourcenew ArrayList<Contact>(...)List<Contact> target/* $Id: JsonLibHandlerTest.java 1097172 2011-04-27 16:36:54Z jogep $ ... */JsonLibHandler handlernew JsonLibHandler(...)String javaHomeString commandString[] programArgsFile wdFile[] jarsFile toolsfindJars(...)File jarprogramArgs.lengthcheckWebAppArgs(...)launch(...)int colonURL[] urlArraynew MainClassLoader(...)Method main/** Reverses the typical order of classloading to defer only to the parent if the current class loader can't be ... */// use all the jars in the current that aren't the src jar// ... but there might not be any (ie: we're in development in IDEA), so use this as backup// load tools.jar from JAVA_HOME// hmm, not there, how about java.home?// try the OS X common path// try the other OS X common path// did the user specify it by hand?// finally, add the verified tools.jar//this is OK to skip// First, check if the class has already been loaded// If still not found, only then ask the parentimport DOTRenderer/** <!-- START SNIPPET: javadocs-intro --> ... */String configDir, ...;String views, ...;this.configDirthis.viewsthis.outputString configDirgetArg(...)String viewsSiteGraph siteGraphnew SiteGraph(...)SiteGraph.classString usage/** Prepares the dot generated content and writes out to the provided writer ... */DOTRenderer renderernew DOTRenderer(...)/** Invokes the dot command, cause GraphViz to render out.dot in the form of out.gif, ... */exec(...)getRuntime(...)/** <!-- START SNIPPET: example-api --> *//** <!-- END SNIPPET: example-api --> */import FreeMarkerViewimport JspViewimport VelocityViewimport View/** Initializes and retrieves XWork config elements */...[] views, ...;boolean isXWorkStarted, ...;Map<String,View> viewCache, ...;ConfigurationManager cm, ...;/** Returns a Map of all action names/configs ... */initXWork(...)String configFilePathFile configFileConfigurationProvider configProvider/** Return a Set of the action names for this namespace. ... *//** Returns the ActionConfig for this action name at this namespace. ... */Map<> allActionConfigsMap<> actionMappingsMap<> resultMapgetResultConfig(...)String viewRootFile viewFilegetViewFileInternal(...)StringBuilder filePathString viewIdView viewgetViewFile(...)View.TYPE_JSPnew JspView(...)View.TYPE_FTLnew FreeMarkerView(...)View.TYPE_VMnew VelocityView(...)StrutsConfigRetriever.configDirStrutsConfigRetriever.viewsStrutsConfigRetriever.classnew LinkedHashMap<String,View>(...)import LinkString contents, ...;this.contentsTreeSet<Target> targetsnew TreeSet<Target>(...)matchPatterns(...)getLinkPattern(...)Link.TYPE_HREFgetActionPattern(...)Link.TYPE_ACTIONgetFormPattern(...)Link.TYPE_FORMString actionRegexBufferedReader inFileBasedView.class// get the contents as a single line// links// forms// FIXME: work with new configuration style//Object ext = Settings.get(StrutsConstants.STRUTS_ACTION_EXTENSION);Target target1target1.typetarget1.targeto.target/** TODO Describe View */int TYPE_JSP, ...;int TYPE_VM, ...;int TYPE_FTL, ...;/** Name of view file ... *//** Returns Set of Commands linked to by this view ... */Set<Link> links, ...;Map<String,SiteGraphNode> nodeMap, ...;this.linksnew TreeSet<Link>(...)SubGraph subGraphnew IndentWriter(...)SiteGraphNode siteGraphNodeLink linknew LinkedHashMap<String,SiteGraphNode>(...)// write out the header// render all the subgraphs// render all the nodes// finally, render the links// and now the footer// not absolute, so use the reference nodeint TYPE_FORM, ...;int TYPE_ACTION, ...;int TYPE_HREF, ...;int TYPE_RESULT, ...;int TYPE_REDIRECT, ...;SiteGraphNode from, ...;SiteGraphNode to, ...;this.fromthis.togetColor(...)getRealLabel(...)getFullName(...)Link otherother.fromother.toother.labelSubGraph parent, ...;String parentPrefixcleanName(...)List<SubGraph> subGraphs, ...;List<SiteGraphNode> nodes, ...;this.subGraphsnew ArrayList<SubGraph>(...)new ArrayList<SiteGraphNode>(...)Graph.nodeMapSubGraph lastfindSubGraph(...)new SubGraph(...)addSubGraph(...)// write the header// write out the subgraphs// write out the actions// .. footerimport StrutsConfigRetrieverimport org.apache.struts2.sitegraph.model.*/** Renders flow diagram to the console at info level */List<TempLink> links, ...;Graph graphnew Graph(...)TreeMap<ViewNode,View> viewMapnew TreeMap<ViewNode,View>(...)new Comparator<ViewNode>(...) { ... }ActionNode actionnew ActionNode(...)Set<String> resultNamesgetViewLocation(...)addTempLink(...)Link.TYPE_RESULTViewNode viewnew ViewNode(...)stripLocation(...)View viewFilegetView(...)String locationConfigLink.TYPE_REDIRECTEntry<ViewNode,View> viewNodeViewEntryMap<>.Entry<ViewNode,View>Set<Target> targetsgetTargets(...)Target targetString viewTargetTempLink temptemp.locationSiteGraphNode tofindNode(...)temp.nodetemp.labeladdLink(...)new Link(...)temp.typeResultnew TempLink(...)int typeString viewSiteGraphNode node, ...;int typeResult, ...;this.typeResultTempLink tempLinktempLink.typeResulttempLink.labeltempLink.locationtempLink.nodenew ArrayList<TempLink>(...)//  FIXME: work with new configuration style                        // check if the redirect is to an action -- if so, link it//  FIXME: work with new configuration style// now look for links in the view// finally, let's match up these links as real Link objects//writer.write(graph.to_s(true));SiteGraphTest.classURL compare// use the classloader rather than relying on the// working directory being an assumed value when// running the test:  so let's get this class's parent dirimport HTMLPageimport RequestConstantsimport InvalidReferenceExceptionimport StrutsListener/** <p>This is a SiteMesh FreeMarker view servlet.</p> ... */Enumeration<> initpnamesStrutsListener.classFreemarkerManager.INITPARAM_TEMPLATE_PATHgetNocache(...)getNoCharsetInContentType(...)requestUrlToTemplatePath(...)freemarkerManager.ATTR_TEMPLATE_MODELpreprocessRequest(...)setBrowserCachingPolicy(...)getActionContext(...)InvalidReferenceException xStringBuilder msgBufTemplateException te/** Returns the locale used for the ... */SimpleHash hashHTMLPage htmlPageRequestConstants.PAGEString headStringWriter bufferwriteBody(...)writeHead(...)/** If the parameter "nocache" was set to true, generate a set of headers ... */freemarkerManager.EXPIRATION_DATEFreemarkerDecoratorServlet.class// template path is already handled!// Give chance to subclasses to perform preprocessing// Set cache policy// this exception is thrown if there is an error processing a reference.  We want to report these!// Attempt to set init cause, but don't freak out if the method// is not available (i.e. pre-1.4 JRE). This is required as the// constructor-passed throwable won't show up automatically in// stack traces.// Can't set init cause, we're probably running on a pre-1.4// JDK, oh well.../* Factory factory = Factory.getInstance(new Config(getServletConfig())); ... */// HTTP/1.1 + IE extensions// HTTP/1.0// Last resort for those that ignore all of the aboveimport AbstractDecoratorMapperimport Decoratorimport Pageimport DecoratorMapperimport DecoratorSelectorimport Contentimport SiteMeshContextimport Content2HTMLPageimport OldDecorator2NewDecoratorimport SiteMeshWebAppContextimport NoDecorator/** Returns a {@link OldDecorator2NewStrutsFreemarkerDecorator} decorator ... */DecoratorMapper decoratorMapper, ...;this.decoratorMapperSiteMeshWebAppContext webAppContextDecorator decoratorgetDecorator(...)new Content2HTMLPage(...)new NoDecorator(...)new OldDecorator2NewStrutsFreemarkerDecorator(...)import Configimport SiteMeshFilter/** Core Filter for integrating SiteMesh + Freemarker into ... */String SITEMESH_FACTORY, ...;/* @see com.opensymphony.module.sitemesh.Factory.SITEMESH_FACTORY */ServletContext scFactory instancenew StrutsSiteMeshFactory(...)new Config(...)Factory factorynew FreemarkerMapper2DecoratorSelector(...)getDecoratorMapper(...)/** Won't decorate the output if it finds a "decorator" flag in the request */import BaseWebAppDecorator/** Adapts a SiteMesh 2 {@link com.opensymphony.module.sitemesh.Decorator} to a ... */Decorator oldDecorator, ...;String customEncoding, ...;this.oldDecorator/** Applies the decorator, using the relevent contexts ... *//** Applies the decorator, creating the relevent contexts and delegating to ... */getURIPath(...)new DummyActionInvocation(...)/** Returns the locale used for the {@link freemarker.template.Configuration#getTemplate(String, java.util.Locale)} call. The base implementation ... *//** Gets the L18N encoding of the system.  The default is UTF-8. */// see if the URI path (webapp) is set// in a security conscious environment, the servlet container// may return null for a given URL// ok, one isn't associated with the request, so let's create one using the current Dispatcher// put in a dummy ActionSupport so basic functionality still works// delegate to the actual page decorator/** Extends OldDecorator2NewStrutsDecorator to add Struts functionality  for Freemarker */getHead(...)new SimpleHash(...)OldDecorator2NewStrutsFreemarkerDecorator.class/** Adapts a SiteMesh 2 Freemarker {@link com.opensymphony.module.sitemesh.Decorator} to a ... */// get the configuration and template// WW-1181// get the main hash// populate the hash with the page// finally, render it/** Extends OldDecorator2NewStrutsDecorator to add Struts functionality for Velocity *//** Adapts a SiteMesh 2 Velocity {@link com.opensymphony.module.sitemesh.Decorator} ... */// init (if needed)// get encoding// get the template and context// put the page in the contextimport DefaultFactory/** Determine whether a Page of given content-type should be parsed or not, avoiding inner action parsing. */shouldParsePage(...)StrutsSiteMeshFactory.classimport com.opensymphony.module.sitemesh.*import OutputConverterimport RuntimeConstantsimport VelocityViewServlet/** <p>This is a SiteMesh Velocity view servlet.</p> ... */String defaultContentType, ...;/** <p>Initializes servlet, toolbox and Velocity template engine. ... */getVelocityProperty(...)RuntimeConstants.OUTPUT_ENCODINGVelocityView.DEFAULT_OUTPUT_ENCODINGsetVelocityEngine(...)getVelocityView(...)VelocityView.CONTENT_TYPE_KEYVelocityView.DEFAULT_CONTENT_TYPEDecoratorMapper decoratorMapper/** <p>Creates and returns an initialized Velocity context.</p> ... */VelocityManager.KEY_VELOCITY_STRUTS_CONTEXTVelocityDecoratorServlet.class// do whatever we have to do to init Velocity// toolboxManager = velocityManager.getToolboxManager();// we can get these now that velocity is initialized// For non Latin-1 encodings, ensure that the charset is// included in the Content-Type header.// the charset specifier is not yet present in header.// append character encoding to default content-type// The user may have configuration issues.// For backwards compatibility with apps that used the old VelocityDecoratorServlet// that extended VelocityServlet instead of VelocityViewServlet/** Returns a {@link OldDecorator2NewStrutsVelocityDecorator} decorator ... */new OldDecorator2NewStrutsVelocityDecorator(...)/* $Id: NoneDecoratorMapper.java 651946 2008-04-27 13:41:38Z apetrelli $ ... *//** Core Filter for integrating SiteMesh into a Java web application. */setVelocityManager(...)// TODO: Remove heavy coupling on horrible SM2 Factoryimport BeanWrapperimport DefaultListableBeanFactoryimport CannotLoadBeanClassExceptionimport ClassUtilsimport DecoratingClassLoader/** Same as DefaultListableBeanFactory, but it doesn't use the constructor and class cached in RootBeanDefinition */resolveBeanClass(...)Constructor<>[] constructorsdetermineConstructorsFromBeanPostProcessors(...)getFactoryMethodName(...)instantiateUsingFactoryMethod(...)hasConstructorArgumentValues(...)getResolvedAutowireMode(...)RootBeanDefinition.AUTOWIRE_CONSTRUCTORautowireConstructor(...)instantiateBean(...)ClassLoader tempClassLoadergetTempClassLoader(...)getBeanClassName(...)DecoratingClassLoader dcltypesToMatch.lengthexcludeClass(...)getBeanClassLoader(...)new CannotLoadBeanClassException(...)getResourceDescription(...)LinkageError err// Need to determine the constructor...// No special handling: simply use no-arg constructor.import SimpleInstantiationStrategyimport BeanFactoryimport BeanInstantiationException/** Same as SimpleInstantiationStrategy, but constructor is not cached */getMethodOverrides(...)getBeanClass(...)new BeanInstantiationException(...)instantiateClass(...)instantiateWithMethodInjection(...)// Don't override the class with CGLIB if no overrides.// Must generate CGLIB subclass.import FileResourceStoreimport JarResourceStoreimport FilesystemAlterationListenerimport FilesystemAlterationMonitorimport FilesystemAlterationObserverimport XmlWebApplicationContextimport ConfigurableListableBeanFactoryReloadingClassLoader classLoader, ...;FilesystemAlterationMonitor filesystemAlterationMonitor, ...;ClassReloadingBeanFactory beanFactory, ...;boolean reloadConfig, ...;//reload the runtime configuration when a change is detectedthis.reloadConfigClassReloadingXMLWebApplicationContext.classsplitted.lengthsetAccepClasses(...)new FilesystemAlterationMonitor(...)String watchaddResourceStore(...)new JarResourceStore(...)List<File> dirsgetAllPaths(...)new ClassReloadingBeanFactory(...)setInstantiationStrategy(...)new ClassReloadingInstantiationStrategy(...)setBeanClassLoader(...)/** If root is a dir, find all the subdir paths */removeListener(...)createBeanFactory(...)prepareBeanFactory(...)//make a list of accepted classes//setup stores//make it absolute, if it is a relative path//register with the filesystemAlterationMonitor//get all subdirs//setup the bean factory//start watch thread//overwrite the class loader in the bean factory/** Constructs the spring object factory ... */StrutsConstants.STRUTS_OBJECTFACTORY_SPRING_AUTOWIREStrutsConstants.STRUTS_OBJECTFACTORY_SPRING_AUTOWIRE_ALWAYS_RESPECTStrutsConstants.STRUTS_OBJECTFACTORY_SPRING_USE_CLASS_CACHEStrutsConstants.STRUTS_OBJECTFACTORY_SPRING_ENABLE_AOP_SUPPORTboolean useClassCacheObject rootWebApplicationContextApplicationContext appContextString watchListString acceptClassesString reloadConfigRuntimeException runtimeExceptionClassReloadingXMLWebApplicationContext reloadingContextsetupReloading(...)getReloadingClassLoader(...)setUseClassCache(...)setEnableAopSupport(...)StrutsSpringObjectFactory.class//prevent class caching//we need to reload the context, so our isntance of the factory is picked upimport ConfigurableWebApplicationContext/** Unit test for {@link StrutsSpringObjectFactory}. */StrutsSpringObjectFactory facnew StrutsSpringObjectFactory(...)ConfigurableWebApplicationContext acnew XmlWebApplicationContext(...)ServletContext mscsetConfigLocations(...)// to cover situations where there will be logged an errorimport TestNGXWorkTestCase/** Base test class for TestNG unit tests.  Provides common Struts variables ... */RunTest.duDispatcher du, ...;import AbstractAttributeEvaluatorimport ServletUtilHttpServletRequest httpRequestgetServletRequest(...)I18NAttributeEvaluator.classimport PostfixedApplicationResourcegetLocalePath(...)import EvaluationExceptionOgnlUtil ognlUtilnew EvaluationException(...)StrutsAttributeEvaluator.classimport BeanModelimport StrutsBeanWrapperimport TilesFMModelRepositoryimport InvalidTemplateExceptionimport RendererreadActionContext(...)registerTilesBeanModel(...)new InvalidTemplateException(...)/** Depending how Tiles definition was defined, request can an instance of JspRequest (for JSPs) ... *//** This register dedicated BeanModel to support tiles tags. ... */BeanModel tilesBeanModelnew TilesFMModelRepository(...)JspSupportServlet.classsetSharedVariable(...)StrutsFreeMarkerAttributeRenderer.classimport ViewPreparerimport BasicPreparerFactory/** This is a basic ViewPreparer factory that uses {@link ObjectFactory} to create the ViewPreparer */createPreparer(...)StrutsPreparerFactory.classimport TilesAddAttributeimport TilesAddListAttributeimport TilesDefinitionsimport TilesPutListAttributeimport Attributeimport Definitionimport ListAttribute/** Processes tiles annotations to create {@link Definition}s and ... *//** Search strategy is as follows: ... */TilesDefinition tilesDefinitionTilesDefinition.classTilesDefinitions tilesDefinitionsTilesDefinitions.classTilesDefinition ivalue(...).length/** Builds a {@link Definition} based on given {@link TilesDefinition} with ... */Definition definitionnew Definition(...)String extendgetValueOrNull(...)extend(...)String preparerpreparer(...)setPreparer(...)setTemplateAttribute(...)buildTemplateAttribute(...)TilesPutAttribute putAttributeputAttributes(...)Attribute attributebuildPutAttribute(...)putAttribute(...)cascade(...)TilesPutListAttribute putListAttributeputListAttributes(...)buildPutListAttribute(...)createTemplateAttribute(...)template(...)String templateExpressiontemplateExpression(...)Expression expressioncreateExpressionFromDescribedExpression(...)templateType(...)setExpressionObject(...)setRole(...)role(...)setRenderer(...)new Attribute(...)ListAttribute attributenew ListAttribute(...)setInherit(...)inherit(...)TilesAddAttribute addAttributebuildAddAttribute(...)TilesAddListAttribute addListAttributeaddListAttributes(...)buildAddListAttribute(...)// see tiles DigesterDefinitionsReaderimport DefinitionsFactoryimport DefinitionPatternMatcherFactoryimport PatternDefinitionResolverimport PrefixedPatternDefinitionResolverimport RegexpDefinitionPatternMatcherFactoryimport WildcardDefinitionPatternMatcherFactoryimport ELAttributeEvaluatorimport JspExpressionFactoryFactoryimport ScopeELResolverimport TilesContextBeanELResolverimport TilesContextELResolverimport AttributeEvaluatorFactoryimport BasicAttributeEvaluatorFactoryimport DirectAttributeEvaluatorimport BasicTilesContainerFactoryimport TilesContainerFactoryExceptionimport CachingTilesContainerimport LocaleResolverimport AnyScopePropertyAccessorimport DelegatePropertyAccessorimport NestedObjectDelegatePropertyAccessorimport OGNLAttributeEvaluatorimport PropertyAccessorDelegateFactoryimport ScopePropertyAccessorimport TilesApplicationContextNestedObjectExtractorimport TilesContextPropertyAccessorDelegateFactoryimport PreparerFactoryimport ApplicationResourceimport BasicRendererFactoryimport ChainedDelegateRenderer/** Dedicated Struts factory to build Tiles container with support for: ... */String FREEMARKER_RENDERER_NAME, ...;/** The freemarker renderer name. */String PATTERN_WILDCARD, ...;/** Supported pattern types */String PATTERN_REGEXP, ...;String TILES_DEFAULT_PATTERN, ...;/** Default pattern to be used to collect Tiles definitions if user didn't configure any *//** Supported expression languages */String EL, ...;String S2, ...;String I18N, ...;new CachingTilesContainer(...)StrutsFreeMarkerAttributeRenderer freemarkerRenderernew StrutsFreeMarkerAttributeRenderer(...)registerAttributeRenderers(...)registerRenderer(...)ChainedDelegateRenderer retValuenew ChainedDelegateRenderer(...)addAttributeRenderer(...)getRenderer(...)BasicAttributeEvaluatorFactory attributeEvaluatorFactorynew BasicAttributeEvaluatorFactory(...)new DirectAttributeEvaluator(...)ELAttributeEvaluator elEvaluatorcreateELEvaluator(...)registerAttributeEvaluator(...)createStrutsEvaluator(...)createI18NEvaluator(...)createOGNLEvaluator(...)DefinitionPatternMatcherFactory wildcardFactorynew WildcardDefinitionPatternMatcherFactory(...)DefinitionPatternMatcherFactory regexpFactorynew RegexpDefinitionPatternMatcherFactory(...)PrefixedPatternDefinitionResolver<T> resolvernew PrefixedPatternDefinitionResolver<T>(...)registerDefinitionPatternMatcherFactory(...)new StrutsTilesLocaleResolver(...)Collection<ApplicationResource> resourcesnew ArrayList<ApplicationResource>(...)Set<String> definitionsgetTilesDefinitions(...)getInitParams(...)List<ApplicationResource> filteredResourcesString definitionApplicationResource resourceLocale.ROOTnew StrutsPreparerFactory(...)DefinitionsFactory.DEFINITIONS_CONFIGELAttributeEvaluator evaluatornew ELAttributeEvaluator(...)JspExpressionFactoryFactory efFactorynew JspExpressionFactoryFactory(...)ELResolver elResolvernew CompositeELResolver(...) { ... }BeanELResolver beanElResolvernew ScopeELResolver(...)new TilesContextELResolver(...)new TilesContextBeanELResolver(...)setExpressionFactory(...)setResolver(...)new StrutsAttributeEvaluator(...)new I18NAttributeEvaluator(...)PropertyAccessor objectPropertyAccessorPropertyAccessor applicationContextPropertyAccessornew NestedObjectDelegatePropertyAccessor<Request>(...)new TilesApplicationContextNestedObjectExtractor(...)PropertyAccessor anyScopePropertyAccessornew AnyScopePropertyAccessor(...)PropertyAccessor scopePropertyAccessornew ScopePropertyAccessor(...)PropertyAccessorDelegateFactory<Request> factorynew TilesContextPropertyAccessorDelegateFactory(...)PropertyAccessor tilesRequestAccessornew DelegatePropertyAccessor<Request>(...)new OGNLAttributeEvaluator(...)new TilesContainerFactoryException(...)StrutsTilesContainerFactory.classimport AbstractTilesContainerFactoryimport ServletApplicationContextimport AbstractTilesInitializernew ServletApplicationContext(...)new StrutsWildcardServletApplicationContext(...)new StrutsTilesContainerFactory(...)StrutsTilesInitializer.classimport TilesInitializerimport AbstractTilesListener/** Listener used to automatically tie Tiles support into Struts ... */new StrutsTilesInitializer(...)StrutsTilesListener.classStrutsTilesLocaleResolver.classResourceFinder finder, ...;Object pathString realPathSet<ApplicationResource> resourcesnew HashSet<ApplicationResource>(...)findResources(...)String localePathFile localFilenew StrutsApplicationResource(...)StrutsWildcardServletApplicationContext.class/** Represents a <code>&lt;add-attribute&gt;</code> element in <code>tiles.xml</code>. *//** Represents a <code>&lt;add-list-attribute&gt;</code> element in <code>tiles.xml</code>. */import Inherited/** Represents a <code>&lt;definition&gt;</code> element in <code>tiles.xml</code>. ... *//** An array of {@link TilesDefinition}s. *//** Represents a <code>&lt;put-attribute&gt;</code> element in <code>tiles.xml</code>. *//** Represents a <code>&lt;put-list-attribute&gt;</code> element in <code>tiles.xml</code>. */import StrutsTilesAnnotationProcessorimport MutableTilesContainerStrutsTilesAnnotationProcessor annotationProcessornew StrutsTilesAnnotationProcessor(...)HttpServletResponse httpResponsenew ServletRequest(...)boolean definitionValidString tileNameisValidDefinition(...)TilesException ebuildTilesDefinition(...)TilesResult.classnew TilesTestActionSingleAnnotation(...)new TilesTestActionMultipleAnnotations(...)Attribute templateAttributegetTemplateAttribute(...)Expression definitionExpressionObjectgetExpressionObject(...)Attribute putAttributeExpression putAttrExpressionObjectAttribute listAttributeList<Attribute> listValuegetListValue(...)Attribute addAttributeExpression addAttrExpressionObjectAttribute addListAttributeList<Attribute> addListValueSet<String> cascadedAttributeNamesgetCascadedAttributeNames(...)getPreparer(...)getRole(...)new TilesTestActionSingleAnnotationAllEmpty(...)StrutsUnsafeDeserializationConfig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      X    